var Task=require("task"),Cache=require("cache"),Pathing=require("pathing"),Utilities=require("utilities"),FillEnergy=function(a){this.init(a)};FillEnergy.prototype=Object.create(Task.prototype);FillEnergy.prototype.constructor=FillEnergy;FillEnergy.prototype.init=function(a){Task.call(this);this.type="fillEnergy";this.id=a;this.object=Game.getObjectById(a)};
FillEnergy.prototype.canAssign=function(a){var b;if(a.spawning||!a.carry[RESOURCE_ENERGY]||this.object.energyCapacity&&this.object.energy===this.object.energyCapacity)return!1;if(this.object.structureType===STRUCTURE_EXTENSION){switch(this.object.room.controller.level){case 7:b=100;break;case 8:b=200;break;default:b=50}if(a.carry[RESOURCE_ENERGY]<b)return!1}Task.prototype.assign.call(this,a);return!0};
FillEnergy.prototype.run=function(a){var b=this.object;(b.energy||_.sum(b.store))===(b.energyCapacity||b.storeCapacity)?Task.prototype.complete.call(this,a):b&&a.carry[RESOURCE_ENERGY]?(Pathing.moveTo(a,b,1),a.transfer(b,RESOURCE_ENERGY)===OK&&Task.prototype.complete.call(this,a)):Task.prototype.complete.call(this,a)};FillEnergy.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};FillEnergy.fromObj=function(a){return new FillEnergy(a.memory.currentTask.id)};
FillEnergy.getExtensionTasks=function(a){return _.map(_.filter(Cache.extensionsInRoom(a),function(a){return a.energy<a.energyCapacity}),function(a){return new FillEnergy(a.id)})};FillEnergy.getSpawnTasks=function(a){return _.map(_.filter(Cache.spawnsInRoom(a),function(a){return a.energy<a.energyCapacity}),function(a){return new FillEnergy(a.id)})};
FillEnergy.getTowerTasks=function(a){return _.map(_.filter(Cache.towersInRoom(a),function(a){return.8>a.energy/a.energyCapacity}).sort(function(a,c){return a.energy-c.energy}),function(a){return new FillEnergy(a.id)})};FillEnergy.getLabTasks=function(a){return _.map(_.filter(Cache.labsInRoom(a),function(a){return a.energy<a.energyCapacity}),function(a){return new FillEnergy(a.id)})};
FillEnergy.getContainerTasks=function(a){var b=_.filter(Cache.containersInRoom(a),function(a){return _.sum(a.store)<a.storeCapacity});a.storage&&_.sum(a.storage.store)<a.storage.storeCapacity&&b.unshift(a.storage);return _.map(b,function(a){return new FillEnergy(a.id)})};FillEnergy.getStorageTasks=function(a){return a.storage&&_.sum(a.storage.store)<a.storage.storeCapacity?[new FillEnergy(a.storage.id)]:[]};
FillEnergy.getLinkTasks=function(a){var b=Cache.linksInRoom(a);a=Cache.spawnsInRoom(a);if(0===b.length||0===a.length)return[];b=Utilities.objectsClosestToObj(b,a[0]);return[new FillEnergy(b[0].id)]};FillEnergy.getNukerTasks=function(a){a=Cache.nukersInRoom(a);return 0===a.length?[]:[new FillEnergy(a[0].id)]};FillEnergy.getPowerSpawnTasks=function(a){a=Cache.powerSpawnsInRoom(a);return 0===a.length?[]:[new FillEnergy(a[0].id)]};require("screeps-profiler").registerObject(FillEnergy,"TaskFillEnergy");
module.exports=FillEnergy;