var $jscomp={scope:{},findInternal:function(a,e,f){a instanceof String&&(a=String(a));for(var c=a.length,d=0;d<c;d++){var b=a[d];if(e.call(f,b,d,a))return{i:d,v:b}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[e]=f.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,e,f,c){if(e){f=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var d=a[c];d in f||(f[d]={});f=f[d]}a=a[a.length-1];c=f[a];e=e(c);e!=c&&null!=e&&$jscomp.defineProperty(f,a,{configurable:!0,writable:!0,value:e})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,f){return $jscomp.findInternal(this,a,f).v}},"es6-impl","es3");
var Cache=require("cache"),Utilities=require("utilities"),TaskCollectEnergy=require("task.collectEnergy"),TaskPickupResource=require("task.pickupResource"),TaskRally=require("task.rally"),RemoteCollector={checkSpawn:function(a,e){var f=a.name,c=Cache.creeps[f]&&Cache.creeps[f].remoteCollector||[],d=a.memory.roomType&&"cleanup"===a.memory.roomType.type?8:1;e||(e=a);0!==Cache.spawnsInRoom(e).length&&(_.filter(c,function(b){return b.spawning||300<=b.ticksToLive}).length<d&&RemoteCollector.spawn(a,e),
Memory.log&&(0<c.length||0<d)&&Cache.log.rooms[f].creeps.push({role:"remoteCollector",count:c.length,max:d}))},spawn:function(a,e){var f=[];a=a.name;var c=e.name,d,b;if(0===_.filter(Game.spawns,function(b){return!b.spawning&&!Cache.spawning[b.id]}).length)return!1;d=Math.floor(Math.min(e.energyCapacityAvailable,2400)/150);for(b=0;b<d;b++)f.push(CARRY),f.push(CARRY);for(b=0;b<d;b++)f.push(MOVE);d=_.filter(Game.spawns,function(b){return!b.spawning&&!Cache.spawning[b.id]&&b.room.energyAvailable>=Utilities.getBodypartCost(f)&&
b.room.memory.region===e.memory.region}).sort(function(b,a){return(b.room.name===c?0:1)-(a.room.name===c?0:1)})[0];if(!d)return!1;a=d.createCreep(f,"remoteCollector-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"remoteCollector",home:a,supportRoom:c});d.room.name===c&&(Cache.spawning[d.id]="number"!==typeof a);return"number"!==typeof a},assignTasks:function(a,e){var f=a.name,c=_.filter(Utilities.creepsWithNoTask(Cache.creeps[f]&&Cache.creeps[f].remoteCollector||[]),function(b){return 0<_.sum(b.carry)||
!b.spawning&&150<b.ticksToLive}),d=[];0!==c.length&&(_.forEach(c,function(b){_.forEach(TaskPickupResource.getTasks(b.room),function(a){if(!(0<_.filter(a.resource.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"pickupResource"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length)&&a.canAssign(b))return b.say("Pickup"),d.push(b.name),!1})}),_.remove(c,function(b){return-1!==d.indexOf(b.name)}),d=[],0!==c.length&&(e.collectMinerals&&e.collectMinerals.cleanupTasks&&
_.forEach(e.collectMinerals.cleanupTasks,function(b){_.forEach(_.filter(c,function(b){return b.room.name===f}),function(a){b.canAssign(a)&&(a.say("Collecting"),d.push(a.name))});_.remove(c,function(b){return-1!==d.indexOf(b.name)});d=[]}),e.collectEnergy&&e.collectEnergy.cleanupTasks&&_.forEach(e.collectEnergy.cleanupTasks,function(b){_.forEach(_.filter(c,function(b){return b.room.name===f}),function(a){b.canAssign(a)&&(a.say("Collecting"),d.push(a.name))});_.remove(c,function(b){return-1!==d.indexOf(b.name)});
d=[]}),_.forEach(e.fillEnergy.storageTasks,function(b){var a=b.object.storeCapacity-_.sum(b.object.store)-_.reduce(_.filter(b.object.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(a.memory.currentTask.type)&&a.memory.currentTask.id===b.id}),function(b,a){return b+_.sum(a.carry)},0);0<a&&(_.forEach(Utilities.objectsClosestToObj(c,b.object),function(c){if(b.canAssign(c)&&(c.say("Storage"),d.push(c.name),a-=_.sum(c.carry),0>=a))return!1}),_.remove(c,
function(b){return-1!==d.indexOf(b.name)}),d=[])}),0!==c.length&&(_.forEach(e.fillMinerals.storageTasks,function(b){_.forEach(c,function(a){b.canAssign(a)&&(a.say("Storage"),d.push(a.name))});_.remove(c,function(b){return-1!==d.indexOf(b.name)});d=[]}),0!==c.length&&(_.forEach(e.fillMinerals.terminalTasks,function(b){_.forEach(c,function(a){b.canAssign(a)&&(a.say("Terminal"),d.push(a.name))});_.remove(c,function(b){return-1!==d.indexOf(b.name)});d=[]}),0!==c.length&&(_.forEach(e.fillEnergy.containerTasks,
function(b){var a=b.object.storeCapacity-_.sum(b.object.store)-_.reduce(_.filter(b.object.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(a.memory.currentTask.type)&&a.memory.currentTask.id===b.id}),function(a,b){return a+_.sum(b.carry)},0);0<a&&(_.forEach(Utilities.objectsClosestToObj(c,b.object),function(c){if(b.canAssign(c)&&(c.say("Container"),d.push(c.name),a-=_.sum(c.carry),0>=a))return!1}),_.remove(c,function(a){return-1!==d.indexOf(a.name)}),
d=[])}),0!==c.length&&_.forEach(c,function(a){(0<_.sum(a.carry)?new TaskRally(a.memory.supportRoom):new TaskRally(a.memory.home)).canAssign(a)}))))))}};require("screeps-profiler").registerObject(RemoteCollector,"RoleRemoteCollector");module.exports=RemoteCollector;