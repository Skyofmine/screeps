var Cache=require("cache"),Commands=require("commands"),Utilities=require("utilities"),TaskRally=require("task.rally"),TaskClaim=require("task.claim"),Claimer={checkSpawn:function(b){var d=Memory.maxCreeps.claimer,c=b.name,a=Cache.creeps[c]&&Cache.creeps[c].claimer||[],e=0;d&&_.forEach(d[c],function(c,d){c=_.filter(a,function(a){return a.memory.claim===d}).length;e+=1;0===c&&Claimer.spawn(b,d)});Memory.log&&(0<a.length||0<e)&&Cache.log.rooms[c].creeps.push({role:"claimer",count:a.length,max:e})},
spawn:function(b,d){var c=Cache.spawnsInRoom(b),a=[CLAIM,MOVE];if(0===_.filter(c,function(a){return!a.spawning&&!Cache.spawning[a.id]}).length)return!1;c=_.filter(c,function(b){return!b.spawning&&!Cache.spawning[b.id]&&b.room.energyAvailable>=Utilities.getBodypartCost(a)})[0];if(!c)return!1;b=c.createCreep(a,"claimer-"+d+"-"+Game.time.toFixed(0).substring(4),{role:"claimer",home:b.name,claim:d});Cache.spawning[c.id]="number"!==typeof b;return"number"!==typeof b},assignTasks:function(b,d){b=b.name;
b=Utilities.creepsWithNoTask(Cache.creeps[b]&&Cache.creeps[b].claimer||[]);var c=[];0!==b.length&&(_.forEach(_.filter(b,function(a){return a.room.name!==a.memory.claim}),function(a){TaskRally.getClaimerTask(a).canAssign(a)&&c.push(a.name)}),_.remove(b,function(a){return-1!==c.indexOf(a.name)}),c=[],0!==b.length&&(_.forEach(b,function(a){TaskClaim.getTask(a).canAssign(a)&&(a.say("Claiming"),c.push(a.name))}),_.remove(b,function(a){return-1!==c.indexOf(a.name)}),c=[],0!==b.length&&_.forEach(b,function(a){a.room.name===
a.memory.claim&&a.room.controller.my&&a.suicide()})))}};require("screeps-profiler").registerObject(Claimer,"RoleClaimer");module.exports=Claimer;