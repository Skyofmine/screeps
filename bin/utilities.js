var $jscomp={scope:{},findInternal:function(a,d,b){a instanceof String&&(a=String(a));for(var c=a.length,e=0;e<c;e++){var f=a[e];if(d.call(b,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[d]=b.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,d,b,c){if(d){b=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var e=a[c];e in b||(b[e]={});b=b[e]}a=a[a.length-1];c=b[a];d=d(c);d!=c&&null!=d&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:d})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");
var Cache=require("cache"),Utilities={nest:function(a,d){var b,c;if(!d.length)return a;b=d[0];c=d.slice(1);return _.mapValues(_.groupBy(a,b),function(a){return Utilities.nest(a,c)})},creepsWithNoTask:function(a){return _.filter(a,function(a){return!a.memory.currentTask})},objectsClosestToObj:function(a,d){var b=d.id;if(0===a.length)return[];if(!d)return a;a=_.map(a,function(a){var c=a.id,f;Memory.ranges&&Memory.ranges[b]&&Memory.ranges[b][c]?f=Memory.ranges[b][c]:(f=d.pos.getRangeTo(a),a instanceof
Creep||d instanceof Creep||(Memory.ranges||(Memory.ranges={}),Memory.ranges[b]||(Memory.ranges[b]={}),Memory.ranges[b][c]=f));return{object:a,distance:f}});a.sort(function(a,b){return a.distance-b.distance});return _.map(a,function(a){return a.object})},getEmptyPosAroundPos:function(a){var d=0,b,c,e;for(b=a.x-1;b<a.x+2;b++)for(c=a.y-1;c<a.y+2;c++)if(b!==a.x||c!==a.y)e=new RoomPosition(b,c,a.roomName),d+=_.filter(e.look(),function(a){return"terrain"===a.type&&"wall"!==a.terrain}).length;return d},
checkSiteIsClear:function(a){var d=!0,b=a.x,c=a.y,e=a.roomName,f=Game.rooms[e];if("wall"===(new RoomPosition(b,c,e)).lookFor(LOOK_TERRAIN)[0]||"wall"===(new RoomPosition(b-1,c,e)).lookFor(LOOK_TERRAIN)[0]&&"wall"===(new RoomPosition(b+1,c,e)).lookFor(LOOK_TERRAIN)[0]||"wall"===(new RoomPosition(b,c-1,e)).lookFor(LOOK_TERRAIN)[0]&&"wall"===(new RoomPosition(b,c+1,e)).lookFor(LOOK_TERRAIN)[0])return!1;_.forEach(f.find(FIND_SOURCES),function(b){return d=1<a.getRangeTo(b)});if(!d)return!1;_.forEach(f.find(FIND_MINERALS),
function(b){return d=1<a.getRangeTo(b)});if(!d||4>=a.getRangeTo(f.controller))return!1;b=_.filter(a.lookFor(LOOK_STRUCTURES),function(a){return"rampart"!==a.structureType});return 0===b.length?!0:_.filter(b,function(a){return-1!==[STRUCTURE_ROAD,STRUCTURE_WALL].indexOf(a.structureType)}).length!==b.length?!1:b},buildStructures:function(a,d,b,c){var e=1,f=c.pos;c=f.x;for(var f=f.y,g,h,k;0<b&&50>e;){for(g=c-e;g<=c+e;g+=2){for(h=f-e;h<=f+e&&(1>g||48<g||1>h||48<h||0<_.filter(a.find(FIND_MY_CONSTRUCTION_SITES),
function(a){return a.pos.x===g&&a.pos.y===h}).length||(k=Utilities.checkSiteIsClear(new RoomPosition(g,h,a.name)),!1===k||(!0!==k&&_.forEach(k,function(a){a.destroy()}),a.createConstructionSite(g,h,d),b--,0!==b)));h+=Math.abs(c-g)===e?2:2*e);if(0===b)break}e++}},getBodypartCost:function(a){return _.sum(_.map(a,function(a){return BODYPART_COST[a]}))},getSourceLabs:function(a){var d=Cache.labsInRoom(a),b=[];_.forEach(d,function(a){if(2>=Utilities.objectsClosestToObj(d,a)[d.length-1].pos.getRangeTo(a)&&
(b.push(a.id),2<=b.length))return!1});return b},getLabToBoostWith:function(a,d){var b=a.memory.labQueue,c=b&&b.sourceLabs?b.sourceLabs:[],e=[],b=null,f;d||(d=1);0===c.length&&(c=Utilities.getSourceLabs(a));a.memory.labsInUse||(a.memory.labsInUse=[]);for(var g=0;g<d;g++){b={};f=_.filter(Cache.labsInRoom(a),function(b){return-1===c.indexOf(b.id)&&-1===_.map(a.memory.labsInUse,function(a){return a.id}).indexOf(b.id)&&-1===_.map(e,function(a){return a.id}).indexOf(b.id)});0<f.length&&(b={id:f[0].id,pause:!1});
if(!b||!b.id){b={id:_.filter(c,function(b){return-1===_.map(a.memory.labsInUse,function(a){return a.id}).indexOf(b)&&-1===_.map(e,function(a){return a.id}).indexOf(b)})[0],pause:!0};if(!b.id)return!1;f=Game.getObjectById(b.id);0<f.mineralAmount&&(b.status="emptying",b.oldResource=f.mineralType,b.oldAmount=f.mineralAmount)}if(!b.id)return!1;e.push(b)}return e},roomLabsArePaused:function(a){return a.memory.labsInUse&&0<_.filter(a.memory.labsInUse,function(a){return a.pause}).length}};
require("screeps-profiler").registerObject(Utilities,"Utilities");module.exports=Utilities;