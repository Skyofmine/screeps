var Cache=require("cache"),Utilities=require("utilities"),TaskHeal=require("task.heal"),TaskRally=require("task.rally"),Healer={checkSpawn:function(b){var d=b.name,c=Cache.creeps[d]&&Cache.creeps[d].healer||[],a=Game.rooms[Memory.rooms[d].roomType.supportRoom];1>_.filter(c,function(a){return a.spawning||300<=a.ticksToLive}).length&&Healer.spawn(b,a);Memory.log&&Cache.log.rooms[d].creeps.push({role:"healer",count:c.length,max:1})},spawn:function(b,d){var c=[];b=b.name;var a=d.name,e,f;if(0===_.filter(Game.spawns,
function(a){return!a.spawning&&!Cache.spawning[a.id]}).length)return!1;e=Math.floor(Math.min(d.energyCapacityAvailable,7500)/300);for(f=0;f<e;f++)c.push(MOVE);for(f=0;f<e;f++)c.push(HEAL);e=_.filter(Game.spawns,function(a){return!a.spawning&&!Cache.spawning[a.id]&&a.room.energyAvailable>=Utilities.getBodypartCost(c)&&a.room.memory.region===d.memory.region}).sort(function(b,c){return(b.room.name===a?0:1)-(c.room.name===a?0:1)})[0];if(!e)return!1;b=e.createCreep(c,"healer-"+b+"-"+Game.time.toFixed(0).substring(4),
{role:"healer",home:b,supportRoom:a});e.room.name===a&&(Cache.spawning[e.id]="number"!==typeof b);return"number"!==typeof b},assignTasks:function(b,d){b=b.name;b=_.filter(Utilities.creepsWithNoTask(Cache.creeps[b]&&Cache.creeps[b].healer||[]),function(a){return!a.spawning});var c=[];0!==b.length&&(_.forEach(_.filter(b,function(a){return a.room.name!==a.memory.home}),function(a){TaskRally.getDefenderTask(a).canAssign(a)&&c.push(a.name)}),_.remove(b,function(a){return-1!==c.indexOf(a.name)}),c=[],0!==
b.length&&(_.forEach(b,function(a){var b=TaskHeal.getDefenderTask(a);b&&b.canAssign(a)&&(a.say("Heal"),c.push(a.name))}),_.remove(b,function(a){return-1!==c.indexOf(a.name)}),c=[],0!==b.length&&_.forEach(_.filter(b,function(a){return a.room.name===a.memory.home}),function(a){TaskRally.getDefenderTask(a).canAssign(a)&&c.push(a.name)})))}};require("screeps-profiler").registerObject(Healer,"RoleHealer");module.exports=Healer;