var Task=require("task"),Cache=require("cache"),Pathing=require("pathing"),Ranged=function(a){this.init(a)};Ranged.prototype=Object.create(Task.prototype);Ranged.prototype.constructor=Ranged;Ranged.prototype.init=function(a){Task.call(this);this.type="rangedAttack";this.id=a;this.enemy=Game.getObjectById(a)};Ranged.prototype.canAssign=function(a){if(a.spawning||0===a.getActiveBodyparts(RANGED_ATTACK))return!1;Task.prototype.assign.call(this,a);return!0};
Ranged.prototype.run=function(a){this.enemy?0===a.getActiveBodyparts(RANGED_ATTACK)?(a.say("Help!"),Task.prototype.complete.call(this,a)):0<a.getActiveBodyparts(ATTACK)?(Pathing.moveTo(a,this.enemy),a.attack(this.enemy)===ERR_NOT_IN_RANGE&&a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a),0<a.getActiveBodyparts(RANGED_ATTACK)&&a.rangedAttack(this.enemy)):(Pathing.moveTo(a,this.enemy,3),a.rangedAttack(this.enemy),a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a)):(a.say("Get Rekt!",
!0),Task.prototype.complete.call(this,a))};Ranged.prototype.toObj=function(a){this.enemy?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};Ranged.fromObj=function(a){return new Ranged(a.memory.currentTask.id)};Ranged.getTasks=function(a){return _.map(Cache.hostilesInRoom(a).sort(function(a,b){return a.hits-b.hits}),function(a){return new Ranged(a.id)})};
Ranged.getDefenderTask=function(a){return _.map(Cache.hostilesInRoom(a.room).sort(function(a,b){return a.hits-b.hits}),function(a){return new Ranged(a.id)})[0]};require("screeps-profiler").registerObject(Ranged,"TaskRangedAttack");module.exports=Ranged;