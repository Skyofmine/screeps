var $jscomp={scope:{},findInternal:function(b,c,d){b instanceof String&&(b=String(b));for(var a=b.length,e=0;e<a;e++){var f=b[e];if(c.call(d,f,e,b))return{i:e,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,c,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[c]=d.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,c,d,a){if(c){d=$jscomp.global;b=b.split(".");for(a=0;a<b.length-1;a++){var e=b[a];e in d||(d[e]={});d=d[e]}b=b[b.length-1];a=d[b];c=c(a);c!=a&&null!=c&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,d){return $jscomp.findInternal(this,b,d).v}},"es6-impl","es3");
var Cache=require("cache"),Utilities=require("utilities"),TaskBuild=require("task.build"),TaskHarvest=require("task.harvest"),TaskPickupResource=require("task.pickupResource"),TaskRally=require("task.rally"),TaskRepair=require("task.repair"),Builder={checkSpawn:function(b){var c=b.name,d=Game.rooms[Memory.rooms[c].roomType.supportRoom],a;0!==Cache.spawnsInRoom(d).length&&(2>(a=(Cache.creeps[c]&&Cache.creeps[c].remoteBuilder||[]).length)&&Builder.spawn(b,d),Memory.log&&Cache.log.rooms[c].creeps.push({role:"remoteBuilder",
count:a,max:2}))},spawn:function(b,c){var d=[];b=b.name;var a=c.name,e,f,g;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!Cache.spawning[a.id]}).length)return!1;e=Math.min(c.energyCapacityAvailable,3300);f=Math.floor(e/200);e%=200;for(g=0;g<f;g++)d.push(WORK);150<=e&&d.push(WORK);for(g=0;g<f;g++)d.push(CARRY);100<=e&&150>e&&d.push(CARRY);for(g=0;g<f;g++)d.push(MOVE);50<=e&&d.push(MOVE);f=_.filter(Game.spawns,function(a){return!a.spawning&&!Cache.spawning[a.id]&&a.room.energyAvailable>=
Utilities.getBodypartCost(d)&&a.room.memory.region===c.memory.region}).sort(function(b,d){return(b.room.name===a?0:1)-(d.room.name===a?0:1)})[0];if(!f)return!1;b=f.createCreep(d,"remoteBuilder-"+b+"-"+Game.time.toFixed(0).substring(4),{role:"remoteBuilder",home:b,supportRoom:a});f.room.name===a&&(Cache.spawning[f.id]="number"!==typeof b);return"number"!==typeof b},assignTasks:function(b){var c=b.name,c=_.filter(Utilities.creepsWithNoTask(Cache.creeps[c]&&Cache.creeps[c].remoteBuilder||[]),function(a){return 0<
_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),d=[];if(0!==c.length&&(_.forEach(_.filter(c,function(a){return a.room.name===b.name}),function(a){0<b.find(FIND_HOSTILE_CONSTRUCTION_SITES).length&&((new TaskRally(b.find(FIND_HOSTILE_CONSTRUCTION_SITES)[0].id)).canAssign(a),a.say("Stomping"),d.push(a.name))}),_.remove(c,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==c.length&&(_.forEach(c,function(a){_.forEach(TaskRepair.getCriticalTasks(a.room),function(b){if(0===_.filter(b.structure.room.find(FIND_MY_CREEPS),
function(a){return a.memory.currentTask&&"repair"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length&&b.canAssign(a))return a.say("CritRepair"),d.push(a.name),!1})}),_.remove(c,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==c.length))){if(!b.unobservable&&(_.forEach(c,function(a){var c=b.find(FIND_MY_CONSTRUCTION_SITES);0<c.length&&(new TaskBuild(Utilities.objectsClosestToObj(c,a)[0].id)).canAssign(a)&&(a.say("Build"),d.push(a.name))}),_.remove(c,function(a){return-1!==d.indexOf(a.name)}),
d=[],0===c.length))return;_.forEach(c,function(a){a.room.name===a.memory.home&&_.forEach(TaskPickupResource.getTasks(a.room),function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Pickup"),d.push(a.name),!1})});_.remove(c,function(a){return-1!==d.indexOf(a.name)});d=[];0!==c.length&&(b.unobservable||_.forEach(c,function(a){var c=new TaskHarvest,
f=Utilities.objectsClosestToObj(_.filter(b.find(FIND_SOURCES),function(a){return 0<a.energy}),a);if(0===f.length)return!1;a.memory.homeSource=f[0].id;c.canAssign(a)&&(a.say("Harvesting"),d.push(a.name))}),_.remove(c,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==c.length&&_.forEach(c,function(a){(new TaskRally(a.memory.home)).canAssign(a)}))}}};require("screeps-profiler").registerObject(Builder,"RoleRemoteBuilder");module.exports=Builder;