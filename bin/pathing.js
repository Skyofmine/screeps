var $jscomp={scope:{},checkStringArgs:function(b,c,d){if(null==b)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return b+""}};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,c,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[c]=d.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,c,d,f){if(c){d=$jscomp.global;b=b.split(".");for(f=0;f<b.length-1;f++){var g=b[f];g in d||(d[g]={});d=d[g]}b=b[b.length-1];f=d[b];c=c(f);c!=f&&null!=c&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("String.prototype.startsWith",function(b){return b?b:function(b,d){var c=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var g=c.length,k=b.length;d=Math.max(0,Math.min(d|0,c.length));for(var h=0;h<k&&d<g;)if(c[d++]!=b[h++])return!1;return h>=k}},"es6-impl","es3");
var direction={1:{dx:0,dy:-1},2:{dx:1,dy:-1},3:{dx:1,dy:0},4:{dx:1,dy:1},5:{dx:0,dy:1},6:{dx:-1,dy:1},7:{dx:-1,dy:0},8:{dx:-1,dy:-1}},Cache=require("cache"),Pathing={moveTo:function(b,c,d){var f=[],g=b.pos,k=g.x,h=g.y,l=g.roomName,a=b.memory,n=Game.time,p,q,m,e,r;c instanceof RoomObject&&(c=c.pos);p=c.x;q=c.y;m=c.roomName;d||(d=0);if(g.getRangeTo(c)<=d)delete a._pathing;else{a._pathing&&(a._pathing.dest.x===p&&a._pathing.dest.y===q&&a._pathing.dest.room===m||delete a._pathing);a._pathing&&a._pathing.restartOn&&
-1!==a._pathing.restartOn.indexOf(l)&&(delete a._pathing.path,delete a._pathing.restartOn);a._pathing&&((e=k===a._pathing.start.x&&h===a._pathing.start.y&&l===a._pathing.start.room,a._pathing.stationary=e?a._pathing.stationary+1:0,2<=a._pathing.stationary)?(a._pathing.path&&0<a._pathing.path.length&&(e=direction[+a._pathing.path[0]],e={x:k+e.dx,y:h+e.dy,room:l,blockedUntil:n+12},e.x!==k||e.y!==h)&&(a._pathing.blocked||(a._pathing.blocked=[]),a._pathing.blocked.push(e)),delete a._pathing.path,delete a._pathing.restartOn):
a._pathing.path&&!e&&(1===a._pathing.path.length?delete a._pathing:(a._pathing.start={x:k,y:h,room:l},a._pathing.path=a._pathing.path.substring(1))));if(!a._pathing||!a._pathing.path)if(e=b.getActiveBodyparts(MOVE),r=1+(_.filter(b.body,function(a){return 0<a.hits&&-1===[MOVE,CARRY].indexOf(a.type)}).length+Math.ceil(_.sum(b.carry)/50)-e)/e,a._pathing&&a._pathing.blocked&&_.remove(a._pathing.blocked,function(a){return a.blockedUntil<=n}),e=l+"."+k+"."+h+"."+m+"."+p+"."+q+"."+d+"."+(1>=r?"0":"1"),a._pathing&&
0!==a._pathing.blocked.length||!Memory.paths[e]){c=PathFinder.search(g,{pos:c,range:d},{plainCost:Math.ceil(1*r),swampCost:Math.ceil(5*r),maxOps:l===m?2E3:1E5,roomCallback:function(c){var d=Game.rooms[c],e;if(-1!==Memory.avoidRooms.indexOf(c)||l===m&&c!==m&&!b.memory.role.startsWith("remote"))return!1;if(d)return e=Cache.getCostMatrix(d),a._pathing&&c===l&&_.forEach(a._pathing.blocked,function(a){c===a.room&&n<a.blockedUntil&&e.set(a.x,a.y,255)}),e;f.push(c)}});if(!c.path||0===c.path.length)return;
a._pathing?(a._pathing.path=Pathing.serializePath(g,c.path),a._pathing.restartOn=f):a._pathing={start:{x:k,y:h,room:l},dest:{x:p,y:q,room:m},path:Pathing.serializePath(g,c.path),stationary:0,blocked:[],restartOn:f};0===a._pathing.blocked.length&&(Memory.paths[e]={path:a._pathing.path,restartOn:f,firstUsed:n,lastUsed:n})}else a._pathing?(a._pathing.path=Memory.paths[e].path,a._pathing.restartOn=Memory.paths[e].restartOn):a._pathing={start:{x:k,y:h,room:l},dest:{x:p,y:q,room:m},path:Memory.paths[e].path,
stationary:0,blocked:[],restartOn:Memory.paths[e].restartOn},Memory.paths[e].lastUsed=n;b.move(+a._pathing.path[0])!==OK&&--a._pathing.stationary}},serializePath:function(b,c){return _.map(c,function(d,f){f=0===f?b:c[f-1];switch(d.x-f.x){case 0:case -49:case 49:switch(d.y-f.y){case 0:case -49:case 49:return"";case 1:case -48:return BOTTOM.toString();case -1:case 48:return TOP.toString()}break;case 1:case -48:switch(d.y-f.y){case 0:case -49:case 49:return RIGHT.toString();case 1:case -48:return BOTTOM_RIGHT.toString();
case -1:case 48:return TOP_RIGHT.toString()}break;case -1:case 48:switch(d.y-f.y){case 0:case -49:case 49:return LEFT.toString();case 1:case -48:return BOTTOM_LEFT.toString();case -1:case 48:return TOP_LEFT.toString()}}}).join("")}};require("screeps-profiler").registerObject(Pathing,"Pathing");module.exports=Pathing;