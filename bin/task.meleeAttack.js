var Task=require("task"),Cache=require("cache"),Pathing=require("pathing"),Melee=function(a){this.init(a)};Melee.prototype=Object.create(Task.prototype);Melee.prototype.constructor=Melee;Melee.prototype.init=function(a){Task.call(this);this.type="meleeAttack";this.id=a;this.enemy=Game.getObjectById(a)};Melee.prototype.canAssign=function(a){if(a.spawning||0===a.getActiveBodyparts(ATTACK))return!1;Task.prototype.assign.call(this,a);return!0};
Melee.prototype.run=function(a){this.enemy?0===a.getActiveBodyparts(ATTACK)?(a.say("Help!"),Task.prototype.complete.call(this,a)):(Pathing.moveTo(a,this.enemy),a.attack(this.enemy)===ERR_NOT_IN_RANGE&&a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a),0<a.getActiveBodyparts(RANGED_ATTACK)&&a.rangedAttack(this.enemy)):(a.say("Get Rekt!",!0),Task.prototype.complete.call(this,a))};Melee.prototype.toObj=function(a){this.enemy?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};
Melee.fromObj=function(a){return new Melee(a.memory.currentTask.id)};Melee.getTasks=function(a){return _.map(Cache.hostilesInRoom(a).sort(function(a,b){return a.hits-b.hits}),function(a){return new Melee(a.id)})};Melee.getDefenderTask=function(a){return _.map(Cache.hostilesInRoom(a.room).sort(function(a,b){return a.hits-b.hits}),function(a){return new Melee(a.id)})[0]};require("screeps-profiler").registerObject(Melee,"TaskMeleeAttack");module.exports=Melee;