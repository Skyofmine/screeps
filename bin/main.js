var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.inherits=function(e,n){function r(){}r.prototype=n.prototype;e.superClass_=n.prototype;e.prototype=new r;e.prototype.constructor=e;for(var u in n)if(Object.defineProperties){var l=Object.getOwnPropertyDescriptor(n,u);l&&Object.defineProperty(e,u,l)}else e[u]=n[u]};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,n,r){e!=Array.prototype&&e!=Object.prototype&&(e[n]=r.value)};$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.symbolCounter_=0;$jscomp.Symbol=function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(e){var n=0;return $jscomp.iteratorPrototype(function(){return n<e.length?{done:!1,value:e[n++]}:{done:!0}})};$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();e={next:e};e[$jscomp.global.Symbol.iterator]=function(){return this};return e};$jscomp.makeIterator=function(e){$jscomp.initSymbolIterator();var n=e[Symbol.iterator];return n?n.call(e):$jscomp.arrayIterator(e)};
$jscomp.arrayFromIterator=function(e){for(var n,r=[];!(n=e.next()).done;)r.push(n.value);return r};$jscomp.arrayFromIterable=function(e){return e instanceof Array?e:$jscomp.arrayFromIterator($jscomp.makeIterator(e))};
$jscomp.iteratorFromArray=function(e,n){$jscomp.initSymbolIterator();e instanceof String&&(e+="");var r=0,u={next:function(){if(r<e.length){var l=r++;return{value:n(l,e[l]),done:!1}}u.next=function(){return{done:!0,value:void 0}};return u.next()}};u[Symbol.iterator]=function(){return u};return u};
$jscomp.polyfill=function(e,n,r,u){if(n){r=$jscomp.global;e=e.split(".");for(u=0;u<e.length-1;u++){var l=e[u];l in r||(r[l]={});r=r[l]}e=e[e.length-1];u=r[e];n=n(u);n!=u&&null!=n&&$jscomp.defineProperty(r,e,{configurable:!0,writable:!0,value:n})}};$jscomp.polyfill("Array.prototype.keys",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.values",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(e,r){return r})}},"es6","es3");$jscomp.findInternal=function(e,n,r){e instanceof String&&(e=String(e));for(var u=e.length,l=0;l<u;l++){var g=e[l];if(n.call(r,g,l,e))return{i:l,v:g}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(e,r){return $jscomp.findInternal(this,e,r).v}},"es6-impl","es3");
$jscomp.checkStringArgs=function(e,n,r){if(null==e)throw new TypeError("The 'this' value for String.prototype."+r+" must not be null or undefined");if(n instanceof RegExp)throw new TypeError("First argument to String.prototype."+r+" must not be a regular expression");return e+""};
$jscomp.polyfill("String.prototype.startsWith",function(e){return e?e:function(e,r){var n=$jscomp.checkStringArgs(this,e,"startsWith");e+="";var l=n.length,g=e.length;r=Math.max(0,Math.min(r|0,n.length));for(var d=0;d<g&&r<l;)if(n[r++]!=e[d++])return!1;return d>=g}},"es6-impl","es3");$jscomp.polyfill("Number.isFinite",function(e){return e?e:function(e){return"number"!==typeof e?!1:!isNaN(e)&&Infinity!==e&&-Infinity!==e}},"es6-impl","es3");
$jscomp.polyfill("Number.isInteger",function(e){return e?e:function(e){return Number.isFinite(e)?e===Math.floor(e):!1}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.fill",function(e){return e?e:function(e,r,u){var l=this.length||0;0>r&&(r=Math.max(0,l+r));if(null==u||u>l)u=l;u=Number(u);0>u&&(u=Math.max(0,l+u));for(r=Number(r||0);r<u;r++)this[r]=e;return this}},"es6-impl","es3");
(function(){function e(e,g){u[e]||(r[e]={exports:{},loaded:!1},u[e]=!0,0===e&&"function"===typeof require?require.main=r[0]:r[e].parent=r[g],n[e].call(this,r[e],r[e].exports),r[e].loaded=!0);return r[e].exports}var n={},r={},u={};n[0]=function(l,g){var d=e(1,0),m=e(2,0),h=e(3,0),a=e(4,0),b=e(5,0),c=e(6,0),f=e(7,0),k=e(8,0),v=e(9,0),B=e(10,0),t=e(11,0),p=e(12,0),z=e(13,0),w=e(14,0),q=e(15,0),D=e(16,0),y=e(17,0),C=e(18,0),E=e(19,0),F=e(20,0),I=e(21,0),n=e(22,0),K=e(23,0),P=e(24,0),Q=e(25,0),L=e(26,
0),A=e(27,0),R=e(28,0),S=e(29,0),T=e(30,0),U=e(31,0),M=e(32,0),N=e(33,0),r=e(34,0),O=e(35,0),V=e(36,0),u=e(37,0),x=e(38,0),W=e(39,0),X=e(40,0),J=e(41,0),H=e(42,0),Y=e(43,0),Z=e(44,0),aa=e(45,0),ba=e(46,0),ca=e(47,0),da=e(48,0),ea=e(49,0),fa=e(50,0),ga=e(51,0),ha=e(52,0),ia=e(53,0),ja=e(54,0),ka=e(55,0);g=function(){};g.loop=function(){var a=this,b=Game.cpu,c=b.bucket;c<b.tickLimit?Game.notify("Bucket at "+c.toFixed(0)+", aborting! "+Game.time.toFixed(0)):(b=function(){a.init();a.minerals();a.baseMatrixes();
a.deserializeCreeps();a.deserializeRooms();a.deserializeArmies();a.balanceEnergy();a.rooms();a.army();a.creeps();Memory.debug&&a.debug();Memory.visualizations&&a.drawGlobal();a.finalize()},Memory.profiling?d.wrap(b):b())};g.init=function(){var b=Game.time%1500;h.reset();this.reset||(this.reset=!0);h.credits<Memory.minimumCredits&&delete Memory.buy;h.credits>=1.5*Memory.minimumCredits&&(Memory.buy=!0);Game.cmd={Army:m,Cache:h,Commands:a,Market:c,Minerals:f,RoleArmyDismantler:B,RoleArmyHealer:t,RoleArmyMelee:p,
RoleArmyRanged:z,RoleClaimer:w,RoleCollector:q,RoleDefender:D,RoleDismantler:y,RoleDowngrader:C,RoleHealer:E,RoleMiner:F,RoleRemoteBuilder:I,RoleRemoteCollector:n,RoleRemoteDismantler:K,RoleRemoteMiner:P,RoleRemoteReserver:Q,RoleRemoteStorer:L,RoleRemoteWorker:A,RoleScientist:R,RoleStorer:S,RoleUpgrader:T,RoleWorker:U,RoomBase:M,RoomCleanup:N,RoomMine:r,RoomSource:O,Tower:k,Utilities:v};Memory.maxCreeps||(Memory.maxCreeps={});Memory.containerSource||(Memory.containerSource={});Memory.army||(Memory.army=
{});Memory.avoidRooms||(Memory.avoidRooms=[]);Memory.avoidSquares||(Memory.avoidSquares={});Memory.paths||(Memory.paths={});Memory.ranges||(Memory.ranges={});Memory.lengthToController||(Memory.lengthToController={});Memory.lengthToContainer||(Memory.lengthToContainer={});Memory.lengthToStorage||(Memory.lengthToStorage={});Memory.towerTasks||(Memory.towerTasks={});Memory.stats||(Memory.stats={});Memory.stats.cpu||(Memory.stats.cpu=[]);Memory.stats.bucket||(Memory.stats.bucket=[]);Memory.stats.gclProgress||
(Memory.stats.gclProgress=[]);Memory.allies||(Memory.allies=[]);0===Game.time%10&&(_.forEach(Memory.creeps,function(a,b){Game.creeps[b]||delete Memory.creeps[b]}),_.forEach(Memory.lengthToContainer,function(a,b){Game.getObjectById(b)||delete Memory.lengthToContainer[b]}),_.forEach(Memory.lengthToController,function(a,b){Game.getObjectById(b)||delete Memory.lengthToController[b]}),_.forEach(Memory.lengthToStorage,function(a,b){Game.getObjectById(b)||delete Memory.lengthToStorage[b]}),_.forEach(Memory.containerSource,
function(a,b){Game.getObjectById(b)||delete Memory.containerSource[b]}),_.forEach(Memory.dismantle,function(a,b){0===a.length&&delete Memory.dismantle[b]}),_.forEach(Memory.rooms,function(a,b){a&&a.roomType||delete Memory.rooms[b]}),_.forEach(Memory.maxCreeps,function(a,b){_.forEach(Memory.maxCreeps[b],function(b,c){0===Object.keys(b).length&&delete a[c]})}),_.forEach(Memory.paths,function(a,b){(a[3]<=Game.time-500||a[2]<=Game.time-1500)&&delete Memory.paths[b]}));delete Memory.flags;switch(b){case 0:Memory.lengthToStorage=
{};break;case 100:Memory.lengthToContainer={};break;case 200:Memory.lengthToController={};break;case 300:Memory.ranges={}}h.creeps=v.nest(_.filter(Game.creeps,function(a){return a.memory.home||a.memory.army}),[function(a){return a.memory.home||a.memory.army},function(a){return a.memory.role}]);_.forEach(h.creeps,function(a,b){h.creeps[b].all=_.flatten(_.values(a))})};g.minerals=function(){var a={};if(0===Game.time%10||Game.cpu.bucket>=Memory.marketBucket){Memory.mineralPrices=[{resource:RESOURCE_HYDROGEN,
amount:15E3,priority:1},{resource:RESOURCE_OXYGEN,amount:15E3,priority:1},{resource:RESOURCE_ZYNTHIUM,amount:15E3,priority:1},{resource:RESOURCE_KEANIUM,amount:15E3,priority:1},{resource:RESOURCE_UTRIUM,amount:15E3,priority:1},{resource:RESOURCE_LEMERGIUM,amount:15E3,priority:1},{resource:RESOURCE_CATALYST,amount:15E3,priority:1},{resource:RESOURCE_HYDROXIDE,amount:15E3,priority:1},{resource:RESOURCE_ZYNTHIUM_KEANITE,amount:15E3,priority:1},{resource:RESOURCE_UTRIUM_LEMERGITE,amount:15E3,priority:1},
{resource:RESOURCE_GHODIUM,amount:15E3,priority:1},{resource:RESOURCE_UTRIUM_HYDRIDE,amount:15E3,priority:1},{resource:RESOURCE_KEANIUM_OXIDE,amount:15E3,priority:1},{resource:RESOURCE_LEMERGIUM_HYDRIDE,amount:15E3,priority:1},{resource:RESOURCE_LEMERGIUM_OXIDE,amount:15E3,priority:1},{resource:RESOURCE_ZYNTHIUM_HYDRIDE,amount:15E3,priority:1},{resource:RESOURCE_ZYNTHIUM_OXIDE,amount:15E3,priority:1},{resource:RESOURCE_GHODIUM_HYDRIDE,amount:15E3,priority:1},{resource:RESOURCE_GHODIUM_OXIDE,amount:15E3,
priority:1},{resource:RESOURCE_UTRIUM_ACID,amount:15E3,priority:1},{resource:RESOURCE_KEANIUM_ALKALIDE,amount:15E3,priority:1},{resource:RESOURCE_LEMERGIUM_ACID,amount:15E3,priority:1},{resource:RESOURCE_LEMERGIUM_ALKALIDE,amount:15E3,priority:1},{resource:RESOURCE_ZYNTHIUM_ACID,amount:15E3,priority:1},{resource:RESOURCE_ZYNTHIUM_ALKALIDE,amount:15E3,priority:1},{resource:RESOURCE_GHODIUM_ACID,amount:15E3,priority:1},{resource:RESOURCE_GHODIUM_ALKALIDE,amount:15E3,priority:1},{resource:RESOURCE_CATALYZED_UTRIUM_ACID,
amount:15E3,priority:1},{resource:RESOURCE_CATALYZED_KEANIUM_ALKALIDE,amount:15E3,priority:1},{resource:RESOURCE_CATALYZED_LEMERGIUM_ACID,amount:15E3,priority:1},{resource:RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE,amount:15E3,priority:1},{resource:RESOURCE_CATALYZED_ZYNTHIUM_ACID,amount:15E3,priority:1},{resource:RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE,amount:15E3,priority:1},{resource:RESOURCE_CATALYZED_GHODIUM_ACID,amount:15E3,priority:1},{resource:RESOURCE_CATALYZED_GHODIUM_ALKALIDE,amount:15E3,priority:1},
{resource:RESOURCE_POWER,amount:15E3,priority:2}];Memory.reserveMinerals={};var b=Memory,k=b.reserveMinerals,d=b.mineralPrices;_.forEach(d,function(a){k[a.resource]=a.amount});_.forEach(_.uniq(_.map(c.getAllOrders(),function(a){return a.resourceType})),function(b){var k=(c.getFilteredOrders().sell[b]||[])["0"],f=_.find(d,function(a){return a.resource===b});a[b]=k?k.price:Infinity;f&&(f.marketPrice=a[b])});_.forEach(d,function(b){var c=b.resource,k=f[c];k&&0!==k.length?(b.value=1.2*_.sum(_.map(k,function(b){return a[b]||
Infinity})),a[c]=b.value):b.value=a[c]});_.forEach(_.filter(Game.rooms,function(a){return(a=a.memory.roomType)&&"base"===a.type}),function(a){var b=a.memory,c=a.storage,k=a.terminal,v=h.creeps[a.name],m=v&&v.all,e=h.labsInRoom(a);if(c&&c.my&&k&&k.my&&!(3>e.length)){var g=c.store,A=k.store,B=_.cloneDeep(d);_.forEach(B,function(a){var b=a.resource;a.amountInRoom=(g[b]||0)+(A[b]||0)+_.sum(m,function(a){return a.carry[b]||0})+_.sum(e,function(a){return a.mineralType===b?a.mineralAmount:0})});a=_.filter(B,
function(a){return Infinity!==a.marketPrice&&Infinity!==a.value&&a.marketPrice<=a.value}).sort(function(a,b){var c=a.priority-b.priority;return c?c:b.amount-b.amountInRoom-(a.amount-a.amountInRoom)});0===a.length?delete b.buyQueue:(a=a["0"],b.buyQueue={resource:a.resource,amount:a.amount-a.amountInRoom,price:a.marketPrice,start:Game.time});if(!b.labQueue&&(c=_.filter(B,function(a){var c=a.resource,k=f[c];if((b.buyQueue||!Memory.buy)&&b.buyQueue.resource===c||!k||0===k.length)return!1;var c=_.find(B,
function(a){return a.resource===k[0]}),h=_.find(B,function(a){return a.resource===k[1]});return a.amountInRoom<a.amount&&c&&h&&5<=c.amountInRoom&&5<=h.amountInRoom}).sort(function(a,b){return b.amount-b.amountInRoom-(a.amount-a.amountInRoom)}),0<c.length)){a=c["0"];var c=c["0"].resource,p=f[c];b.labQueue={resource:c,amount:Math.min(5*Math.floor(Math.min(Math.min(Math.min(a.amount-5*Math.floor(a.amountInRoom/5),_.find(B,function(a){return a.resource===p[0]}).amountInRoom),_.find(B,function(a){return a.resource===
p[1]}).amountInRoom),LAB_MINERAL_CAPACITY)/5),LAB_MINERAL_CAPACITY),children:p,start:Game.time}}}})}};g.baseMatrixes=function(){Memory.baseMatrixes||(Memory.baseMatrixes={});_.forEach(Memory.baseMatrixes,function(a,b){var c=Game.rooms[b];if(!c||c.unobservable||"complete"===a.status||0===h.spawnsInRoom(c).length)return!0;var k=h.repairableStructuresInRoom(c);if(!a.status){var f=new PathFinder.CostMatrix;_.forEach(_.filter(k,function(a){return a.structureType!==STRUCTURE_ROAD}),function(a){f.set(a.pos.x,
a.pos.y,255)});a.tempMatrix=f.serialize();a.costMatrix=f.serialize();a.status="building";a.x=0;a.y=0}if("building"===a.status){for(var c=h.spawnsInRoom(c)["0"],d=PathFinder.CostMatrix.deserialize(a.tempMatrix),v=PathFinder.CostMatrix.deserialize(a.costMatrix);50>a.x;a.x++){for(;50>a.y;a.y++){if(250<=Game.cpu.getUsed())return a.costMatrix=v.serialize(),!1;PathFinder.search(new RoomPosition(a.x,a.y,b),{pos:c.pos,range:1},{roomCallback:function(){return d},maxOps:1E4,maxRooms:1}).incomplete&&v.set(a.x,
a.y,255)}a.y=0}_.forEach(_.filter(k,function(a){return a.structureType===STRUCTURE_RAMPART}),function(a){v.set(a.pos.x,a.pos.y,0)});delete a.tempMatrix;delete a.x;delete a.y;a.costMatrix=v.serialize();a.status="complete"}return!0})};g.deserializeCreeps=function(){var a=h.creepTasks;_.forEach(Game.creeps,function(b){if(b.memory.currentTask)switch(b.memory.currentTask.type){case "build":a[b.name]=V.fromObj(b);break;case "claim":a[b.name]=u.fromObj(b);break;case "collectEnergy":a[b.name]=x.fromObj(b);
break;case "collectMinerals":a[b.name]=W.fromObj(b);break;case "dismantle":a[b.name]=X.fromObj(b);break;case "downgrade":a[b.name]=J.fromObj(b);break;case "fillEnergy":a[b.name]=H.fromObj(b);break;case "fillMinerals":a[b.name]=Y.fromObj(b);break;case "flee":a[b.name]=Z.fromObj(b);break;case "harvest":a[b.name]=aa.fromObj(b);break;case "heal":a[b.name]=ba.fromObj(b);break;case "meleeAttack":a[b.name]=ca.fromObj(b);break;case "mine":a[b.name]=da.fromObj(b);break;case "pickupResource":a[b.name]=ea.fromObj(b);
break;case "rally":a[b.name]=fa.fromObj(b);break;case "rangedAttack":a[b.name]=ga.fromObj(b);break;case "repair":a[b.name]=ha.fromObj(b);break;case "reserve":a[b.name]=ia.fromObj(b);break;case "suicide":a[b.name]=ja.fromObj(b);break;case "upgradeController":a[b.name]=ka.fromObj(b)}})};g.deserializeRooms=function(){var a=h.rooms,b={};_.forEach(Memory.rooms,function(c,k){Game.rooms[k]||(b[k]={name:k,unobservable:!0,memory:c});if(c.roomType)switch(c.roomType.type){case "base":a[k]=M.fromObj(Game.rooms[k]||
b[k]);break;case "cleanup":a[k]=N.fromObj(Game.rooms[k]||b[k]);break;case "mine":a[k]=r.fromObj(Game.rooms[k]||b[k]);break;case "source":a[k]=O.fromObj(Game.rooms[k]||b[k])}});this.unobservableRooms=_.values(b)};g.deserializeArmies=function(){var a=h.armies;_.forEach(Memory.army,function(b,c){a[c]=m.fromObj(c,b)})};g.balanceEnergy=function(){var a=_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&"base"===a.memory.roomType.type&&a.storage&&a.storage.my&&a.terminal&&a.terminal.my}).sort(function(a,
b){return a.storage.store[RESOURCE_ENERGY]+a.terminal.store[RESOURCE_ENERGY]-(b.storage.store[RESOURCE_ENERGY]+b.terminal.store[RESOURCE_ENERGY])});if(1<a.length){var b=Math.min(_.sum(_.map(a,function(a){return a.storage.store[RESOURCE_ENERGY]+a.terminal.store[RESOURCE_ENERGY]}))/a.length,5E5);_.forEach(a,function(c,k){var f=a[a.length-k-1],h=f.name,d=f.storage.store[RESOURCE_ENERGY];k=f.terminal;var f=f.terminal.store[RESOURCE_ENERGY],v=c.name,m=c.storage.store[RESOURCE_ENERGY];if(0<k.cooldown)return!0;
if(m>=d||m+c.terminal.store[RESOURCE_ENERGY]>b||d+f<b+1E4)return!1;1E3<=f&&(c=Game.market.calcTransactionCost(f,h,v),k.send(RESOURCE_ENERGY,Math.floor(f/(f+c)*f),v));return!0})}};g.rooms=function(){var a=this,b=["base","source","mine","cleanup",""],c=Memory.rooms,k=_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&"base"===a.memory.roomType.type&&a.controller&&8>a.controller.level}).sort(function(a,b){return b.controller.level-a.controller.level||b.controller.progress-a.controller.progress})[0]||
{name:""};Memory.rushRoom=k.name;_.forEach(Array.prototype.concat.apply([],[_.filter(Game.rooms),this.unobservableRooms]).sort(function(a,k){return b.indexOf(c[a.name]&&c[a.name].roomType&&c[a.name].roomType.type||"")-b.indexOf(c[k.name]&&c[k.name].roomType&&c[k.name].roomType.type||"")}),function(b){var k=b.name,f=h.rooms[k],k=c[k];f&&k&&k.roomType&&(k=k.roomType.type,(9700<=Game.cpu.bucket||Game.time%2||"base"!==k||0<h.hostilesInRoom(b).length)&&f.run(),k===f.type&&f.toObj());Memory.visualizations&&
!b.unobservable&&a.drawRoom(b)})};g.drawRoom=function(a){var c=a.visual;c||(c=new RoomVisual(a.name));if(c){a.memory&&a.memory.roomType&&c.text(_.capitalize(a.memory.roomType.type),-.5,49.325,{align:"left",font:"0.5 Arial"});a.controller&&a.controller.level&&(c.text("RCL "+a.controller.level,2.5,49.325,{align:"left",font:"0.5 Arial"}),a.controller.progress&&a.controller.progressTotal&&b.progressBar(c,5.5,48.9,20,.5,a.controller.progress,a.controller.progressTotal,{background:"#808080",bar:"#00ff00",
showDetails:!0,color:"#ffffff",font:"0.5 Arial"}));var k=2.125;a.energyCapacityAvailable&&(k+=.7,c.text("Energy",-.5,k,{align:"left",font:"0.5 Arial"}),b.progressBar(c,2.5,k-.425,5,.5,a.energyAvailable,a.energyCapacityAvailable,{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"}));var f=h.towersInRoom(a);0<f.length&&(k+=.7,c.text("Towers",-.5,k,{align:"left",font:"0.5 Arial"}),b.progressBar(c,2.5,k-.425,5,.5,_.sum(_.map(f,function(a){return a.energy})),_.sum(_.map(f,
function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"}));f=h.labsInRoom(a);0<f.length&&(k+=.7,c.text("Labs",-.5,k,{align:"left",font:"0.5 Arial"}),b.progressBar(c,2.5,k-.425,5,.5,_.sum(_.map(f,function(a){return a.energy})),_.sum(_.map(f,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"}));var d=h.nukersInRoom(a);0<d.length&&(k+=.7,c.text("Nuker",-.5,k,{align:"left",
font:"0.5 Arial"}),b.progressBar(c,2.5,k-.425,5,.5,_.sum(_.map(d,function(a){return a.energy})),_.sum(_.map(d,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"}),b.progressBar(c,8.5,k-.425,5,.5,_.sum(_.map(d,function(a){return a.ghodium})),_.sum(_.map(d,function(a){return a.ghodiumCapacity})),{background:"#808080",bar:"#ffff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"}));d=h.powerSpawnsInRoom(a);0<d.length&&(k+=.7,c.text("Power Spawn",
-.5,k,{align:"left",font:"0.5 Arial"}),b.progressBar(c,2.5,k-.425,5,.5,_.sum(_.map(d,function(a){return a.energy})),_.sum(_.map(d,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"}),b.progressBar(c,8.5,k-.425,5,.5,_.sum(_.map(d,function(a){return a.power})),_.sum(_.map(d,function(a){return a.powerCapacity})),{background:"#808080",bar:"#ff0000",showDetails:!1,color:"#ffffff",font:"0.5 Arial"}));a.memory&&a.memory.buyQueue&&(k+=
.7,c.text("Buy",-.5,k,{align:"left",font:"bold 0.5 Arial"}),c.text(a.memory.buyQueue.amount,2.5,k,{align:"right",font:"0.5 Arial"}),b.resource(c,2.8,k-.175,.5,a.memory.buyQueue.resource,{opacity:1}));a.memory&&a.memory.labQueue&&(k+=.7,c.text("Create",-.5,k,{align:"left",font:"bold 0.5 Arial"}),c.text(a.memory.labQueue.amount,2.5,k,{align:"right",font:"0.5 Arial"}),b.resource(c,2.8,k-.175,.5,a.memory.labQueue.resource,{opacity:1}));if(0<f.length){k+=.7;c.text("Labs",-.5,k,{align:"left",font:"bold 0.5 Arial"});
var v=0;_.forEach(f,function(a){v+=2.5;0===a.mineralAmount?c.text("Empty",v,k,{align:"right",font:"0.5 Arial"}):(c.text(a.mineralAmount,v,k,{align:"right",font:"0.5 Arial"}),b.resource(c,v+.3,k-.175,.5,a.mineralType,{opacity:1}))})}a.storage&&(k+=1.4,c.text("Storage",-.5,k,{align:"left",font:"bold 0.5 Arial"}),_.forEach(a.storage.store,function(a,f){f!==RESOURCE_ENERGY&&(k+=.7,c.text(a,1,k,{align:"right",font:"0.5 Arial"}),b.resource(c,1.3,k-.175,.5,f,{opacity:1}))}));a.terminal&&(k+=1.4,c.text("Terminal",
-.5,k,{align:"left",font:"bold 0.5 Arial"}),_.forEach(a.terminal.store,function(a,f){f!==RESOURCE_ENERGY&&(k+=.7,c.text(a,1,k,{align:"right",font:"0.5 Arial"}),b.resource(c,1.3,k-.175,.5,f,{opacity:1}))}))}};g.army=function(){_.forEach(h.armies,function(a){a.run();a.toObj()})};g.creeps=function(){var a=Game.time;_.forEach(Game.creeps,function(b){if(!b.spawning&&!b.memory.stop){var c=b.ticksToLive,k=b.memory,f=b.room.name,d=k.army,v=h.creepTasks[b.name];if(150>=c||500>c&&1===c%10||1===c%100)switch(c-
1){case 3:b.say("R.I.P. and",!0);break;case 2:b.say("Pepperonis",!0);break;case 1:b.say(":(",!0);break;default:b.say("TTL "+(c-1))}d&&h.armies[d]&&f===h.armies[d].attackRoom&&b.say("All my friends are heathens, take it slow.  Wait for them to ask you who you know.  Please don't make any sudden moves.  You don't know the half of the abuse. ".split(" ")[a%35],!0);switch(a%1E6){case 999990:b.say("TEN!",!0);break;case 999991:b.say("NINE!",!0);break;case 999992:b.say("EIGHT!",!0);break;case 999993:b.say("SEVEN!",
!0);break;case 999994:b.say("SIX!",!0);break;case 999995:b.say("FIVE!",!0);break;case 999996:b.say("FOUR!",!0);break;case 999997:b.say("THREE!",!0);break;case 999998:b.say("TWO!",!0);break;case 999999:b.say("ONE!",!0);break;case 0:b.say("HAPPY NEW",!0);break;case 1:b.say("MILLION!",!0)}if(k.currentTask&&v){if(0===b.pos.x)switch(Math.floor(3*Math.random())){case 0:b.move(RIGHT);break;case 1:b.move(TOP_RIGHT);break;case 2:b.move(BOTTOM_RIGHT)}if(49===b.pos.x)switch(Math.floor(3*Math.random())){case 0:b.move(LEFT);
break;case 1:b.move(TOP_LEFT);break;case 2:b.move(BOTTOM_LEFT)}if(0===b.pos.y)switch(Math.floor(3*Math.random())){case 0:b.move(BOTTOM);break;case 1:b.move(BOTTOM_RIGHT);break;case 2:b.move(BOTTOM_LEFT)}if(49===b.pos.y)switch(Math.floor(3*Math.random())){case 0:b.move(TOP);break;case 1:b.move(TOP_RIGHT);break;case 2:b.move(TOP_LEFT)}v.run(b);!k.lastRoom||k.lastRoom===f||v&&v.force||delete k.currentTask;k.lastRoom=f;k.currentTask&&v&&k.currentTask.type===v.type&&v.toObj(b);0<b.carry[RESOURCE_ENERGY]&&
0<b.getActiveBodyparts(WORK)&&_.forEach(_.filter(b.pos.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_ROAD&&a.hits<a.hitsMax}),function(a){b.repair(a)});b.spawning||!(150>c)||0!==_.sum(b.carry)||k.currentTask&&"rally"!==k.currentTask.type||-1!=="armyDismantler armyHealer armyMelee armyRanged claimer downgrader defender healer remoteReserver".split(" ").indexOf(b.memory.role)||b.suicide()}else delete k.currentTask,!b.spawning&&150>c&&0===_.sum(b.carry)&&-1==="armyDismantler armyHealer armyMelee armyRanged claimer downgrader defender healer remoteReserver".split(" ").indexOf(k.role)?
b.suicide():b.say("Idle")}})};g.debug=function(){_.forEach(Game.creeps,function(a){var b=a.memory;a.room.visual.text(a.name,a.pos.x,a.pos.y+1,{align:"center",font:"0.5 Arial"}).text(b.role,a.pos.x,a.pos.y+1.5,{align:"center",font:"0.5 Arial"}).text(b.currentTask?b.currentTask.type:"",a.pos.x,a.pos.y+2,{align:"center",font:"0.5 Arial"})})};g.drawGlobal=function(){h.globalVisual.text("GCL "+Game.gcl.level,-.5,.025,{align:"left",font:"0.5 Arial"});b.progressBar(h.globalVisual,2.5,-.4,20,.5,Game.gcl.progress,
Game.gcl.progressTotal,{background:"#808080",bar:"#00ff00",showDetails:!0,color:"#ffffff",font:"0.5 Arial"});b.progressBar(h.globalVisual,34.5,-.4,10,.5,Game.cpu.bucket,1E4,{label:"Bucket",background:"#808080",showMax:!1,bar:9990<=Game.cpu.bucket?"#00ffff":9E3<=Game.cpu.bucket?"#00ff00":5E3<=Game.cpu.bucket?"#cccc00":"#ff0000",color:"#ffffff",font:"0.5 Arial"});h.globalVisual.text("Tick "+Game.time,49.5,.025,{align:"right",font:"0.5 Arial"}).text(h.time,49.5,.725,{align:"right",font:"0.5 Arial"});
h.globalVisual.text("Credits "+Game.market.credits.toFixed(2),-.5,.725,{align:"left",font:"0.5 Arial"});h.globalVisual.text("Creeps "+Object.keys(Game.creeps).length,-.5,1.425,{align:"left",font:"0.5 Arial"});var a=.725;_.forEach(_.filter(Game.rooms,function(a){return!a.unobservable&&a.memory.roomType&&"base"===a.memory.roomType.type}),function(c){a+=.7;h.globalVisual.text(c.name,43.5,a,{align:"right",font:"bold 0.5 Arial"});c.storage&&(h.globalVisual.text(c.storage.store[RESOURCE_ENERGY],45.8,a,
{align:"right",font:"0.5 Arial"}),b.resource(h.globalVisual,46.15,a-.175,.5,RESOURCE_ENERGY,{opacity:1}));c.terminal&&(h.globalVisual.text(c.terminal.store[RESOURCE_ENERGY],48.8,a,{align:"right",font:"0.5 Arial"}),b.resource(h.globalVisual,49.15,a-.175,.5,RESOURCE_ENERGY,{opacity:1}))});for(Memory.stats.cpu.push(Game.cpu.getUsed());100<Memory.stats.cpu.length;)Memory.stats.cpu.shift();for(Memory.stats.bucket.push(Game.cpu.bucket);100<Memory.stats.bucket.length;)Memory.stats.bucket.shift();for(Memory.stats.gclProgress.push(Game.gcl.progress);100<
Memory.stats.gclProgress.length;)Memory.stats.gclProgress.shift();b.sparkline(h.globalVisual,23.5,1,18,2,_.map(Memory.stats.cpu,function(a,b){return{cpu:Memory.stats.cpu[b],bucket:Memory.stats.bucket[b],limit:Game.cpu.limit}}),[{key:"limit",min:.5*Game.cpu.limit,max:1.5*Game.cpu.limit,stroke:"#c0c0c0",opacity:.25},{key:"cpu",min:.5*Game.cpu.limit,max:1.5*Game.cpu.limit,stroke:"#ffff00",opacity:.5},{key:"bucket",min:0,max:1E4,stroke:"#00ffff",opacity:.5,font:"0.5 Arial"}]);Memory.stats.cpu[Memory.stats.cpu.length-
1]=Game.cpu.getUsed();b.progressBar(h.globalVisual,23.5,-.4,10,.5,Game.cpu.getUsed(),Game.cpu.limit,{label:"CPU",background:"#808080",valueDecimals:2,bar:Game.cpu.getUsed()>Game.cpu.limit?"#ff0000":"#00ff00",color:"#ffffff",font:"0.5 Arial"})};g.finalize=function(){};Memory.profiling&&(d.registerObject(g,"Main"),d.enable());l.exports=g;return l.exports};n[1]=function(e,g){function d(){p=0;Game.profiler={stream:function(a,b,c){m("stream",a||10,b,c)},email:function(a,b,c){m("email",a||100,b,c)},profile:function(a,
b,c){m("profile",a||100,b,c)},background:function(a,b){m("background",!1,a,b)},restart:function(){if(w.isProfiling()){var a=Memory.profiler.filter,b=!1;Memory.profiler.disableTick&&(b=Memory.profiler.disableTick-Memory.profiler.enabledTick+1);m(Memory.profiler.type,b,a)}},reset:h,output:w.output};a()}function m(a,b,c,k){h();b=Number.isInteger(b)?Game.time+b:!1;Memory.profiler||(Memory.profiler={map:{},totalTime:0,enabledTick:Game.time+1,disableTick:b,type:a,filter:c,startsWith:k})}function h(){Memory.profiler=
null}function a(){Game.rooms.sim&&(B=0,Game.cpu.getUsed=function(){return performance.now()-B})}function b(a,b){return function(){if(w.isProfiling()){var c=Memory.profiler.startsWith?a.startsWith(Memory.profiler.filter):a===Memory.profiler.filter,k=Game.cpu.getUsed();c&&p++;var f=b.apply(this,arguments);if(0<p||!Memory.profiler.filter){var d=Game.cpu.getUsed();w.record(a,d-k)}c&&p--;return f}return b.apply(this,arguments)}}function c(){w.prototypes.forEach(function(a){k(a.val,a.name)})}function f(a,
b){Object.getOwnPropertyNames(a).forEach(function(c){var k=b+"."+c;try{var f="function"===typeof a[c],d=-1===l.indexOf(c);f&&d&&(a[c]=v(a[c],k))}catch(I){}});return a}function k(a,b){a.prototype&&f(a.prototype,b);f(a,b)}function v(a,c){c=c||a.name;return c?b(c,a):(console.log("Couldn't find a function name for - ",a),console.log("Will not profile this function."),a)}Array.prototype.forEach=function(a,b){for(var c=0;c<this.length;c++)a.call(b,this[c],c,this)};Array.prototype.map=function(a,b){for(var c=
[],k=0;k<this.length;k++)c.push(a.call(b,this[k],k,this));return c};var B=0,t=!1,p=0,l=["getUsed","constructor"],w={printProfile:function(){console.log(w.output())},emailProfile:function(){Game.notify(w.output())},output:function(a){a=a?a:20;if(!Memory.profiler||!Memory.profiler.enabledTick)return"Profiler not active.";var b=Game.time-Memory.profiler.enabledTick+1,b=["Avg: "+(Memory.profiler.totalTime/b).toFixed(2),"Total: "+Memory.profiler.totalTime.toFixed(2),"Ticks: "+b].join("\t");return[].concat("calls\t\ttime\t\tavg\t\tmax\t\tfunction",
w.lines().slice(0,a),b).join("\n")},lines:function(){return Object.keys(Memory.profiler.map).map(function(a){var b=Memory.profiler.map[a];return{name:a,calls:b.calls,totalTime:b.time,averageTime:b.time/b.calls,maxTime:b.maxTime}}).sort(function(a,b){return b.totalTime-a.totalTime}).map(function(a){return[a.calls,a.totalTime.toFixed(1),a.averageTime.toFixed(3),a.maxTime.toFixed(3),a.name].join("\t\t")})},prototypes:[{name:"Game",val:Game},{name:"Room",val:Room},{name:"Structure",val:Structure},{name:"Spawn",
val:Spawn},{name:"Creep",val:Creep},{name:"RoomPosition",val:RoomPosition},{name:"Source",val:Source},{name:"Flag",val:Flag}],record:function(a,b){Memory.profiler.map[a]||(Memory.profiler.map[a]={time:0,calls:0,maxTime:0});Memory.profiler.map[a].calls++;Memory.profiler.map[a].time+=b;Memory.profiler.map[a].maxTime=Math.max(Memory.profiler.map[a].maxTime,b)},endTick:function(){if(Game.time>=Memory.profiler.enabledTick){var a=Game.cpu.getUsed();Memory.profiler.totalTime+=a;w.report()}},report:function(){w.shouldPrint()?
w.printProfile():w.shouldEmail()&&w.emailProfile()},isProfiling:function(){return t&&Memory.profiler?!Memory.profiler.disableTick||Game.time<=Memory.profiler.disableTick:!1},type:function(){return Memory.profiler.type},shouldPrint:function(){var a="stream"===w.type(),b="profile"===w.type(),c=Memory.profiler.disableTick===Game.time;return a||b&&c},shouldEmail:function(){return"email"===w.type()&&Memory.profiler.disableTick===Game.time}};e.exports={wrap:function(a){t&&d();return w.isProfiling()?(B=
Game.cpu.getUsed(),a=a(),w.endTick(),a):a()},enable:function(){t=!0;c()},output:w.output,registerObject:k,registerFN:v,registerClass:k};return e.exports};n[2]=function(l,g){var d=e(3,2),m=e(9,2),h=e(10,2),a=e(11,2),b=e(12,2),c=e(13,2),f=function(a,b){b.directive||(b.directive="preparing");Memory.army[a]||(Memory.army[a]=b);_.extend(this,b);this.name=a};f.prototype.run=function(){var k=this,f=this.name,e=this.dismantler,g=this.healer,p=this.melee,l=this.ranged,w=d.creeps[f]&&d.creeps[f].all||[],q=
Game.rooms[this.attackRoom];if(!(this.scheduled&&this.scheduled>Game.time))if(0===w.length&&this.success)this.delete=!0;else{"preparing"===this.directive||"building"===this.directive||0!==w.length||this.success||(Game.notify("Army "+f+" operation failed, restarting."),this.directive="preparing");if(this.safeMode&&q&&q.controller&&q.controller.safeMode){this.directive="staging";var n=this.safeMode;this.stageRoom=n.stageRoom;this.attackRoom=n.attackRoom;this.dismantle=n.dismantle;this.safeMode=n.safeMode}if("preparing"===
this.directive)if(n=this.boostRoom){if(n=Game.rooms[n].storage.store,!n||(n[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]||0)>=150*(e.maxCreeps+p.maxCreeps+l.maxCreeps+g.maxCreeps)&&(n[RESOURCE_CATALYZED_ZYNTHIUM_ACID]||0)>=30*e.units*e.maxCreeps&&(n[RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE]||0)>=30*g.units*g.maxCreeps)this.directive="building"}else this.directive="building";"building"===this.directive&&0===_.filter(w,function(a){return a.room.name!==k.buildRoom}).length&&_.filter(w,function(a){return a.room.name===
k.buildRoom}).length>=e.maxCreeps+g.maxCreeps+p.maxCreeps+l.maxCreeps&&(this.directive="staging");"staging"===this.directive&&0===_.filter(w,function(a){return a.room.name!==k.stageRoom}).length&&(this.directive="dismantle");"dismantle"===this.directive&&(this.dismantle?q&&(this.dismantle=_.filter(this.dismantle,function(a){return Game.getObjectById(a)}),0===this.dismantle.length&&(this.directive="attack")):this.directive="attack");q&&(this.hostileConstructionSites=d.hostileConstructionSitesInRoom(q),
0!==q.find(FIND_HOSTILE_CREEPS).length||this.reinforce||0!==_.filter(q.find(FIND_HOSTILE_STRUCTURES),function(a){return a.structureType!==STRUCTURE_CONTROLLER&&a.structureType!==STRUCTURE_RAMPART&&a.structureType!==STRUCTURE_KEEPER_LAIR}).length||0!==this.hostileConstructionSites.length||(this.directive="attack",this.success=!0));if("building"===this.directive||this.reinforce)this.checkSpawn("armyDismantler",e.maxCreeps,this.spawnFromRegion.bind(this,h)),this.checkSpawn("armyHealer",g.maxCreeps,this.spawnFromRegion.bind(this,
a)),this.checkSpawn("armyMelee",p.maxCreeps,this.spawnFromRegion.bind(this,b)),this.checkSpawn("armyRanged",l.maxCreeps,this.spawnFromRegion.bind(this,c));(e.escort||p.escort||l.escort)&&_.forEach(_.filter(d.creeps[f]&&d.creeps[f].armyHealer||[],function(a){return!a.memory.escorting&&!a.spawning}),function(a){var b=Array.prototype.concat.apply([],[e.escort&&d.creeps[f].armyDismantler?_.filter(d.creeps[f].armyDismantler,function(a){return(!a.memory.escortedBy||!Game.getObjectById(a.memory.escortedBy))&&
!a.spawning}):[],p.escort&&d.creeps[f].armyMelee?_.filter(d.creeps[f].armyMelee,function(a){return(!a.memory.escortedBy||!Game.getObjectById(a.memory.escortedBy))&&!a.spawning}):[],l.escort&&d.creeps[f].armyRanged?_.filter(d.creeps[f].armyRanged,function(a){return(!a.memory.escortedBy||!Game.getObjectById(a.memory.escortedBy))&&!a.spawning}):[]])["0"];if(b)a.memory.escorting=b.id,b.memory.escortedBy=a.id;else return!1;return!0});if(q)switch(this.directive){case "attack":this.hostiles=d.hostilesInRoom(q);
break;default:this.hostiles=0<w.length?_.filter(d.hostilesInRoom(q),function(a){return 3>=m.objectsClosestToObj(w,a)[0].pos.getRangeTo(a)}):[]}h.assignTasks(this);a.assignTasks(this);b.assignTasks(this);c.assignTasks(this)}};f.prototype.checkSpawn=function(a,b,c){var k=this.name;_.filter(d.creeps[k]&&d.creeps[k][a]||[],function(a){return a.spawning||300<a.ticksToLive}).length<b&&c()};f.prototype.spawnFromRegion=function(a){var b=this,c=a.spawnSettings(this);a=_.filter(Game.spawns,function(a){return!a.spawning&&
!d.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(c.body)&&a.room.memory.region===b.region});var k;if(0===a.length)return!1;if(this.boostRoom){var f=Game.rooms[this.boostRoom];var h=f.memory.labsInUse;if(f&&!(k=m.getLabToBoostWith(f,Object.keys(c.boosts).length)))return!1}var e=a[0].createCreep(c.body,c.name+"-"+this.name+"-"+Game.time.toFixed(0).substring(4),{role:c.name,army:this.name,labs:f?_.map(k,function(a){return a.id}):[],portals:this.portals});d.spawning[a[0].id]="number"!==typeof e;
if("number"!==typeof e&&f){var g=0;_.forEach(c.boosts,function(a,b){k[g].creepToBoost=e;k[g].resource=b;k[g].amount=30*a;h.push(k[g]);g++});d.creeps[f.name]&&_.forEach(_.filter(d.creeps[f.name].all,function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&-1!==_.map(k,function(a){return a.id}).indexOf(a.memory.currentTask.id)}),function(a){delete a.memory.currentTask})}return"number"!==typeof e};f.prototype.toObj=function(){this.delete?delete Memory.army[this.name]:Memory.army[this.name]=
{attackRoom:this.attackRoom,boostRoom:this.boostRoom,buildRoom:this.buildRoom,directive:this.directive,dismantle:this.dismantle,dismantler:this.dismantler,healer:this.healer,melee:this.melee,ranged:this.ranged,region:this.region,reinforce:this.reinforce,restPosition:this.restPosition,safeMode:this.safeMode,scheduled:this.scheduled,stageRoom:this.stageRoom,success:this.success}};f.fromObj=function(a,b){return new f(a,b)};Memory.profiling&&e(1,2).registerObject(f,"Army");l.exports=f;return l.exports};
n[3]=function(l,g){g=function(){};g.reset=function(){this.extensions={};this.hostileConstructionSites={};this.hostiles={};this.labs={};this.spawns={};this.resources={};0!==Game.time%4&&this.containers||(this.containers={},this.costMatrixes={},this.criticalRepairableStructures={},this.extractors={},this.links={},this.nukers={},this.portals={},this.powerBanks={},this.powerSpawns={},this.repairableStructures={},this.sortedRepairableStructures={},this.sortedResources={},this.sourceKeepers={},this.towers=
{});this.armies={};this.creepTasks={};this.spawning={};this.rooms={};this.credits=Game.market.credits;Memory.visualizations&&(this.globalVisual=new RoomVisual,this.time=(new Date).toLocaleString("en-US",{timeZone:"America/Los_Angeles"}).replace(",",""))};g.containersInRoom=function(d){return this.containers[d.name]?this.containers[d.name]:this.containers[d.name]=d.find(FIND_STRUCTURES,{filter:function(d){return d.structureType===STRUCTURE_CONTAINER}})};g.costMatrixForRoom=function(d){var m=d.name;
if(!d||d.unobservable)return new PathFinder.CostMatrix;if(!this.costMatrixes[m]){var h=new PathFinder.CostMatrix;_.forEach(d.find(FIND_STRUCTURES),function(a){var b=a.pos;a.structureType===STRUCTURE_ROAD?h.set(b.x,b.y,Math.max(1,h.get(b.x,b.y))):a.structureType===STRUCTURE_WALL?h.set(b.x,b.y,255):a.structureType===STRUCTURE_CONTAINER?h.set(b.x,b.y,Math.max(10,h.get(b.x,b.y))):a.structureType===STRUCTURE_RAMPART&&a.my||h.set(b.x,b.y,255)});_.forEach(d.find(FIND_MY_CONSTRUCTION_SITES),function(a){a=
a.pos;h.set(a.x,a.y,Math.max(5,h.get(a.x,a.y)))});_.forEach(this.portalsInRoom(d),function(a){a=a.pos;h.set(a.x,a.y,10)});Memory.avoidSquares[m]&&_.forEach(Memory.avoidSquares[m],function(a){h.set(a.x,a.y,255)});this.costMatrixes[m]=h}return this.costMatrixes[m]};g.criticalRepairableStructuresInRoom=function(d){return this.criticalRepairableStructures[d.name]?this.criticalRepairableStructures[d.name]:this.criticalRepairableStructures[d.name]=_.filter(this.sortedRepairableStructuresInRoom(d),function(d){return 125E3>
d.hits&&.5>d.hits/d.hitsMax})};g.extensionsInRoom=function(d){return this.extensions[d.name]?this.extensions[d.name]:this.extensions[d.name]=d.find(FIND_MY_STRUCTURES,{filter:function(d){return d.structureType===STRUCTURE_EXTENSION}})};g.extractorsInRoom=function(d){return this.extractors[d.name]?this.extractors[d.name]:this.extractors[d.name]=d.find(FIND_STRUCTURES,{filter:function(d){return d.structureType===STRUCTURE_EXTRACTOR}})};g.hostileConstructionSitesInRoom=function(d){return this.hostileConstructionSites[d.name]?
this.hostileConstructionSites[d.name]:this.hostileConstructionSites[d.name]=d.find(FIND_HOSTILE_CONSTRUCTION_SITES,{filter:function(d){return!d.owner||-1===Memory.allies.indexOf(d.owner.username)}})};g.hostilesInRoom=function(d){var e=d.name;if(this.hostiles[e])return this.hostiles[e];if(!d||d.unobservable)return[];this.hostiles[e]=d.find(FIND_HOSTILE_CREEPS,{filter:function(a){return!a.owner||-1===Memory.allies.indexOf(a.owner.username)}});d=d.memory;var h=_.groupBy(_.map(this.hostiles[e],function(a){return{id:a.id,
threat:_.sum(a.body,function(a){switch(a.type){case ATTACK:case RANGED_ATTACK:case HEAL:case WORK:case TOUGH:var b=BODYPART_COST[a.type];break;default:return 0}var f=BOOSTS[a.type];if(a.boost&&f&&f[a.boost])switch(f=f[a.boost],a.type){case ATTACK:f.attack&&(b*=f.attack);break;case RANGED_ATTACK:f.rangedAttack&&(b*=f.rangedAttack);break;case HEAL:f.heal&&(b*=f.heal);break;case WORK:f.dismantle&&(b*=f.dismantle);break;case TOUGH:f.damage&&(b/=f.damage)}return b})}}),function(a){return a.id});d.threat=
_.sum(_.map(_.values(h),function(a){return a[0].threat}));this.hostiles[e].sort(function(a,b){return h[b.id].threat-h[a.id].threat});d&&(d.hostiles||(d.hostiles=[]),d.hostiles=_.map(this.hostiles[e],function(a){return a.id}));return this.hostiles[e]};g.labsInRoom=function(d){return this.labs[d.name]?this.labs[d.name]:this.labs[d.name]=d.find(FIND_MY_STRUCTURES,{filter:function(d){return d.structureType===STRUCTURE_LAB}})};g.linksInRoom=function(d){return this.links[d.name]?this.links[d.name]:this.links[d.name]=
d.find(FIND_STRUCTURES,{filter:function(d){return d.structureType===STRUCTURE_LINK}})};g.nukersInRoom=function(d){return this.nukers[d.name]?this.nukers[d.name]:this.nukers[d.name]=d.find(FIND_MY_STRUCTURES,{filter:function(d){return d.structureType===STRUCTURE_NUKER}})};g.portalsInRoom=function(d){return this.portals[d.name]?this.portals[d.name]:this.portals[d.name]=d.find(FIND_STRUCTURES,{filter:function(d){return d.structureType===STRUCTURE_PORTAL}})};g.powerBanksInRoom=function(d){return this.powerBanks[d.name]?
this.powerBanks[d.name]:this.powerBanks[d.name]=d.find(FIND_STRUCTURES,{filter:function(d){return d.structureType===STRUCTURE_POWER_BANK}})};g.powerSpawnsInRoom=function(d){return this.powerSpawns[d.name]?this.powerSpawns[d.name]:this.powerSpawns[d.name]=d.find(FIND_MY_STRUCTURES,{filter:function(d){return d.structureType===STRUCTURE_POWER_SPAWN}})};g.repairableStructuresInRoom=function(d){return this.repairableStructures[d.name]?this.repairableStructures[d.name]:this.repairableStructures[d.name]=
d.find(FIND_STRUCTURES,{filter:function(d){return(d.my||d.structureType===STRUCTURE_WALL||d.structureType===STRUCTURE_ROAD||d.structureType===STRUCTURE_CONTAINER)&&d.hits}})};g.sortedRepairableStructuresInRoom=function(d){return this.sortedRepairableStructures[d.name]?this.sortedRepairableStructures[d.name]:this.sortedRepairableStructures[d.name]=this.repairableStructuresInRoom(d).sort(function(d,h){return d.hits-h.hits})};g.sortedResourcesInRoom=function(d){return this.sortedResources[d.name]?this.sortedResources[d.name]:
this.sortedResources[d.name]=d.find(FIND_DROPPED_RESOURCES).sort(function(d,h){return d.resourceType===RESOURCE_ENERGY&&h.resourceType!==RESOURCE_ENERGY?1:d.resourceType!==RESOURCE_ENERGY&&h.resourceType===RESOURCE_ENERGY?-1:h.amount-d.amount})};g.sourceKeepersInRoom=function(d){return this.sourceKeepers[d.name]?this.sourceKeepers[d.name]:this.sourceKeepers[d.name]=d.find(FIND_HOSTILE_STRUCTURES,{filter:function(d){return d.structureType===STRUCTURE_KEEPER_LAIR}})};g.spawnsInRoom=function(d){return this.spawns[d.name]?
this.spawns[d.name]:this.spawns[d.name]=d.find(FIND_MY_STRUCTURES,{filter:function(d){return d.structureType===STRUCTURE_SPAWN}})};g.towersInRoom=function(d){return this.towers[d.name]?this.towers[d.name]:this.towers[d.name]=d.find(FIND_MY_STRUCTURES,{filter:function(d){return d.structureType===STRUCTURE_TOWER}})};g.resourcesInRoom=function(d){return this.resources[d.name]?this.resources[d.name]:this.resources[d.name]=d.find(FIND_DROPPED_RESOURCES).sort(function(d,h){return h.amount-d.amount})};Memory.profiling&&
e(1,3).registerObject(g,"Cache");l.exports=g;return l.exports};n[4]=function(l,g){var d=e(3,4);g=function(){};g.addAlly=function(d){Memory.allies.push(d)};g.addSign=function(d,h){Memory.signs||(Memory.signs={});h?Memory.signs[d]=h:delete Memory.signs[d]};g.avoidRoom=function(d,h){h&&-1===Memory.avoidRooms.indexOf(d)&&Memory.avoidRooms.push(d);h||_.remove(Memory.avoidRooms,function(a){return a===d})};g.avoidSquare=function(d,h,a,b){b&&(Memory.avoidSquares[a]||(Memory.avoidSquares[a]=[]),Memory.avoidSquares[a].push({x:d,
y:h}));b||Memory.avoidSquares[a]&&_.remove(Memory.avoidSquares[a],function(a){return a.x===d&&a.y===h})};g.claimMine=function(e){Game.rooms[e]&&d.creeps[e]&&_.forEach(d.creeps[e].remoteReserver,function(d){d.claimController(Game.rooms[e].controller)})};g.claimRoom=function(d,h,a){Memory.maxCreeps.claimer||(Memory.maxCreeps.claimer={});Memory.maxCreeps.claimer[d]||(Memory.maxCreeps.claimer[d]={});a?Memory.maxCreeps.claimer[d][h]=!0:delete Memory.maxCreeps.claimer[d][h]};g.createArmy=function(d,h){void 0===
h?delete Memory.army[d]:(Memory.army[d]=h,Memory.army[d].directive="preparing")};g.dismantle=function(d,h,a){Memory.dismantle||(Memory.dismantle={});Memory.dismantle[a]||(Memory.dismantle[a]=[]);Memory.dismantle[a].push({x:d,y:h})};g.downgradeRoomController=function(d,h,a){Memory.maxCreeps.downgrader||(Memory.maxCreeps.downgrader={});Memory.maxCreeps.downgrader[d]||(Memory.maxCreeps.downgrader[d]={});a?Memory.maxCreeps.downgrader[d][h]=!0:delete Memory.maxCreeps.downgrader[d][h]};g.recover=function(){_.forEach(Game.spawns,
function(d){return d.createCreep([MOVE,MOVE,CARRY,CARRY,CARRY,CARRY],"storer-emerg-"+d.room.name+"-"+d.name,{role:"storer",home:d.room.name})})};g.removeAlly=function(d){_.pull(Memory.allies,d)};g.resetBaseMatrix=function(d){Memory.baseMatrixes[d]={}};g.setContainerSource=function(d,h){Memory.containerSource[d]=h};g.setRoomType=function(d,h,a){void 0===a?delete Memory.rooms[d].roomType:(Memory.rooms[d]||(Memory.rooms[d]={}),Memory.rooms[d].roomType=a,Memory.rooms[d].region=h)};g.startAllCreeps=function(){_.forEach(Game.creeps,
function(d){delete d.memory.stop})};g.startCreep=function(d){Game.creeps[d]&&delete Game.creeps[d].memory.stop};g.stopCreep=function(d){Game.creeps[d]&&(Game.creeps[d].memory.stop=!0)};Memory.profiling&&e(1,4).registerObject(g,"Commands");l.exports=g;return l.exports};n[5]=function(l,g){g=function(){};g.progressBar=function(d,e,h,a,b,c,f,k){void 0===k.showMax&&(k.showMax=!0);void 0===k.valueDecimals&&(k.valueDecimals=0);d.rect(e,h,a,b,{fill:k.background}).rect(e,h,a*Math.min(c/f,1),b,{fill:k.bar}).text(""+
(k.label?k.label+" ":"")+c.toFixed(k.valueDecimals)+(k.showMax?"/"+f.toFixed(0):"")+(k.showDetails?" ("+(100*c/f).toFixed(3)+"%) "+(f-c).toFixed(0)+" to go":""),e+a/2,h+b/2+.175,{align:"center",color:k.color,font:k.font})};g.resource=function(d,e,h,a,b,c){switch(b){case RESOURCE_ENERGY:d.circle(e,h,{radius:.625*a/2,fill:"#FFE664",opacity:c.opacity});break;case RESOURCE_POWER:d.circle(e,h,{radius:.625*a/2,fill:"#FF1930",opacity:c.opacity});break;case RESOURCE_HYDROGEN:d.circle(e,h,{radius:.4375*a,
fill:"#B4B4B4",opacity:c.opacity}).circle(e,h,{radius:.375*a,fill:"#4C4C4C",opacity:c.opacity}).text(b,e,h+.2*a,{color:"#B4B4B4",size:.625*a,opacity:c.opacity});break;case RESOURCE_OXYGEN:d.circle(e,h,{radius:.4375*a,fill:"#B4B4B4",opacity:c.opacity}).circle(e,h,{radius:.375*a,fill:"#4C4C4C",opacity:c.opacity}).text(b,e,h+.2*a,{color:"#B4B4B4",size:.625*a,opacity:c.opacity});break;case RESOURCE_UTRIUM:d.circle(e,h,{radius:.4375*a,fill:"#50D7F9",opacity:c.opacity}).circle(e,h,{radius:.375*a,fill:"#006181",
opacity:c.opacity}).text(b,e,h+.2*a,{color:"#50D7F9",size:.625*a,opacity:c.opacity});break;case RESOURCE_KEANIUM:d.circle(e,h,{radius:.4375*a,fill:"#A071FF",opacity:c.opacity}).circle(e,h,{radius:.375*a,fill:"#371383",opacity:c.opacity}).text(b,e,h+.2*a,{color:"#A071FF",size:.625*a,opacity:c.opacity});break;case RESOURCE_LEMERGIUM:d.circle(e,h,{radius:.4375*a,fill:"#00F4A2",opacity:c.opacity}).circle(e,h,{radius:.375*a,fill:"#236144",opacity:c.opacity}).text(b,e,h+.2*a,{color:"#00F4A2",size:.625*
a,opacity:c.opacity});break;case RESOURCE_ZYNTHIUM:d.circle(e,h,{radius:.4375*a,fill:"#FDD388",opacity:c.opacity}).circle(e,h,{radius:.375*a,fill:"#5D4C2E",opacity:c.opacity}).text(b,e,h+.2*a,{color:"#FDD388",size:.625*a,opacity:c.opacity});break;case RESOURCE_CATALYST:d.circle(e,h,{radius:.4375*a,fill:"#FF7B7B",opacity:c.opacity}).circle(e,h,{radius:.375*a,fill:"#592121",opacity:c.opacity}).text(b,e,h+.2*a,{color:"#FF7B7B",size:.625*a,opacity:c.opacity});break;case RESOURCE_HYDROXIDE:d.rect(e-a/
2,h-a/2,1.375*a,a,{fill:"#B4B4B4",opacity:c.opacity}).text(b,e+.1875*a,h+.2*a,{color:"#666666",size:.625*a,opacity:c.opacity});break;case RESOURCE_ZYNTHIUM_KEANITE:d.rect(e-a/2,h-a/2,1.375*a,a,{fill:"#B4B4B4",opacity:c.opacity}).text(b,e+.1875*a,h+.2*a,{color:"#666666",size:.625*a,opacity:c.opacity});break;case RESOURCE_UTRIUM_LEMERGITE:d.rect(e-a/2,h-a/2,1.375*a,a,{fill:"#B4B4B4",opacity:c.opacity}).text(b,e+.1875*a,h+.2*a,{color:"#666666",size:.625*a,opacity:c.opacity});break;case RESOURCE_GHODIUM:d.rect(e-
a/2,h-a/2,a,a,{fill:"#FFFFFF",opacity:c.opacity}).text(b,e,h+.2*a,{color:"#666666",size:.625*a,opacity:c.opacity});break;case RESOURCE_UTRIUM_HYDRIDE:d.rect(e-a/2,h-a/2,1.375*a,a,{fill:"#50D7F9",opacity:c.opacity}).text(b,e+.1875*a,h+.2*a,{color:"#006181",font:.625*a,opacity:c.opacity});break;case RESOURCE_UTRIUM_OXIDE:d.rect(e-a/2,h-a/2,1.375*a,a,{fill:"#50D7F9",opacity:c.opacity}).text(b,e+.1875*a,h+.2*a,{color:"#006181",font:.625*a,opacity:c.opacity});break;case RESOURCE_KEANIUM_HYDRIDE:d.rect(e-
a/2,h-a/2,1.375*a,a,{fill:"#A071FF",opacity:c.opacity}).text(b,e+.1875*a,h+.2*a,{color:"#371383",font:.625*a,opacity:c.opacity});break;case RESOURCE_KEANIUM_OXIDE:d.rect(e-a/2,h-a/2,1.375*a,a,{fill:"#A071FF",opacity:c.opacity}).text(b,e+.1875*a,h+.2*a,{color:"#371383",font:.625*a,opacity:c.opacity});break;case RESOURCE_LEMERGIUM_HYDRIDE:d.rect(e-a/2,h-a/2,1.375*a,a,{fill:"#00F4A2",opacity:c.opacity}).text(b,e+.1875*a,h+.2*a,{color:"#236144",font:.625*a,opacity:c.opacity});break;case RESOURCE_LEMERGIUM_OXIDE:d.rect(e-
a/2,h-a/2,1.375*a,a,{fill:"#00F4A2",opacity:c.opacity}).text(b,e+.1875*a,h+.2*a,{color:"#236144",font:.625*a,opacity:c.opacity});break;case RESOURCE_ZYNTHIUM_HYDRIDE:d.rect(e-a/2,h-a/2,1.375*a,a,{fill:"#FDD388",opacity:c.opacity}).text(b,e+.1875*a,h+.2*a,{color:"#5D4C2E",font:.625*a,opacity:c.opacity});break;case RESOURCE_ZYNTHIUM_OXIDE:d.rect(e-a/2,h-a/2,1.375*a,a,{fill:"#FDD388",opacity:c.opacity}).text(b,e+.1875*a,h+.2*a,{color:"#5D4C2E",font:.625*a,opacity:c.opacity});break;case RESOURCE_GHODIUM_HYDRIDE:d.rect(e-
a/2,h-a/2,1.375*a,a,{fill:"#FFFFFF",opacity:c.opacity}).text(b,e+.1875*a,h+.2*a,{color:"#666666",font:.625*a,opacity:c.opacity});break;case RESOURCE_GHODIUM_OXIDE:d.rect(e-a/2,h-a/2,1.375*a,a,{fill:"#FFFFFF",opacity:c.opacity}).text(b,e+.1875*a,h+.2*a,{color:"#666666",font:.625*a,opacity:c.opacity});break;case RESOURCE_UTRIUM_ACID:d.rect(e-a/2,h-a/2,2.125*a,a,{fill:"#50D7F9",opacity:c.opacity}).text(b,e+.5*a,h+.2*a,{color:"#006181",font:.625*a,opacity:c.opacity});break;case RESOURCE_UTRIUM_ALKALIDE:d.rect(e-
a/2,h-a/2,2.125*a,a,{fill:"#50D7F9",opacity:c.opacity}).text(b,e+.5*a,h+.2*a,{color:"#006181",font:.625*a,opacity:c.opacity});break;case RESOURCE_KEANIUM_ACID:d.rect(e-a/2,h-a/2,2.125*a,a,{fill:"#A071FF",opacity:c.opacity}).text(b,e+.5*a,h+.2*a,{color:"#371383",font:.625*a,opacity:c.opacity});break;case RESOURCE_KEANIUM_ALKALIDE:d.rect(e-a/2,h-a/2,2.125*a,a,{fill:"#A071FF",opacity:c.opacity}).text(b,e+.5*a,h+.2*a,{color:"#371383",font:.625*a,opacity:c.opacity});break;case RESOURCE_LEMERGIUM_ACID:d.rect(e-
a/2,h-a/2,2.125*a,a,{fill:"#00F4A2",opacity:c.opacity}).text(b,e+.5*a,h+.2*a,{color:"#236144",font:.625*a,opacity:c.opacity});break;case RESOURCE_LEMERGIUM_ALKALIDE:d.rect(e-a/2,h-a/2,2.125*a,a,{fill:"#00F4A2",opacity:c.opacity}).text(b,e+.5*a,h+.2*a,{color:"#236144",font:.625*a,opacity:c.opacity});break;case RESOURCE_ZYNTHIUM_ACID:d.rect(e-a/2,h-a/2,2.125*a,a,{fill:"#FDD388",opacity:c.opacity}).text(b,e+.5*a,h+.2*a,{color:"#5D4C2E",font:.625*a,opacity:c.opacity});break;case RESOURCE_ZYNTHIUM_ALKALIDE:d.rect(e-
a/2,h-a/2,2.125*a,a,{fill:"#FDD388",opacity:c.opacity}).text(b,e+.5*a,h+.2*a,{color:"#5D4C2E",font:.625*a,opacity:c.opacity});break;case RESOURCE_GHODIUM_ACID:d.rect(e-a/2,h-a/2,2.125*a,a,{fill:"#FFFFFF",opacity:c.opacity}).text(b,e+.5*a,h+.2*a,{color:"#666666",font:.625*a,opacity:c.opacity});break;case RESOURCE_GHODIUM_ALKALIDE:d.rect(e-a/2,h-a/2,2.125*a,a,{fill:"#FFFFFF",opacity:c.opacity}).text(b,e+.5*a,h+.2*a,{color:"#666666",font:.625*a,opacity:c.opacity});break;case RESOURCE_CATALYZED_UTRIUM_ACID:d.rect(e-
a/2,h-a/2,2.5*a,a,{fill:"#50D7F9",opacity:c.opacity}).text(b,e+.725*a,h+.2*a,{color:"#006181",font:.625*a,opacity:c.opacity});break;case RESOURCE_CATALYZED_UTRIUM_ALKALIDE:d.rect(e-a/2,h-a/2,2.5*a,a,{fill:"#50D7F9",opacity:c.opacity}).text(b,e+.725*a,h+.2*a,{color:"#006181",font:.625*a,opacity:c.opacity});break;case RESOURCE_CATALYZED_KEANIUM_ACID:d.rect(e-a/2,h-a/2,2.5*a,a,{fill:"#A071FF",opacity:c.opacity}).text(b,e+.725*a,h+.2*a,{color:"#371383",font:.625*a,opacity:c.opacity});break;case RESOURCE_CATALYZED_KEANIUM_ALKALIDE:d.rect(e-
a/2,h-a/2,2.5*a,a,{fill:"#A071FF",opacity:c.opacity}).text(b,e+.725*a,h+.2*a,{color:"#371383",font:.625*a,opacity:c.opacity});break;case RESOURCE_CATALYZED_LEMERGIUM_ACID:d.rect(e-a/2,h-a/2,2.5*a,a,{fill:"#00F4A2",opacity:c.opacity}).text(b,e+.725*a,h+.2*a,{color:"#236144",font:.625*a,opacity:c.opacity});break;case RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE:d.rect(e-a/2,h-a/2,2.5*a,a,{fill:"#00F4A2",opacity:c.opacity}).text(b,e+.725*a,h+.2*a,{color:"#236144",font:.625*a,opacity:c.opacity});break;case RESOURCE_CATALYZED_ZYNTHIUM_ACID:d.rect(e-
a/2,h-a/2,2.5*a,a,{fill:"#FDD388",opacity:c.opacity}).text(b,e+.725*a,h+.2*a,{color:"#5D4C2E",font:.625*a,opacity:c.opacity});break;case RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE:d.rect(e-a/2,h-a/2,2.5*a,a,{fill:"#FDD388",opacity:c.opacity}).text(b,e+.725*a,h+.2*a,{color:"#5D4C2E",font:.625*a,opacity:c.opacity});break;case RESOURCE_CATALYZED_GHODIUM_ACID:d.rect(e-a/2,h-a/2,2.5*a,a,{fill:"#FFFFFF",opacity:c.opacity}).text(b,e+.725*a,h+.2*a,{color:"#666666",font:.625*a,opacity:c.opacity});break;case RESOURCE_CATALYZED_GHODIUM_ALKALIDE:d.rect(e-
a/2,h-a/2,2.5*a,a,{fill:"#FFFFFF",opacity:c.opacity}).text(b,e+.725*a,h+.2*a,{color:"#666666",font:.625*a,opacity:c.opacity})}};g.sparkline=function(d,e,h,a,b,c,f){d.rect(e,h,a,b,{fill:"#404040",opacity:.5});_.forEach(f,function(k){d.poly(_.map(c,function(f,d){return[e+d/(c.length-1)*a,h+b*(1-(f[k.key]-k.min)/(k.max-k.min))]}),k)})};Memory.profiling&&e(1,5).registerObject(g,"Drawing");l.exports=g;return l.exports};n[6]=function(l,g){var d=e(3,6),m=e(9,6),h=function(){};h.getAllOrders=function(){if(!h.orders||
Game.cpu.bucket>=Memory.marketBucket)h.orders=Game.market.getAllOrders(),delete h.filteredOrders;return h.orders};h.getFilteredOrders=function(){h.filteredOrders||(h.filteredOrders=m.nest(_.filter(h.getAllOrders(),function(a){return 0<a.amount}),[function(a){return a.type},function(a){return a.resourceType}]),_.forEach(h.filteredOrders.sell,function(a,b){h.filteredOrders.sell[b].sort(function(a,b){return a.price-b.price})}),_.forEach(h.filteredOrders.buy,function(a,b){h.filteredOrders.buy[b].sort(function(a,
b){return b.price-a.price})}));return h.filteredOrders};h.deal=function(a,b,c){c=Game.market.deal(a,b,c);var f=_.find(h.orders,function(b){return b.id===a});c===OK?f&&("sell"===f.type&&(d.credits-=f.amount*f.price),f.amount<=b?(_.remove(h.filteredOrders[f.type][f.resourceType],function(b){return b.id===a}),_.remove(h.orders,function(b){return b.id===a})):f.amount-=b):f&&(_.remove(h.filteredOrders[f.type][f.resourceType],function(b){return b.id===a}),_.remove(h.orders,function(b){return b.id===a}));
return c};Memory.profiling&&e(1,6).registerObject(h,"Market");l.exports=h;return l.exports};n[7]=function(e,g){g={};g[RESOURCE_HYDROGEN]=[];g[RESOURCE_OXYGEN]=[];g[RESOURCE_ZYNTHIUM]=[];g[RESOURCE_KEANIUM]=[];g[RESOURCE_UTRIUM]=[];g[RESOURCE_LEMERGIUM]=[];g[RESOURCE_CATALYST]=[];g[RESOURCE_HYDROXIDE]=[RESOURCE_HYDROGEN,RESOURCE_OXYGEN];g[RESOURCE_ZYNTHIUM_KEANITE]=[RESOURCE_ZYNTHIUM,RESOURCE_KEANIUM];g[RESOURCE_UTRIUM_LEMERGITE]=[RESOURCE_UTRIUM,RESOURCE_LEMERGIUM];g[RESOURCE_GHODIUM]=[RESOURCE_ZYNTHIUM_KEANITE,
RESOURCE_UTRIUM_LEMERGITE];g[RESOURCE_UTRIUM_HYDRIDE]=[RESOURCE_UTRIUM,RESOURCE_HYDROGEN];g[RESOURCE_UTRIUM_OXIDE]=[RESOURCE_UTRIUM,RESOURCE_OXYGEN];g[RESOURCE_KEANIUM_HYDRIDE]=[RESOURCE_KEANIUM,RESOURCE_HYDROGEN];g[RESOURCE_KEANIUM_OXIDE]=[RESOURCE_KEANIUM,RESOURCE_OXYGEN];g[RESOURCE_LEMERGIUM_HYDRIDE]=[RESOURCE_LEMERGIUM,RESOURCE_HYDROGEN];g[RESOURCE_LEMERGIUM_OXIDE]=[RESOURCE_LEMERGIUM,RESOURCE_OXYGEN];g[RESOURCE_ZYNTHIUM_HYDRIDE]=[RESOURCE_ZYNTHIUM,RESOURCE_HYDROGEN];g[RESOURCE_ZYNTHIUM_OXIDE]=
[RESOURCE_ZYNTHIUM,RESOURCE_OXYGEN];g[RESOURCE_GHODIUM_HYDRIDE]=[RESOURCE_GHODIUM,RESOURCE_HYDROGEN];g[RESOURCE_GHODIUM_OXIDE]=[RESOURCE_GHODIUM,RESOURCE_OXYGEN];g[RESOURCE_UTRIUM_ACID]=[RESOURCE_UTRIUM_HYDRIDE,RESOURCE_HYDROXIDE];g[RESOURCE_UTRIUM_ALKALIDE]=[RESOURCE_UTRIUM_OXIDE,RESOURCE_HYDROXIDE];g[RESOURCE_KEANIUM_ACID]=[RESOURCE_KEANIUM_HYDRIDE,RESOURCE_HYDROXIDE];g[RESOURCE_KEANIUM_ALKALIDE]=[RESOURCE_KEANIUM_OXIDE,RESOURCE_HYDROXIDE];g[RESOURCE_LEMERGIUM_ACID]=[RESOURCE_LEMERGIUM_HYDRIDE,
RESOURCE_HYDROXIDE];g[RESOURCE_LEMERGIUM_ALKALIDE]=[RESOURCE_LEMERGIUM_OXIDE,RESOURCE_HYDROXIDE];g[RESOURCE_ZYNTHIUM_ACID]=[RESOURCE_ZYNTHIUM_HYDRIDE,RESOURCE_HYDROXIDE];g[RESOURCE_ZYNTHIUM_ALKALIDE]=[RESOURCE_ZYNTHIUM_OXIDE,RESOURCE_HYDROXIDE];g[RESOURCE_GHODIUM_ACID]=[RESOURCE_GHODIUM_HYDRIDE,RESOURCE_HYDROXIDE];g[RESOURCE_GHODIUM_ALKALIDE]=[RESOURCE_GHODIUM_OXIDE,RESOURCE_HYDROXIDE];g[RESOURCE_CATALYZED_UTRIUM_ACID]=[RESOURCE_UTRIUM_ACID,RESOURCE_CATALYST];g[RESOURCE_CATALYZED_UTRIUM_ALKALIDE]=
[RESOURCE_UTRIUM_ALKALIDE,RESOURCE_CATALYST];g[RESOURCE_CATALYZED_KEANIUM_ACID]=[RESOURCE_KEANIUM_ACID,RESOURCE_CATALYST];g[RESOURCE_CATALYZED_KEANIUM_ALKALIDE]=[RESOURCE_KEANIUM_ALKALIDE,RESOURCE_CATALYST];g[RESOURCE_CATALYZED_LEMERGIUM_ACID]=[RESOURCE_LEMERGIUM_ACID,RESOURCE_CATALYST];g[RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE]=[RESOURCE_LEMERGIUM_ALKALIDE,RESOURCE_CATALYST];g[RESOURCE_CATALYZED_ZYNTHIUM_ACID]=[RESOURCE_ZYNTHIUM_ACID,RESOURCE_CATALYST];g[RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE]=[RESOURCE_ZYNTHIUM_ALKALIDE,
RESOURCE_CATALYST];g[RESOURCE_CATALYZED_GHODIUM_ACID]=[RESOURCE_GHODIUM_ACID,RESOURCE_CATALYST];g[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]=[RESOURCE_GHODIUM_ALKALIDE,RESOURCE_CATALYST];g[RESOURCE_POWER]=[];e.exports=g;return e.exports};n[8]=function(l,g){var d=e(3,8);g=function(){};g.assignTasks=function(e){var h=e.tasks;e=d.towersInRoom(e.room);0<_.filter(e,function(a){return 0===a.energy}).length||(0<h.hostiles.length&&0===_.filter(e,function(a){return 500>a.energy}).length?_.forEach(e,function(a){a.attack(h.hostiles[0])}):
0<h.criticalRepairableStructures.length?_.forEach(e,function(a){a.repair(h.criticalRepairableStructures[0])}):0<h.hurtCreeps.length&&_.forEach(e,function(a){a.heal(h.hurtCreeps[0])}))};Memory.profiling&&e(1,8).registerObject(g,"Tower");l.exports=g;return l.exports};n[9]=function(l,g){var d=e(3,9),m=function(){};m.buildStructures=function(d,a,b,c){var f=c.pos;c=f.x;for(var f=f.y,k=1;0<b&&50>k;){var e={};for(e.x=c-k;e.x<=c+k;e={x:e.x},e.x+=2){var h={};for(h.y=f-k;h.y<=f+k;h={y:h.y},h.y+=Math.abs(c-
e.x)===k?2:2*k)if(!(1>e.x||48<e.x||1>h.y||48<h.y||0<d.find(FIND_MY_CONSTRUCTION_SITES,{filter:function(a,b){return function(c){return c.pos.x===a.x&&c.pos.y===b.y}}(e,h)}).length)){var g=m.checkSiteIsClear(new RoomPosition(e.x,h.y,d.name));if(!1!==g&&(!0!==g&&_.forEach(g,function(a){a.destroy()}),d.createConstructionSite(e.x,h.y,a),b--,0===b))break}if(0===b)break}k++}};m.checkQuadrant=function(d,a){switch(a){default:return 25>d.x&&25>d.y;case 1:return 25>d.x&&25<=d.y;case 2:return 25<=d.x&&25<=d.y;
case 3:return 25<=d.x&&25>d.y}};m.checkSiteIsClear=function(d){var a=d.x,b=d.y,c=d.roomName,f=Game.rooms[c],k=!0;if("wall"===(new RoomPosition(a,b,c)).lookFor(LOOK_TERRAIN)[0]||"wall"===(new RoomPosition(a-1,b,c)).lookFor(LOOK_TERRAIN)[0]&&"wall"===(new RoomPosition(a+1,b,c)).lookFor(LOOK_TERRAIN)[0]||"wall"===(new RoomPosition(a,b-1,c)).lookFor(LOOK_TERRAIN)[0]&&"wall"===(new RoomPosition(a,b+1,c)).lookFor(LOOK_TERRAIN)[0])return!1;_.forEach(f.find(FIND_SOURCES),function(a){return k=1<d.getRangeTo(a)});
if(!k)return!1;_.forEach(f.find(FIND_MINERALS),function(a){return k=1<d.getRangeTo(a)});if(!k||4>=d.getRangeTo(f.controller))return!1;a=_.filter(d.lookFor(LOOK_STRUCTURES),function(a){return"rampart"!==a.structureType});return 0===a.length?!0:_.filter(a,function(a){return-1!==[STRUCTURE_ROAD,STRUCTURE_WALL].indexOf(a.structureType)}).length!==a.length?!1:a};m.creepsWithNoTask=function(d){return _.filter(d,function(a){return!a.memory.currentTask||a.memory.currentTask.unimportant})};m.getBodypartCost=
function(d){return _.sum(_.map(d,function(a){return BODYPART_COST[a]}))};m.getControllerOwner=function(d){return d.owner?d.owner.username:d.reservation?d.reservation.owner:""};m.getLabToBoostWith=function(e,a){var b=e.memory,c=e.memory.labQueue,f=[],k=c&&c.sourceLabs||[];a||(a=1);0===k.length&&(k=m.getSourceLabs(e));b.labsInUse||(b.labsInUse=[]);for(c=0;c<a;c++){var h=_.filter(d.labsInRoom(e),function(a){return-1===k.indexOf(a.id)&&-1===_.map(b.labsInUse,function(a){return a.id}).indexOf(a.id)&&-1===
_.map(f,function(a){return a.id}).indexOf(a.id)}),g={};0<h.length&&(g={id:h[0].id,pause:!1});if(!g||!g.id){g={id:_.filter(k,function(a){return-1===_.map(b.labsInUse,function(a){return a.id}).indexOf(a)&&-1===_.map(f,function(a){return a.id}).indexOf(a)})[0],pause:!0};if(!g.id)return!1;h=Game.getObjectById(g.id);0<h.mineralAmount&&(g.status="emptying",g.oldResource=h.mineralType,g.oldAmount=h.mineralAmount)}if(!g.id)return!1;f.push(g)}return f};m.getSourceLabs=function(e){var a=d.labsInRoom(e),b=[];
_.forEach(a,function(c){return 2>=m.objectsClosestToObj(a,c)[a.length-1].pos.getRangeTo(c)&&(b.push(c.id),2<=b.length)?!1:!0});return b};m.nest=function(d,a){return a.length?_.mapValues(_.groupBy(d,a[0]),function(b){return m.nest(b,a.slice(1))}):d};m.objectsClosestToObj=function(d,a){var b=a.id;if(0===d.length)return[];if(!a)return d;var c=Memory,f=c.ranges,k=c.ranges[b];d=_.map(d,function(c){var d=c.id;if(f&&f[b]&&f[b][d])var e=k[d];else e=a.pos.getRangeTo(c),c instanceof Creep||a instanceof Creep||
(f[b]||(f[b]={}),f[b][d]=e);return{object:c,distance:e}});d.sort(function(a,b){return a.distance-b.distance});return _.map(d,function(a){return a.object})};m.roomLabsArePaused=function(d){return(d=d.memory.labsInUse)&&0<_.filter(d,function(a){return a.pause}).length};Memory.profiling&&e(1,9).registerObject(m,"Utilities");l.exports=m;return l.exports};n[10]=function(l,g){var d=e(56,10),m=e(3,10),h=e(9,10);g=function(){};g.spawnSettings=function(a){var b=a.dismantler.units,c=[TOUGH,TOUGH,TOUGH,TOUGH,
TOUGH];c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(b).fill(WORK))));c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(a.super?10:b+5).fill(MOVE))));if(a.boostRoom){var f={};f[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]=5;f[RESOURCE_CATALYZED_ZYNTHIUM_ACID]=b;a.super&&(f[RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE]=10)}return{body:c,boosts:f,name:"armyDismantler"}};g.assignTasks=function(a){var b=m.creeps[a.name];d.getBoost(_.filter(b&&b.armyDismantler||[],function(a){return!a.spawning}),"Boosting");
switch(a.directive){case "building":this.assignBuildingTasks(a);break;case "staging":this.assignStagingTasks(a);break;case "dismantle":this.assignDismantleTasks(a);break;case "attack":this.assignAttackTasks(a)}};g.assignBuildingTasks=function(a){var b=m.creeps[a.name],b=_.filter(h.creepsWithNoTask(b&&b.armyDismantler||[]),function(a){return!a.spawning});0!==b.length&&d.moveToRoom(b,a.buildRoom,"Building")};g.assignStagingTasks=function(a){var b=m.creeps[a.name],b=_.filter(h.creepsWithNoTask(b&&b.armyDismantler||
[]),function(a){return!a.spawning});0!==b.length&&d.moveToRoom(_.filter(b,function(a){return!a.spawning}),a.stageRoom,"Staging")};g.assignDismantleTasks=function(a){var b=a.attackRoom,c=m.creeps[a.name],f=c&&c.armyDismantler||[],k=_.filter(h.creepsWithNoTask(f),function(a){return!a.spawning});0!==k.length&&(d.retreatArmyUnitOrMoveToHealer(f,c&&c.armyHealer||[],a.stageRoom,b,.8,"Ouch!"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===
Game.time)}),0!==k.length&&(d.dismantleArmyTarget(k,b,a.dismantle,"Dismantle"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&d.moveToRoom(k,b,"Attacking")))};g.assignAttackTasks=function(a){var b=a.attackRoom,c=m.creeps[a.name],f=c&&c.armyDismantler||[],k=_.filter(h.creepsWithNoTask(f),function(a){return!a.spawning});0!==k.length&&(d.retreatArmyUnit(f,c&&c.armyHealer||[],a.stageRoom,b,.8,"Ouch!"),
_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.dismantleHostileStructures(k,b,"Dismantle"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.stomp(k,a.hostileConstructionSites,"Stomping"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===
Game.time)}),0!==k.length&&((a=a.restPosition)?d.moveToPos(k,new RoomPosition(a.x,a.y,a.room),void 0,"Attacking"):d.moveToRoom(k,b,"Attacking")))))};Memory.profiling&&e(1,10).registerObject(g,"RoleArmyDismantler");l.exports=g;return l.exports};n[11]=function(l,g){var d=e(56,11),m=e(3,11),h=e(9,11);g=function(){};g.spawnSettings=function(a){var b=a.healer.units,c=[TOUGH,TOUGH,TOUGH,TOUGH,TOUGH];c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(b-1).fill(HEAL))));c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(a.super?
10:b+5).fill(MOVE))));c.push(HEAL);if(a.boostRoom){var f={};f[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]=5;f[RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE]=b;a.super&&(f[RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE]=10)}return{body:c,boosts:f,name:"armyHealer"}};g.assignTasks=function(a){var b=m.creeps[a.name],b=b&&b.armyHealer||[];d.getBoost(_.filter(b,function(a){return!a.spawning}),"Boosting");d.escort(_.filter(b,function(a){return!a.memory.labs||0===a.memory.labs.length}),"Healing");switch(a.directive){case "building":this.assignBuildingTasks(a);
break;case "staging":this.assignStagingTasks(a);break;case "dismantle":this.assignDismantleTasks(a);break;case "attack":this.assignAttackTasks(a)}};g.assignBuildingTasks=function(a){var b=m.creeps[a.name],c=_.filter(h.creepsWithNoTask(b&&b.armyHealer||[]),function(a){return!a.spawning&&!a.memory.escorting});0!==c.length&&(d.heal(c,_.filter(b&&b.all||[],function(a){return a.hits<a.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}),"Healing"),_.remove(c,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==c.length&&d.moveToRoom(c,a.buildRoom,"Building"))};g.assignStagingTasks=function(a){var b=m.creeps[a.name],c=_.filter(h.creepsWithNoTask(b&&b.armyHealer||[]),function(a){return!a.spawning&&!a.memory.escorting});0!==c.length&&(d.heal(c,_.filter(b&&b.all||[],function(a){return a.hits<a.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}),"Healing"),_.remove(c,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==c.length&&d.moveToRoom(c,a.stageRoom,"Staging"))};g.assignDismantleTasks=function(a){var b=m.creeps[a.name],c=b&&b.armyHealer||[],f=a.attackRoom,k=_.filter(h.creepsWithNoTask(c),function(a){return!a.spawning&&!a.memory.escorting});if(0!==k.length&&(d.retreatArmyUnit(c,c,a.stageRoom,f,.8,"Ouch!"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===
Game.time)}),0!==k.length&&(d.heal(k,_.filter(b&&b.all||[],function(a){return a.hits<a.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}),"Healing"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length))){if(Game.rooms[f]&&0<a.dismantle.length&&(a=Game.getObjectById(a.dismantle["0"]))&&(d.moveToPos(k,a.pos,3,"Attacking"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||
a.memory.currentTask.priority===Game.time)}),0===k.length))return;d.moveToRoom(k,f,"Attacking")}};g.assignAttackTasks=function(a){var b=m.creeps[a.name],c=b&&b.armyHealer||[],f=a.attackRoom,k=_.filter(h.creepsWithNoTask(c),function(a){return!a.spawning&&!a.memory.escorting});if(0!==k.length&&(d.retreatArmyUnit(c,c,a.stageRoom,f,.8,"Ouch!"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.heal(k,_.filter(b&&
b.all||[],function(a){return a.hits<a.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}),"Healing"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length))){if(b=Game.rooms[f])if(d.heal(k,_.filter(b.find(FIND_MY_CREEPS),function(a){return a.hits<a.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}),"Healing"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||
a.memory.currentTask.priority===Game.time)}),0===k.length)return;d.stomp(k,a.hostileConstructionSites,"Stomping");_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==k.length&&((a=a.restPosition)?d.moveToPos(k,new RoomPosition(a.x,a.y,a.room),void 0,"Attacking"):d.moveToRoom(k,f,"Attacking"))}};Memory.profiling&&e(1,11).registerObject(g,"RoleArmyHealer");l.exports=g;return l.exports};n[12]=function(l,g){var d=e(56,
12),m=e(3,12),h=e(9,12);g=function(){};g.spawnSettings=function(a){var b=a.melee.units,c=[TOUGH,TOUGH,TOUGH,TOUGH,TOUGH];c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(b).fill(ATTACK))));c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(a.super?10:b+5).fill(MOVE))));if(a.boostRoom){var f={};f[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]=5;f[RESOURCE_CATALYZED_UTRIUM_ACID]=b;a.super&&(f[RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE]=10)}return{body:c,boosts:f,name:"armyMelee"}};g.assignTasks=function(a){var b=
m.creeps[a.name];d.getBoost(_.filter(b&&b.armyMelee||[],function(a){return!a.spawning}),"Boosting");switch(a.directive){case "building":this.assignBuildingTasks(a);break;case "staging":this.assignStagingTasks(a);break;case "dismantle":this.assignDismantleTasks(a);break;case "attack":this.assignAttackTasks(a)}};g.assignBuildingTasks=function(a){var b=m.creeps[a.name],b=_.filter(h.creepsWithNoTask(b&&b.armyMelee||[]),function(a){return!a.spawning});0!==b.length&&(d.attack(b,a.hostiles,"Attacking"),
_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==b.length&&d.moveToRoom(b,a.buildRoom,"Building"))};g.assignStagingTasks=function(a){var b=m.creeps[a.name],b=_.filter(h.creepsWithNoTask(b&&b.armyMelee||[]),function(a){return!a.spawning});0!==b.length&&(d.attack(b,a.hostiles,"Attacking"),_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),
0!==b.length&&d.moveToRoom(b,a.stageRoom,"Staging"))};g.assignDismantleTasks=function(a){var b=m.creeps[a.name],c=b&&b.armyMelee||[],f=a.attackRoom,k=_.filter(h.creepsWithNoTask(c),function(a){return!a.spawning});if(0!==k.length&&(d.retreatArmyUnitOrMoveToHealer(c,b&&b.armyHealer||[],a.stageRoom,f,.8,"Ouch!"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.attack(k,a.hostiles,"Attacking"),_.remove(k,
function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length))){a=a.dismantle;if(Game.rooms[f]&&0<a.length&&(a=Game.getObjectById(a["0"]))&&(d.moveToPos(k,a.pos,3,"Attacking"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0===k.length))return;d.moveToRoom(k,f,"Attacking")}};g.assignAttackTasks=function(a){var b=m.creeps[a.name],c=b&&b.armyMelee||
[],f=a.attackRoom,k=_.filter(h.creepsWithNoTask(c),function(a){return!a.spawning});0!==k.length&&(d.retreatArmyUnit(c,b&&b.armyHealer||[],a.stageRoom,f,.8,"Ouch!"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.attack(k,a.hostiles,"Attacking"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.stomp(k,
a.hostileConstructionSites,"Stomping"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&((a=a.restPosition)?d.moveToPos(k,new RoomPosition(a.x,a.y,a.room),void 0,"Attacking"):d.moveToRoom(k,f,"Attacking")))))};Memory.profiling&&e(1,12).registerObject(g,"RoleArmyMelee");l.exports=g;return l.exports};n[13]=function(l,g){var d=e(56,13),m=e(3,13),h=e(9,13);g=function(){};g.spawnSettings=function(a){var b=
a.ranged.units,c=[TOUGH,TOUGH,TOUGH,TOUGH,TOUGH];c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(b).fill(RANGED_ATTACK))));c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(a.super?10:b+5).fill(MOVE))));if(a.boostRoom){var f={};f[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]=5;f[RESOURCE_CATALYZED_KEANIUM_ALKALIDE]=b;a.super&&(f[RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE]=10)}return{body:c,boosts:f,name:"armyRanged"}};g.assignTasks=function(a){var b=m.creeps[a.name];d.getBoost(_.filter(b&&b.armyRanged||
[],function(a){return!a.spawning}),"Boosting");switch(a.directive){case "building":this.assignBuildingTasks(a);break;case "staging":this.assignStagingTasks(a);break;case "dismantle":this.assignDismantleTasks(a);break;case "attack":this.assignAttackTasks(a)}};g.assignBuildingTasks=function(a){var b=m.creeps[a.name],b=_.filter(h.creepsWithNoTask(b&&b.armyRanged||[]),function(a){return!a.spawning});0!==b.length&&(d.rangedAttack(b,a.hostiles,"Attacking"),_.remove(b,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==b.length&&d.moveToRoom(b,a.buildRoom,"Building"))};g.assignStagingTasks=function(a){var b=m.creeps[a.name],b=_.filter(h.creepsWithNoTask(b&&b.armyRanged||[]),function(a){return!a.spawning});0!==b.length&&(d.rangedAttack(b,a.hostiles,"Attacking"),_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==b.length&&d.moveToRoom(b,a.stageRoom,
"Staging"))};g.assignDismantleTasks=function(a){var b=m.creeps[a.name],c=b&&b.armyRanged||[],f=a.attackRoom,k=_.filter(h.creepsWithNoTask(c),function(a){return!a.spawning});if(0!==k.length&&(d.retreatArmyUnitOrMoveToHealer(c,b&&b.armyHealer||[],a.stageRoom,f,.8,"Ouch!"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.rangedAttack(k,a.hostiles,"Attacking"),_.remove(k,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length))){a=a.dismantle;if(Game.rooms[f]&&0<a.length&&(a=Game.getObjectById(a["0"]))&&(d.moveToPos(k,a.pos,3,"Attacking"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0===k.length))return;d.moveToRoom(k,f,"Attacking")}};g.assignAttackTasks=function(a){var b=m.creeps[a.name],c=b&&b.armyRanged||[],f=a.attackRoom,k=_.filter(h.creepsWithNoTask(c),
function(a){return!a.spawning});0!==k.length&&(d.retreatArmyUnit(c,b&&b.armyHealer||[],a.stageRoom,f,.8,"Ouch!"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.rangedAttack(k,a.hostiles,"Attacking"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.stomp(k,a.hostileConstructionSites,"Stomping"),_.remove(k,
function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&((a=a.restPosition)?d.moveToPos(k,new RoomPosition(a.x,a.y,a.room),void 0,"Attacking"):d.moveToRoom(k,f,"Attacking")))))};Memory.profiling&&e(1,13).registerObject(g,"RoleArmyRanged");l.exports=g;return l.exports};n[14]=function(l,g){var d=e(56,14),m=e(3,14),h=e(9,14);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("claimer"),f;if(c)return c;
var c=Memory.maxCreeps.claimer,k=a.room.name;if(!b)return{name:"claimer",spawn:!1,max:c&&c[k]?Object.keys(c[k]).length:0};var d=(b=m.creeps[k])&&b.claimer||[];c&&_.forEach(c[k],function(a,b){return 0===_.filter(d,function(a){return a.memory.claim===b}).length?(f=b,!1):!0});c={name:"claimer",spawn:!!f,max:c&&c[k]?Object.keys(c[k]).length:0,roomToClaim:f};0<d.length&&(a.room.memory.maxCreeps.claimer={cache:c,cacheUntil:Game.time+(c.spawn?100:Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(d,
function(a){return a.spawning?100:Math.min(a.ticksToLive,100)})))))});return c};g.spawnSettings=function(a){return{body:[CLAIM,MOVE],memory:{role:"claimer",home:a.home,claim:a.roomToClaim}}};g.assignTasks=function(a){a=m.creeps[a.room.name];a=_.filter(h.creepsWithNoTask(a&&a.claimer||[]),function(a){return!a.spawning});0!==a.length&&d.claimController(a,"Claiming")};Memory.profiling&&e(1,14).registerObject(g,"RoleClaimer");l.exports=g;return l.exports};n[15]=function(l,g){var d=e(56,15),m=e(3,15),
h=e(9,15);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("collector"),f;if(c)return c;var c=a.room,k=c.storage;if(0!==m.containersInRoom(c).length&&k&&k.my)return{name:"collector",spawn:!1,max:0};k=c.find(FIND_SOURCES);if(1>=k.length)return{name:"collector",spawn:!1,max:0};var d=3*(k.length-1);if(!b)return{name:"collector",spawn:!1,max:d};var e=(b=m.creeps[c.name])&&b.collector||[];_.forEach(h.objectsClosestToObj(k,m.spawnsInRoom(c)[0]),function(a,b){if(0===b)return!0;
var c=a.id;return 3>_.filter(e,function(a){return a.memory.homeSource===c&&(a.spawning||150<=a.ticksToLive)}).length?(f=c,!1):!0});c={name:"collector",spawn:!!f,max:d,spawnFromRegion:!0,sourceIdToCollectFrom:f};0<e.length&&(a.room.memory.maxCreeps.collector={cache:c,cacheUntil:Game.time+(c.spawn?100:Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(e,function(a){return a.spawning?100:Math.min(a.ticksToLive-150,100)})))))});return c};g.spawnSettings=function(a){var b=Math.min(a.energyCapacityAvailable,
3300),c=Math.floor(b/200),b=b%200,f=[];f.push.apply(f,[].concat($jscomp.arrayFromIterable(Array(c+(150<=b?1:0)).fill(WORK))));f.push.apply(f,[].concat($jscomp.arrayFromIterable(Array(c+(100<=b&&150>b?1:0)).fill(CARRY))));f.push.apply(f,[].concat($jscomp.arrayFromIterable(Array(c+(50<=b?1:0)).fill(MOVE))));return{body:f,memory:{role:"collector",home:a.home,homeSource:a.sourceIdToCollectFrom}}};g.assignTasks=function(a){var b=a.room;a=a.tasks;var c=b.controller,f=m.creeps[b.name],k=_.filter(h.creepsWithNoTask(f&&
f.collector||[]),function(a){return!a.spawning&&150<a.ticksToLive}),f=f&&f.all||[];0!==k.length&&(d.upgradeCriticalController(k,c,"Upgrade"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.fillExtensions(k,f,b.controller.level,a.extensions,"Extension"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&
(d.fillSpawns(k,f,a.spawns,"Spawn"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.fillTowersWithEnergy(k,f,a.towers,"Tower"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.repairStructures(k,f,a.criticalRepairableStructures,"CritRepair"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||
a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.build(k,f,a.constructionSites,"Build"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.repairStructures(k,f,a.repairableStructures,"Repair"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.upgradeController(k,c,"Upgrade"),_.remove(k,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.pickupResources(k,f,m.resourcesInRoom(b),a.hostiles,"Pickup"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.collectEnergy(k,f,a.structuresWithEnergy,"Collecting"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==
k.length&&(d.harvest(k,"Harvesting"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&d.moveToHomeSource(k))))))))))))};Memory.profiling&&e(1,15).registerObject(g,"RoleCollector");l.exports=g;return l.exports};n[16]=function(l,g){var d=e(56,16),m=e(3,16),h=e(9,16);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("defender");if(c)return c;if(!b)return{name:"defender",spawn:!1,
max:1};b=(c=m.creeps[a.room.name])&&c.defender||[];c={name:"defender",spawn:1>_.filter(b||[],function(a){return a.spawning||300<=a.ticksToLive}).length,spawnFromRegion:!0,max:1};0<b.length&&(a.room.memory.maxCreeps.defender={cache:c,cacheUntil:Game.time+(c.spawn?25:Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(b,function(a){return a.spawning?25:Math.min(a.ticksToLive-300,25)})))))});return c};g.spawnSettings=function(a){return{body:[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,
MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,HEAL,HEAL,HEAL,HEAL,HEAL],memory:{role:"defender",home:a.home,supportRoom:a.supportRoom,quadrant:0}}};g.assignTasks=function(a){var b=a.room.name;a=a.tasks;var c=m.creeps[b],c=_.filter(h.creepsWithNoTask(c&&c.defender||[]),function(a){return!a.spawning});0!==c.length&&(d.attackTarget(c,
a.hostiles,"Die!"),_.remove(c,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==c.length&&(d.attackInQuadrant(c,a.hostiles,"Die!"),_.remove(c,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==c.length&&(d.moveToSourceKeeper(c,a.keepers),_.remove(c,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===
Game.time)}),0!==c.length&&(d.moveToRoom(c,b),_.forEach(_.filter(c,function(a){return!a.memory.currentTask||a.memory.currentTask.unimportant}),function(a){a.memory.quadrant=(a.memory.quadrant+1)%4||0})))))};Memory.profiling&&e(1,16).registerObject(g,"RoleDefender");l.exports=g;return l.exports};n[17]=function(l,g){var d=e(56,17),m=e(3,17),h=e(9,17);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("dismantler");if(c)return c;if(!b)return{name:"dismantler",spawn:!1,
max:0};b=(c=m.creeps[a.room.name])&&c.dismantler||[];c={name:"dismantler",spawn:1>_.filter(b||[],function(a){return a.spawning||150<=a.ticksToLive}).length,spawnFromRegion:!0,max:1};0<b.length&&(a.room.memory.maxCreeps.dismantler={cache:c,cacheUntil:Game.time+(c.spawn?100:Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(b,function(a){return a.spawning?100:Math.min(a.ticksToLive-300,100)})))))});return c};g.spawnSettings=function(a){var b=Math.min(a.energyCapacityAvailable,3300),c=Math.floor(b/
200),b=b%200,f=[];f.push.apply(f,[].concat($jscomp.arrayFromIterable(Array(c+(150<=b?1:0)).fill(WORK))));f.push.apply(f,[].concat($jscomp.arrayFromIterable(Array(c+(100<=b&&150>b?1:0)).fill(CARRY))));f.push.apply(f,[].concat($jscomp.arrayFromIterable(Array(c+(50<=b?1:0)).fill(MOVE))));return{body:f,memory:{role:"dismantler",home:a.home,supportRoom:a.supportRoom}}};g.assignTasks=function(a){var b=a.room;a=a.tasks;var c=m.creeps[b.name],f=_.filter(h.creepsWithNoTask(c&&c.dismantler||[]),function(a){return!a.spawning&&
150<a.ticksToLive}),c=c&&c.all||[];0!==f.length&&(d.dismantleTargets(f,b,"Dismantle"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.buildInCurrentRoom(f,c,!1,"Build"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillStorageWithEnergy(f,c,b,"Storage"),_.remove(f,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithMinerals(f,b.storage,a.storageResourcesNeeded,"Storage"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithMinerals(f,b.terminal,void 0,"Terminal"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&
(d.fillWithEnergy(f,c,m.containersInRoom(b),"Container"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.pickupResources(f,c,m.resourcesInRoom(b),a.hostiles,"Pickup"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&d.moveToHomeRoom(f))))))))};Memory.profiling&&e(1,17).registerObject(g,"RoleDismantler");
l.exports=g;return l.exports};n[18]=function(l,g){var d=e(56,18),m=e(3,18),h=e(9,18);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("downgrader"),f;if(c)return c;var c=Memory.maxCreeps.downgrader,k=a.room.name;if(!b)return{name:"downgrader",spawn:!1,max:c&&c[k]?Object.keys(c[k]).length:0};var d=(b=m.creeps[k])&&b.downgrader||[];c&&_.forEach(c[k],function(a,b){return 0===_.filter(d,function(a){return a.memory.downgrade===b}).length?(f=b,!1):!0});c={name:"downgrader",
spawn:!!f,max:c&&c[k]?Object.keys(c[k]).length:0,roomToDowngrade:f};0<d.length&&(a.room.memory.maxCreeps.downgrader={cache:c,cacheUntil:Game.time+(c.spawn?100:Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(d,function(a){return a.spawning?100:Math.min(a.ticksToLive,100)})))))});return c};g.spawnSettings=function(a){var b=Math.floor(Math.min(a.energyCapacityAvailable,24400)/3050),c=[];c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(5*b).fill(CLAIM))));c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(b).fill(MOVE))));
return{body:c,memory:{role:"downgrader",home:a.home,downgrade:a.roomToDowngrade}}};g.assignTasks=function(a){a=m.creeps[a.room.name];a=_.filter(h.creepsWithNoTask(a&&a.downgrader||[]),function(a){return!a.spawning});0!==a.length&&d.downgradeController(a,"Downgrade")};Memory.profiling&&e(1,18).registerObject(g,"RoleDowngrader");l.exports=g;return l.exports};n[19]=function(l,g){var d=e(56,19),m=e(3,19),h=e(9,19);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("healer");
if(c)return c;if(!b)return{name:"healer",spawn:!1,max:1};b=(c=m.creeps[a.room.name])&&c.healer||[];c={name:"healer",spawn:1>_.filter(b,function(a){return a.spawning||300<=a.ticksToLive}).length,spawnFromRegion:!0,max:1};0<b.length&&(a.room.memory.maxCreeps.healer={cache:c,cacheUntil:Game.time+(c.spawn?25:Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(b,function(a){return a.spawning?25:Math.min(a.ticksToLive-300,25)})))))});return c};g.spawnSettings=function(a){var b=Math.floor(Math.min(a.energyCapacityAvailable,
4500)/300),c=[];c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(b).fill(MOVE))));c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(b).fill(HEAL))));return{body:c,memory:{role:"healer",home:a.home,supportRoom:a.supportRoom}}};g.assignTasks=function(a){var b=a.room.name;a=a.tasks;var c=m.creeps[b],c=_.filter(h.creepsWithNoTask(c&&c.healer||[]),function(a){return!a.spawning});0!==c.length&&(d.heal(c,a.hurtCreeps,"Heal"),_.remove(c,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||
a.memory.currentTask.priority===Game.time)}),0!==c.length&&(d.moveToSourceKeeper(c,a.keepers),_.remove(c,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==c.length&&d.moveToRoom(c,b)))};Memory.profiling&&e(1,19).registerObject(g,"RoleHealer");l.exports=g;return l.exports};n[20]=function(l,g){var d=e(56,20),m=e(3,20),h=e(9,20);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("miner"),d,k;if(c)return c;
var e=a.room,c=m.containersInRoom(e),g=e.find(FIND_MINERALS),l=Array.prototype.concat.apply([],[e.find(FIND_SOURCES),g]);if(0===c.length)return{name:"miner",spawn:!1,max:0};if(!b)return{name:"miner",spawn:!1,max:c.length-_.filter(g,function(a){return 0===a.mineralAmount}).length};var p=Memory.containerSource,z=(b=m.creeps[e.name])&&b.miner||[];_.forEach(c,function(a){var b=a.id;p[b]||(a=h.objectsClosestToObj(l,a)["0"],p[b]=a.id);a=Game.getObjectById(p[b]);var c=a instanceof Mineral;return c&&0===
a.mineralAmount?!0:0===_.filter(z,function(a){return(a.spawning||150<=a.ticksToLive)&&a.memory.container===b}).length?(d=b,k=c,!1):!0});c={name:"miner",spawn:!!d,max:c.length-_.filter(g,function(a){return 0===a.mineralAmount}).length,containerIdToMineOn:d,isMineralHarvester:k};0<z.length&&(a.room.memory.maxCreeps.miner={cache:c,cacheUntil:Game.time+(c.spawn?100:Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(z,function(a){return a.spawning?100:Math.min(a.ticksToLive-150,100)})))))});
return c};g.spawnSettings=function(a){var b=[];if(a.isMineralHarvester){var c=Math.min(a.energyCapacityAvailable,4500),d=Math.floor(c/450),c=c%450;b.push.apply(b,[].concat($jscomp.arrayFromIterable(Array(d+(150<=c?1:0)).fill(MOVE))));b.push.apply(b,[].concat($jscomp.arrayFromIterable(Array(4*d+(150<=c?1:0)+(250<=c?1:0)+(350<=c?1:0)).fill(WORK))))}else b=[MOVE,MOVE,WORK,WORK,WORK,WORK,WORK];return{body:b,memory:{role:"miner",home:a.home,container:a.containerIdToMineOn}}};g.assignTasks=function(a){a=
m.creeps[a.room.name];a=_.filter(h.creepsWithNoTask(a&&a.miner||[]),function(a){return!a.spawning});0!==a.length&&(d.getBoost(a,"Boosting"),_.remove(a,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==a.length&&d.mine(a,"Mining"))};Memory.profiling&&e(1,20).registerObject(g,"RoleMiner");l.exports=g;return l.exports};n[21]=function(l,g){var d=e(56,21),m=e(3,21),h=e(9,21);g=function(){};g.checkSpawnSettings=function(a,b){var c=
a.checkSpawnSettingsCache("remoteBuilder");if(c)return c;if(!b)return{name:"remoteBuilder",spawn:!1,max:2};b=(c=m.creeps[a.room.name])&&c.remoteBuilder||[];c={name:"remoteBuilder",spawn:2>_.filter(b,function(a){return a.spawning||150<=a.ticksToLive}).length,spawnFromRegion:!0,max:2};0<b.length&&(a.room.memory.maxCreeps.remoteBuilder={cache:c,cacheUntil:Game.time+(c.spawn?100:Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(b,function(a){return a.spawning?100:Math.min(a.ticksToLive-150,
100)})))))});return c};g.spawnSettings=function(a){var b=Math.min(a.energyCapacityAvailable,3300),c=Math.floor(b/200),b=b%200,d=[];d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(c+(150<=b?1:0)).fill(WORK))));d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(c+(100<=b&&150>b?1:0)).fill(CARRY))));d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(c+(50<=b?1:0)).fill(MOVE))));return{body:d,memory:{role:"remoteBuilder",home:a.home,supportRoom:a.supportRoom}}};g.assignTasks=function(a){var b=
m.creeps[a.room.name],c=a.room;a=a.tasks;var f=_.filter(b&&b.remoteBuilder||[],function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),k=h.creepsWithNoTask(f),b=b&&b.all||[];if(0!==f.length&&(d.flee(f,"Run away!"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.stomp(k,a.hostileConstructionSites,"Stomping"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||
a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.repairCriticalStructuresInCurrentRoom(k,"CritRepair"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.buildInCurrentRoom(k,b,!1,"Build"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length))))){if(!c.unobservable&&(d.pickupResources(k,b,m.sortedResourcesInRoom(c),
m.hostilesInRoom(c),"Pickup"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0===k.length))return;d.harvest(k,"Harvesting");_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==k.length&&(d.moveToHomeSource(k),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),
0!==k.length&&d.moveToHomeRoom(k))}};Memory.profiling&&e(1,21).registerObject(g,"RoleRemoteBuilder");l.exports=g;return l.exports};n[22]=function(l,g){var d=e(56,22),m=e(3,22),h=e(9,22);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("remoteCollector");if(c)return c;c="cleanup"===a.type?5:1;if(!b)return{name:"remoteCollector",spawn:!1,max:c};b=(b=m.creeps[a.room.name])&&b.remoteCollector||[];c={name:"remoteCollector",spawn:_.filter(b,function(a){return a.spawning||
300<=a.ticksToLive}).length<c,spawnFromRegion:!0,max:c};0<b.length&&(a.room.memory.maxCreeps.remoteCollector={cache:c,cacheUntil:Game.time+(c.spawn?100:Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(b,function(a){return a.spawning?100:Math.min(a.ticksToLive-300,100)})))))});return c};g.spawnSettings=function(a){var b=Math.floor(Math.min(a.energyCapacityAvailable,2400)/150),c=[];c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(2*b).fill(CARRY))));c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(b).fill(MOVE))));
return{body:c,memory:{role:"remoteCollector",home:a.home,supportRoom:a.supportRoom}}};g.assignTasks=function(a){var b=a.supportRoom,c=m.creeps[a.room.name],f=h.creepsWithNoTask(c&&c.remoteCollector||[]),c=c&&c.all||[];0!==f.length&&(d.pickupResourcesInCurrentRoom(f,c,"Pickup"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.collectMinerals(f,c,a.tasks.mineralStructures,void 0,void 0,"Collecting"),
_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.collectEnergy(f,c,a.tasks.energyStructures,"Collecting"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillStorageWithEnergy(f,c,b,"Storage"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===
Game.time)}),0!==f.length&&(d.fillWithMinerals(f,b.storage,m.rooms[b.name].tasks.storageResourcesNeeded,"Storage"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithMinerals(f,b.terminal,void 0,"Terminal"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithEnergy(f,c,m.containersInRoom(b),
"Container"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&d.moveToHomeOrSupport(f))))))))};Memory.profiling&&e(1,22).registerObject(g,"RoleRemoteCollector");l.exports=g;return l.exports};n[23]=function(l,g){var d=e(56,23),m=e(3,23),h=e(9,23);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("remoteDismantler");if(c)return c;var d=a.room,c=d.unobservable||"cleanup"!==
a.type?1:Math.min(d.find(FIND_STRUCTURES).length-1,8);if(!b)return{name:"remoteDismantler",spawn:!1,max:c};b=(b=m.creeps[d.name])&&b.remoteDismantler||[];c={name:"remoteDismantler",spawn:_.filter(b,function(a){return a.spawning||300<=a.ticksToLive}).length<c,spawnFromRegion:!0,max:c};0<b.length&&(a.room.memory.maxCreeps.remoteDismantler={cache:c,cacheUntil:Game.time+(c.spawn?100:Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(b,function(a){return a.spawning?100:Math.min(a.ticksToLive-
300,100)})))))});return c};g.spawnSettings=function(a){var b=Math.floor(Math.min(a.energyCapacityAvailable,3750)/150),c=[];c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(b).fill(WORK))));c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(b).fill(MOVE))));return{body:c,memory:{role:"remoteDismantler",home:a.home,supportRoom:a.supportRoom}}};g.assignTasks=function(a){var b=a.tasks;a=(a=m.creeps[a.room.name])&&a.remoteDismantler;var c=_.filter(h.creepsWithNoTask(a||[]),function(a){return 0<
_.sum(a.carry)||!a.spawning});0!==c.length&&(d.stomp(c,b.hostileConstructionSites,"Stomping"),_.remove(c,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==c.length&&(d.dismantleStructures(c,a,b.dismantle,"Dismantle"),_.remove(c,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==c.length&&d.moveToHomeRoom(c)))};Memory.profiling&&e(1,23).registerObject(g,
"RoleRemoteDismantler");l.exports=g;return l.exports};n[24]=function(l,g){var d=e(56,24),m=e(3,24),h=e(9,24);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("remoteMiner"),d,k;if(c)return c;var e=a.room,c=m.containersInRoom(e),g=e.find(FIND_MINERALS),l=Array.prototype.concat.apply([],[e.find(FIND_SOURCES),g]);if(0===c.length||0===l.length)return{name:"remoteMiner",spawn:!1,max:0};if(!b)return{name:"remoteMiner",spawn:!1,max:c.length-_.filter(g,function(a){return 0===
a.mineralAmount}).length};b=Memory;var p=b.lengthToContainer,z=b.containerSource;b=a.supportRoom;var n=b.name,q=m.spawnsInRoom(b),D=(e=m.creeps[e.name])&&e.remoteMiner||[];_.forEach(c,function(a){var b=a.id;p[b]||(p[b]={});var c=p[b];if(!c[n]){var f=PathFinder.search(a.pos,{pos:q[0].pos,range:1},{swampCost:1,maxOps:1E5}).path;c[n]=f.length}z[b]||(a=h.objectsClosestToObj(l,a)["0"],z[b]=a.id);a=Game.getObjectById(z[b]);return(c=a instanceof Mineral)&&0===a.mineralAmount?!0:0===_.filter(D,function(a){return(a.spawning||
300<=a.ticksToLive)&&a.memory.container===b}).length?(d=b,k=c,!1):!0});c={name:"remoteMiner",spawn:!!d,max:c.length-_.filter(g,function(a){return 0===a.mineralAmount}).length,spawnFromRegion:!0,containerIdToMineOn:d,isMineralHarvester:k};0<D.length&&(a.room.memory.maxCreeps.remoteMiner={cache:c,cacheUntil:Game.time+(c.spawn?100:Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(D,function(a){return a.spawning?100:Math.min(a.ticksToLive-300,100)})))))});return c};g.spawnSettings=function(a){var b=
[];if(a.isMineralHarvester){var c=Math.min(a.energyCapacityAvailable,4500),d=Math.floor(c/450),c=c%450;b.push.apply(b,[].concat($jscomp.arrayFromIterable(Array(d+(150<=c?1:0)).fill(MOVE))));b.push.apply(b,[].concat($jscomp.arrayFromIterable(Array(4*d+(150<=c?1:0)+(250<=c?1:0)+(350<=c?1:0)).fill(WORK))))}else b=a.isSourceRoom?[MOVE,MOVE,MOVE,MOVE,WORK,WORK,WORK,WORK,WORK,WORK,WORK]:[MOVE,MOVE,MOVE,WORK,WORK,WORK,WORK,WORK];return{body:b,memory:{role:"remoteMiner",home:a.home,supportRoom:a.supportRoom,
container:a.containerIdToMineOn}}};g.assignTasks=function(a){a=m.creeps[a.room.name];a=_.filter(a&&a.remoteMiner||[],function(a){return!a.spawning});var b=h.creepsWithNoTask(a);0!==a.length&&(d.flee(a,"Run away!"),_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==b.length&&(d.mine(b,"Mining"),_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===
Game.time)}),0!==b.length&&d.moveToHomeRoom(b)))};Memory.profiling&&e(1,24).registerObject(g,"RoleRemoteMiner");l.exports=g;return l.exports};n[25]=function(l,g){var d=e(56,25),m=e(3,25),h=e(9,25);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("remoteReserver");if(c)return c;var d=a.room,c=d.controller;if(!c)return{name:"remoteReserver",spawn:!1,max:0};if(!b)return{name:"remoteReserver",spawn:!1,max:1};if((b=c.reservation)&&4E3<=b.ticksToEnd)return{name:"remoteReserver",
spawn:!1,max:0};b=Memory.lengthToController;var k=c.id,e=a.supportRoom,h=e.name,d=(d=m.creeps[d.name])&&d.remoteReserver||[];b[k]||(b[k]={});var g=b[k];g[h]||(c=PathFinder.search(c.pos,{pos:m.spawnsInRoom(e)[0].pos,range:1},{swampCost:1,maxOps:1E5}).path,g[h]=c.length);c={name:"remoteReserver",spawn:1>_.filter(d,function(a){return a.spawning||a.ticksToLive>g[h]}).length,max:1,spawnFromRegion:!0};0<d.length&&(a.room.memory.maxCreeps.remoteReserver={cache:c,cacheUntil:Game.time+(c.spawn?100:Math.min.apply(Math,
[].concat($jscomp.arrayFromIterable(_.map(d,function(a){return a.spawning?100:Math.min(a.ticksToLive-150,100)})))))});return c};g.spawnSettings=function(a){var b=Math.floor(Math.min(a.energyCapacityAvailable,3250)/650),c=[];c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(b).fill(CLAIM))));c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(b).fill(MOVE))));return{body:c,memory:{role:"remoteReserver",home:a.home,supportRoom:a.supportRoom}}};g.assignTasks=function(a){a=a.room;var b=m.creeps[a.name],
b=_.filter(b&&b.remoteReserver||[],function(a){return!a.spawning}),c=h.creepsWithNoTask(b);0!==b.length&&(d.flee(b,"Run away!"),_.remove(c,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==c.length&&(d.reserveController(c,a,"Reserving"),_.remove(c,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==c.length&&d.moveToHomeRoom(c)))};Memory.profiling&&
e(1,25).registerObject(g,"RoleRemoteReserver");l.exports=g;return l.exports};n[26]=function(l,g){var d=e(56,26),m=e(3,26),h=e(9,26);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("remoteStorer"),d=0,k;if(c)return c;var e=a.room,c=m.containersInRoom(e);if(0===c.length)return{name:"remoteStorer",spawn:!1,max:0};var g=Memory,l=g.containerSource,p=g.lengthToContainer,z=Array.prototype.concat.apply([],[e.find(FIND_SOURCES),e.find(FIND_MINERALS)]),g=a.supportRoom,n=g.name,
q=g.controller.level,D=(e=m.creeps[e.name])&&e.remoteStorer||[];var y=!1;_.forEach(c,function(a){var c=a.id,f=0;l[c]||(a=h.objectsClosestToObj(z,a)["0"],l[c]=a.id);a=Game.getObjectById(l[c]);if(a instanceof Mineral){if(0===a.mineralAmount)return}else y||(f=-1,y=!0);var e=p[c]?p[c][n]:0,f=f+Math.max(Math.ceil(e/[18,18,18,18,30,44,54,62,62][q]),0);d+=f;b&&!k&&_.filter(D,function(a){return(a.spawning||a.ticksToLive>=150+2*e)&&a.memory.container===c}).length<f&&(k=c)});if(!b)return{name:"remoteStorer",
spawn:!1,max:d};c={name:"remoteStorer",spawn:!!k,max:d,spawnFromRegion:!0,containerIdToCollectFrom:k,supportRoomRcl:q};0<D.length&&(a.room.memory.maxCreeps.remoteStorer={cache:c,cacheUntil:Game.time+(c.spawn?100:Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(D,function(a){return a.spawning?100:Math.min(a.ticksToLive-300,100)})))))});return c};g.spawnSettings=function(a){switch(a.supportRoomRcl){case 3:var b=[MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,
CARRY];break;case 4:b=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 5:b=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 6:b=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,
CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 7:case 8:b=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY]}return{body:b,memory:{role:"remoteStorer",home:a.home,
supportRoom:a.supportRoom,container:a.containerIdToCollectFrom}}};g.assignTasks=function(a){var b=m.creeps[a.room.name],c=_.filter(b&&b.remoteStorer||[],function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),f=h.creepsWithNoTask(c),b=b&&b.all||[];a=a.supportRoom;0!==c.length&&(d.flee(c,"Run away!"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.pickupResourcesInCurrentRoom(f,b,"Pickup"),
_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillStorageWithEnergy(f,b,a,"Storage"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithMinerals(f,a.storage,m.rooms[a.name].tasks.storageResourcesNeeded,"Storage"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||
a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithMinerals(f,a.terminal,void 0,"Terminal"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithEnergy(f,b,m.containersInRoom(a),"Container"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.collectEnergyFromHomeContainer(f,"Collecting"),
_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.collectMineralsFromHomeContainer(f,"Collecting"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&d.moveToHomeOrSupport(f)))))))))};Memory.profiling&&e(1,26).registerObject(g,"RoleRemoteStorer");l.exports=g;return l.exports};n[27]=function(l,g){var d=e(56,
27),m=e(3,27),h=e(9,27);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("remoteWorker"),d=!1,k;if(c)return c;var e=a.room,c=m.containersInRoom(e);if(0===c.length)return{name:"remoteWorker",spawn:!1,max:0};if(!b)return{name:"remoteWorker",spawn:!1,max:1};var g=Array.prototype.concat.apply([],[e.find(FIND_SOURCES),e.find(FIND_MINERALS)]),l=Memory.lengthToContainer,p=(b=m.creeps[e.name])&&b.remoteWorker||[],z=a.supportRoom.name;_.forEach(c,function(a){var b=h.objectsClosestToObj(g,
a)["0"],c=a.id,f=l[c];if(b instanceof Mineral)return!0;0===_.filter(p,function(a){return(a.spawning||a.ticksToLive>=150+2*(f&&f[z]?f[z]:0))&&a.memory.container===c}).length&&(k=c,d=!0);return!1});c={name:"remoteWorker",spawn:d,max:1,spawnFromRegion:!0,containerIdToCollectFrom:k};0<p.length&&(a.room.memory.maxCreeps.remoteWorker={cache:c,cacheUntil:Game.time+(c.spawn?100:Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(p,function(a){return a.spawning?100:Math.min(a.ticksToLive-300,100)})))))});
return c};g.spawnSettings=function(a){var b=Math.min(a.energyCapacityAvailable,3E3),c=Math.floor(Math.min(b,2E3)/200),d=Math.floor(Math.max(b-2E3,0)/150),k=Math.min(b,2E3)%200,b=Math.max(b-2E3,0)%150,e=[];e.push.apply(e,[].concat($jscomp.arrayFromIterable(Array(c+(150<=k?1:0)).fill(WORK))));e.push.apply(e,[].concat($jscomp.arrayFromIterable(Array(c+2*d+(100<=k&&150>k?1:0)+(100<b?1:0)).fill(CARRY))));e.push.apply(e,[].concat($jscomp.arrayFromIterable(Array(c+d+(50<=k?1:0)+(50<=b?1:0)).fill(MOVE))));
return{body:e,memory:{role:"remoteWorker",home:a.home,supportRoom:a.supportRoom,container:a.containerIdToCollectFrom}}};g.assignTasks=function(a){var b=m.creeps[a.room.name],c=_.filter(b&&b.remoteWorker||[],function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),f=h.creepsWithNoTask(c),b=b&&b.all||[];a=a.supportRoom;0!==c.length&&(d.flee(c,"Run away!"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),
0!==f.length&&(d.buildInCurrentRoom(f,b,!0,"Build"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.repairCriticalStructuresInCurrentRoom(f,"CritRepair"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.buildInCurrentRoom(f,b,!1,"Build"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||
a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillStorageWithEnergy(f,b,a,"Storage"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithMinerals(f,a.storage,m.rooms[a.name].tasks.storageResourcesNeeded,"Storage"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithMinerals(f,
a.terminal,void 0,"Terminal"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithEnergy(f,b,m.containersInRoom(a),"Container"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.pickupResourcesInCurrentRoom(f,b,"Pickup"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||
a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.collectEnergyFromHomeContainer(f,"Collecting"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.harvest(f,"Harvesting"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&d.moveToHomeRoom(f))))))))))))};Memory.profiling&&e(1,27).registerObject(g,
"RoleRemoteWorker");l.exports=g;return l.exports};n[28]=function(l,g){var d=e(56,28),m=e(3,28),h=e(9,28);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("scientist");if(c)return c;if(!b)return{name:"scientist",spawn:!1,max:1};b=(c=m.creeps[a.room.name])&&c.scientist||[];c={name:"scientist",spawn:1>_.filter(b,function(a){return a.spawning||150<=a.ticksToLive}).length,max:1};0<b.length&&(a.room.memory.maxCreeps.scientist={cache:c,cacheUntil:Game.time+(c.spawn?100:Math.min.apply(Math,
[].concat($jscomp.arrayFromIterable(_.map(b,function(a){return a.spawning?100:Math.min(a.ticksToLive-150,100)})))))});return c};g.spawnSettings=function(a){var b=Math.min(a.energyCapacityAvailable,2500),c=Math.floor(b/150),b=b%150,d=[];d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(2*c+(100<=b?1:0)).fill(CARRY))));d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(c+(50<=b?1:0)).fill(MOVE))));return{body:d,memory:{role:"scientist",home:a.home}}};g.assignTasks=function(a){var b=a.room;
a=a.tasks;var c=m.creeps[b.name],f=_.filter(h.creepsWithNoTask(c&&c.scientist||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),c=c&&c.all||[];0!==f.length&&(d.fillTowersWithEnergy(f,c,a.towers,"Tower"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.collectMinerals(f,c,a.labsCollectMinerals,void 0,void 0,"Collecting"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||
a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithMinerals(f,a.labsFillMinerals,a.labsFillMineralsResourcesNeeded,"Lab"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithMinerals(f,a.nuker,a.nukerResourcesNeeded,"NukeG"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithMinerals(f,
a.powerSpawn,a.powerSpawnResourcesNeeded,"PowerPower"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithMinerals(f,b.storage,a.storageResourcesNeeded,"Storage"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithMinerals(f,b.terminal,void 0,"Terminal"),_.remove(f,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithEnergy(f,m.labsInRoom(b),"LabEnergy"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithEnergy(f,m.nukersInRoom(b),"NukeEnergy"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithEnergy(f,
m.powerSpawnsInRoom(b),"PwrEnergy"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithEnergy(f,a.terminalsFillWithEnergy,"Terminal"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillExtensions(f,c,b.controller.level,a.extensions,"Extension"),_.remove(f,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillSpawns(f,c,a.spawns,"Spawn"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillStorageWithEnergy(f,c,b,"Storage"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.collectMinerals(f,c,a.terminalCollectMinerals,
a.terminalCollectMineralsResource,a.terminalCollectMineralsAmount,"Collecting"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.collectMinerals(f,c,a.storageCollectMinerals,a.storageCollectMineralsResource,a.storageCollectMineralsAmount,"Collecting"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.pickupResources(f,
c,m.resourcesInRoom(b),a.hostiles,"Pickup"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.collectEnergy(f,c,a.terminalsCollectEnergy,"Terminal"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.collectMinerals(f,c,a.structuresWithMinerals,void 0,void 0,"Collecting"),_.remove(f,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.collectEnergy(f,c,a.structuresWithEnergy,"Collecting"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&b.terminal&&d.moveToPos(f,b.terminal.pos,1)))))))))))))))))))))};Memory.profiling&&e(1,28).registerObject(g,"RoleScientist");l.exports=g;return l.exports};n[29]=function(l,g){var d=e(56,29),m=e(3,29),h=
e(9,29);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("storer"),d=0,e=0;if(c)return c;var g=a.room,c=m.containersInRoom(g);if(0===c.length||!g.storage||!g.storage.my)return{name:"storer",spawn:!1,max:0};var l=Memory,t=l.containerSource,p=l.lengthToStorage,z=Array.prototype.concat.apply([],[g.find(FIND_SOURCES),g.find(FIND_MINERALS)]),l=g.controller.level,n=m.creeps[g.name],n=n&&n.storer||[];_.forEach(c,function(a){var b=a.id;if(!t[b]){var c=h.objectsClosestToObj(z,
a)["0"];t[b]=c.id}b=Game.getObjectById(t[b]);b instanceof Mineral?0<b.mineralAmount&&(d+=1):(p[a.id]||(b=PathFinder.search(a.pos,{pos:g.storage.pos,range:1},{swampCost:1}).path,p[a.id]=b.length),e+=p[a.id])});d+=Math.ceil(e/(8===l?20:15));if(!b)return{name:"storer",spawn:!1,max:d};c={name:"storer",spawn:_.filter(n,function(a){return a.spawning||300<=a.ticksToLive}).length<d,max:d,rcl:l};0<n.length&&(a.room.memory.maxCreeps.storer={cache:c,cacheUntil:Game.time+(c.spawn?100:Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(n,
function(a){return a.spawning?100:Math.min(a.ticksToLive-300,100)})))))});return c};g.spawnSettings=function(a){switch(a.rcl){case 7:var b=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 8:b=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,
CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;default:b=[MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY]}return{body:b,memory:{role:"storer",home:a.home}}};g.assignTasks=function(a){var b=a.room;a=a.tasks;var c=m.creeps[b.name],f=_.filter(h.creepsWithNoTask(c&&c.storer||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),c=c&&c.all||[];0!==f.length&&(d.fillWithEnergy(f,a.links,"Link"),_.remove(f,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillExtensions(f,c,b.controller.level,a.extensions,"Extension"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillSpawns(f,c,a.spawns,"Spawn"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithEnergy(f,
m.labsInRoom(b),"LabEnergy"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithEnergy(f,a.terminalsFillWithEnergy,"Terminal"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillStorageWithEnergy(f,c,b,"Storage"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||
a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithMinerals(f,b.storage,a.storageResourcesNeeded,"Storage"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.fillWithMinerals(f,b.terminal,void 0,"Terminal"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.collectMinerals(f,c,a.structuresWithMinerals,
void 0,void 0,"Collecting"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.collectEnergy(f,c,a.structuresWithEnergy,"Collecting"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==f.length&&(d.collectEnergy(f,c,a.terminalsCollectEnergy,"Terminal"),_.remove(f,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||
a.memory.currentTask.priority===Game.time)}),0!==f.length&&d.moveToTerminalOrRoom(f,b))))))))))))};Memory.profiling&&e(1,29).registerObject(g,"RoleStorer");l.exports=g;return l.exports};n[30]=function(l,g){var d=e(56,30),m=e(3,30),h=e(9,30);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("upgrader"),d;if(c)return c;var e=a.room,h=e.name,g=e.storage,l=g?g.store[RESOURCE_ENERGY]:0,c=h===Memory.rushRoom?1:!g||l<Memory.upgradeEnergy?0:1;if(!b)return{name:"upgrader",spawn:!1,
max:c};b=e.controller;var p=m.creeps[h],p=p&&p.upgrader||[];0<c&&(b&&8>b.level&&g&&9E5<l||_.filter(p,function(a){return a.spawning||150<=a.ticksToLive}).length<c)&&(d=h);d||_.forEach(_.filter(Game.rooms,function(a){var b=a.memory,c=a.controller,d=b.roomType;return b&&d&&"base"===d.type&&b.region===e.memory.region&&a.name!==e.name&&c&&7>c.level}),function(a){a=a.name;var b=m.creeps[a];return 0===_.filter(b&&b.upgrader||[],function(a){a=a.memory;return a.supportRoom!==a.home}).length?(d=a,!1):!0});
c={name:"upgrader",spawn:!!d,max:c,spawnFromRegion:6>b.level,spawnForRoom:d};0<p.length&&(a.room.memory.maxCreeps.upgrader={cache:c,cacheUntil:Game.time+(c.spawn?100:Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(p,function(a){return a.spawning?100:Math.min(a.ticksToLive-150,100)})))))});return c};g.spawnSettings=function(a){var b=Game.rooms[a.home],c=m.linksInRoom(b),d=b.controller,e=b.storage,g=e.store,l=m.spawnsInRoom(b),t=[],p={},n=b.energyCapacityAvailable;2<=c&&2>=h.objectsClosestToObj(c,
d)[0].pos.getRangeTo(d)?(c=Math.ceil(n/3200),n=Math.min(n,8===d.level?1950:4100),d=Math.floor((n-50*c)/250),n=(n-50*c)%250,t.push.apply(t,[].concat($jscomp.arrayFromIterable(Array(2*d+(150<=n?1:0)).fill(WORK)))),t.push.apply(t,[].concat($jscomp.arrayFromIterable(Array(c).fill(CARRY))))):(n=Math.min(n,8===d.level?3E3:3300),d=Math.floor(n/200),n%=200,t.push.apply(t,[].concat($jscomp.arrayFromIterable(Array(d+(150<=n?1:0)).fill(WORK)))),t.push.apply(t,[].concat($jscomp.arrayFromIterable(Array(d+(100<=
n&&150>n?1:0)).fill(CARRY)))));t.push.apply(t,[].concat($jscomp.arrayFromIterable(Array(d+(50<=n?1:0)).fill(MOVE))));e&&0<m.labsInRoom(b).length&&(g[RESOURCE_CATALYZED_LEMERGIUM_ACID]>=30*d?p[RESOURCE_CATALYZED_LEMERGIUM_ACID]=d:g[RESOURCE_LEMERGIUM_ACID]>=30*d?p[RESOURCE_LEMERGIUM_ACID]=d:g[RESOURCE_CATALYZED_LEMERGIUM_ACID]>=30*d&&(p[RESOURCE_LEMERGIUM_HYDRIDE]=d));return{body:t,boosts:p,memory:{role:"upgrader",home:a.home,supportRoom:a.supportRoom,homeSource:l?h.objectsClosestToObj(b.find(FIND_SOURCES),
l[0])[0].id:b.find(FIND_SOURCES)[0]}}};g.assignTasks=function(a){var b=a.room;a=a.tasks;var c=m.creeps[b.name],e=c&&c.upgrader||[],k=_.filter(h.creepsWithNoTask(e),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),c=c&&c.all||[];0!==k.length&&(d.getBoost(k,"Boosting"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.upgradeController(k,b.controller,"Upgrade"),_.remove(k,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.collectEnergy(e,[],h.objectsClosestToObj(m.linksInRoom(b),b.controller),"Collecting"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.pickupResources(k,c,m.resourcesInRoom(b),a.hostiles,"Pickup"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===
Game.time)}),0!==k.length&&(d.collectEnergy(k,c,a.structuresWithEnergy,"Collecting"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.harvest(k,"Harvesting"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&d.moveToPos(k,b.controller.pos,1)))))))};Memory.profiling&&e(1,30).registerObject(g,"RoleUpgrader");
l.exports=g;return l.exports};n[31]=function(l,g){var d=e(56,31),m=e(3,31),h=e(9,31);g=function(){};g.checkSpawnSettings=function(a,b){var c=a.checkSpawnSettingsCache("worker");if(c)return c;var d=a.room,e=d.storage,c=e&&e.my?1:2;if(!b)return{name:"worker",spawn:!1,max:c};var h=d.name;b=(b=m.creeps[h])&&b.worker||[];if(0<c&&_.filter(b,function(a){return a.spawning||a.ticksToLive>=(e&&e.my?150:300)}).length<c)var g=d.name;g||_.forEach(_.filter(Game.rooms,function(a){var b=a.memory,c=a.controller,e=
b.roomType;return b&&e&&"base"===e.type&&b.region===d.memory.region&&a.name!==h&&c&&6>c.level}),function(a){var b=a.name;a=m.creeps[a.name];0===_.filter(a&&a.worker||[],function(a){a=a.memory;return a.supportRoom!==a.home}).length&&(g=b)});c={name:"worker",spawn:!!g,max:c,spawnFromRegion:6>d.controller.level,roomToSpawnFor:g};0<b.length&&(a.room.memory.maxCreeps.worker={cache:c,cacheUntil:Game.time+(c.spawn?100:Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(b,function(a){return a.spawning?
100:Math.min(a.ticksToLive-150,100)})))))});return c};g.spawnSettings=function(a){var b=Game.rooms[a.home],c=Math.min(b.energyCapacityAvailable,3300),d=Math.floor(c/200),c=c%200,e=b.storage,g=e.store,l=m.spawnsInRoom(b),n=[],p={};n.push.apply(n,[].concat($jscomp.arrayFromIterable(Array(d+(150<=c?1:0)).fill(WORK))));n.push.apply(n,[].concat($jscomp.arrayFromIterable(Array(d+(100<=c&&150>c?1:0)).fill(CARRY))));n.push.apply(n,[].concat($jscomp.arrayFromIterable(Array(d+(50<=c?1:0)).fill(MOVE))));e&&
0<m.labsInRoom(b).length&&(g[RESOURCE_CATALYZED_LEMERGIUM_ACID]>=30*d?p[RESOURCE_CATALYZED_LEMERGIUM_ACID]=d:g[RESOURCE_LEMERGIUM_ACID]>=30*d?p[RESOURCE_LEMERGIUM_ACID]=d:g[RESOURCE_CATALYZED_LEMERGIUM_ACID]>=30*d&&(p[RESOURCE_LEMERGIUM_HYDRIDE]=d));return{body:n,boosts:p,memory:{role:"worker",home:a.home,supportRoom:a.supportRoom,homeSource:l?h.objectsClosestToObj(b.find(FIND_SOURCES),l[0])[0].id:b.find(FIND_SOURCES)[0]}}};g.assignTasks=function(a){var b=a.room;a=a.tasks;var c=b.controller,e=m.creeps[b.name],
k=_.filter(h.creepsWithNoTask(e&&e.worker||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),g=e&&e.all||[],e=e&&e.storer||[];0!==k.length&&(d.getBoost(k,"Boosting"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.fillWithMinerals(k,b.storage,a.storageResourcesNeeded,"Storage"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===
Game.time)}),0!==k.length&&(d.fillWithMinerals(k,b.terminal,void 0,"Terminal"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.upgradeCriticalController(k,c,"Upgrade"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(b.storage&&0!==e.length||d.fillExtensions(k,g,b.controller.level,a.extensions,"Extension"),
_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(b.storage&&0!==e.length||d.fillSpawns(k,g,a.spawns,"Spawn"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.fillTowersWithEnergy(k,g,a.towers,"Tower"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===
Game.time)}),0!==k.length&&(d.build(k,g,a.quickConstructionSites,"Build"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.repairCriticalStructuresInCurrentRoom(k,"CritRepair"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.build(k,g,a.constructionSites,"Build"),_.remove(k,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.repairStructures(k,g,a.repairableStructures,"Repair"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(c&&8>c.level&&d.upgradeController(k,c,"Upgrade"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&((!c||
6>c.level)&&d.pickupResources(k,g,m.resourcesInRoom(b),a.hostiles,"Pickup"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.collectEnergy(k,g,a.terminalsCollectEnergy,"Terminal"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.collectEnergy(k,g,a.structuresWithEnergy,"Collecting"),_.remove(k,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&(d.harvest(k,"Harvesting"),_.remove(k,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==k.length&&d.moveToHomeSource(k)))))))))))))))))};Memory.profiling&&e(1,31).registerObject(g,"RoleWorker");l.exports=g;return l.exports};n[32]=function(l,g){var d=e(3,32),m=e(4,32),h=e(6,32),a=e(7,32),b=e(57,32),c=e(8,32),f=e(9,32),k=e(14,32),
n=e(15,32),B=e(17,32),t=e(18,32),p=e(20,32),z=e(28,32),w=e(29,32),q=e(30,32),r=e(31,32),y=function(a){var c=b.call(this)||this;c.type="base";c.room=a;a.memory.maxCreeps||(a.memory.maxCreeps={});return c};$jscomp.inherits(y,b);y.prototype.run=function(){var a=this.room,b=a.name;if(a.unobservable)Game.notify("Base Room "+b+" is unobservable, something is wrong!");else{var b=d.spawnsInRoom(a),c=a.terminal,e=a.storage,k=a.memory,h=k.labQueue,g=k.labsInUse;0===Game.time%100&&0<b.length&&this.manage();
this.defend();0<b.length&&this.transferEnergy();c&&!c.cooldown&&this.terminal();this.tasks();this.spawn(0<_.filter(Game.spawns,function(a){return!d.spawning[a.id]&&!a.spawning&&a.room.memory.region===k.region}).length);this.assignTasks();e&&3<=d.labsInRoom(a).length&&h&&!f.roomLabsArePaused(a)&&this.labQueue();g&&this.labsInUse();this.processPower()}};y.prototype.manage=function(){var a=this.room,b=a.storage,c=a.name,e=a.controller.level,k=a.find(FIND_MY_CONSTRUCTION_SITES),h=[0,5,10,20,30,40,50,
60][e-1]-(d.extensionsInRoom(a).length+_.filter(k,function(a){return a.structureType===STRUCTURE_EXTENSION}).length),g=d.spawnsInRoom(a)["0"],l=g.pos,m=a.find(FIND_MINERALS);0<h&&f.buildStructures(a,STRUCTURE_EXTENSION,h,g);3<=e&&0===d.towersInRoom(a).length&&0===_.filter(k,function(a){return a.structureType===STRUCTURE_TOWER}).length&&f.buildStructures(a,STRUCTURE_TOWER,1,g);3<=e&&_.forEach(a.find(FIND_SOURCES),function(b){b=PathFinder.search(b.pos,{pos:l,range:1},{swampCost:1}).path["0"];var c=
b.lookFor(LOOK_STRUCTURES),d=b.x,e=b.y;0===_.filter(c,function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&0===_.filter(k,function(a){return a.pos.x===d&&a.pos.y===e&&a.structureType===STRUCTURE_CONTAINER}).length&&(_.forEach(_.filter(c,function(a){return-1!==[STRUCTURE_ROAD,STRUCTURE_WALL].indexOf(a.structureType)}),function(a){a.destroy()}),a.createConstructionSite(d,e,STRUCTURE_CONTAINER))});4<=e&&!b&&0===_.filter(k,function(a){return a.structureType===STRUCTURE_STORAGE}).length&&
f.buildStructures(a,STRUCTURE_STORAGE,1,g);6<=e&&b&&!a.terminal&&0===_.filter(k,function(a){return a.structureType===STRUCTURE_TERMINAL}).length&&f.buildStructures(a,STRUCTURE_TERMINAL,1,b);6<=e&&m.length!==d.extractorsInRoom(a).length&&_.forEach(m,function(b){b=b.pos;var c=b.x,d=b.y;0===_.filter(b.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_EXTRACTOR}).length&&0===_.filter(k,function(a){return a.pos.x===c&&a.pos.y===d&&a.structureType===STRUCTURE_EXTRACTOR}).length&&a.createConstructionSite(c,
d,STRUCTURE_EXTRACTOR)});6<=e&&_.forEach(m,function(b){b=PathFinder.search(b.pos,{pos:l,range:1},{swampCost:1}).path["0"];var c=b.lookFor(LOOK_STRUCTURES),d=b.x,e=b.y;0===_.filter(c,function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&0===_.filter(k,function(a){return a.pos.x===d&&a.pos.y===e&&a.structureType===STRUCTURE_CONTAINER}).length&&(_.forEach(_.filter(c,function(a){return-1!==[STRUCTURE_ROAD,STRUCTURE_WALL].indexOf(a.structureType)}),function(a){a.destroy()}),a.createConstructionSite(d,
e,STRUCTURE_CONTAINER))});3<=e&&_.forEach(a.find(FIND_MY_STRUCTURES,{filter:function(a){return a.structureType===STRUCTURE_SPAWN||a.structureType===STRUCTURE_EXTENSION||a.structureType===STRUCTURE_TOWER||a.structureType===STRUCTURE_STORAGE||a.structureType===STRUCTURE_TERMINAL}}),function(b){var d=b.pos;b=d.x;d=d.y;_.forEach([new RoomPosition(b-1,d,c),new RoomPosition(b+1,d,c),new RoomPosition(b,d-1,c),new RoomPosition(b,d+1,c)],function(b){var c=b.x,d=b.y;0===_.filter(b.lookFor(LOOK_STRUCTURES),
function(a){return a.structureType===STRUCTURE_ROAD}).length&&0===_.filter(k,function(a){return a.pos.x===c&&a.pos.y===d&&a.structureType===STRUCTURE_ROAD}).length&&a.createConstructionSite(c,d,STRUCTURE_ROAD)})})};y.prototype.defend=function(){var a=this.room,b=_.filter(d.hostilesInRoom(a),function(a){return a.owner&&"Invader"!==a.owner.username}),c=a.name,e=a.memory,f=c+"-defense",a=d.armies[f];if(0<b.length){e.lastHostile=Game.time;e.currentAttack||(e.currentAttack=Game.time);e.edgeTicks||(e.edgeTicks=
{1:0,3:0,5:0,7:0});var k=e.edgeTicks,h=Math.ceil(e.threat/(200*BODYPART_COST[ATTACK]));0<_.filter(b,function(a){return 0===a.pos.x}).length&&k[TOP]++;0<_.filter(b,function(a){return 49===a.pos.x}).length&&k[BOTTOM]++;0<_.filter(b,function(a){return 0===a.pos.y}).length&&k[LEFT]++;0<_.filter(b,function(a){return 49===a.pos.y}).length&&k[RIGHT]++;if(0<h)if(a){var b=Game.time-e.currentAttack,g=Game.map.describeExits(c);500<=b&&(a.boostRoom=c,2E3<=b&&(a=_.filter(Game.rooms,function(a){return(a=a.memory)&&
a.roomType&&"base"===a.roomType.type&&a.region===e.region}),_.forEach(a,function(a){a=a.name;var b=a+"-defense-for-"+c;Memory.army[a+"-defense"]||Memory.army[b]||m.createArmy(b,{reinforce:!1,region:e.region,boostRoom:c,buildRoom:c,stageRoom:c,attackRoom:c,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:h,units:17},melee:{maxCreeps:0,units:20},ranged:{maxCreeps:h,units:20}})}),2500<=b&&_.forEach(a,function(a){a=a.name;var b=a+"-defense-for-"+c;Memory.army[b]&&(Memory.army[b].boostRoom=
a)})));_.forEach(Object.keys(g),function(a){var b=c+"-"+a.toString()+"-border-defense";!Memory.army[b]&&50<=k[a]&&m.createArmy(b,{reinforce:!1,region:e.region,boostRoom:c,buildRoom:c,stageRoom:c,attackRoom:g[a],dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:h,units:17},melee:{maxCreeps:0,units:20},ranged:{maxCreeps:h,units:20}})})}else Game.notify("Warning! "+c+" is under attack!"),m.createArmy(f,{reinforce:!1,region:e.region,boostRoom:c,buildRoom:c,stageRoom:c,attackRoom:c,dismantle:[],
dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:h,units:17},melee:{maxCreeps:0,units:20},ranged:{maxCreeps:h,units:20},creepCount:0})}else a?e.lastHostile+50<Game.time&&(a&&(a.directive="attack",a.success=!0),delete e.lastHostile,delete e.currentAttack,delete e.edgeTicks):(delete e.lastHostile,delete e.currentAttack,delete e.edgeTicks)};y.prototype.transferEnergy=function(){var a=this.room,a=f.objectsClosestToObj(d.linksInRoom(a),d.spawnsInRoom(a)[0]),b=a["0"];_.forEach(a,function(a,c){0!==c&&
!b.cooldown&&0<b.energy&&300>=a.energy&&b.transferEnergy(a)})};y.prototype.terminal=function(){var b=this.room,c=b.terminal,e=b.storage,f=b.name,b=b.memory,k=c.store,g=k[RESOURCE_ENERGY]||0,l=Game.market,m=Math.max.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(_.filter(Game.rooms,function(a){var b=a.memory,c=a.storage;a=a.terminal;return b&&b.roomType&&"base"===b.roomType.type&&c&&c.my&&a&&a.my}),function(a){return(a=a.storage)&&a.my?a.store[RESOURCE_ENERGY]:0})))),L=[],A=b.buyQueue,p=!1,n=
{};e&&(n=e.store);if(1E3<=g&&m>=Memory.dealEnergy){var v=Memory,t=v.reserveMinerals,q=v.mineralPrices;if(A&&m>Memory.marketEnergy&&Memory.buy){e=A.resource;if(e=(h.getFilteredOrders().sell[e]||[])["0"])if(m=e.price,m>A.price)delete b.buyQueue,A=void 0;else{var v=e.amount,z=l.calcTransactionCost(Math.min(A.amount,v),f,e.roomName);g>z&&d.credits>=A.amount*m?(h.deal(e.id,Math.min(A.amount,v),f),p=!0,A.amount-=Math.min(A.amount,v)):0<g&&(m=Math.min(Math.floor(Math.min(A.amount,v)*g/z),Math.floor(d.credits/
m)),0<m&&(h.deal(e.id,m,f),p=!0,A.amount-=m))}else delete b.buyQueue,A=void 0;A&&0>=A.amount&&(delete b.buyQueue,A=void 0)}else if(d.credits>=Memory.minimumCredits&&_.forEach(_.filter(Game.rooms,function(a){var b=a.memory;a=a.terminal;return b&&b.roomType&&"base"===b.roomType.type&&a&&a.my}),function(a){var b=a.name,d=a.storage;p=!1;if(f===b)return!0;_.forEach(_.filter(_.map(k,function(b,c){return{resource:c,amount:Math.min(t?b+n[c]-(c.startsWith("X")&&5===c.length?t[c]-5E3:t[c]):0,b),otherRoomAmount:(a.terminal.store[c]||
0)+(d&&d.store[c]||0),needed:t?(c.startsWith("X")&&5===c.length?t[c]-5E3:t[c])||0:0}}),function(a){var b=a.otherRoomAmount,c=a.needed,d=a.amount;return t[a.resource]&&b<c&&0<d&&0<c-b&&100<=Math.min(d,c-b)}),function(a){var d=a.resource;a=Math.min(a.amount,a.needed-a.otherRoomAmount);var e=l.calcTransactionCost(a,f,b);if(g>e){if(c.send(d,a,b)===OK)return p=!0,!1}else if(0<g&&(a=Math.floor(a*g/e),0<a&&c.send(d,a,b)===OK))return p=!0,!1;return!0});return!p}),p||(b=_.filter(_.map(k,function(a,b){return{resource:b,
amount:Math.min(a,a-(t?(b.startsWith("X")&&5===b.length?t[b]-5E3:t[b])||0:0)+(n[b]||0))}}),function(a){return a.resource!==RESOURCE_ENERGY&&0<a.amount}),0<b.length&&_.forEach(b.sort(function(a,b){return b.amount-a.amount}),function(a){var b=a.resource,c=_.find(q,function(a){return a.resource===b}),e=_.filter(h.getFilteredOrders().buy[b]||[],function(b){return 5005<=a.amount&&d.credits<Memory.minimumCredits||c&&b.price>c.value})["0"];if(e){var k=e.amount,m=l.calcTransactionCost(Math.min(a.amount,k),
f,e.roomName);if(g>m)return h.deal(e.id,Math.min(a.amount,k),f),p=!0,!1;if(0<g&&(k=Math.floor(Math.min(a.amount,k)*g/m),0<k))return h.deal(e.id,k,f),p=!0,!1}return!0})),!p&&e&&m>Memory.marketEnergy&&(!Memory.buy||0===_.filter(Game.rooms,function(a){return a.memory.buyQueue}).length)){var B=h.getFilteredOrders();_.forEach(a,function(a,b){if(n&&!((n[b]||0)<t[b])&&-1===[RESOURCE_ENERGY,SUBSCRIPTION_TOKEN].indexOf(b)){a=(B.sell[b]||[])["0"];var c=(B.buy[b]||[])["0"],e=_.find(q,function(a){return a.resource===
b});a&&c&&a.price<c.price&&a.price<d.credits&&(!e||a.price<=e.value&&c.price>=e.value)&&L.push({resource:b,buy:c,sell:a})}});_.forEach(L.sort(function(a,b){return a.sell.price-a.buy.price-(b.sell.price-b.buy.price)}),function(a,b){b=a.sell;var c=b.price;a=Math.min(a.buy.amount,b.amount);a*c>d.credits&&(a=Math.floor(d.credits/c));c=l.calcTransactionCost(a,f,b.roomName);return g>c||0<g&&(a=Math.floor(a*g/c),0<a)?(h.deal(b.id,a,f),p=!0,!1):!0})}}};y.prototype.tasks=function(){var a=this.room,b=a.controller,
c=a.storage,e=a.terminal,k=a.memory,h=a.name,g=b?b.level:void 0,m=g?EXTENSION_ENERGY_CAPACITY[g]:0,l=d.nukersInRoom(a)["0"],A=d.powerSpawnsInRoom(a)["0"],p=e?e.store[RESOURCE_ENERGY]:0,n=c?c.store:void 0,v=k.labsInUse,t=k.labQueue,q=d.labsInRoom(a),z=t?t.amount:void 0,B=Memory.reserveMinerals,y=d.linksInRoom(a),w=d.spawnsInRoom(a),r,x=this.tasks={constructionSites:a.find(FIND_MY_CONSTRUCTION_SITES),criticalRepairableStructures:d.criticalRepairableStructuresInRoom(a),extensions:_.filter(d.extensionsInRoom(a),
function(a){return a.energy<m}),hostiles:d.hostilesInRoom(a),hurtCreeps:_.filter(Game.creeps,function(a){return a.room.name===h&&a.hits<a.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}),labsCollectMinerals:[],nuker:l,nukerResourcesNeeded:{},powerSpawn:A,powerSpawnResourcesNeeded:{},repairableStructures:_.filter(d.sortedRepairableStructuresInRoom(a),function(a){return.9>a.hits/a.hitsMax||1E5<a.hitsMax-a.hits}),spawns:_.filter(d.spawnsInRoom(a),function(a){return a.energy<SPAWN_ENERGY_CAPACITY}),
structuresWithEnergy:[].concat($jscomp.arrayFromIterable(c&&c.my?[c]:[]),$jscomp.arrayFromIterable(_.filter(d.containersInRoom(a),function(a){return 500<=a.store[RESOURCE_ENERGY]}).sort(function(a,b){return b.store[RESOURCE_ENERGY]-a.store[RESOURCE_ENERGY]}))),structuresWithMinerals:_.filter(d.containersInRoom(a),function(a){return a.store[RESOURCE_ENERGY]<_.sum(a.store)}).sort(function(a,b){return _.sum(b.store)-_.sum(a.store)}),terminalsCollectEnergy:e&&(!e.my||1E4<=p&&(!k.buyQueue||!c||n[RESOURCE_ENERGY]<
Memory.marketEnergy||d.credits<Memory.minimumCredits))?[e]:[],terminalsFillWithEnergy:e&&e.my&&5E3>p?[e]:[],towers:_.filter(d.towersInRoom(a),function(a){return a.energy<.8*TOWER_CAPACITY})};0<x.structuresWithEnergy.length&&_.forEach(d.creeps[h].storer,function(a){a.memory.lastCollectEnergyWasStorage=!1});x.quickConstructionSites=_.filter(x.constructionSites,function(a){return 1===a.progressTotal});c&&c.my&&(e&&e.my?_.sum(n)<c.storeCapacity&&B&&(x.storageResourcesNeeded={},_.forEach(Object.keys(B),
function(a){var b=B[a],b=(a.startsWith("X")&&5===a.length?b-5E3:b)-(n[a]||0);0<b&&(x.storageResourcesNeeded[a]=b)})):x.storageResourcesNeeded=void 0);l&&(x.nukerResourcesNeeded[RESOURCE_GHODIUM]=l.ghodiumCapacity-l.ghodium);.5>A.power/A.powerCapacity&&(x.powerSpawnResourcesNeeded[RESOURCE_POWER]=A.powerCapacity-A.power);if(t){var u=t.status;if(r=t.sourceLabs){var D=Game.getObjectById(r[0]);var J=Game.getObjectById(r[1])}}var H=x.labsCollectMinerals;v&&(_.forEach(v,function(a){Game.creeps[a.creepToBoost]||
H.push(Game.getObjectById(a.id))}),_.forEach(H,function(a){_.remove(v,function(b){return b.id===a.id})}));c&&t&&"clearing"===u&&_.forEach(_.filter(q,function(a){return-1===_.map(v,function(a){return a.id}).indexOf(a.id)&&0<a.mineralAmount}),function(a){H.push(a)});c&&v&&_.forEach(_.filter(v,function(a){var b=Game.getObjectById(a.id);return(!a.status||"emptying"===a.status)&&b&&b.mineralType&&b.mineralType!==a.resource}),function(a){H.push(Game.getObjectById(a.id))});c&&t&&r&&"creating"===u&&!f.roomLabsArePaused(a)&&
(k=D.mineralAmount,p=J.mineralAmount,0===k&&0!==p&&H.push(J),0!==k&&0===p&&H.push(D));!c||t&&"returning"!==u||_.forEach(_.filter(q,function(a){return(!t||a.mineralType===t.resource)&&(!v||0===_.filter(v,function(b){return b.id===a.id}).length)}),function(a){H.push(a)});v&&_.forEach(_.filter(v,function(a){var b=Game.getObjectById(a.id),c=a.status;return(!c||-1!==["filling","refilling"].indexOf(c))&&(!b.mineralType||b.mineralType===("refilling"===c?a.oldResource:a.resource))&&b.mineralAmount<("refilling"===
c?a.oldAmount:a.amount)}),function(a){var b=a.status,c=Game.getObjectById(a.id);x.labsFillMinerals=c;x.labsFillMineralsResourcesNeeded={};x.labsFillMineralsResourcesNeeded["refilling"===b?a.oldResource:a.resource]=("refilling"===b?a.oldAmount:a.amount)-c.mineralAmount;return!1});!x.labsFillMinerals&&c&&3<=q.length&&t&&-1!==["moving","creating"].indexOf(t.status)&&r&&!f.roomLabsArePaused(a)&&(D.mineralAmount<z&&(x.labsFillMinerals=D,x.labsFillMineralsResourcesNeeded={},x.labsFillMineralsResourcesNeeded[t.children[0]]=
z-D.mineralAmount),!x.labsFillMinerals&&J.mineralAmount<z&&(x.labsFillMinerals=J,x.labsFillMineralsResourcesNeeded={},x.labsFillMineralsResourcesNeeded[t.children[1]]=z-J.mineralAmount));c&&e&&B&&_.forEach(e.store,function(a,b){if(b!==RESOURCE_ENERGY){var c=B[b];c&&(n[b]?n[b]<(b.startsWith("X")&&5===b.length?Memory.reserveMinerals[b]-5E3:Memory.reserveMinerals[b])&&(x.terminalCollectMinerals=[e],x.terminalCollectMineralsResource=b,x.terminalCollectMineralsAmount=Math.min(a,(b.startsWith("X")&&5===
b.length?c-5E3:c)-n[b])):(x.terminalCollectMinerals=[e],x.terminalCollectMineralsResource=b,x.terminalCollectMineralsAmount=Math.min(a,b.startsWith("X")&&5===b.length?c-5E3:c)))}});b&&6<=g&&(c&&v&&_.forEach(_.filter(v,function(a){var b=a.status,c=Game.getObjectById(a.id);return(!b||-1!==["filling","refilling"].indexOf(b))&&(!c.mineralType||c.mineralType===("refilling"===b?a.oldResource:a.resource))}),function(a){var b=a.status,d=Game.getObjectById(a.id);return 0<("refilling"===b?a.oldAmount-d.mineralAmount:
a.amount-d.mineralAmount)?(x.storageCollectMinerals=[c],x.storageCollectMineralsResource="refilling"===b?a.oldResource:a.resource,x.storageCollectMineralsAmount="refilling"===b?a.oldAmount-d.mineralAmount:a.amount-d.mineralAmount,!1):!0}),!x.storageCollectMinerals&&c&&t&&-1!==["moving","creating"].indexOf(t.status)&&3<=q.length&&!f.roomLabsArePaused(a)&&_.forEach(t.children,function(a){var b=_.sum(_.filter(q,function(b){return b.mineralType===a}),function(a){return a.mineralAmount});return b<z?(x.storageCollectMinerals=
[c],x.storageCollectMineralsResource=a,x.storageCollectMineralsAmount=z-b,!1):!0}),!x.storageCollectMinerals&&c&&e&&B&&_.forEach(n,function(a,b){if(b===RESOURCE_ENERGY)return!0;var d=B[b];return d?(b.startsWith("X")&&5===b.length?d-5E3:d)<a?(x.storageCollectMinerals=[c],x.storageCollectMineralsResource=b,x.storageCollectMineralsAmount=a-(b.startsWith("X")&&5===b.length?d-5E3:d),!1):!0:(x.storageCollectMinerals=[c],x.storageCollectMineralsResource=b,x.storageCollectMineralsAmount=a,!1)}),x.storageCollectMinerals||
(l&&8<=g&&l.ghodium<l.ghodiumCapacity&&n[RESOURCE_GHODIUM]?(x.storageCollectMinerals=[c],x.storageCollectMineralsResource=RESOURCE_GHODIUM,x.storageCollectMineralsAmount=Math.min(l.ghodiumCapacity-l.ghodium,n[RESOURCE_GHODIUM])):A&&8<=g&&.5>A.power/A.powerCapacity&&n[RESOURCE_POWER]&&(x.storageCollectMinerals=[c],x.storageCollectMineralsResource=RESOURCE_POWER,x.storageCollectMineralsAmount=Math.min(A.powerCapacity-A.power,n[RESOURCE_POWER]))));1<y.length&&0<w.length&&(x.links=f.objectsClosestToObj(y,
w[0]))};y.prototype.spawn=function(a){var b=this.room,c=this.tasks,d=b.storage,e=b.storage.store[RESOURCE_ENERGY],f=b.controller,h=b.name,g=f.level,m=Memory.dismantle;this.checkSpawn(r,a&&(!d||e>=Memory.workerEnergy||3500>f.ticksToDowngrade||0<b.find(FIND_MY_CONSTRUCTION_SITES).length||c.criticalRepairableStructures&&0<c.criticalRepairableStructures.length||c.repairableStructures&&0<_.filter(c.repairableStructures,function(a){return 1!==[STRUCTURE_WALL,STRUCTURE_RAMPART].indexOf(a.structureType)&&
1E6>a.hits}).length));this.checkSpawn(p,a);this.checkSpawn(w,a);this.checkSpawn(z,a&&6<=g);this.checkSpawn(B,a&&!!(m&&m[h]&&0<m[h].length));this.checkSpawn(n,a);this.checkSpawn(k,a);this.checkSpawn(t,a);this.checkSpawn(q,a&&(e>=Memory.upgradeEnergy||8>g||0<_.filter(Game.rooms,function(a){return(a=a.controller)&&a.my&&8>a.level}).length))};y.prototype.assignTasks=function(){r.assignTasks(this);p.assignTasks(this);w.assignTasks(this);z.assignTasks(this);B.assignTasks(this);n.assignTasks(this);k.assignTasks(this);
t.assignTasks(this);q.assignTasks(this);c.assignTasks(this)};y.prototype.labQueue=function(){var a=this.room,b=this.room.memory,c=b.labQueue,e=c.status;if("clearing"===e){var k=b.labsInUse,b=d.labsInRoom(a);if(!k||2<b.length-k.length&&0===_.filter(b,function(a){return 0===_.filter(k,function(b){return b.id===a.id}).length&&0<a.mineralAmount}).length)c.status="moving"}else if("moving"===e)if(!c.start||c.start+500<Game.time)delete b.labQueue,c=void 0;else{var e=c.children||[],h=d.labsInRoom(a),g=c.sourceLabs||
[],m=Game.getObjectById(g[0]),l=Game.getObjectById(g[1]),p=b.labsInUse,n=!0;_.forEach(e,function(a){_.sum(_.filter(h,function(b){return b.mineralType===a}),function(a){return a.mineralAmount})<c.amount&&(n=!1);return n});m.mineralType===e[0]&&l.mineralType===e[1]&&_.forEach(_.filter(h,function(a){return-1===g.indexOf(a.id)&&(!p||-1===_.map(_.filter(p,function(a){return a.resource!==c.resource}),function(a){return a.id}).indexOf(a.id))}),function(a){a.runReaction(m,l)===OK&&(c.amount-=5)});n&&(c.status=
"creating")}else if("creating"===e){var a=d.labsInRoom(a),v=c.sourceLabs||[],t=b.labsInUse,q=Game.getObjectById(v[0]),z=Game.getObjectById(v[1]);_.forEach(_.filter(a,function(a){return-1===v.indexOf(a.id)&&(!t||-1===_.map(_.filter(t,function(a){return a.resource!==c.resource}),function(a){return a.id}).indexOf(a.id))}),function(a){a.mineralAmount===LAB_MINERAL_CAPACITY&&(c.status="returning");a.runReaction(q,z)===OK&&(c.amount-=5)});0===_.sum(_.filter(a,function(a){return-1!==v.indexOf(a.id)}),function(a){return a.mineralAmount})&&
(c.status="returning");0>=c.amount&&(delete b.labQueue,c=void 0)}else"returning"===e?0===_.sum(_.filter(d.labsInRoom(a),function(a){return a.mineralType===c.resource}),function(a){return a.mineralAmount})&&(delete b.labQueue,c=void 0):(c.status="clearing",c.sourceLabs=f.getSourceLabs(a))};y.prototype.labsInUse=function(){var a=this.room.memory.labsInUse,b=[];_.forEach(a,function(a){var c=a.status,d=Game.getObjectById(a.id);if("emptying"===c){if(0===d.mineralAmount||d.mineralType===a.resource)a.status=
"filling"}else if("filling"===c)d.mineralAmount===a.amount&&d.mineralType===a.resource&&(a.status="waiting");else if("refilling"===c)d.mineralAmount===a.oldAmount&&d.mineralType===a.oldResource&&b.push(a);else{var e=Game.creeps[a.creepToBoost];1>=d.pos.getRangeTo(e)&&d.mineralType===a.resource&&d.mineralAmount>=a.amount&&d.boostCreep(e)===OK&&(_.remove(e.memory.labs,function(b){return b===a.id}),c&&0!==a.oldAmount?a.status="refilling":b.push(a))}});_.forEach(b,function(b){_.remove(a,function(a){return a.id===
b.id})})};y.prototype.processPower=function(){_.forEach(d.powerSpawnsInRoom(this.room),function(a){1<=a.power&&50<=a.energy&&a.processPower()})};y.prototype.toObj=function(){Memory.rooms[this.room.name].roomType={type:this.type}};y.fromObj=function(a){return new y(a)};Memory.profiling&&e(1,32).registerObject(y,"RoomBase");l.exports=y;return l.exports};n[33]=function(l,g){var d=e(3,33),m=e(4,33),h=e(57,33),a=e(9,33),b=e(23,33),c=e(22,33),f=function(a){var b=h.call(this)||this;b.type="cleanup";b.room=
a;b.supportRoom=Game.rooms[Memory.rooms[a.name].roomType.supportRoom];a.memory.maxCreeps||(a.memory.maxCreeps={});return b};$jscomp.inherits(f,h);f.prototype.run=function(){this.supportRoom&&(this.room.unobservable||this.tasks(),this.spawn(),this.assignTasks())};f.prototype.tasks=function(){var b=this.supportRoom,c=this.room,e=this.room.name,f=this.tasks={};f.ramparts=c.find(FIND_STRUCTURES,{filter:function(a){return a.structureType===STRUCTURE_RAMPART}});f.structures=c.find(FIND_STRUCTURES,{filter:function(b){return b.structureType!==
STRUCTURE_RAMPART&&b.structureType!==STRUCTURE_CONTROLLER&&b.structureType!==STRUCTURE_ROAD&&b.structureType!==STRUCTURE_WALL&&(0===f.ramparts.length||0<b.pos.getRangeTo(a.objectsClosestToObj(f.ramparts,b)[0]))}});f.noResourceStructures=_.filter(f.structures,function(a){return a.structureType===STRUCTURE_NUKER||(!a.energy||50>a.energy)&&(!a.store||0===_.sum(a.store))&&(!a.mineralAmount||0===a.mineralAmount)});f.resourceStructures=_.filter(f.structures,function(a){return a.structureType!==STRUCTURE_NUKER&&
(a.energy&&0<a.energy||a.store&&0<_.sum(a.store)||a.mineralAmount&&0<a.mineralAmount)});f.junk=c.find(FIND_STRUCTURES,{filter:function(a){return-1!==[STRUCTURE_WALL,STRUCTURE_ROAD].indexOf(a.structureType)}});f.energyStructures=_.filter(f.resourceStructures,function(a){return a.energy||a.store&&a.store[RESOURCE_ENERGY]}).sort(function(a,b){return(a.energy||a.store[RESOURCE_ENERGY])-(b.energy||b.store[RESOURCE_ENERGY])});f.mineralStructures=_.filter(f.resourceStructures,function(a){return(a.store||
-1!==[STRUCTURE_LAB,STRUCTURE_POWER_SPAWN].indexOf(a.structureType))&&(0<_.sum(a.store)&&a.store[RESOURCE_ENERGY]<_.sum(a.store)||0<a.mineralAmount||0<a.power)}).sort(function(a,b){return(a.mineralAmount||a.power||_.sum(a.store)-a.store[RESOURCE_ENERGY])-(b.mineralAmount||b.power||_.sum(b.store)-b.store[RESOURCE_ENERGY])});f.resources=d.resourcesInRoom(c);f.dismantle=Array.prototype.concat.apply([],[f.noResourceStructures,f.ramparts,f.junk]);f.hostileConstructionSites=d.hostileConstructionSitesInRoom(c);
0===f.resourceStructures.length&&0===f.dismantle.length&&0===f.resources.length&&(c=d.creeps[e],Game.notify("Cleanup Room "+e+" is squeaky clean!"),_.forEach(c&&c.remoteCollector||[],function(a){a=a.memory;a.role="storer";a.home=b.name}),_.forEach(c&&c.remoteDismantler||[],function(a){a.suicide()}),m.setRoomType(e),delete d.rooms[e])};f.prototype.spawn=function(){var a=this.tasks;this.checkSpawn(b,this.room.unobservable||0<a.structures.length||0<a.ramparts.length||0<a.length);this.checkSpawn(c,!0)};
f.prototype.assignTasks=function(){b.assignTasks(this);c.assignTasks(this)};f.prototype.toObj=function(){Memory.rooms[this.room.name].roomType={type:this.type,supportRoom:this.supportRoom.name}};f.fromObj=function(a){return new f(a)};Memory.profiling&&e(1,33).registerObject(f,"RoomCleanup");l.exports=f;return l.exports};n[34]=function(l,g){var d=e(3,34),m=e(4,34),h=e(57,34),a=e(9,34),b=e(17,34),c=e(21,34),f=e(24,34),k=e(25,34),n=e(26,34),B=e(27,34),t=function(a){var b=Memory.rooms[a.name].roomType;
var c=h.call(this)||this;c.type="mine";c.room=a;c.supportRoom=Game.rooms[b.supportRoom];c.stage=b.stage||1;a.memory.maxCreeps||(a.memory.maxCreeps={});return c};$jscomp.inherits(t,h);t.prototype.run=function(){var a=this.room,b=this.room.controller;(a.unobservable||0!==a.find(FIND_SOURCES).length)&&Game.rooms[Memory.rooms[a.name].roomType.supportRoom]&&("mine"===this.type&&b&&b.my?this.convert():(1===this.stage&&this.stage1(),2===this.stage&&this.stage2()))};t.prototype.convert=function(){var b=this.supportRoom.name,
c=this.room,e=this.room.name,f=Memory.rooms[e],k=d.creeps[e];m.claimRoom(b,e,!1);m.setRoomType(e,{type:"base",region:f.region});_.forEach(k&&k.all||[],function(d){var f=d.memory;switch(f.role){case "remoteBuilder":case "remoteWorker":f.role="worker";f.home=e;d=a.objectsClosestToObj(c.find(FIND_SOURCES),d)["0"];f.homeSource=d.id;break;case "remoteReserver":d.suicide();break;case "remoteStorer":f.role="storer";f.home=b;break;case "dismantler":f.home=e,f.supportRoom=e}})};t.prototype.stage1=function(){this.stage1Tasks();
this.stage1Spawn();this.stage1AssignTasks();this.room.unobservable||(this.stage1Manage(),this.defend())};t.prototype.stage1Tasks=function(){var a=this.room;this.tasks={};a.unobservable||(this.tasks.hostiles=d.hostilesInRoom(a),this.tasks.hostileConstructionSites=d.hostileConstructionSitesInRoom(a))};t.prototype.stage1Spawn=function(){this.checkSpawn(k,this.room.controller);this.checkSpawn(c,!0)};t.prototype.stage1AssignTasks=function(){this.room.controller&&k.assignTasks(this);c.assignTasks(this);
f.assignTasks(this);B.assignTasks(this);n.assignTasks(this);b.assignTasks(this)};t.prototype.stage1Manage=function(){var b=this,c=this.room,e=this.room.name,f=c.find(FIND_MINERALS),k=c.find(FIND_SOURCES),h=Array.prototype.concat.apply([],[k,/^[EW][0-9]*[4-6][NS][0-9]*[4-6]$/.test(e)?f:[]]),g=d.containersInRoom(c),m=Array.prototype.concat.apply([],[k,f]),l=d.creeps[e];if(g.length>=h.length)this.stage=2,_.forEach(g,function(b){var c=a.objectsClosestToObj(m,b)["0"];if(c instanceof Mineral)return!0;_.forEach(l&&
l.remoteBuilder||[],function(b){b=b.memory;b.role="remoteWorker";var d=a.objectsClosestToObj(g,c)["0"];b.container=d.id});return!1});else{var n=c.find(FIND_MY_CONSTRUCTION_SITES);0===n.length&&_.forEach(h,function(a){var e=PathFinder.search(a.pos,{pos:d.spawnsInRoom(b.supportRoom)[0].pos,range:1},{swampCost:1}).path["0"];0===_.filter(e.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&0===_.filter(n,function(a){return a.pos.x===e.x&&a.pos.y===e.y&&a.structureType===
STRUCTURE_CONTAINER}).length&&c.createConstructionSite(e.x,e.y,STRUCTURE_CONTAINER)})}};t.prototype.defend=function(){var a=this.room,b=this.room,c=b.name,e=b.memory.threat,f=this.supportRoom,b=this.supportRoom.name,k=c+"-defense",h=d.hostilesInRoom(a),g=d.armies[k];0<_.filter(h,function(a){return a.owner&&"Invader"!==a.owner.username}).length&&e&&0<e?(e=Math.ceil(e/(300*BODYPART_COST[ATTACK])),g?(g.boostRoom=b,g.healer.maxCreeps=2*e,g.melee.maxCreeps=e,g.melee.escort=!0,g.ranged.maxCreeps=e,g.ranged.escort=
!0,g.success=!1,g.reinforce=!0):m.createArmy(k,{reinforce:!1,region:a.memory.region,boostRoom:b,buildRoom:b,stageRoom:b,attackRoom:c,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:2*e,units:20},melee:{maxCreeps:e,units:20,escort:!0},ranged:{maxCreeps:e,units:20,escort:!0}})):0<_.filter(h,function(a){return a.owner&&"Invader"===a.owner.username}).length?g||(g=f.energyCapacityAvailable,m.createArmy(k,{reinforce:!1,region:a.memory.region,boostRoom:void 0,buildRoom:b,stageRoom:b,attackRoom:c,
dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:1,units:Math.min(Math.floor((g-300)/300),20)},melee:{maxCreeps:1,units:Math.min(Math.floor((g-300)/130),20)},ranged:{maxCreeps:0,units:20}})):g&&(g.directive="attack",g.success=!0,g.reinforce=!1)};t.prototype.stage2=function(){this.stage2Manage();this.defend();1!==this.stage&&(this.stage2Tasks(),this.room.unobservable||this.stage2Spawn(),this.stage2AssignTasks())};t.prototype.stage2Manage=function(){var a=this.room,b=d.creeps[this.room.name];
a.unobservable?0===(b&&b.remoteMiner||[]).length&&0===(b&&b.remoteWorker||[]).length&&0===(b&&b.remoteStorer||[]).length&&0===(b&&b.remoteReserver||[]).length&&(this.stage=1):d.containersInRoom(a).length<Array.prototype.concat.apply([],[a.find(FIND_SOURCES),/^[EW][0-9]*[4-6][NS][0-9]*[4-6]$/.test(a.name)?a.find(FIND_MINERALS):[]]).length&&(this.stage=1)};t.prototype.stage2Tasks=function(){var a=this.room;this.tasks={};a.unobservable||(this.tasks.hostiles=d.hostilesInRoom(a),this.tasks.hostileConstructionSites=
d.hostileConstructionSitesInRoom(a),this.tasks.energyStructures=d.containersInRoom(a),this.tasks.mineralStructures=d.containersInRoom(a))};t.prototype.stage2Spawn=function(){var a=this.room;if(!(0<d.hostilesInRoom(a).length)){var c=Memory,e=c.dismantle,c=c.dismantle[a.name];this.checkSpawn(k,a.controller);this.checkSpawn(f,!0);this.checkSpawn(B,!0);this.checkSpawn(n,!0);this.checkSpawn(b,!!(e&&c&&0<c.length))}};t.prototype.stage2AssignTasks=function(){this.room.controller&&k.assignTasks(this);f.assignTasks(this);
B.assignTasks(this);n.assignTasks(this);b.assignTasks(this)};t.prototype.toObj=function(){Memory.rooms[this.room.name].roomType={type:this.type,supportRoom:this.supportRoom.name,stage:this.stage}};t.fromObj=function(a){return new t(a)};Memory.profiling&&e(1,34).registerObject(t,"RoomMine");l.exports=t;return l.exports};n[35]=function(l,g){var d=e(3,35),m=e(4,35),h=e(34,35),a=e(16,35),b=e(19,35),c=e(22,35),f=function(a){a=h.call(this,a)||this;a.type="source";delete a.convert;return a};$jscomp.inherits(f,
h);f.prototype.stage1Tasks=function(){var a=this.room;h.prototype.stage1Tasks.call(this);a.unobservable||(this.tasks.keepers=d.sourceKeepersInRoom(a),this.tasks.hurtCreeps=_.filter(Game.creeps,function(b){return b.room.name===a.name&&b.hits<b.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}))};f.prototype.stage1Spawn=function(){var c=d.creeps[this.room.name],e=c&&c.defender||[];if(!this.room.unobservable&&(this.checkSpawn(a,!0),this.checkSpawn(b,!0),!c||!e||0===_.filter(e,function(a){return!a.spawning}).length))return;
h.prototype.stage1Spawn.call(this)};f.prototype.stage1AssignTasks=function(){a.assignTasks(this);b.assignTasks(this);h.prototype.stage1AssignTasks.call(this,this)};f.prototype.defend=function(){var a=this.room,b=this.room.name,c=this.supportRoom.name,e=b+"-defense",f=Memory.army[e];0<_.filter(d.hostilesInRoom(a),function(a){return a.owner&&"Invader"===a.owner.username}).length?f||m.createArmy(e,{reinforce:!1,region:a.memory.region,boostRoom:void 0,buildRoom:c,stageRoom:c,attackRoom:b,dismantle:[],
dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:2,units:17},melee:{maxCreeps:2,units:20},ranged:{maxCreeps:0,units:20}}):f&&(f.directive="attack",f.success=!0)};f.prototype.stage2Tasks=function(){var a=this.room;h.prototype.stage2Tasks.call(this);a.unobservable||(this.tasks.keepers=d.sourceKeepersInRoom(a).sort(function(a,b){return a.ticksToSpawn&&!b.ticksToSpawn?-1:!a.ticksToSpawn&&b.ticksToSpawn?1:a.ticksToSpawn-b.ticksToSpawn}),this.tasks.hurtCreeps=_.filter(Game.creeps,function(b){return b.room.name===
a.name&&b.hits<b.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}))};f.prototype.stage2Spawn=function(){var e=d.creeps[this.room.name],f=e&&e.defender||[];this.room.unobservable||(this.checkSpawn(a,!0),this.checkSpawn(b,!0),e&&f&&0!==_.filter(f,function(a){return!a.spawning}).length&&(h.prototype.stage2Spawn.call(this),this.checkSpawn(c,!0)))};f.prototype.stage2AssignTasks=function(){a.assignTasks(this);b.assignTasks(this);h.prototype.stage2AssignTasks.call(this);c.assignTasks(this)};
f.fromObj=function(a){return new f(a)};Memory.profiling&&e(1,35).registerObject(f,"RoomSource");l.exports=f;return l.exports};n[36]=function(l,g){var d=e(3,36),m=e(58,36),h=function(a){this.type="build";this.id=a;this.constructionSite=Game.getObjectById(a);this.force=!0};h.prototype.canAssign=function(a){if(a.spawning||!a.carry[RESOURCE_ENERGY]||0===a.getActiveBodyparts(WORK))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};h.prototype.run=function(a){var b=this.constructionSite;a.carry[RESOURCE_ENERGY]&&
b&&0!==a.getActiveBodyparts(WORK)?(m.moveTo(a,b,Math.max(Math.min(a.pos.getRangeTo(b)-1,3),1)),a.build(b,RESOURCE_ENERGY)===OK&&(Math.min(5*a.getActiveBodyparts(WORK),a.carry[RESOURCE_ENERGY])>=b.progressTotal-b.progress||a.carry[RESOURCE_ENERGY]<=Math.min(5*a.getActiveBodyparts(WORK)))&&delete a.memory.currentTask):delete a.memory.currentTask};h.prototype.toObj=function(a){this.constructionSite?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};h.fromObj=function(a){a=
a.memory.currentTask.id;if(Game.getObjectById(a))return new h(a)};Memory.profiling&&e(1,36).registerObject(h,"TaskBuild");l.exports=h;return l.exports};n[37]=function(l,g){var d=e(3,37),m=e(58,37),h=function(a,b){var c=Game.getObjectById(a);this.id=a;this.pos=(this.controller=c)?c.pos:b;this.type="claim"};h.prototype.canAssign=function(a){var b=this.controller;if(a.spawning||"claimer"!==a.memory.role||!b||b.my||0===a.getActiveBodyparts(CLAIM))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};
h.prototype.run=function(a){if(0===!a.getActiveBodyparts(CLAIM))delete a.memory.currentTask;else{var b=this.controller;m.moveTo(a,this.pos,1);b&&a.claimController(b)}};h.prototype.toObj=function(a){a.memory.currentTask={id:this.id,x:this.x,y:this.y,roomName:this.roomName,type:this.type}};h.fromObj=function(a){a=a.memory.currentTask;return new h(a.id,new RoomPosition(a.x,a.y,a.roomName))};Memory.profiling&&e(1,37).registerObject(h,"TaskClaim");l.exports=h;return l.exports};n[38]=function(l,g){var d=
e(3,38),m=e(58,38),h=function(a){this.type="collectEnergy";this.id=a;this.object=Game.getObjectById(a)};h.prototype.canAssign=function(a){var b=this.object;if(a.spawning||150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||!b||0===(b.energy||b.store&&b.store[RESOURCE_ENERGY]||0))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};h.prototype.run=function(a){var b=this.object;if(150>a.ticksToLive||!b)delete a.memory.currentTask;else{var c=b.energy||b.store&&b.store[RESOURCE_ENERGY]||0;if(_.sum(a.carry)===
a.carryCapacity||0===c)delete a.memory.currentTask;else{m.moveTo(a,b,1);if(1===a.pos.getRangeTo(b)&&(c=_.filter(b.pos.lookFor(LOOK_RESOURCES),function(a){return 50<a.amount}),0<c.length)){a.pickup(c[0]);return}a.withdraw(b,RESOURCE_ENERGY)===OK&&delete a.memory.currentTask}}};h.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};h.fromObj=function(a){a=a.memory.currentTask.id;if(Game.getObjectById(a))return new h(a)};Memory.profiling&&
e(1,38).registerObject(h,"TaskCollectEnergy");l.exports=h;return l.exports};n[39]=function(l,g){var d=e(3,39),m=e(58,39),h=function(a,b,c){this.type="collectMinerals";this.id=a;this.resource=b;this.amount=c;this.object=Game.getObjectById(a)};h.prototype.canAssign=function(a){var b=this.object;if(!b||0>this.amount||a.spawning||150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||0<a.carry[RESOURCE_ENERGY])return!1;var c=b.structureType===STRUCTURE_LAB,e=b.mineralAmount,k=b.store;if(c&&0===e||b.store&&
_.sum(k)===k[RESOURCE_ENERGY])return!1;var h=this.resource,g=this.amount;if(h&&this.amount&&(c&&b.mineralType!==h&&e<g||!c&&(k[h]||0)<g))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};h.prototype.run=function(a){var b=this.object,c=this.resource,d=this.amount,e=a.carryCapacity,h=_.sum(a.carry);if(0>d||150>a.ticksToLive||!b)delete a.memory.currentTask;else{var g=b.store;if(h===e)delete a.memory.currentTask;else{if(b.structureType===STRUCTURE_LAB){if(null===b.mineralType){delete a.memory.currentTask;
return}c=[b.mineralType]}else c=c?[c]:_.filter(Object.keys(g),function(a){return a!==RESOURCE_ENERGY&&0<g[a]});0===c.length?delete a.memory.currentTask:(m.moveTo(a,b,1),d?a.withdraw(b,c[0],Math.min(d,e-h))===OK&&delete a.memory.currentTask:a.withdraw(b,c[0])===OK&&delete a.memory.currentTask)}}};h.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id,resource:this.resource,amount:this.amount}:delete a.memory.currentTask};h.fromObj=function(a){var b=a.memory;a=b.currentTask;
b=b.currentTask.id;if(Game.getObjectById(b))return new h(b,a.resource,a.amount)};Memory.profiling&&e(1,39).registerObject(h,"TaskCollectMinerals");l.exports=h;return l.exports};n[40]=function(l,g){var d=e(3,40),m=e(58,40),h=function(a){this.type="dismantle";this.id=a;this.structure=Game.getObjectById(a);this.force=this.unimportant=!0};h.prototype.canAssign=function(a){if(a.spawning||0<a.carryCapacity&&_.sum(a.carry)===a.carryCapacity||a.spawning||0===a.getActiveBodyparts(WORK))return!1;d.creepTasks[a.name]=
this;this.toObj(a);return!0};h.prototype.run=function(a){var b=this.structure,c=a.carry,d=a.carryCapacity;0<d&&_.sum(c)===d||!b||0===a.getActiveBodyparts(WORK)?delete a.memory.currentTask:(m.moveTo(a,b,1),a.dismantle(b),50*Math.min(a.getActiveBodyparts(WORK),c[RESOURCE_ENERGY])>=b.hits&&delete a.memory.currentTask)};h.prototype.toObj=function(a){this.structure?a.memory.currentTask={type:this.type,id:this.structure.id}:delete a.memory.currentTask};h.fromObj=function(a){a=a.memory.currentTask.id;if(Game.getObjectById(a))return new h(a)};
Memory.profiling&&e(1,40).registerObject(h,"TaskDismantle");l.exports=h;return l.exports};n[41]=function(l,g){var d=e(3,41),m=e(58,41),h=function(a,b){var c=Game.getObjectById(a);this.id=a;this.pos=(this.controller=c)?c.pos:b;this.type="downgrade"};h.prototype.canAssign=function(a){var b=this.controller;if(a.spawning||"downgrader"!==a.memory.role||!b||!b.level||0===a.getActiveBodyparts(CLAIM))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};h.prototype.run=function(a){if(0===!a.getActiveBodyparts(CLAIM))delete a.memory.currentTask;
else{var b=this.controller;m.moveTo(a,new RoomPosition(this.x,this.y,this.roomName),1);b&&a.attackController(b)}};h.prototype.toObj=function(a){a.memory.currentTask={id:this.controller.id,x:this.x,y:this.y,roomName:this.roomName,type:this.type}};h.fromObj=function(a){a=a.memory.currentTask;return new h(a.id,new RoomPosition(a.x,a.y,a.roomName))};Memory.profiling&&e(1,41).registerObject(h,"TaskDowngrade");l.exports=h;return l.exports};n[42]=function(l,g){var d=e(3,42),m=e(58,42),h=function(a){this.type=
"fillEnergy";this.id=a;this.object=Game.getObjectById(a)};h.prototype.canAssign=function(a){var b=this.object;if(a.spawning||!a.carry[RESOURCE_ENERGY]||b.energyCapacity&&b.energy===b.energyCapacity)return!1;if(b.structureType===STRUCTURE_EXTENSION){switch(b.room.controller.level){case 7:b=100;break;case 8:b=200;break;default:b=50}if(a.carry[RESOURCE_ENERGY]<b)return!1}d.creepTasks[a.name]=this;this.toObj(a);return!0};h.prototype.run=function(a){var b=this.object;b&&(b.energy||_.sum(b.store))!==(b.energyCapacity||
b.storeCapacity)?b&&a.carry[RESOURCE_ENERGY]?(m.moveTo(a,b,1),a.transfer(b,RESOURCE_ENERGY)===OK&&delete a.memory.currentTask):delete a.memory.currentTask:delete a.memory.currentTask};h.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};h.fromObj=function(a){a=a.memory.currentTask.id;if(Game.getObjectById(a))return new h(a)};Memory.profiling&&e(1,42).registerObject(h,"TaskFillEnergy");l.exports=h;return l.exports};n[43]=function(l,
g){var d=e(3,43),m=e(58,43),h=function(a,b){this.type="fillMinerals";this.id=a;this.resources=b;this.object=Game.getObjectById(a)};h.prototype.canAssign=function(a){if(a.spawning)return!1;var b=a.carry;if(_.sum(b)===b[RESOURCE_ENERGY])return!1;var c=this.resources;if(c&&0===_.intersection(Object.keys(c),_.filter(Object.keys(b),function(a){return a!==RESOURCE_ENERGY&&b[a]})).length)return!1;var c=this.object,e=this.object.structureType;if(e===STRUCTURE_NUKER&&c.ghodium===c.ghodiumCapacity||e===STRUCTURE_POWER_SPAWN&&
c.power===c.powerCapacity)return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};h.prototype.run=function(a){var b=this.object;if(b){var c=b.storeCapacity,d=a.carry;if(c&&0===_.filter(Object.keys(d),function(a){return a!==RESOURCE_ENERGY&&0<d[a]}).length||(_.sum(b.store)||0)===c)delete a.memory.currentTask;else{var e=this.resources;if(e)if(c=_.intersection(Object.keys(e),_.filter(Object.keys(d),function(a){return d[a]})).sort(function(a,b){a=e[a];b=e[b];return a===b?0:null===a?1:null===b?-1:a-
b}),0===c.length)delete a.memory.currentTask;else{m.moveTo(a,b,1);var h=c["0"],g=e[h];a.transfer(b,h,null===g?void 0:Math.min(g,d[h]))===OK&&1===c.length&&delete a.memory.currentTask}else c=_.filter(Object.keys(d),function(a){return a!==RESOURCE_ENERGY&&0<d[a]}),0===c.length?delete a.memory.currentTask:(m.moveTo(a,b,1),a.transfer(b,c[0])===OK&&0===_.filter(Object.keys(d),function(a){return a!==RESOURCE_ENERGY&&0<d[a]}).length&&delete a.memory.currentTask)}}else delete a.memory.currentTask};h.prototype.toObj=
function(a){this.object?a.memory.currentTask={type:this.type,id:this.id,resources:this.resources}:delete a.memory.currentTask};h.fromObj=function(a){var b=a.memory;a=b.currentTask;b=b.currentTask.id;if(Game.getObjectById(b))return new h(b,a.resources)};Memory.profiling&&e(1,43).registerObject(h,"TaskFillMinerals");l.exports=h;return l.exports};n[44]=function(l,g){var d=e(3,44),m=e(58,44),h=function(a){this.type="flee";this.pos=a;this.unimportant=!0};h.prototype.canAssign=function(a){if(a.spawning)return!1;
d.creepTasks[a.name]=this;this.toObj(a);return!0};h.prototype.run=function(a){m.moveTo(a,this.pos,10,!0,d.hostilesInRoom(a.room))};h.prototype.toObj=function(a){a.memory.currentTask={type:this.type,x:this.pos.x,y:this.pos.y,roomName:this.pos.roomName,unimportant:this.unimportant}};h.fromObj=function(a){a=a.memory.currentTask;return new h(new RoomPosition(a.x,a.y,a.roomName))};Memory.profiling&&e(1,44).registerObject(h,"TaskFlee");l.exports=h;return l.exports};n[45]=function(l,g){var d=e(3,45),m=e(58,
45),h=function(a,b){this.type="harvest";this.id=a;this.failIn=b||10};h.prototype.canAssign=function(a){var b=Game.getObjectById(a.memory.homeSource);if(a.spawning||150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||0===a.getActiveBodyparts(WORK)||!(-1!==["miner","remoteMiner"].indexOf(a.role)||b&&0!==b.energy||(b=a.room.find(FIND_SOURCES_ACTIVE)["0"],b)))return!1;this.id=b.id;d.creepTasks[a.name]=this;this.toObj(a);return!0};h.prototype.run=function(a){var b=Game.getObjectById(this.id||a.memory.homeSource);
150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||!b||0===b.energy||0===a.getActiveBodyparts(WORK)?delete a.memory.currentTask:(m.moveTo(a,b,1),a.harvest(b)!==OK&&(this.failIn--,0===this.failIn&&delete a.memory.currentTask))};h.prototype.toObj=function(a){a.memory.currentTask={type:this.type,failIn:this.failIn,id:this.id}};h.fromObj=function(a){a=a.memory.currentTask;if(Game.getObjectById(a.id))return new h(a.id,a.failIn)};Memory.profiling&&e(1,45).registerObject(h,"TaskHarvest");l.exports=h;return l.exports};
n[46]=function(l,g){var d=e(3,46),m=e(58,46),h=function(a){this.type="heal";this.id=a;this.ally=Game.getObjectById(a);this.unimportant=!0};h.prototype.canAssign=function(a){if(a.spawning||0===a.getActiveBodyparts(HEAL))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};h.prototype.run=function(a){var b=this.ally;a.hits<a.hitsMax&&a.heal(a);if(b){if(m.moveTo(a,b),b.hits!==b.hitsMax&&a.id!==b.id){var c=a.pos.getRangeTo(b);1>=c?a.heal(b):3>=c&&a.rangedHeal(b)}}else delete a.memory.currentTask};
h.prototype.toObj=function(a){this.ally?a.memory.currentTask={type:this.type,id:this.ally.id,unimportant:this.unimportant}:delete a.memory.currentTask};h.fromObj=function(a){a=a.memory.currentTask.id;if(Game.getObjectById(a))return new h(a)};Memory.profiling&&e(1,46).registerObject(h,"TaskHeal");l.exports=h;return l.exports};n[47]=function(l,g){var d=e(3,47),m=e(58,47),h=function(a){this.type="meleeAttack";this.id=a;this.enemy=Game.getObjectById(a)};h.prototype.canAssign=function(a){if(a.spawning||
0===a.getActiveBodyparts(ATTACK))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};h.prototype.run=function(a){this.enemy?0===a.getActiveBodyparts(ATTACK)?(a.say("Help!"),delete a.memory.currentTask):(m.moveTo(a,this.enemy),a.attack(this.enemy)===ERR_NOT_IN_RANGE&&a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a),0<a.getActiveBodyparts(RANGED_ATTACK)&&a.rangedAttack(this.enemy)):(a.say("Get Rekt!",!0),delete a.memory.currentTask)};h.prototype.toObj=function(a){this.enemy?a.memory.currentTask=
{type:this.type,id:this.id}:delete a.memory.currentTask};h.fromObj=function(a){a=a.memory.currentTask.id;if(Game.getObjectById(a))return new h(a)};Memory.profiling&&e(1,47).registerObject(h,"TaskMeleeAttack");l.exports=h;return l.exports};n[48]=function(l,g){var d=e(3,48),m=e(58,48),h=e(9,48),a=function(a){this.type="mine";this.id=a;this.source=Game.getObjectById(a);this.force=!0};a.prototype.canAssign=function(a){var b=Game.getObjectById(a.memory.container);if(a.spawning||!b||0===a.getActiveBodyparts(WORK))return!1;
d.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){var b=a.memory.container,e=Game.getObjectById(b);if(e){var k=e.pos,g=k.x,l=k.y,k=k.roomName,n=a.pos,p=n.x,r=n.y,w=n.roomName;g===p&&l===r&&k===w||m.moveTo(a,e,0);g===p&&l===r&&k===w&&(g=Memory.containerSource[b],this.source?g=this.source:(g?g=Game.getObjectById(g):(g=e.room,g=h.objectsClosestToObj(Array.prototype.concat.apply([],[g.find(FIND_SOURCES),g.find(FIND_MINERALS)]),a)["0"]),this.id=g.id),g instanceof Mineral&&0===
g.mineralAmount&&(a.say(":("),a.suicide()),g instanceof Mineral&&1500<=_.sum(e.store)||(a.harvest(g),e=d.creeps[w],0<_.filter(Array.prototype.concat.apply([],[e&&e.miner||[],e&&e.remoteMiner||[]]),function(c){return c.room.name===w&&c.memory.container===b&&1===c.pos.getRangeTo(a)&&c.ticksToLive>a.ticksToLive&&0===c.fatigue}).length&&(a.say(":("),a.suicide())))}else delete a.memory.currentTask};a.prototype.toObj=function(a){a.memory.currentTask={type:this.type,id:this.id}};a.fromObj=function(b){var c=
b.memory.currentTask.id;if(!b.memory.currentTask.id||c)return new a(c)};Memory.profiling&&e(1,48).registerObject(a,"TaskMine");l.exports=a;return l.exports};n[49]=function(l,g){var d=e(3,49),m=e(38,49),h=e(9,49),a=e(58,49),b=function(a){this.type="pickupResource";this.id=a;this.resource=Game.getObjectById(a);this.force=!0};b.prototype.canAssign=function(a){var b=this.resource;if(!b)return!1;var c=b.amount,e=b.room.controller;if(a.spawning||150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||c<a.pos.getRangeTo(b)||
b.resourceType===RESOURCE_ENERGY&&50>c||e&&-1!==Memory.allies.indexOf(h.getControllerOwner(e)))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};b.prototype.run=function(b){var c=this.resource;c&&_.sum(b.carry)!==b.carryCapacity?(a.moveTo(b,c,1),b.pickup(c)===OK&&(delete b.memory.currentTask,c=_.filter(b.room.lookForAt(LOOK_STRUCTURES,c),function(a){return a.structureType===STRUCTURE_CONTAINER&&a.store[RESOURCE_ENERGY]}),0<c.length&&(new m(c[0].id)).canAssign(b))):delete b.memory.currentTask};
b.prototype.toObj=function(a){var b=this.resource;b?a.memory.currentTask={type:this.type,id:b.id}:delete a.memory.currentTask};b.fromObj=function(a){a=a.memory.currentTask.id;if(Game.getObjectById(a))return new b(a)};Memory.profiling&&e(1,49).registerObject(b,"TaskPickupResource");l.exports=b;return l.exports};n[50]=function(l,g){var d=e(3,50),m=e(58,50),h=function(a,b){this.type="rally";this.id=a;this.rallyTo=b;switch(b){case "position":this.rallyPoint=new RoomPosition(a.x,a.y,a.roomName);this.range=
1;break;case "id":this.rallyPoint=Game.getObjectById(a);this.range=1;break;case "room":this.rallyPoint=new RoomPosition(25,25,a),this.range=5}this.unimportant=!0};h.prototype.canAssign=function(a){if(a.spawning)return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};h.prototype.run=function(a){var b=this.rallyPoint;if(b){var c=a.pos,d=a.pos,e=d.x,d=d.y,h=this.range;c.getRangeTo(b)<=h?0===e?a.move(RIGHT):49===e?a.move(LEFT):0===d?a.move(BOTTOM):49===d?a.move(TOP):0<_.filter(c.lookFor(LOOK_STRUCTURES),
function(a){return-1!==[STRUCTURE_ROAD,STRUCTURE_CONTAINER].indexOf(a.structureType)}).length&&a.move(Math.floor(8*Math.random())):m.moveTo(a,b,h);0<a.getActiveBodyparts(HEAL)&&(b=this.heal,c=this.rangedHeal,b?a.heal(Game.getObjectById(b)):c?a.rangedHeal(Game.getObjectById(c)):a.hits<a.hitsMax&&a.heal(a));0<a.getActiveBodyparts(ATTACK)&&(b=this.attack)&&a.attack(Game.getObjectById(b));0<a.getActiveBodyparts(RANGED_ATTACK)&&((b=this.rangedAttack)?a.rangedAttack(Game.getObjectById(b)):a.rangedMassAttack())}else delete a.memory.currentTask};
h.prototype.toObj=function(a){this.rallyPoint?a.memory.currentTask={type:this.type,id:this.id,rallyTo:this.rallyTo,unimportant:this.unimportant,range:this.range}:delete a.memory.currentTask};h.fromObj=function(a){var b=a.memory.currentTask;a=b.id;var c=b.rallyTo,b=b.range;switch(c){case "position":a=new h(new RoomPosition(a.x,a.y,a.roomName),c);break;case "id":case "room":a=new h(a,c);break;default:return}a&&b&&(a.range=b);return a};Memory.profiling&&e(1,50).registerObject(h,"TaskRally");l.exports=
h;return l.exports};n[51]=function(l,g){var d=e(3,51),m=e(58,51),h=function(a){this.type="rangedAttack";this.id=a;this.enemy=Game.getObjectById(a)};h.prototype.canAssign=function(a){if(a.spawning||0===a.getActiveBodyparts(RANGED_ATTACK))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};h.prototype.run=function(a){if(this.enemy)if(0===a.getActiveBodyparts(RANGED_ATTACK))a.say("Help!"),delete a.memory.currentTask;else{var b=this.enemy;0<a.getActiveBodyparts(ATTACK)?(m.moveTo(a,b),a.attack(b)===
ERR_NOT_IN_RANGE&&a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a),0<a.getActiveBodyparts(RANGED_ATTACK)&&a.rangedAttack(b)):(3<a.pos.getRangeTo(b)?m.moveTo(a,b,3):m.moveTo(a,b,3,!0,[b]),a.rangedAttack(b),a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a))}else a.say("Get Rekt!",!0),delete a.memory.currentTask};h.prototype.toObj=function(a){this.enemy?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};h.fromObj=function(a){a=a.memory.currentTask.id;if(Game.getObjectById(a))return new h(a)};
Memory.profiling&&e(1,51).registerObject(h,"TaskRangedAttack");l.exports=h;return l.exports};n[52]=function(l,g){var d=e(3,52),m=e(58,52),h=function(a){this.type="repair";this.id=a;this.structure=Game.getObjectById(a);this.force=!0};h.prototype.canAssign=function(a){if(!this.structure||a.spawning||!a.carry[RESOURCE_ENERGY]||0===a.getActiveBodyparts(WORK))return!1;var b=a.memory,c=a.room;if(1E6<=this.structure.hits&&"worker"===b.role&&c.name===b.home&&8>c.controller.level&&!_.find(a.body,function(a){return a.type===
WORK&&-1!==[RESOURCE_CATALYZED_LEMERGIUM_ACID,RESOURCE_LEMERGIUM_ACID,RESOURCE_LEMERGIUM_HYDRIDE].indexOf(a.boost)}))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};h.prototype.run=function(a){var b=a.carry[RESOURCE_ENERGY],c=this.structure,d=this.structure,e=d.hits,d=d.hitsMax;b&&c&&e!==d&&0!==a.getActiveBodyparts(WORK)?(m.moveTo(a,c,Math.max(Math.min(a.pos.getRangeTo(c)-1,3),1)),a.repair(c)===OK&&100*Math.min(a.getActiveBodyparts(WORK),b)>=d-e&&delete a.memory.currentTask):delete a.memory.currentTask};
h.prototype.toObj=function(a){var b=this.structure;b?a.memory.currentTask={type:this.type,id:b.id}:delete a.memory.currentTask};h.fromObj=function(a){a=a.memory.currentTask.id;if(Game.getObjectById(a))return new h(a)};Memory.profiling&&e(1,52).registerObject(h,"TaskRepair");l.exports=h;return l.exports};n[53]=function(l,g){var d=e(3,53),m=e(58,53),h=function(){this.type="reserve";this.force=!0};h.prototype.canAssign=function(a){if(a.spawning||0===a.getActiveBodyparts(CLAIM))return!1;var b=Game.rooms[a.memory.home];
if(!b||!b.controller||b.controller.my)return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};h.prototype.run=function(a){var b=a.memory.home,c=Game.rooms[a.memory.home];a.say("You;spin;me;right;round;baby;right;round;like a;record;baby;right;round;round;round;".split(";")[Game.time%16],!0);if(c&&c.controller&&!c.controller.my&&0!==a.getActiveBodyparts(CLAIM)){var d=Memory,e=d.signs,b=d.signs[b],d=c.controller,c=c.controller.sign;m.moveTo(a,d,1);a.reserveController(d);!e||!b||c&&"roncli"===c.username||
a.signController(d,b)}else delete a.memory.currentTask};h.prototype.toObj=function(a){a.memory.currentTask={type:this.type}};h.fromObj=function(){return new h};Memory.profiling&&e(1,53).registerObject(h,"TaskReserve");l.exports=h;return l.exports};n[54]=function(l,g){var d=e(3,54),m=function(){this.type="suicide";this.force=!0};m.prototype.canAssign=function(e){d.creepTasks[e.name]=this;this.toObj(e);return!0};m.prototype.run=function(d){d.suicide()};m.prototype.toObj=function(d){d.memory.currentTask=
{type:this.type}};m.fromObj=function(){return new m};Memory.profiling&&e(1,54).registerObject(m,"TaskSuicide");l.exports=m;return l.exports};n[55]=function(l,g){var d=e(3,55),m=e(58,55),h=e(9,55),a=function(a){var b=Game.rooms[a];this.type="upgradeController";this.room=a;this.controller=b.controller;this.force=!0};a.prototype.canAssign=function(a){if(a.spawning||!a.carry[RESOURCE_ENERGY]||"upgrader"!==a.memory.role&&_.sum(a.carry)!==a.carryCapacity&&150<=a.ticksToLive&&1E3<=this.controller.ticksToDowngrade||
0===a.getActiveBodyparts(WORK))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){var b=this.controller;a.say("I've;got to;celebrate;you baby;I've got;to praise;GCL like;I should!;".split(";")[Game.time%9],!0);if(b&&a.carry[RESOURCE_ENERGY]&&0!==a.getActiveBodyparts(WORK)){var e=a.pos,g=a.room,l=Memory,n=l.signs,l=l.signs[a.room.name],t=b.sign;"upgrader"===a.memory.role&&(g=h.objectsClosestToObj(d.linksInRoom(g),a)["0"])&&0<g.energy&&1>=e.getRangeTo(g)&&a.withdraw(g,
RESOURCE_ENERGY);m.moveTo(a,b,Math.max(Math.min(e.getRangeTo(b)-1,3),1));a.transfer(this.controller,RESOURCE_ENERGY);!n||!l||t&&"roncli"===t.username||a.signController(b,l);a.carry[RESOURCE_ENERGY]<=a.getActiveBodyparts(WORK)&&delete a.memory.currentTask}else delete a.memory.currentTask};a.prototype.toObj=function(a){a.memory.currentTask={type:this.type,room:this.room}};a.fromObj=function(b){return new a(b.memory.currentTask.room)};Memory.profiling&&e(1,55).registerObject(a,"TaskUpgradeController");
l.exports=a;return l.exports};n[56]=function(l,g){var d=e(3,56),m=e(4,56),h=e(9,56),a=e(36,56),b=e(37,56),c=e(38,56),f=e(39,56),k=e(40,56),n=e(41,56),r=e(42,56),t=e(43,56),p=e(44,56),z=e(45,56),w=e(46,56),q=e(48,56),u=e(47,56),y=e(49,56),C=e(50,56),E=e(51,56),F=e(52,56),I=e(53,56),G=e(54,56),K=e(55,56);g=function(){};g.attack=function(a,b,c){var d;b&&0!==b.length&&_.forEach(a,function(a){if(d=b["0"]){if(1>=a.pos.getRangeTo(d))var e=new u(d.id);else{var f=_.filter(b,function(b){return 1>=a.pos.getRangeTo(b)});
e=new C(d.pos,"position");0<f.length&&(e.attack=f["0"].id)}e.canAssign(a)&&(a.memory.currentTask.priority=Game.time,c&&a.say(c))}})};g.attackInQuadrant=function(a,b,c){var d;b&&0!==b.length&&_.forEach(a,function(a){if(d=_.filter(b,function(b){return h.checkQuadrant(b.pos,a.memory.quadrant)})["0"]){a.memory.target=d.id;if(1>=a.pos.getRangeTo(d))var e=new u(d.id);else{var f=_.filter(b,function(b){return 1>=a.pos.getRangeTo(b)});e=new C(d.pos,"position");0<f.length&&(e.attack=f["0"].id)}e.canAssign(a)&&
(a.memory.currentTask.priority=Game.time,c&&a.say(c))}})};g.attackTarget=function(a,b,c){_.forEach(a,function(a){var d;if(a.memory.target)if(d=Game.getObjectById(a.memory.target)){if(1>=a.pos.getRangeTo(d))d=new u(d.id);else{var e=_.filter(b,function(b){return 1>=a.pos.getRangeTo(b)});d=new C(d.pos,"position");0<e.length&&(d.attack=e["0"].id)}d.canAssign(a)&&(a.memory.currentTask.priority=Game.time,c&&a.say(c))}else delete a.memory.target})};g.build=function(b,c,d,e){d&&0!==d.length&&_.forEach(d,
function(d){var f=d.progressTotal-d.progress-_.sum(_.map(_.filter(c,function(a){return a.memory.currentTask&&"build"===a.memory.currentTask.type&&a.memory.currentTask.id===d.id}),function(a){return a.carry[RESOURCE_ENERGY]}));0<f&&_.forEach(h.objectsClosestToObj(b,d),function(b){return(new a(d.id)).canAssign(b)&&(e&&b.say(e),f-=b.carry[RESOURCE_ENERGY]||0,0>=f)?!1:!0})})};g.buildInCurrentRoom=function(b,c,d,e){var f=_.groupBy(b,function(a){return a.room.name});_.forEach(Object.keys(f),function(b){var g=
_.filter(Game.rooms[b].find(FIND_MY_CONSTRUCTION_SITES),function(a){return!d||1===a.progressTotal}),k=f[b];_.forEach(g,function(b){var d=b.progressTotal-b.progress-_.sum(_.map(_.filter(c,function(a){return a.memory.currentTask&&"build"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}),function(a){return a.carry[RESOURCE_ENERGY]}));0<d&&_.forEach(h.objectsClosestToObj(k,b),function(c){return(new a(b.id)).canAssign(c)&&(e&&c.say(e),d-=c.carry[RESOURCE_ENERGY]||0,_.remove(k,function(a){return a.id===
c.id}),0>=d)?!1:!0})})})};g.claimController=function(a,c){var d=this;_.forEach(a,function(a){var e=a.memory.claim,f=Game.rooms[e];f?(f=f.controller,!f||f.my?(delete Memory.maxCreeps.claimer[e],(new G).canAssign(a)&&a.say("RIP :(")):(new b(f.id)).canAssign(a)&&c&&a.say(c)):d.moveToRoom([a],e,c)})};g.collectEnergy=function(a,b,d,e){d&&0!==d.length&&_.forEach(d,function(d){var f=(d.store?d.store[RESOURCE_ENERGY]:d.energy)-_.sum(_.map(_.filter(b,function(a){return a.memory.currentTask&&"collectEnergy"===
a.memory.currentTask.type&&a.memory.currentTask.id===d.id}),function(a){return a.carryCapacity-_.sum(a.carry)}));0<f&&_.forEach(a,function(b){return b?(new c(d.id)).canAssign(b)&&(e&&(b.say(e),_.remove(a,function(a){return a.id===b.id})),"storer"===b.memory.role&&(b.memory.lastCollectEnergyWasStorage=d.structureType===STRUCTURE_STORAGE),f-=b.carryCapacity-_.sum(b.carry)||0,0>=f)?!1:!0:!0})})};g.collectEnergyFromHomeContainer=function(a,b){_.forEach(a,function(a){(new c(a.memory.container)).canAssign(a)&&
b&&a.say(b)})};g.collectMinerals=function(a,b,c,d,e,g){c&&0!==c.length&&_.forEach(c,function(c){var h=c.store?_.sum(c.store)-c.store[RESOURCE_ENERGY]-_.sum(_.map(_.filter(b,function(a){return a.memory.currentTask&&"collectMinerals"===a.memory.currentTask.type&&a.memory.currentTask.id===c.id}),function(a){return a.carryCapacity-_.sum(a.carry)})):c.mineralAmount;0<h&&_.forEach(a,function(a){return(new f(c.id,d,e)).canAssign(a)&&(g&&a.say(g),h-=a.carryCapacity-_.sum(a.carry)||0,0>=h)?!1:!0})})};g.collectMineralsFromHomeContainer=
function(a,b){_.forEach(a,function(a){(new f(a.memory.container)).canAssign(a)&&a.say(b)})};g.dismantleArmyTarget=function(a,b,c,d){if(Game.rooms[b]&&c&&0!==c.length){var e=new k(c[0]);_.forEach(a,function(a){e.canAssign(a)&&d&&a.say(d)})}};g.dismantleHostileStructures=function(a,b,c){if(b=Game.rooms[b])if(b=b.find(FIND_HOSTILE_STRUCTURES,{filter:function(a){return-1===[STRUCTURE_CONTROLLER,STRUCTURE_RAMPART,STRUCTURE_KEEPER_LAIR].indexOf(a.structureType)}}),0<b.length){var d=new k(b[0].id);_.forEach(a,
function(a){d.canAssign(a)&&c&&a.say(c)})}};g.dismantleStructures=function(a,b,c,d){c&&0!==c.length&&_.forEach(a,function(a){_.forEach(c,function(c){return 0===_.filter(b,function(a){return a.memory.currentTask&&"dismantle"===a.memory.currentTask.type&&a.memory.currentTask.id===c.id}).length&&(new k(c.id)).canAssign(a)?(d&&a.say(d),!1):!0});a.memory.currentTask||(new k(c[0].id)).canAssign(a)&&d&&a.say(d)})};g.dismantleTargets=function(a,b,c){var e=Memory.dismantle,f=b.name;if(e&&e[f])for(var g={};0<
e[f].length;){var h=e[f]["0"];g.structures=_.filter(b.lookForAt(LOOK_STRUCTURES,h.x,h.y),function(a){return a.hits});if(0===g.structures.length)e[f].shift();else{_.forEach(a,function(a){return function(b){(new k(a.structures[0].id)).canAssign(b)&&c&&b.say(c)}}(g));return}}(function(){_.forEach(a,function(a){var b=a.memory;b.role="worker";var c=d.containersInRoom(Game.rooms[b.supportRoom])["0"];b.container=c.id;delete d.creepTasks[a.name]})})()};g.downgradeController=function(a,b){var c=this;_.forEach(a,
function(a){var d=a.memory.downgrade,e=Game.rooms[d];e?(e=e.controller)&&e.level?(new n(e.id)).canAssign(a)&&b&&a.say(b):(delete Memory.maxCreeps.downgrader[d],(new G).canAssign(a)&&a.say("RIP :(")):c.moveToRoom([a],d,b)})};g.escort=function(a,b){_.forEach(_.filter(a,function(a){return!a.spawning&&a.memory.escorting}),function(a){var c=Game.getObjectById(a.memory.escorting);c?0===c.hitsMax-c.hits||c.hits/c.hitsMax>a.hits/a.hitsMax||!(new w(c.id)).canAssign(a)?(new C(c.pos,"position")).canAssign(a):
b&&a.say(b):delete a.memory.escorting})};g.fillExtensions=function(a,b,c,d,e){d&&0!==d.length&&_.forEach(_.filter(a,function(a){return a.carry[RESOURCE_ENERGY]>=EXTENSION_ENERGY_CAPACITY[c]}),function(a){_.forEach(d.sort(function(b,c){return b.pos.getRangeTo(a)-c.pos.getRangeTo(a)}),function(c){return 0===_.filter(b,function(a){return a.memory.currentTask&&"fillEnergy"===a.memory.currentTask.type&&a.memory.currentTask.id===c.id}).length&&(new r(c.id)).canAssign(a)?(e&&a.say(e),!1):!0})})};g.fillSpawns=
function(a,b,c,d){c&&0!==c.length&&_.forEach(_.filter(a,function(a){return 0<a.carry[RESOURCE_ENERGY]}),function(a){_.forEach(c.sort(function(b,c){return b.pos.getRangeTo(a)-c.pos.getRangeTo(a)}),function(c){return 0===_.filter(b,function(a){return a.memory.currentTask&&"fillEnergy"===a.memory.currentTask.type&&a.memory.currentTask.id===c.id}).length&&(new r(c.id)).canAssign(a)?(d&&a.say(d),!1):!0})})};g.fillStorageWithEnergy=function(a,b,c,d){c&&c.storage&&_.forEach(_.filter(a,function(a){return 0<
a.carry[RESOURCE_ENERGY]}),function(a){c.terminal&&a.memory.lastCollectEnergyWasStorage||!(new r(c.storage.id)).canAssign(a)||d&&a.say(d)})};g.fillTerminal=function(a,b,c,d){c&&c.terminal&&_.forEach(_.filter(a,function(a){return 0<a.carry[RESOURCE_ENERGY]}),function(a){(new r(c.terminal.id)).canAssign(a)&&a.say(d)})};g.fillTowersWithEnergy=function(a,b,c,d){c&&0!==c.length&&_.forEach(_.filter(a,function(a){return 0<a.carry[RESOURCE_ENERGY]}),function(a){_.forEach(c.sort(function(a,b){return a.energy-
b.energy}),function(c){return 0===_.filter(b,function(a){return a.memory.currentTask&&"fillEnergy"===a.memory.currentTask.type&&a.memory.currentTask.id===c.id}).length&&(new r(c.id)).canAssign(a)?(d&&a.say(d),!1):!0})})};g.fillWithEnergy=function(a,b,c){b&&0!==b.length&&_.forEach(_.filter(a,function(a){return 0<a.carry[RESOURCE_ENERGY]}),function(a){_.forEach(b,function(b){return(new r(b.id)).canAssign(a)?(c&&a.say(c),!1):!0})})};g.fillWithMinerals=function(a,b,c,d){b&&_.forEach(a,function(a){(new t(b.id,
c)).canAssign(a)&&d&&a.say(d)})};g.flee=function(a,b){_.forEach(a,function(a){var c=d.hostilesInRoom(a.room);c&&0!==c.length&&(c=h.objectsClosestToObj(c,a)["0"],10>c.pos.getRangeTo(a)&&(new p(c.pos)).canAssign(a)&&(a.memory.currentTask.priority=Game.time,a.say(b)))})};g.getBoost=function(a,b){_.forEach(_.filter(a,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(a){var c=a.memory.labs["0"],d=Game.getObjectById(c);d?(d=d.room.memory.labsInUse,d&&0!==_.filter(d,function(a){return a.id===
c}).length)?(new C(c,"id")).canAssign(a)&&(a.memory.currentTask.priority=Game.time,a.say(b)):a.memory.labs.shift():a.memory.labs.shift()})};g.harvest=function(a,b){_.forEach(a,function(a){var c=new z;a.room.name===a.memory.home&&c.canAssign(a)&&b&&a.say(b)})};g.heal=function(a,b,c){var d;b&&0!==b.length&&_.forEach(a,function(a){d=b["0"];if(a.id===d.id&&2<=b.length)var e=new C(b[1].pos,"position");else if(3>=a.pos.getRangeTo(d))e=new w(d.id);else if(e=new C(d.pos,"position"),a.hits===a.hitsMax){var f=
_.filter(b,function(b){return 1>=a.pos.getRangeTo(b)});0<f.length?e.heal=f["0"].id:(f=_.filter(b,function(b){return 3>=a.pos.getRangeTo(b)}),0<f.length&&(e.rangedHeal=f["0"].id))}e.canAssign(a)&&(a.memory.currentTask.priority=Game.time,c&&a.say(c))})};g.mine=function(a,b){_.forEach(a,function(a){(new q).canAssign(a)&&b&&a.say(b)})};g.moveToHomeOrSupport=function(a){_.forEach(a,function(a){(0<_.sum(a.carry)?new C(a.memory.supportRoom,"room"):new C(a.memory.home,"room")).canAssign(a)})};g.moveToHomeRoom=
function(a){_.forEach(_.filter(a,function(a){return!a.spawning&&150<=a.ticksToLive&&a.memory.home}),function(a){(new C(a.memory.home,"room")).canAssign(a)})};g.moveToHomeSource=function(a){_.forEach(_.filter(a,function(a){return!a.spawning&&150<=a.ticksToLive&&a.memory.homeSource}),function(a){(new C(a.memory.homeSource,"id")).canAssign(a)})};g.moveToPos=function(a,b,c,d){var e=new C(b,"position");c&&(e.range=c);_.forEach(a,function(a){e.canAssign(a)&&d&&a.say(d)})};g.moveToRoom=function(a,b,c){_.forEach(a,
function(a){var e=a.memory.portals;a.memory.portaling&&e[0]!==a.room.name&&e.shift();e&&0<e.length?e[0]===a.room.name?(a.memory.portaling=!0,e=new C(d.portalsInRoom(a.room)[0].pos,"position")):(e=new C(e[0],"room"),e.range=20):(e=new C(b,"room"),e.range=20);e.canAssign(a)&&c&&a.say(c)})};g.moveToSourceKeeper=function(a,b){b&&0!==b.length&&_.forEach(a,function(a){_.forEach(_.filter(b,function(b){return 200>b.ticksToSpawn&&("defender"!==a.memory.role||h.checkQuadrant(b.pos,a.memory.quadrant))}).sort(function(a,
b){return a.ticksToSpawn-b.ticksToSpawn}),function(b){b=new C(b.pos,"position");b.range=1;return b.canAssign(a)?(a.memory.currentTask.priority=Game.time,!1):!0})})};g.moveToTerminalOrRoom=function(a,b){b.terminal?_.forEach(a,function(a){(new C(b.terminal.pos,"position")).canAssign(a)}):_.forEach(a,function(a){(new C(b.name,"room")).canAssign(a)})};g.pickupResources=function(a,b,c,d,e){d&&0<d.length||_.forEach(a,function(a){_.forEach(_.filter(c,function(b){return b.amount>a.pos.getRangeTo(b)}),function(c){return 0<
_.filter(b,function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===c.id}).length?!0:(new y(c.id)).canAssign(a)?(e&&a.say(e),!1):!0})})};g.pickupResourcesInCurrentRoom=function(a,b,c){var e=_.groupBy(a,function(a){return a.room.name});_.forEach(Object.keys(e),function(a){var f=Game.rooms[a];if(!(0<d.hostilesInRoom(f).length)){var g=d.sortedResourcesInRoom(f);_.forEach(e[a],function(a){_.forEach(_.filter(g,function(b){return b.amount>a.pos.getRangeTo(b)}),
function(d){return 0<_.filter(b,function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===d.id}).length?!0:(new y(d.id)).canAssign(a)?(c&&a.say(c),!1):!0})})}})};g.rangedAttack=function(a,b,c){var d;b&&0!==b.length&&_.forEach(a,function(a){if(d=b["0"]){if(1>=a.pos.getRangeTo(d))var e=new E(d.id);else{var f=_.filter(b,function(b){return 3>=a.pos.getRangeTo(b)});e=new C(d.pos,"position");0<f.length&&(e.rangedAttack=f["0"].id)}e.canAssign(a)&&(a.memory.currentTask.priority=
Game.time,c&&a.say(c))}})};g.repairCriticalStructuresInCurrentRoom=function(a,b){var c=_.groupBy(a,function(a){return a.room.name});_.forEach(Object.keys(c),function(a){var e=d.criticalRepairableStructuresInRoom(Game.rooms[a]),f=c[a];_.forEach(e,function(a){_.forEach(h.objectsClosestToObj(f,a),function(c){return(new F(a.id)).canAssign(c)?(b&&c.say(b),_.remove(f,function(a){return a.id===c.id}),!1):!0})})})};g.repairStructures=function(a,b,c,d){c&&0!==c.length&&_.forEach(a,function(a){_.forEach(c,
function(c){return 0===_.filter(b,function(a){return a.memory.currentTask&&"repair"===a.memory.currentTask.type&&a.memory.currentTask.id===c.id}).length&&(new F(c.id)).canAssign(a)?(d&&a.say(d),!1):!0})})};g.reserveController=function(a,b,c){b&&!b.unobservable&&b.controller&&_.forEach(a,function(a){b.controller.my?(m.setRoomType(b.name,{type:"base"}),(new G).canAssign(a)&&a.say("RIP :(")):(new I).canAssign(a)&&c&&a.say(c)})};g.retreatArmyUnit=function(a,b,c,d,e,f){if(b&&0!==b.length&&c!==d){var g=
new C(c,"room");_.forEach(_.filter(a,function(a){return(a.room.name===d||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&a.hits/a.hitsMax<e}),function(a){g.canAssign(a)&&(a.memory.currentTask.priority=Game.time,f&&a.say(f))})}};g.retreatArmyUnitOrMoveToHealer=function(a,b,c,d,e,f){if(b&&0!==b.length){if(c!==d){var g=new C(c,"room");_.forEach(_.filter(a,function(a){return(a.room.name===d||2>=a.pos.x||47<=a.pos.x||2>=a.pos.y||47<=a.pos.y)&&a.hits/a.hitsMax<e}),function(a){g.canAssign(a)&&(a.memory.currentTask.priority=
Game.time,f&&a.say(f))})}var k=_.filter(b,function(a){return!a.memory.escorting});0<k.length&&_.forEach(a,function(a){var b=h.objectsClosestToObj(k,a);2<b[0].pos.getRangeTo(a)&&(b=new C(b[0].pos,"position"),b.canAssign(a)&&(a.memory.currentTask.priority=Game.time))})}};g.stomp=function(a,b,c){b&&0!==b.length&&_.forEach(a,function(a){(new C(h.objectsClosestToObj(b,a)[0].pos,"position")).canAssign(a)&&(a.memory.currentTask.priority=Game.time,c&&a.say(c))})};g.upgradeController=function(a,b,c){if(b.my){var d=
new K(b.room.name);_.forEach(a,function(a){d.canAssign(a)&&c&&a.say(c)})}};g.upgradeCriticalController=function(a,b,c){b.my&&b.ticksToDowngrade<[0,1E4,3500,5E3,1E4,2E4,3E4,5E4,1E5][b.level]&&(new K(b.room.name)).canAssign(a[0])&&c&&a[0].say(c)};Memory.profiling&&e(1,56).registerObject(g,"Assign");l.exports=g;return l.exports};n[57]=function(l,g){var d=e(3,57),m=e(9,57);g=function(){};g.prototype.checkSpawn=function(e,a){var b=this.room,c=this.room.name,f=!1;void 0===a&&(a=!0);a=e.checkSpawnSettings(this,
a);if(a.spawn){var g=b.memory,h=b.memory.roomType,h=a.supportRoom||(h&&h.supportRoom?h.supportRoom:c),l=Game.rooms[h];a.home=a.roomToSpawnFor||c;a.supportRoom=h;a.energyCapacityAvailable=l.energyCapacityAvailable;var n=e.spawnSettings(a);if(n.boosts&&l&&0<d.labsInRoom(l).length){var p=m.getLabToBoostWith(l,Object.keys(n.boosts).length);f=!!p}if(e=a.spawnFromRegion?_.filter(Game.spawns,function(a){return!d.spawning[a.id]&&!a.spawning&&a.room.memory.region===b.memory.region&&a.room.energyAvailable>=
m.getBodypartCost(n.body)}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})["0"]:_.filter(Game.spawns,function(a){return!d.spawning[a.id]&&!a.spawning&&a.room.name===c&&a.room.energyAvailable>=m.getBodypartCost(n.body)})["0"]){n.memory.labs=f?_.map(p,function(a){return a.id}):[];var r=e.createCreep(n.body,a.name+"-"+(a.roomToSpawnFor||c)+"-"+Game.time.toFixed(0).substring(4),n.memory),w="number"!==typeof r;w&&delete g.maxCreeps[a.name];d.spawning[e.id]=w;if(f&&typeof w){var q=
l.memory.labsInUse,u=0;_.forEach(n.boosts,function(a,b){p[u].creepToBoost=r;p[u].resource=b;p[u].amount=30*a;q.push(p[u]);u++});d.creeps[h]&&_.forEach(_.filter(d.creeps[h].all,function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&-1!==_.map(p,function(a){return a.id}).indexOf(a.memory.currentTask.id)}),function(a){delete a.memory.currentTask})}}}};g.prototype.checkSpawnSettingsCache=function(d){var a=this.room.memory,b=a.maxCreeps;(a=a.maxCreeps[d])&&null===a.cacheUntil&&
!1===a.cache.spawn&&delete b[d];if(a&&(!a.cacheUntil||a.cacheUntil>=Game.time))return a.cache;delete b[d]};Memory.profiling&&e(1,57).registerObject(g,"RoomEngine");l.exports=g;return l.exports};n[58]=function(l,g){var d=e(3,58),m={1:{dx:0,dy:-1},2:{dx:1,dy:-1},3:{dx:1,dy:0},4:{dx:1,dy:1},5:{dx:0,dy:1},6:{dx:-1,dy:1},7:{dx:-1,dy:0},8:{dx:-1,dy:-1}};g=function(){};g.moveTo=function(e,a,b,c,f){var g=e.memory,h=e.pos,l=h.x,n=h.y,p=h.roomName,r=Game.time,w=[],q=g._pathing;a instanceof RoomObject&&(a=a.pos);
var u=h.getRangeTo(a);b||(b=0);if(!(!c&&u<=b||c&&u>=b)){var y=a;var u=y.x,C=y.y,E=y.roomName;!q||q.dest.x===u&&q.dest.y===C&&q.dest.room===E||(delete g._pathing,q=void 0);q&&q.restartOn&&-1!==q.restartOn.indexOf(p)&&(delete q.path,delete q.restartOn);q&&((y=l===q.start.x&&n===q.start.y&&p===q.start.room||(49===Math.abs(l-q.start.x)||49===Math.abs(n-q.start.y))&&p!==q.start.room,q.stationary=y?q.stationary+1:0,2<=q.stationary)?(q.path&&0<q.path.length&&(y=m[+q.path[0]],y={x:l+y.dx,y:n+y.dy,room:p,
blockedUntil:r+12},y.x!==l||y.y!==n)&&(q.blocked||(q.blocked=[]),q.blocked.push(y)),q.stationary=0,delete q.path,delete q.restartOn):q.path&&!y&&(1===q.path.length?(delete g._pathing,q=void 0):(q.start={x:l,y:n,room:p},q.path=q.path.substring(1))));if(!q||!q.path){var F=e.getActiveBodyparts(MOVE);y=Memory.paths;var I=1+(_.filter(e.body,function(a){return 0<a.hits&&-1===[MOVE,CARRY].indexOf(a.type)}).length+Math.ceil(_.sum(e.carry)/50)-F)/F;q&&q.blocked&&_.remove(q.blocked,function(a){return a.blockedUntil<=
r});var F=p+"."+l+"."+n+"."+E+"."+u+"."+C+"."+b+"."+(1>=I?0:1),G=y[F];if(q&&0!==q.blocked.length||!G||c){a=PathFinder.search(h,c?_.map(f,function(a){return{pos:a.pos,range:b}}):{pos:a,range:b},{plainCost:Math.ceil(1*I),swampCost:Math.ceil(5*I),flee:c,maxOps:p===E?2E3:1E5,roomCallback:function(a){var b=Game.rooms[a];if(p!==a&&(-1!==Memory.avoidRooms.indexOf(a)||p===E&&a!==E&&!g.role.startsWith("remote")&&!g.role.startsWith("army")))return!1;if(!b)return w.push(a),!0;var c=d.costMatrixForRoom(b);q&&
a===p&&_.forEach(q.blocked,function(b){a===b.room&&r<b.blockedUntil&&c.set(b.x,b.y,255)});return c}});if(!a.path||0===a.path.length)return;q?(q.path=this.serializePath(h,a.path),q.restartOn=w):q={start:{x:l,y:n,room:p},dest:{x:u,y:C,room:E},path:this.serializePath(h,a.path),stationary:0,blocked:[],restartOn:w};0===q.blocked.length&&10<q.path.length&&!c&&(y[F]=[this.encodePath(q.path),[],r,r],w&&0<w.length&&(y[F][1]=w))}else q?(q.path=this.decodePath(G[0]),q.restartOn=G["1"]):q={start:{x:l,y:n,room:p},
dest:{x:u,y:C,room:E},path:this.decodePath(G[0]),stationary:0,blocked:[],restartOn:G[1]},G[3]=r}e.move(+q.path[0])!==OK&&--q.stationary;g._pathing=q}};g.serializePath=function(d,a){return _.map(a,function(b,c){c=0===c?d:a[c-1];switch(b.x-c.x){case 0:case -49:case 49:switch(b.y-c.y){case 0:case -49:case 49:return"";case 1:case -48:return BOTTOM.toString();case -1:case 48:return TOP.toString()}break;case 1:case -48:switch(b.y-c.y){case 0:case -49:case 49:return RIGHT.toString();case 1:case -48:return BOTTOM_RIGHT.toString();
case -1:case 48:return TOP_RIGHT.toString()}break;case -1:case 48:switch(b.y-c.y){case 0:case -49:case 49:return LEFT.toString();case 1:case -48:return BOTTOM_LEFT.toString();case -1:case 48:return TOP_LEFT.toString()}}return""}).join("")};g.encodePath=function(d){var a=[],b;for(b=0;b<d.length;b+=2)b===d.length-1?a.push(d.charCodeAt(b)-17):a.push(8*(d.charCodeAt(b)-49)+(d.charCodeAt(b+1)-49)+40);return String.fromCharCode.apply(String,[].concat($jscomp.arrayFromIterable(a)))};g.decodePath=function(d){var a=
[],b;for(b=0;b<d.length;b++){var c=d.charCodeAt(b);40>c?a.push(c+17):(a.push(Math.floor((c-40)/8)+49),a.push((c-40)%8+49))}return String.fromCharCode.apply(String,[].concat($jscomp.arrayFromIterable(a)))};Memory.profiling&&e(1,58).registerObject(g,"Pathing");l.exports=g;return l.exports};if("object"===typeof module)module.exports=e(0);else return e(0)})();