var $jscomp={scope:{},getGlobal:function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,u,w){if(w.get||w.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[u]=w.value)};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var u=0;return $jscomp.iteratorPrototype(function(){return u<c.length?{done:!1,value:c[u++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.makeIterator=function(c){$jscomp.initSymbolIterator();var u=c[Symbol.iterator];return u?u.call(c):$jscomp.arrayIterator(c)};$jscomp.arrayFromIterator=function(c){for(var u,w=[];!(u=c.next()).done;)w.push(u.value);return w};$jscomp.arrayFromIterable=function(c){return c instanceof Array?c:$jscomp.arrayFromIterator($jscomp.makeIterator(c))};
$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(c,u){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var w=0,z={next:function(){if(w<c.length){var m=w++;return{value:u(m,c[m]),done:!1}}z.next=function(){return{done:!0,value:void 0}};return z.next()}};z[Symbol.iterator]=function(){return z};return z};
$jscomp.polyfill=function(c,u,w,z){if(u){w=$jscomp.global;c=c.split(".");for(z=0;z<c.length-1;z++){var m=c[z];m in w||(w[m]={});w=w[m]}c=c[c.length-1];z=w[c];u=u(z);u!=z&&null!=u&&$jscomp.defineProperty(w,c,{configurable:!0,writable:!0,value:u})}};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.values",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c,w){return w})}},"es6","es3");$jscomp.findInternal=function(c,u,w){c instanceof String&&(c=String(c));for(var z=c.length,m=0;m<z;m++){var k=c[m];if(u.call(w,k,m,c))return{i:m,v:k}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,w){return $jscomp.findInternal(this,c,w).v}},"es6-impl","es3");
$jscomp.checkStringArgs=function(c,u,w){if(null==c)throw new TypeError("The 'this' value for String.prototype."+w+" must not be null or undefined");if(u instanceof RegExp)throw new TypeError("First argument to String.prototype."+w+" must not be a regular expression");return c+""};
$jscomp.polyfill("String.prototype.startsWith",function(c){return c?c:function(c,w){var u=$jscomp.checkStringArgs(this,c,"startsWith");c+="";var m=u.length,k=c.length;w=Math.max(0,Math.min(w|0,u.length));for(var d=0;d<k&&w<m;)if(u[w++]!=c[d++])return!1;return d>=k}},"es6-impl","es3");$jscomp.polyfill("Number.isFinite",function(c){return c?c:function(c){return"number"!==typeof c?!1:!isNaN(c)&&Infinity!==c&&-Infinity!==c}},"es6-impl","es3");
$jscomp.polyfill("Number.isInteger",function(c){return c?c:function(c){return Number.isFinite(c)?c===Math.floor(c):!1}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.fill",function(c){return c?c:function(c,w,z){var m=this.length||0;0>w&&(w=Math.max(0,m+w));if(null==z||z>m)z=m;z=Number(z);0>z&&(z=Math.max(0,m+z));for(w=Number(w||0);w<z;w++)this[w]=c;return this}},"es6-impl","es3");
(function(){function c(c,k){z[c]||(w[c]={exports:{},loaded:!1},z[c]=!0,0===c&&"function"===typeof require?require.main=w[0]:w[c].parent=w[k],u[c].call(this,w[c],w[c].exports),w[c].loaded=!0);return w[c].exports}var u={},w={},z={};u[0]=function(m,k){var d=c(1,0),n=c(2,0),f=c(3,0),a=c(4,0),b=c(5,0),e=c(6,0),r=c(7,0);c(8,0);var g=c(9,0),l=c(10,0),p=c(11,0),h=c(12,0),q=c(13,0),t=c(14,0),y=c(15,0),v=c(16,0),A=c(17,0),x=c(18,0),F=c(19,0),J=c(20,0),B=c(21,0),u=c(22,0),D=c(23,0),N=c(24,0),w=c(25,0),z=c(26,
0),C=c(27,0),G=c(28,0),V=c(29,0),W=c(30,0),X=c(31,0),Y=c(32,0),Z=c(33,0),Q=c(34,0),R=c(35,0),S=c(36,0),T=c(37,0),aa=c(38,0),ba=c(39,0),ca=c(40,0),da=c(41,0),ea=c(42,0),fa=c(43,0),ga=c(44,0),ha=c(45,0),ia=c(46,0),ja=c(47,0),ka=c(48,0),P=c(49,0),I=c(50,0),H=c(51,0),L=c(52,0),la=c(53,0),ma=c(54,0),na=c(55,0),U,M;k=function(){};k.loop=function(){var a=this,b=Game.cpu.getUsed(),e=Game.cpu.bucket;10<=b&&9800>Game.cpu.bucket?Game.notify("CPU started at "+b.toFixed(2)+" with bucket at "+e.toFixed(0)+", aborting! "+
Game.time.toFixed(0)):e<Game.cpu.tickLimit?Game.notify("Bucket at "+e.toFixed(0)+", aborting! "+Game.time.toFixed(0)):(b=function(){var b="",e,d;Memory.logCpu&&(e=d,b="Started at "+e.toFixed(2));a.init();Memory.logCpu&&(d=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"init took "+(d-e).toFixed(2),e=d);a.minerals();Memory.logCpu&&(d=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"minerals took "+(d-e).toFixed(2),e=d);a.baseMatrixes();Memory.logCpu&&(d=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"baseMatrixes took "+
(d-e).toFixed(2),e=d);a.deserializeCreeps();Memory.logCpu&&(d=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"deserializeCreeps took "+(d-e).toFixed(2),e=d);a.deserializeRooms();Memory.logCpu&&(d=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"deserializeRooms took "+(d-e).toFixed(2),e=d);a.deserializeArmies();Memory.logCpu&&(d=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"deserializeArmies took "+(d-e).toFixed(2),e=d);a.balanceEnergy();Memory.logCpu&&(d=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"balanceEnergy took "+
(d-e).toFixed(2),e=d);Memory.log&&(a.log(),Memory.logCpu&&(d=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"log took "+(d-e).toFixed(2),e=d));a.rooms();Memory.logCpu&&(d=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"rooms took "+(d-e).toFixed(2),e=d);a.army();Memory.logCpu&&(d=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"army took "+(d-e).toFixed(2),e=d);a.creeps();Memory.logCpu&&(d=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"creeps took "+(d-e).toFixed(2),e=d);Memory.debug&&(a.debug(),Memory.logCpu&&
(d=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"debug took "+(d-e).toFixed(2),e=d));Memory.visualizations&&(a.drawGlobal(),Memory.logCpu&&(d=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"drawGlobal took "+(d-e).toFixed(2),f.log.events.push(b)));a.finalize();Memory.logCpu&&(d=Game.cpu.getUsed(),(d-e).toFixed(2))},Memory.profiling?d.wrap(b):b())};k.init=function(){var b=Game.time%1500;g.init();f.reset();U||(U=!0,f.log.events.push("System reset."));f.credits<Memory.minimumCredits&&delete Memory.buy;f.credits>=
1.5*Memory.minimumCredits&&(Memory.buy=!0);Game.cmd={Army:n,Cache:f,Commands:a,Market:e,Minerals:r,Role:{ArmyDismantler:p,ArmyHealer:h,ArmyMelee:q,ArmyRanged:t,Claimer:y,Collector:v,Converter:A,Defender:x,Dismantler:F,Healer:J,Miner:B,RemoteBuilder:u,RemoteCollector:D,RemoteDismantler:N,RemoteMiner:w,RemoteReserver:z,RemoteStorer:C,RemoteWorker:G,Scientist:V,Storer:W,Tower:X,Upgrader:Y,Worker:Z},Room:{Base:Q,Cleanup:R,Mine:S,Source:T},Utilities:l};Memory.maxCreeps||(Memory.maxCreeps={});Memory.containerSource||
(Memory.containerSource={});Memory.army||(Memory.army={});Memory.avoidRooms||(Memory.avoidRooms=[]);Memory.avoidSquares||(Memory.avoidSquares={});Memory.paths||(Memory.paths={});Memory.lengthToStorage||(Memory.lengthToStorage={});Memory.towerTasks||(Memory.towerTasks={});Memory.stats||(Memory.stats={});Memory.stats.cpu||(Memory.stats.cpu=[]);Memory.stats.bucket||(Memory.stats.bucket=[]);Memory.stats.gclProgress||(Memory.stats.gclProgress=[]);Memory.minimumSell||(Memory.minimumSell={});Memory.flipPrice||
(Memory.flipPrice={});Memory.allies||(Memory.allies=[]);0===Game.time%10&&(_.forEach(Memory.creeps,function(a,b){Game.creeps[b]||delete Memory.creeps[b]}),_.forEach(Memory.lengthToContainer,function(a,b){Game.getObjectById(b)||delete Memory.lengthToContainer[b]}),_.forEach(Memory.lengthToController,function(a,b){Game.getObjectById(b)||delete Memory.lengthToController[b]}),_.forEach(Memory.lengthToStorage,function(a,b){Game.getObjectById(b)||delete Memory.lengthToStorage[b]}),_.forEach(Memory.containerSource,
function(a,b){Game.getObjectById(b)||delete Memory.containerSource[b]}),_.forEach(Memory.dismantle,function(a,b){0===a.length&&delete Memory.dismantle[b]}),_.forEach(Memory.rooms,function(a,b){a&&a.roomType||delete Memory.rooms[b]}),_.forEach(Memory.maxCreeps,function(a,b){_.forEach(Memory.maxCreeps[b],function(b,e){0===Object.keys(b).length&&delete a[e]})}),_.forEach(Memory.paths,function(a,b){(a[3]<=Game.time-500||a[2]<=Game.time-1500)&&delete Memory.paths[b]}));delete Memory.flags;switch(b){case 0:Memory.lengthToStorage=
{};break;case 100:Memory.lengthToContainer={};break;case 200:Memory.lengthToController={};break;case 300:Memory.ranges={}}f.creeps=l.nest(_.filter(Game.creeps,function(a){return a.memory.home||a.memory.army}),[function(a){return a.memory.home||a.memory.army},function(a){return a.memory.role}]);_.forEach(f.creeps,function(a,b){f.creeps[b].all=_.flatten(_.values(a))})};k.minerals=function(){var a={},b,d;Game.cpu.bucket>=Memory.marketBucket&&(b=[{resource:RESOURCE_HYDROGEN,amount:3E3},{resource:RESOURCE_OXYGEN,
amount:3E3},{resource:RESOURCE_ZYNTHIUM,amount:3E3},{resource:RESOURCE_KEANIUM,amount:3E3},{resource:RESOURCE_UTRIUM,amount:3E3},{resource:RESOURCE_LEMERGIUM,amount:3E3},{resource:RESOURCE_CATALYST,amount:3E3},{resource:RESOURCE_HYDROXIDE,amount:3E3},{resource:RESOURCE_ZYNTHIUM_KEANITE,amount:3E3},{resource:RESOURCE_UTRIUM_LEMERGITE,amount:3E3},{resource:RESOURCE_GHODIUM,amount:3E3},{resource:RESOURCE_UTRIUM_HYDRIDE,amount:3E3},{resource:RESOURCE_KEANIUM_OXIDE,amount:3E3},{resource:RESOURCE_LEMERGIUM_HYDRIDE,
amount:3E3},{resource:RESOURCE_LEMERGIUM_OXIDE,amount:3E3},{resource:RESOURCE_ZYNTHIUM_HYDRIDE,amount:3E3},{resource:RESOURCE_GHODIUM_HYDRIDE,amount:3E3},{resource:RESOURCE_GHODIUM_OXIDE,amount:3E3},{resource:RESOURCE_UTRIUM_ACID,amount:3E3},{resource:RESOURCE_KEANIUM_ALKALIDE,amount:3E3},{resource:RESOURCE_LEMERGIUM_ACID,amount:3E3},{resource:RESOURCE_LEMERGIUM_ALKALIDE,amount:3E3},{resource:RESOURCE_ZYNTHIUM_ACID,amount:3E3},{resource:RESOURCE_GHODIUM_ACID,amount:3E3},{resource:RESOURCE_GHODIUM_ALKALIDE,
amount:3E3},{resource:RESOURCE_CATALYZED_UTRIUM_ACID,amount:15E3},{resource:RESOURCE_CATALYZED_KEANIUM_ALKALIDE,amount:15E3},{resource:RESOURCE_CATALYZED_LEMERGIUM_ACID,amount:15E3},{resource:RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE,amount:15E3},{resource:RESOURCE_CATALYZED_ZYNTHIUM_ACID,amount:15E3},{resource:RESOURCE_CATALYZED_GHODIUM_ACID,amount:15E3},{resource:RESOURCE_CATALYZED_GHODIUM_ALKALIDE,amount:15E3},{resource:RESOURCE_POWER,amount:3E3}],_.forEach(b,function(a){var b=function(a,b){a.children=
_.map(r[a.resource],function(a){return{resource:a}});_.forEach(a.children,function(e){e.amount=a.amount;b(e,b)})};b(a,b)}),Memory.reserveMinerals={},_.forEach(b,function(a){var b=function(a,b){Memory.reserveMinerals[a.resource]||(Memory.reserveMinerals[a.resource]=0);Memory.reserveMinerals[a.resource]=Math.min(Memory.reserveMinerals[a.resource]+a.amount,2E4);_.forEach(a.children,function(a){b(a,b)});a.amount=Memory.reserveMinerals[a.resource]};b(a,b)}),_.forEach(_.uniq(_.map(e.getAllOrders(),function(a){return a.resourceType})),
function(b){(d=(e.getFilteredOrders().sell[b]||[])[0])&&(a[b]=d)}),_.forEach(Game.rooms,function(e,d){var g=Infinity,t=e.memory,l=f.creeps[d]&&f.creeps[d].all,h;e.storage&&e.terminal&&e.terminal.my&&e.memory.roomType&&"base"===e.memory.roomType.type&&!(3>f.labsInRoom(e))&&(f.minerals[d]=_.cloneDeep(b),_.forEach(f.minerals[d],function(b){var d=function(b,d){var v,p=b.resource,q=(e.storage.store[p]||0)+(e.terminal.store[p]||0)+_.sum(l,function(a){return a.carry[p]||0});b.buyPrice=a[p]?a[p].price:Infinity;
b.amount=Math.max(b.amount-q,0);_.forEach(b.children,function(a){d(a,d)});if(b.children&&0!==b.children.length)if(v=1.2*_.sum(_.map(b.children,function(a){return a.buyPrice})),Memory.minimumSell[p]=Math.min(Infinity,v),0!==Memory.minimumSell[p]&&Infinity!==Memory.minimumSell[p]||delete Memory.minimumSell[p],b.buyPrice>v||!Memory.buy){var y=5*Math.floor(((e.storage.store[b.children[0].resource]||0)+(e.terminal.store[b.children[0].resource]||0)+_.sum(l,function(a){return a.carry[b.children[0].resource]||
0}))/5),r=5*Math.floor(((e.storage.store[b.children[1].resource]||0)+(e.terminal.store[b.children[1].resource]||0)+_.sum(l,function(a){return a.carry[b.children[1].resource]||0}))/5);b.amount=Math.min(Math.min(b.amount,y),r);b.action="create";b.buyPrice=v;q<=g&&0<b.amount&&(h=b,g=q)}else b.action="buy";else b.action="buy";0<b.amount&&"buy"===b.action&&!t.buyQueue&&f.credits>=Memory.minimumCredits&&Memory.buy&&(t.buyQueue={resource:p,amount:b.amount,price:b.buyPrice,start:Game.time})};d(b,d)}),h&&
!t.labQueue&&(d=function(a,b){var d=a.resource;if(!(0>=a.amount)&&"create"===a.action){var g=5*Math.floor(((e.storage.store[a.children[0].resource]||0)+(e.terminal.store[a.children[0].resource]||0)+_.sum(l,function(b){return b.carry[a.children[0].resource]||0}))/5),h=5*Math.floor(((e.storage.store[a.children[1].resource]||0)+(e.terminal.store[a.children[1].resource]||0)+_.sum(l,function(b){return b.carry[a.children[1].resource]||0}))/5);t.labQueue={resource:d,amount:Math.min(5*Math.ceil(Math.min(Math.min(Math.min(a.amount,
g),h),LAB_MINERAL_CAPACITY)/5),3E3),children:_.map(a.children,function(a){return a.resource}),start:Game.time};_.forEach(a.children,function(a){b(a,b)})}},d(h,d)))}))};k.baseMatrixes=function(){Memory.baseMatrixes||(Memory.baseMatrixes={});_.forEach(Memory.baseMatrixes,function(a,b){var e=Game.rooms[b],d,g,t;if(e&&!e.unobservable&&"complete"!==a.status&&0!==f.spawnsInRoom(e).length&&(t=f.repairableStructuresInRoom(e),a.status||(g=new PathFinder.CostMatrix,_.forEach(_.filter(t,function(a){return a.structureType!==
STRUCTURE_ROAD}),function(a){g.set(a.pos.x,a.pos.y,255)}),a.tempMatrix=g.serialize(),a.costMatrix=g.serialize(),a.status="building",a.x=0,a.y=0),"building"===a.status)){d=PathFinder.CostMatrix.deserialize(a.tempMatrix);for(g=PathFinder.CostMatrix.deserialize(a.costMatrix);50>a.x;a.x++){for(;50>a.y;a.y++){if(250<=Game.cpu.getUsed())return a.costMatrix=g.serialize(),!1;PathFinder.search(new RoomPosition(a.x,a.y,b),{pos:f.spawnsInRoom(e)[0].pos,range:1},{roomCallback:function(){return d},maxOps:1E4,
maxRooms:1}).incomplete&&g.set(a.x,a.y,255)}a.y=0}_.forEach(_.filter(t,function(a){return a.structureType===STRUCTURE_RAMPART}),function(a){g.set(a.pos.x,a.pos.y,0)});delete a.tempMatrix;delete a.x;delete a.y;a.costMatrix=g.serialize();a.status="complete"}})};k.deserializeCreeps=function(){_.forEach(Game.creeps,function(a){if(a.memory.currentTask)switch(a.memory.currentTask.type){case "attack":f.creepTasks[a.name]=aa.fromObj(a);break;case "build":f.creepTasks[a.name]=ba.fromObj(a);break;case "claim":f.creepTasks[a.name]=
ca.fromObj(a);break;case "collectEnergy":f.creepTasks[a.name]=da.fromObj(a);break;case "collectMinerals":f.creepTasks[a.name]=ea.fromObj(a);break;case "dismantle":f.creepTasks[a.name]=fa.fromObj(a);break;case "fillEnergy":f.creepTasks[a.name]=ga.fromObj(a);break;case "fillMinerals":f.creepTasks[a.name]=ha.fromObj(a);break;case "harvest":f.creepTasks[a.name]=ia.fromObj(a);break;case "heal":f.creepTasks[a.name]=ja.fromObj(a);break;case "meleeAttack":f.creepTasks[a.name]=ka.fromObj(a);break;case "mine":f.creepTasks[a.name]=
P.fromObj(a);break;case "pickupResource":f.creepTasks[a.name]=I.fromObj(a);break;case "rally":f.creepTasks[a.name]=H.fromObj(a);break;case "rangedAttack":f.creepTasks[a.name]=L.fromObj(a);break;case "repair":f.creepTasks[a.name]=la.fromObj(a);break;case "reserve":f.creepTasks[a.name]=ma.fromObj(a);break;case "upgradeController":f.creepTasks[a.name]=na.fromObj(a)}})};k.deserializeRooms=function(){M=[];_.forEach(Memory.rooms,function(a,b){if(a.roomType){switch(a.roomType.type){case "base":f.rooms[b]=
Q.fromObj(a);break;case "cleanup":f.rooms[b]=R.fromObj(a);break;case "mine":f.rooms[b]=S.fromObj(a);break;case "source":f.rooms[b]=T.fromObj(a)}Game.rooms[b]||M.push({name:b,unobservable:!0})}})};k.deserializeArmies=function(){_.forEach(Memory.army,function(a,b){f.armies[b]=n.fromObj(b,a)})};k.balanceEnergy=function(){var a,b;a=_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&"base"===a.memory.roomType.type&&a.storage&&a.storage.my&&a.terminal&&a.terminal.my}).sort(function(a,b){return a.storage.store[RESOURCE_ENERGY]+
a.terminal.store[RESOURCE_ENERGY]-(b.storage.store[RESOURCE_ENERGY]+b.terminal.store[RESOURCE_ENERGY])});1<a.length&&(b=Math.min(_.sum(_.map(a,function(a){return a.storage.store[RESOURCE_ENERGY]+a.terminal.store[RESOURCE_ENERGY]}))/a.length,5E5),_.forEach(a,function(e,d){d=a[a.length-d-1];var g=e.storage.store[RESOURCE_ENERGY],t=d.storage.store[RESOURCE_ENERGY],l=d.terminal,h=l.store[RESOURCE_ENERGY];if(!(0<l.cooldown)){if(g>=t||g+e.terminal.store[RESOURCE_ENERGY]>b||t+h<b+1E4)return!1;1E3<=h&&(g=
Game.market.calcTransactionCost(h,d.name,e.name),l.send(RESOURCE_ENERGY,Math.floor(h/(h+g)*h),e.name),f.log.events.push("Sending "+Math.floor(h/(h+g)*h)+" energy from "+d.name+" to "+e.name))}}))};k.log=function(){f.log.creeps=_.map(Game.creeps,function(a){return{creepId:a.id,name:a.name,creepType:a.memory.role,home:a.memory.home,army:a.memory.army,room:a.pos.roomName,x:a.pos.x,y:a.pos.y,spawning:a.spawning,ttl:a.ticksToLive,carryCapacity:a.carryCapacity,carry:a.carry,hits:a.hits,hitsMax:a.hitsMax}});
_.forEach(f.armies,function(a){f.log.army[a.name]={directive:a.directive,scheduled:a.scheduled,portals:a.portals,boostRoom:a.boostRoom,buildRoom:a.buildRoom,stageRoom:a.stageRoom,attackRoom:a.attackRoom,dismantle:a.dismantle.length,creeps:[]};Game.rooms[a.attackRoom]&&(f.log.army[a.name].structures=_.filter(Game.rooms[a.attackRoom].find(FIND_HOSTILE_STRUCTURES),function(a){return a.structureType!==STRUCTURE_CONTROLLER&&a.structureType!==STRUCTURE_RAMPART&&a.structureType!==STRUCTURE_KEEPER_LAIR}).length,
f.log.army[a.name].constructionSites=Game.rooms[a.attackRoom].find(FIND_HOSTILE_CONSTRUCTION_SITES).length)});f.log.spawns=_.map(Game.spawns,function(a){return{spawnId:a.id,name:a.name,room:a.room.name,spawningName:a.spawning?a.spawning.name:void 0,spawningNeedTime:a.spawning?a.spawning.needTime:void 0,spawningRemainingTime:a.spawning?a.spawning.remainingTime:void 0}});_.forEach([].concat.apply([],[_.filter(Game.rooms),M]),function(a){var b=a.name,e=Memory.rooms[b],d=e&&e.roomType&&e.roomType.type?
e.roomType.type:"unknown",g,t,h,l,p,v;a.unobservable?f.log.rooms[b]={type:d,supportRoom:e&&e.roomType?e.roomType.supportRoom:void 0,region:e?e.region:void 0,unobservable:!0,store:{},labs:[],source:[],creeps:[]}:(0===Game.time%10&&(g=f.repairableStructuresInRoom(a)),t=a.find(FIND_MY_CONSTRUCTION_SITES),h=f.towersInRoom(a),l=f.labsInRoom(a),p=f.nukersInRoom(a),v=f.powerSpawnsInRoom(a),f.log.rooms[b]={type:d,supportRoom:e&&e.roomType?e.roomType.supportRoom:void 0,region:e?e.region:void 0,unobservable:!1,
controller:!!a.controller,store:{},labs:[],source:[],creeps:[]},f.log.rooms[b].controller&&(f.log.rooms[b].rcl=a.controller.level,a.controller.owner&&(f.log.rooms[b].ownerUsername=a.controller.owner.username),f.log.rooms[b].progress=a.controller.progress,f.log.rooms[b].progressTotal=a.controller.progressTotal,f.log.rooms[b].ttd=a.controller.ticksToDowngrade),a.controller&&a.controller.reservation&&(f.log.rooms[b].reservedUsername=a.controller.reservation.username,f.log.rooms[b].tte=a.controller.reservation.ticksToEnd),
f.log.rooms[b].lowestWall=0===Game.time%10?Math.min.apply(Math,_.map(_.filter(g,function(a){return a.structureType===STRUCTURE_WALL||a.structureType===STRUCTURE_RAMPART}),function(a){return a.hits})):Memory.console&&Memory.console.rooms&&Memory.console.rooms[b]&&Memory.console.rooms[b].lowestWall||null,a.energyCapacityAvailable&&0<a.energyCapacityAvailable&&(f.log.rooms[b].energyAvailable=a.energyAvailable,f.log.rooms[b].energyCapacityAvailable=a.energyCapacityAvailable),f.log.rooms[b].constructionProgress=
_.sum(_.map(t,function(a){return a.progress})),f.log.rooms[b].constructionProgressTotal=_.sum(_.map(t,function(a){return a.progressTotal})),f.log.rooms[b].towerEnergy=_.sum(_.map(h,function(a){return a.energy})),f.log.rooms[b].towerEnergyCapacity=_.sum(_.map(h,function(a){return a.energyCapacity})),f.log.rooms[b].labEnergy=_.sum(_.map(l,function(a){return a.energy})),f.log.rooms[b].labEnergyCapacity=_.sum(_.map(l,function(a){return a.energyCapacity})),f.log.rooms[b].nukerEnergy=_.sum(_.map(p,function(a){return a.energy})),
f.log.rooms[b].nukerEnergyCapacity=_.sum(_.map(p,function(a){return a.energyCapacity})),f.log.rooms[b].nukerGhodium=_.sum(_.map(p,function(a){return a.ghodium})),f.log.rooms[b].nukerGhodiumCapacity=_.sum(_.map(p,function(a){return a.ghodiumCapacity})),f.log.rooms[b].powerSpawnEnergy=_.sum(_.map(v,function(a){return a.energy})),f.log.rooms[b].powerSpawnEnergyCapacity=_.sum(_.map(v,function(a){return a.energyCapacity})),f.log.rooms[b].powerSpawnPower=_.sum(_.map(v,function(a){return a.power})),f.log.rooms[b].powerSpawnPowerCapacity=
_.sum(_.map(v,function(a){return a.powerCapacity})),a.storage&&(f.log.rooms[b].store.storage=_.map(a.storage.store,function(a,b){return{resource:b,amount:a}})),a.terminal&&(f.log.rooms[b].store.terminal=_.map(a.terminal.store,function(a,b){return{resource:b,amount:a}})),f.log.rooms[b].labs=_.map(l,function(a){return{resource:a.mineralType,amount:a.mineralAmount}}),f.log.rooms[b].labQueue=e.labQueue,f.log.rooms[b].buyQueue=e.buyQueue,_.forEach(a.find(FIND_SOURCES),function(a){f.log.rooms[b].source.push({sourceId:a.id,
resource:RESOURCE_ENERGY,amount:a.energy,capacity:a.energyCapacity,ttr:a.ticksToRegeneration})}),_.forEach(a.find(FIND_MINERALS),function(a){f.log.rooms[b].source.push({sourceId:a.id,resource:a.mineralType,amount:a.mineralAmount,ttr:a.ticksToRegeneration})}),f.log.hostiles=[].concat.apply([],[f.log.hostiles,_.map(f.hostilesInRoom(a),function(a){return{creepId:a.id,ownerUsername:a.owner.username,room:b,x:a.pos.x,y:a.pos.y,ttl:a.ticksToLive,hits:a.hits,hitsMax:a.hitsMax}})]))})};k.rooms=function(){var a=
this,b=["base","source","mine","cleanup",""],e=Memory.rooms,d=["source","cleanup"],g=9800<=Game.cpu.bucket||0===Game.time%2;Memory.rushRoom=(_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&"base"===a.memory.roomType.type&&a.controller&&8>a.controller.level}).sort(function(a,b){return b.controller.level-a.controller.level||b.controller.progress-a.controller.progress})[0]||{name:""}).name;_.forEach([].concat.apply([],[_.filter(Game.rooms),M]).sort(function(a,d){return b.indexOf(e[a.name]&&
e[a.name].roomType&&e[a.name].roomType.type||"")-b.indexOf(e[d.name]&&e[d.name].roomType&&e[d.name].roomType.type||"")}),function(b){var t=b.name,l=e[t].roomType;f.rooms[t]&&((-1!==d.indexOf(l.type)||g)&&f.rooms[t].run(b),l.type===f.rooms[t].type&&f.rooms[t].toObj(b));Memory.visualizations&&!b.unobservable&&a.drawRoom(b)})};k.drawRoom=function(a){var e=a.visual,d,g,t,l;e||(e=new RoomVisual(a.name));e&&(a.memory&&a.memory.roomType&&e.text(_.capitalize(a.memory.roomType.type),-.5,49.325,{align:"left",
font:"0.5 Arial"}),a.controller&&a.controller.level&&(e.text("RCL "+a.controller.level,2.5,49.325,{align:"left",font:"0.5 Arial"}),a.controller.progress&&a.controller.progressTotal&&b.progressBar(e,5.5,48.9,20,.5,a.controller.progress,a.controller.progressTotal,{background:"#808080",bar:"#00ff00",showDetails:!0,color:"#ffffff",font:"0.5 Arial"})),g=2.125,a.energyCapacityAvailable&&(g+=.7,e.text("Energy",-.5,g,{align:"left",font:"0.5 Arial"}),b.progressBar(e,2.5,g-.425,5,.5,a.energyAvailable,a.energyCapacityAvailable,
{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),t=f.towersInRoom(a),0<t.length&&(g+=.7,e.text("Towers",-.5,g,{align:"left",font:"0.5 Arial"}),b.progressBar(e,2.5,g-.425,5,.5,_.sum(_.map(t,function(a){return a.energy})),_.sum(_.map(t,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),t=f.labsInRoom(a),0<t.length&&(g+=.7,e.text("Labs",-.5,g,{align:"left",font:"0.5 Arial"}),b.progressBar(e,
2.5,g-.425,5,.5,_.sum(_.map(t,function(a){return a.energy})),_.sum(_.map(t,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),l=f.nukersInRoom(a),0<l.length&&(g+=.7,e.text("Nuker",-.5,g,{align:"left",font:"0.5 Arial"}),b.progressBar(e,2.5,g-.425,5,.5,_.sum(_.map(l,function(a){return a.energy})),_.sum(_.map(l,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"}),
b.progressBar(e,8.5,g-.425,5,.5,_.sum(_.map(l,function(a){return a.ghodium})),_.sum(_.map(l,function(a){return a.ghodiumCapacity})),{background:"#808080",bar:"#ffff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),l=f.powerSpawnsInRoom(a),0<l.length&&(g+=.7,e.text("Power Spawn",-.5,g,{align:"left",font:"0.5 Arial"}),b.progressBar(e,2.5,g-.425,5,.5,_.sum(_.map(l,function(a){return a.energy})),_.sum(_.map(l,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,
color:"#ffffff",font:"0.5 Arial"}),b.progressBar(e,8.5,g-.425,5,.5,_.sum(_.map(l,function(a){return a.power})),_.sum(_.map(l,function(a){return a.powerCapacity})),{background:"#808080",bar:"#ff0000",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),a.memory&&a.memory.buyQueue&&(g+=.7,e.text("Buy",-.5,g,{align:"left",font:"bold 0.5 Arial"}),e.text(a.memory.buyQueue.amount,2.5,g,{align:"right",font:"0.5 Arial"}),b.resource(e,2.8,g-.175,.5,a.memory.buyQueue.resource,{opacity:1})),a.memory&&a.memory.labQueue&&
(g+=.7,e.text("Create",-.5,g,{align:"left",font:"bold 0.5 Arial"}),e.text(a.memory.labQueue.amount,2.5,g,{align:"right",font:"0.5 Arial"}),b.resource(e,2.8,g-.175,.5,a.memory.labQueue.resource,{opacity:1})),0<t.length&&(g+=.7,e.text("Labs",-.5,g,{align:"left",font:"bold 0.5 Arial"}),d=0,_.forEach(t,function(a){d+=2.5;0===a.mineralAmount?e.text("Empty",d,g,{align:"right",font:"0.5 Arial"}):(e.text(a.mineralAmount,d,g,{align:"right",font:"0.5 Arial"}),b.resource(e,d+.3,g-.175,.5,a.mineralType,{opacity:1}))})),
a.storage&&(g+=1.4,e.text("Storage",-.5,g,{align:"left",font:"bold 0.5 Arial"}),_.forEach(a.storage.store,function(a,d){d!==RESOURCE_ENERGY&&(g+=.7,e.text(a,1,g,{align:"right",font:"0.5 Arial"}),b.resource(e,1.3,g-.175,.5,d,{opacity:1}))})),a.terminal&&(g+=1.4,e.text("Terminal",-.5,g,{align:"left",font:"bold 0.5 Arial"}),_.forEach(a.terminal.store,function(a,d){d!==RESOURCE_ENERGY&&(g+=.7,e.text(a,1,g,{align:"right",font:"0.5 Arial"}),b.resource(e,1.3,g-.175,.5,d,{opacity:1}))})))};k.army=function(){_.forEach(f.armies,
function(a){a.run();a.toObj()})};k.creeps=function(){_.forEach(Game.creeps,function(a){if(!a.spawning&&!a.memory.stop){if(150>=a.ticksToLive||500>a.ticksToLive&&1===a.ticksToLive%10||1===a.ticksToLive%100)switch(a.ticksToLive-1){case 3:a.say("R.I.P. and",!0);break;case 2:a.say("Pepperonis",!0);break;case 1:a.say(":(",!0);break;default:a.say("TTL "+(a.ticksToLive-1))}a.memory.army&&f.armies[a.memory.army]&&a.room.name===f.armies[a.memory.army].attackRoom&&a.say("All my friends are heathens, take it slow.  Wait for them to ask you who you know.  Please don't make any sudden moves.  You don't know the half of the abuse. ".split(" ")[Game.time%
35],!0);switch(Game.time%1E6){case 999990:a.say("TEN!",!0);break;case 999991:a.say("NINE!",!0);break;case 999992:a.say("EIGHT!",!0);break;case 999993:a.say("SEVEN!",!0);break;case 999994:a.say("SIX!",!0);break;case 999995:a.say("FIVE!",!0);break;case 999996:a.say("FOUR!",!0);break;case 999997:a.say("THREE!",!0);break;case 999998:a.say("TWO!",!0);break;case 999999:a.say("ONE!",!0);break;case 0:a.say("HAPPY NEW",!0);break;case 1:a.say("MILLION!",!0)}if(a.memory.currentTask&&f.creepTasks[a.name]){if(0===
a.pos.x)switch(Math.floor(3*Math.random())){case 0:a.move(RIGHT);break;case 1:a.move(TOP_RIGHT);break;case 2:a.move(BOTTOM_RIGHT)}if(49===a.pos.x)switch(Math.floor(3*Math.random())){case 0:a.move(LEFT);break;case 1:a.move(TOP_LEFT);break;case 2:a.move(BOTTOM_LEFT)}if(0===a.pos.y)switch(Math.floor(3*Math.random())){case 0:a.move(BOTTOM);break;case 1:a.move(BOTTOM_RIGHT);break;case 2:a.move(BOTTOM_LEFT)}if(49===a.pos.y)switch(Math.floor(3*Math.random())){case 0:a.move(TOP);break;case 1:a.move(TOP_RIGHT);
break;case 2:a.move(TOP_LEFT)}f.creepTasks[a.name].run(a);!a.memory.lastRoom||a.memory.lastRoom===a.room.name||f.creepTasks[a.name]&&f.creepTasks[a.name].force||delete a.memory.currentTask;a.memory.lastRoom=a.room.name;a.memory.currentTask&&f.creepTasks[a.name]&&f.creepTasks[a.name].toObj(a);0<a.carry[RESOURCE_ENERGY]&&0<a.getActiveBodyparts(WORK)&&_.forEach(_.filter(a.pos.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_ROAD&&a.hits<a.hitsMax}),function(b){a.repair(b)});a.spawning||
!(150>a.ticksToLive)||0!==_.sum(a.carry)||a.memory.currentTask&&"rally"!==a.memory.currentTask.type||-1!=="armyDismantler armyHealer armyMelee armyRanged claimer converter defender healer remoteReserver".split(" ").indexOf(a.memory.role)||a.suicide()}else delete a.memory.currentTask,!a.spawning&&150>a.ticksToLive&&0===_.sum(a.carry)&&-1==="armyDismantler armyHealer armyMelee armyRanged claimer converter defender healer remoteReserver".split(" ").indexOf(a.memory.role)?a.suicide():a.say("Idle")}})};
k.debug=function(){_.forEach(Game.creeps,function(a){a.room.visual.text(a.name,a.pos.x,a.pos.y+1,{align:"center",font:"0.5 Arial"});a.room.visual.text(a.memory.role,a.pos.x,a.pos.y+1.5,{align:"center",font:"0.5 Arial"});a.room.visual.text(a.memory.currentTask?a.memory.currentTask.type:"",a.pos.x,a.pos.y+2,{align:"center",font:"0.5 Arial"})})};k.finalize=function(){f.log.tick=Game.time;f.log.date=new Date;f.log.gcl=Game.gcl.level;f.log.progress=Game.gcl.progress;f.log.progressTotal=Game.gcl.progressTotal;
f.log.limit=Game.cpu.limit;f.log.tickLimit=Game.cpu.tickLimit;f.log.bucket=Game.cpu.bucket;f.log.credits=Game.market.credits;f.log.cpuUsed=Game.cpu.getUsed();Memory.console=f.log};k.drawGlobal=function(){var a;f.globalVisual.text("GCL "+Game.gcl.level,-.5,.025,{align:"left",font:"0.5 Arial"});b.progressBar(f.globalVisual,2.5,-.4,20,.5,Game.gcl.progress,Game.gcl.progressTotal,{background:"#808080",bar:"#00ff00",showDetails:!0,color:"#ffffff",font:"0.5 Arial"});b.progressBar(f.globalVisual,34.5,-.4,
10,.5,Game.cpu.bucket,1E4,{label:"Bucket",background:"#808080",showMax:!1,bar:9990<=Game.cpu.bucket?"#00ffff":9E3<=Game.cpu.bucket?"#00ff00":5E3<=Game.cpu.bucket?"#cccc00":"#ff0000",color:"#ffffff",font:"0.5 Arial"});f.globalVisual.text("Tick "+Game.time,49.5,.025,{align:"right",font:"0.5 Arial"});f.globalVisual.text(f.time,49.5,.725,{align:"right",font:"0.5 Arial"});f.globalVisual.text("Credits "+Game.market.credits.toFixed(2),-.5,.725,{align:"left",font:"0.5 Arial"});f.globalVisual.text("Creeps "+
_.keys(Game.creeps).length,-.5,1.425,{align:"left",font:"0.5 Arial"});a=.725;_.forEach(_.filter(Game.rooms,function(a){return!a.unobservable&&a.memory.roomType&&"base"===a.memory.roomType.type}),function(e){a+=.7;f.globalVisual.text(e.name,43.5,a,{align:"right",font:"bold 0.5 Arial"});e.storage&&(f.globalVisual.text(e.storage.store[RESOURCE_ENERGY],45.8,a,{align:"right",font:"0.5 Arial"}),b.resource(f.globalVisual,46.15,a-.175,.5,RESOURCE_ENERGY,{opacity:1}));e.terminal&&(f.globalVisual.text(e.terminal.store[RESOURCE_ENERGY],
48.8,a,{align:"right",font:"0.5 Arial"}),b.resource(f.globalVisual,49.15,a-.175,.5,RESOURCE_ENERGY,{opacity:1}))});for(Memory.stats.cpu.push(Game.cpu.getUsed());100<Memory.stats.cpu.length;)Memory.stats.cpu.shift();for(Memory.stats.bucket.push(Game.cpu.bucket);100<Memory.stats.bucket.length;)Memory.stats.bucket.shift();for(Memory.stats.gclProgress.push(Game.gcl.progress);100<Memory.stats.gclProgress.length;)Memory.stats.gclProgress.shift();b.sparkline(f.globalVisual,23.5,1,18,2,_.map(Memory.stats.cpu,
function(a,b){return{cpu:Memory.stats.cpu[b],bucket:Memory.stats.bucket[b],limit:Game.cpu.limit}}),[{key:"limit",min:.5*Game.cpu.limit,max:1.5*Game.cpu.limit,stroke:"#c0c0c0",opacity:.25},{key:"cpu",min:.5*Game.cpu.limit,max:1.5*Game.cpu.limit,stroke:"#ffff00",opacity:.5},{key:"bucket",min:0,max:1E4,stroke:"#00ffff",opacity:.5,font:"0.5 Arial"}]);f.log.cpuUsed=Game.cpu.getUsed();Memory.stats.cpu[Memory.stats.cpu.length-1]=Game.cpu.getUsed();b.progressBar(f.globalVisual,23.5,-.4,10,.5,Game.cpu.getUsed(),
Game.cpu.limit,{label:"CPU",background:"#808080",valueDecimals:2,bar:f.log.cpuUsed>Game.cpu.limit?"#ff0000":"#00ff00",color:"#ffffff",font:"0.5 Arial"})};Memory.profiling&&(d.registerObject(k,"Main"),d.enable());m.exports=k;return m.exports};u[1]=function(c,k){function d(){q=0;Game.profiler={stream:function(a,b,e){n("stream",a||10,b,e)},email:function(a,b,e){n("email",a||100,b,e)},profile:function(a,b,e){n("profile",a||100,b,e)},background:function(a,b){n("background",!1,a,b)},restart:function(){if(y.isProfiling()){var a=
Memory.profiler.filter,b=!1;Memory.profiler.disableTick&&(b=Memory.profiler.disableTick-Memory.profiler.enabledTick+1);n(Memory.profiler.type,b,a)}},reset:f,output:y.output};a()}function n(a,b,e,d){f();b=Number.isInteger(b)?Game.time+b:!1;Memory.profiler||(Memory.profiler={map:{},totalTime:0,enabledTick:Game.time+1,disableTick:b,type:a,filter:e,startsWith:d})}function f(){Memory.profiler=null}function a(){Game.rooms.sim&&(p=0,Game.cpu.getUsed=function(){return performance.now()-p})}function b(a,b){return function(){if(y.isProfiling()){var e=
Memory.profiler.startsWith?a.startsWith(Memory.profiler.filter):a===Memory.profiler.filter,d=Game.cpu.getUsed();e&&q++;var g=b.apply(this,arguments);if(0<q||!Memory.profiler.filter){var t=Game.cpu.getUsed();y.record(a,t-d)}e&&q--;return g}return b.apply(this,arguments)}}function e(){y.prototypes.forEach(function(a){g(a.val,a.name)})}function r(a,b){Object.getOwnPropertyNames(a).forEach(function(e){var d=b+"."+e;try{var g="function"===typeof a[e],h=-1===t.indexOf(e);g&&h&&(a[e]=l(a[e],d))}catch(E){}});
return a}function g(a,b){a.prototype&&r(a.prototype,b);r(a,b)}function l(a,e){e=e||a.name;return e?b(e,a):(console.log("Couldn't find a function name for - ",a),console.log("Will not profile this function."),a)}Array.prototype.forEach=function(a,b){for(var e=0;e<this.length;e++)a.call(b,this[e],e,this)};Array.prototype.map=function(a,b){for(var e=[],d=0;d<this.length;d++)e.push(a.call(b,this[d],d,this));return e};var p=0,h=!1,q=0,t=["getUsed","constructor"],y={printProfile:function(){console.log(y.output())},
emailProfile:function(){Game.notify(y.output())},output:function(a){a=a?a:20;if(!Memory.profiler||!Memory.profiler.enabledTick)return"Profiler not active.";var b=Game.time-Memory.profiler.enabledTick+1,b=["Avg: "+(Memory.profiler.totalTime/b).toFixed(2),"Total: "+Memory.profiler.totalTime.toFixed(2),"Ticks: "+b].join("\t");return[].concat("calls\t\ttime\t\tavg\t\tfunction",y.lines().slice(0,a),b).join("\n")},lines:function(){return Object.keys(Memory.profiler.map).map(function(a){var b=Memory.profiler.map[a];
return{name:a,calls:b.calls,totalTime:b.time,averageTime:b.time/b.calls}}).sort(function(a,b){return b.totalTime-a.totalTime}).map(function(a){return[a.calls,a.totalTime.toFixed(1),a.averageTime.toFixed(3),a.name].join("\t\t")})},prototypes:[{name:"Game",val:Game},{name:"Room",val:Room},{name:"Structure",val:Structure},{name:"Spawn",val:Spawn},{name:"Creep",val:Creep},{name:"RoomPosition",val:RoomPosition},{name:"Source",val:Source},{name:"Flag",val:Flag}],record:function(a,b){Memory.profiler.map[a]||
(Memory.profiler.map[a]={time:0,calls:0});Memory.profiler.map[a].calls++;Memory.profiler.map[a].time+=b},endTick:function(){if(Game.time>=Memory.profiler.enabledTick){var a=Game.cpu.getUsed();Memory.profiler.totalTime+=a;y.report()}},report:function(){y.shouldPrint()?y.printProfile():y.shouldEmail()&&y.emailProfile()},isProfiling:function(){return h&&Memory.profiler?!Memory.profiler.disableTick||Game.time<=Memory.profiler.disableTick:!1},type:function(){return Memory.profiler.type},shouldPrint:function(){var a=
"stream"===y.type(),b="profile"===y.type(),e=Memory.profiler.disableTick===Game.time;return a||b&&e},shouldEmail:function(){return"email"===y.type()&&Memory.profiler.disableTick===Game.time}};c.exports={wrap:function(a){h&&d();return y.isProfiling()?(p=Game.cpu.getUsed(),a=a(),y.endTick(),a):a()},enable:function(){h=!0;e()},output:y.output,registerObject:g,registerFN:l,registerClass:g};return c.exports};u[2]=function(m,k){var d=c(3,2),n=c(10,2),f=c(11,2),a=c(12,2),b=c(13,2),e=c(14,2),r=function(a,
b){b.directive||(b.directive="preparing");Memory.army[a]||(Memory.army[a]=b);_.extend(this,b);this.name=a};r.prototype.run=function(){var g=this,l=this.name,p=d.creeps[l]&&d.creeps[l].all||[],h=Game.rooms[this.attackRoom],q=this.dismantler,t=this.healer,y=this.melee,v=this.ranged;if(!(this.scheduled&&this.scheduled>Game.time))if(0===p.length&&this.success)this.delete=!0;else{"preparing"===this.directive||"building"===this.directive||0!==p.length||this.success||(Game.notify("Army "+l+" operation failed, restarting."),
this.directive="preparing");this.safeMode&&h&&h.controller&&h.controller.safeMode&&(this.directive="staging",this.stageRoom=this.safeMode.stageRoom,this.attackRoom=this.safeMode.attackRoom,this.dismantle=this.safeMode.dismantle,this.safeMode=this.safeMode.safeMode);if("preparing"===this.directive){var r=this.boostRoom;if(r){if(r=Game.rooms[r].storage.store,!r||(r[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]||0)>=150*(q.maxCreeps+y.maxCreeps+v.maxCreeps+t.maxCreeps)&&(r[RESOURCE_CATALYZED_ZYNTHIUM_ACID]||
0)>=30*q.units*q.maxCreeps&&(r[RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE]||0)>=30*t.units*t.maxCreeps)this.directive="building"}else this.directive="building"}"building"===this.directive&&0===_.filter(p,function(a){return a.room.name!==g.buildRoom}).length&&_.filter(p,function(a){return a.room.name===g.buildRoom}).length>=q.maxCreeps+t.maxCreeps+y.maxCreeps+v.maxCreeps&&(this.directive="staging");"staging"===this.directive&&0===_.filter(p,function(a){return a.room.name!==g.stageRoom}).length&&(this.directive=
"dismantle");"dismantle"===this.directive&&(this.dismantle?h&&(this.dismantle=_.filter(this.dismantle,function(a){return Game.getObjectById(a)}),0===this.dismantle.length&&(this.directive="attack")):this.directive="attack");"attack"===this.directive&&h&&(this.hostileConstructionSites=h.find(FIND_HOSTILE_CONSTRUCTION_SITES),this.reinforce||0!==_.filter(h.find(FIND_HOSTILE_STRUCTURES),function(a){return a.structureType!==STRUCTURE_CONTROLLER&&a.structureType!==STRUCTURE_RAMPART&&a.structureType!==STRUCTURE_KEEPER_LAIR}).length||
0!==this.hostileConstructionSites.length||(this.success=!0));if("building"===this.directive||this.reinforce)this.checkSpawn("armyDismantler",q.maxCreeps,this.spawnFromRegion.bind(this,f)),this.checkSpawn("armyHealer",t.maxCreeps,this.spawnFromRegion.bind(this,a)),this.checkSpawn("armyMelee",y.maxCreeps,this.spawnFromRegion.bind(this,b)),this.checkSpawn("armyRanged",v.maxCreeps,this.spawnFromRegion.bind(this,e));(q.escort||y.escort||v.escort)&&_.forEach(_.filter(d.creeps[l]&&d.creeps[l].armyHealer||
[],function(a){return!a.memory.escorting&&!a.spawning}),function(a){var b=[].concat.apply([],[q.escort&&d.creeps[l].armyDismantler?_.filter(d.creeps[l].armyDismantler,function(a){return!a.memory.escortedBy&&!a.spawning}):[],y.escort&&d.creeps[l].armyMelee?_.filter(d.creeps[l].armyMelee,function(a){return!a.memory.escortedBy&&!a.spawning}):[],v.escort&&d.creeps[l].armyRanged?_.filter(d.creeps[l].armyRanged,function(a){return!a.memory.escortedBy&&!a.spawning}):[]])[0];if(b)a.memory.escorting=b.id,b.memory.escortedBy=
a.id;else return!1});if(h)switch(this.directive){case "attack":this.hostiles=d.hostilesInRoom(h);break;default:this.hostiles=0<p.length?_.filter(d.hostilesInRoom(h),function(a){return 3>=n.objectsClosestToObj(p,a)[0].pos.getRangeTo(a)}):[]}f.assignTasks(this);a.assignTasks(this);b.assignTasks(this);e.assignTasks(this)}};r.prototype.checkSpawn=function(a,b,e){var g=this.name,l=_.filter(d.creeps[g]&&d.creeps[g][a]||[],function(a){return a.spawning||300<a.ticksToLive}).length,g=d.log.army[g];l<b&&e();
g&&(0<b||0<l)&&g.creeps.push({role:a,count:l,max:b})};r.prototype.spawnFromRegion=function(a){var b=this,e=a.spawnSettings(this);a=_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(e.body)&&a.room.memory.region===b.region});var g,f,t,y;if(0===a.length||this.boostRoom&&(g=Game.rooms[this.boostRoom],f=g.memory.labsInUse,g&&!(t=n.getLabToBoostWith(g,Object.keys(e.boosts).length))))return!1;y=a[0].createCreep(e.body,e.name+"-"+this.name+"-"+
Game.time.toFixed(0).substring(4),{role:e.name,army:this.name,labs:g?_.map(t,function(a){return a.id}):[],portals:this.portals});d.spawning[a[0].id]="number"!==typeof y;if("number"!==typeof y&&g){var v=0;_.forEach(e.boosts,function(a,b){t[v].creepToBoost=y;t[v].resource=b;t[v].amount=30*a;f.push(t[v]);v++});d.creeps[g.name]&&_.forEach(_.filter(d.creeps[g.name].all,function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&-1!==_.map(t,function(a){return a.id}).indexOf(a.memory.currentTask.id)}),
function(a){delete a.memory.currentTask})}return"number"!==typeof y};r.prototype.toObj=function(){this.delete?delete Memory.army[this.name]:Memory.army[this.name]={attackRoom:this.attackRoom,boostRoom:this.boostRoom,buildRoom:this.buildRoom,directive:this.directive,dismantle:this.dismantle,dismantler:this.dismantler,healer:this.healer,melee:this.melee,ranged:this.ranged,region:this.region,reinforce:this.reinforce,restPosition:this.restPosition,safeMode:this.safeMode,scheduled:this.scheduled,stageRoom:this.stageRoom,
success:this.success}};r.fromObj=function(a,b){return new r(a,b)};Memory.profiling&&c(1,2).registerObject(r,"Army");m.exports=r;return m.exports};u[3]=function(m,k){k=function(){};k.reset=function(){this.containers={};this.costMatrixes={};this.extensions={};this.extractors={};this.hostiles={};this.labs={};this.links={};this.nukers={};this.portals={};this.powerBanks={};this.powerSpawns={};this.repairableStructures={};this.resources={};this.sortedRepairableStructures={};this.sourceKeepers={};this.spawns=
{};this.towers={};this.armies={};this.creepTasks={};this.minerals={};this.spawning={};this.rooms={};this.log={events:[],hostiles:[],creeps:[],spawns:[],structures:[],rooms:{},army:{}};this.credits=Game.market.credits;Memory.visualizations&&(this.globalVisual=new RoomVisual,this.time=(new Date).toLocaleString("en-US",{timeZone:"America/Los_Angeles"}).replace(",",""))};k.containersInRoom=function(d){return this.containers[d.name]?this.containers[d.name]:this.containers[d.name]=_.filter(d.find(FIND_STRUCTURES),
function(d){return d.structureType===STRUCTURE_CONTAINER})};k.costMatrixForRoom=function(d){var c=d.name;if(!d||d.unobservable)return new PathFinder.CostMatrix;if(!this.costMatrixes[c]){var f=new PathFinder.CostMatrix;_.forEach(d.find(FIND_STRUCTURES),function(a){var b=a.pos;a.structureType===STRUCTURE_ROAD?f.set(b.x,b.y,Math.max(1,f.get(b.x,b.y))):a.structureType===STRUCTURE_WALL?f.set(b.x,b.y,Math.max(255,f.get(b.x,b.y))):a.structureType===STRUCTURE_CONTAINER?f.set(b.x,b.y,Math.max(10,f.get(b.x,
b.y))):a.structureType===STRUCTURE_RAMPART&&a.my||f.set(b.x,b.y,255)});_.forEach(d.find(FIND_MY_CONSTRUCTION_SITES),function(a){a=a.pos;f.set(a.x,a.y,Math.max(5,f.get(a.x,a.y)))});_.forEach(this.portalsInRoom(d),function(a){a=a.pos;f.set(a.x,a.y,5)});Memory.avoidSquares[c]&&_.forEach(Memory.avoidSquares[c],function(a){f.set(a.x,a.y,255)});this.costMatrixes[c]=f}return this.costMatrixes[c]};k.extensionsInRoom=function(d){return this.extensions[d.name]?this.extensions[d.name]:this.extensions[d.name]=
_.filter(d.find(FIND_MY_STRUCTURES),function(d){return d.structureType===STRUCTURE_EXTENSION})};k.extractorsInRoom=function(d){return this.extractors[d.name]?this.extractors[d.name]:this.extractors[d.name]=d.find(FIND_STRUCTURES,{filter:function(d){return d.structureType===STRUCTURE_EXTRACTOR}})};k.hostilesInRoom=function(d){var c;if(!d||d.unobservable)return[];c=this.hostiles[d.name]?this.hostiles[d.name]:this.hostiles[d.name]=_.filter(d.find(FIND_HOSTILE_CREEPS),function(d){return!d.owner||-1===
Memory.allies.indexOf(d.owner.username)});d=d.memory;d.hostiles||(d.hostiles=[]);d.hostiles=_.map(c,function(d){return d.id});return c};k.labsInRoom=function(d){return this.labs[d.name]?this.labs[d.name]:this.labs[d.name]=_.filter(d.find(FIND_MY_STRUCTURES),function(d){return d.structureType===STRUCTURE_LAB})};k.linksInRoom=function(d){return this.links[d.name]?this.links[d.name]:this.links[d.name]=d.find(FIND_STRUCTURES,{filter:function(d){return d.structureType===STRUCTURE_LINK}})};k.nukersInRoom=
function(d){return this.nukers[d.name]?this.nukers[d.name]:this.nukers[d.name]=_.filter(d.find(FIND_MY_STRUCTURES),function(d){return d.structureType===STRUCTURE_NUKER})};k.portalsInRoom=function(d){return this.portals[d.name]?this.portals[d.name]:this.portals[d.name]=d.find(FIND_STRUCTURES,{filter:function(d){return d.structureType===STRUCTURE_PORTAL}})};k.powerBanksInRoom=function(d){return this.powerBanks[d.name]?this.powerBanks[d.name]:this.powerBanks[d.name]=d.find(FIND_STRUCTURES,{filter:function(d){return d.structureType===
STRUCTURE_POWER_BANK}})};k.powerSpawnsInRoom=function(d){return this.powerSpawns[d.name]?this.powerSpawns[d.name]:this.powerSpawns[d.name]=_.filter(d.find(FIND_MY_STRUCTURES),function(d){return d.structureType===STRUCTURE_POWER_SPAWN})};k.repairableStructuresInRoom=function(d){return this.repairableStructures[d.name]?this.repairableStructures[d.name]:this.repairableStructures[d.name]=d.find(FIND_STRUCTURES,{filter:function(d){return(d.my||d.structureType===STRUCTURE_WALL||d.structureType===STRUCTURE_ROAD||
d.structureType===STRUCTURE_CONTAINER)&&d.hits}})};k.sortedRepairableStructuresInRoom=function(d){return this.sortedRepairableStructures[d.name]?this.sortedRepairableStructures[d.name]:this.sortedRepairableStructures[d.name]=this.repairableStructuresInRoom(d).sort(function(d,f){return d.hits-f.hits})};k.sourceKeepersInRoom=function(d){return this.sourceKeepers[d.name]?this.sourceKeepers[d.name]:this.sourceKeepers[d.name]=d.find(FIND_HOSTILE_STRUCTURES,{filter:function(d){return d.structureType===
STRUCTURE_KEEPER_LAIR}})};k.spawnsInRoom=function(d){return this.spawns[d.name]?this.spawns[d.name]:this.spawns[d.name]=_.filter(d.find(FIND_MY_STRUCTURES),function(d){return d.structureType===STRUCTURE_SPAWN})};k.towersInRoom=function(d){return this.towers[d.name]?this.towers[d.name]:this.towers[d.name]=_.filter(d.find(FIND_MY_STRUCTURES),function(d){return d.structureType===STRUCTURE_TOWER})};k.resourcesInRoom=function(d){return this.resources[d.name]?this.resources[d.name]:this.resources[d.name]=
d.find(FIND_DROPPED_RESOURCES).sort(function(d,f){return f.amount-d.amount})};Memory.profiling&&c(1,3).registerObject(k,"Cache");m.exports=k;return m.exports};u[4]=function(m,k){var d=c(3,4);k=function(){};k.addAlly=function(d){Memory.allies.push(d)};k.addSign=function(d,f){Memory.signs||(Memory.signs={});f?Memory.signs[d]=f:delete Memory.signs[d]};k.attackRoomController=function(d,f,a){Memory.maxCreeps.converter||(Memory.maxCreeps.converter={});Memory.maxCreeps.converter[d]||(Memory.maxCreeps.converter[d]=
{});a?Memory.maxCreeps.converter[d][f]=!0:delete Memory.maxCreeps.converter[d][f]};k.avoidRoom=function(d,f){f&&-1===Memory.avoidRooms.indexOf(d)&&Memory.avoidRooms.push(d);f||_.remove(Memory.avoidRooms,function(a){return a===d})};k.avoidSquare=function(d,f,a,b){b&&(Memory.avoidSquares[a]||(Memory.avoidSquares[a]=[]),Memory.avoidSquares[a].push({x:d,y:f}));b||Memory.avoidSquares[a]&&_.remove(Memory.avoidSquares[a],function(a){return a.x===d&&a.y===f})};k.claimMine=function(c){Game.rooms[c]&&d.creeps[c]&&
_.forEach(d.creeps[c].remoteReserver,function(d){d.claimController(Game.rooms[c].controller)})};k.claimRoom=function(d,f,a){Memory.maxCreeps.claimer||(Memory.maxCreeps.claimer={});Memory.maxCreeps.claimer[d]||(Memory.maxCreeps.claimer[d]={});a?Memory.maxCreeps.claimer[d][f]=!0:delete Memory.maxCreeps.claimer[d][f]};k.createArmy=function(d,f){void 0===f?delete Memory.army[d]:(Memory.army[d]=f,Memory.army[d].directive="preparing")};k.dismantle=function(d,f,a){Memory.dismantle||(Memory.dismantle={});
Memory.dismantle[a]||(Memory.dismantle[a]=[]);Memory.dismantle[a].push({x:d,y:f})};k.recover=function(){_.forEach(Game.spawns,function(d){d.createCreep([MOVE,MOVE,CARRY,CARRY,CARRY,CARRY],"storer-emerg-"+d.room.name+"-"+d.name,{role:"storer",home:d.room.name})})};k.removeAlly=function(d){_.pull(Memory.allies,d)};k.resetBaseMatrix=function(d){Memory.baseMatrixes[d]={}};k.setContainerSource=function(d,f){Memory.containerSource[d]=f};k.setRoomType=function(d,f,a){void 0===a?delete Memory.rooms[d].roomType:
(Memory.rooms[d]||(Memory.rooms[d]={}),Memory.rooms[d].roomType=a,Memory.rooms[d].region=f)};k.startAllCreeps=function(){_.forEach(Game.creeps,function(d){delete d.memory.stop})};k.startCreep=function(d){Game.creeps[d]&&delete Game.creeps[d].memory.stop};k.stopCreep=function(d){Game.creeps[d]&&(Game.creeps[d].memory.stop=!0)};Memory.profiling&&c(1,4).registerObject(k,"Commands");m.exports=k;return m.exports};u[5]=function(m,k){k=function(){};k.progressBar=function(d,c,f,a,b,e,r,g){void 0===g.showMax&&
(g.showMax=!0);void 0===g.valueDecimals&&(g.valueDecimals=0);d.rect(c,f,a,b,{fill:g.background}).rect(c,f,a*Math.min(e/r,1),b,{fill:g.bar}).text(""+(g.label?g.label+" ":"")+e.toFixed(g.valueDecimals)+(g.showMax?"/"+r.toFixed(0):"")+(g.showDetails?" ("+(100*e/r).toFixed(3)+"%) "+(r-e).toFixed(0)+" to go":""),c+a/2,f+b/2+.175,{align:"center",color:g.color,font:g.font})};k.sparkline=function(d,c,f,a,b,e,r,g){d.rect(c,f,a,b,{fill:"#404040",opacity:.5});_.forEach(g,function(e){d.poly(_.map(values,function(d,
g){return[c+g/(values.length-1)*a,f+b*(1-(d[e.key]-e.min)/(e.max-e.min))]}),e)})};k.resource=function(d,c,f,a,b,e){switch(b){case RESOURCE_ENERGY:d.circle(c,f,{radius:.625*a/2,fill:"#FFE664",opacity:e.opacity});break;case RESOURCE_POWER:d.circle(c,f,{radius:.625*a/2,fill:"#FF1930",opacity:e.opacity});break;case RESOURCE_HYDROGEN:d.circle(c,f,{radius:.4375*a,fill:"#B4B4B4",opacity:e.opacity}).circle(c,f,{radius:.375*a,fill:"#4C4C4C",opacity:e.opacity}).text(b,c,f+.2*a,{color:"#B4B4B4",size:.625*a,
opacity:e.opacity});break;case RESOURCE_OXYGEN:d.circle(c,f,{radius:.4375*a,fill:"#B4B4B4",opacity:e.opacity}).circle(c,f,{radius:.375*a,fill:"#4C4C4C",opacity:e.opacity}).text(b,c,f+.2*a,{color:"#B4B4B4",size:.625*a,opacity:e.opacity});break;case RESOURCE_UTRIUM:d.circle(c,f,{radius:.4375*a,fill:"#50D7F9",opacity:e.opacity}).circle(c,f,{radius:.375*a,fill:"#006181",opacity:e.opacity}).text(b,c,f+.2*a,{color:"#50D7F9",size:.625*a,opacity:e.opacity});break;case RESOURCE_KEANIUM:d.circle(c,f,{radius:.4375*
a,fill:"#A071FF",opacity:e.opacity}).circle(c,f,{radius:.375*a,fill:"#371383",opacity:e.opacity}).text(b,c,f+.2*a,{color:"#A071FF",size:.625*a,opacity:e.opacity});break;case RESOURCE_LEMERGIUM:d.circle(c,f,{radius:.4375*a,fill:"#00F4A2",opacity:e.opacity}).circle(c,f,{radius:.375*a,fill:"#236144",opacity:e.opacity}).text(b,c,f+.2*a,{color:"#00F4A2",size:.625*a,opacity:e.opacity});break;case RESOURCE_ZYNTHIUM:d.circle(c,f,{radius:.4375*a,fill:"#FDD388",opacity:e.opacity}).circle(c,f,{radius:.375*a,
fill:"#5D4C2E",opacity:e.opacity}).text(b,c,f+.2*a,{color:"#FDD388",size:.625*a,opacity:e.opacity});break;case RESOURCE_CATALYST:d.circle(c,f,{radius:.4375*a,fill:"#FF7B7B",opacity:e.opacity}).circle(c,f,{radius:.375*a,fill:"#592121",opacity:e.opacity}).text(b,c,f+.2*a,{color:"#FF7B7B",size:.625*a,opacity:e.opacity});break;case RESOURCE_HYDROXIDE:d.rect(c-a/2,f-a/2,1.375*a,a,{fill:"#B4B4B4",opacity:e.opacity}).text(b,c+.1875*a,f+.2*a,{color:"#666666",size:.625*a,opacity:e.opacity});break;case RESOURCE_ZYNTHIUM_KEANITE:d.rect(c-
a/2,f-a/2,1.375*a,a,{fill:"#B4B4B4",opacity:e.opacity}).text(b,c+.1875*a,f+.2*a,{color:"#666666",size:.625*a,opacity:e.opacity});break;case RESOURCE_UTRIUM_LEMERGITE:d.rect(c-a/2,f-a/2,1.375*a,a,{fill:"#B4B4B4",opacity:e.opacity}).text(b,c+.1875*a,f+.2*a,{color:"#666666",size:.625*a,opacity:e.opacity});break;case RESOURCE_GHODIUM:d.rect(c-a/2,f-a/2,a,a,{fill:"#FFFFFF",opacity:e.opacity}).text(b,c,f+.2*a,{color:"#666666",size:.625*a,opacity:e.opacity});break;case RESOURCE_UTRIUM_HYDRIDE:d.rect(c-a/
2,f-a/2,1.375*a,a,{fill:"#50D7F9",opacity:e.opacity}).text(b,c+.1875*a,f+.2*a,{color:"#006181",font:.625*a,opacity:e.opacity});break;case RESOURCE_UTRIUM_OXIDE:d.rect(c-a/2,f-a/2,1.375*a,a,{fill:"#50D7F9",opacity:e.opacity}).text(b,c+.1875*a,f+.2*a,{color:"#006181",font:.625*a,opacity:e.opacity});break;case RESOURCE_KEANIUM_HYDRIDE:d.rect(c-a/2,f-a/2,1.375*a,a,{fill:"#A071FF",opacity:e.opacity}).text(b,c+.1875*a,f+.2*a,{color:"#371383",font:.625*a,opacity:e.opacity});break;case RESOURCE_KEANIUM_OXIDE:d.rect(c-
a/2,f-a/2,1.375*a,a,{fill:"#A071FF",opacity:e.opacity}).text(b,c+.1875*a,f+.2*a,{color:"#371383",font:.625*a,opacity:e.opacity});break;case RESOURCE_LEMERGIUM_HYDRIDE:d.rect(c-a/2,f-a/2,1.375*a,a,{fill:"#00F4A2",opacity:e.opacity}).text(b,c+.1875*a,f+.2*a,{color:"#236144",font:.625*a,opacity:e.opacity});break;case RESOURCE_LEMERGIUM_OXIDE:d.rect(c-a/2,f-a/2,1.375*a,a,{fill:"#00F4A2",opacity:e.opacity}).text(b,c+.1875*a,f+.2*a,{color:"#236144",font:.625*a,opacity:e.opacity});break;case RESOURCE_ZYNTHIUM_HYDRIDE:d.rect(c-
a/2,f-a/2,1.375*a,a,{fill:"#FDD388",opacity:e.opacity}).text(b,c+.1875*a,f+.2*a,{color:"#5D4C2E",font:.625*a,opacity:e.opacity});break;case RESOURCE_ZYNTHIUM_OXIDE:d.rect(c-a/2,f-a/2,1.375*a,a,{fill:"#FDD388",opacity:e.opacity}).text(b,c+.1875*a,f+.2*a,{color:"#5D4C2E",font:.625*a,opacity:e.opacity});break;case RESOURCE_GHODIUM_HYDRIDE:d.rect(c-a/2,f-a/2,1.375*a,a,{fill:"#FFFFFF",opacity:e.opacity}).text(b,c+.1875*a,f+.2*a,{color:"#666666",font:.625*a,opacity:e.opacity});break;case RESOURCE_GHODIUM_OXIDE:d.rect(c-
a/2,f-a/2,1.375*a,a,{fill:"#FFFFFF",opacity:e.opacity}).text(b,c+.1875*a,f+.2*a,{color:"#666666",font:.625*a,opacity:e.opacity});break;case RESOURCE_UTRIUM_ACID:d.rect(c-a/2,f-a/2,2.125*a,a,{fill:"#50D7F9",opacity:e.opacity}).text(b,c+.5*a,f+.2*a,{color:"#006181",font:.625*a,opacity:e.opacity});break;case RESOURCE_UTRIUM_ALKALIDE:d.rect(c-a/2,f-a/2,2.125*a,a,{fill:"#50D7F9",opacity:e.opacity}).text(b,c+.5*a,f+.2*a,{color:"#006181",font:.625*a,opacity:e.opacity});break;case RESOURCE_KEANIUM_ACID:d.rect(c-
a/2,f-a/2,2.125*a,a,{fill:"#A071FF",opacity:e.opacity}).text(b,c+.5*a,f+.2*a,{color:"#371383",font:.625*a,opacity:e.opacity});break;case RESOURCE_KEANIUM_ALKALIDE:d.rect(c-a/2,f-a/2,2.125*a,a,{fill:"#A071FF",opacity:e.opacity}).text(b,c+.5*a,f+.2*a,{color:"#371383",font:.625*a,opacity:e.opacity});break;case RESOURCE_LEMERGIUM_ACID:d.rect(c-a/2,f-a/2,2.125*a,a,{fill:"#00F4A2",opacity:e.opacity}).text(b,c+.5*a,f+.2*a,{color:"#236144",font:.625*a,opacity:e.opacity});break;case RESOURCE_LEMERGIUM_ALKALIDE:d.rect(c-
a/2,f-a/2,2.125*a,a,{fill:"#00F4A2",opacity:e.opacity}).text(b,c+.5*a,f+.2*a,{color:"#236144",font:.625*a,opacity:e.opacity});break;case RESOURCE_ZYNTHIUM_ACID:d.rect(c-a/2,f-a/2,2.125*a,a,{fill:"#FDD388",opacity:e.opacity}).text(b,c+.5*a,f+.2*a,{color:"#5D4C2E",font:.625*a,opacity:e.opacity});break;case RESOURCE_ZYNTHIUM_ALKALIDE:d.rect(c-a/2,f-a/2,2.125*a,a,{fill:"#FDD388",opacity:e.opacity}).text(b,c+.5*a,f+.2*a,{color:"#5D4C2E",font:.625*a,opacity:e.opacity});break;case RESOURCE_GHODIUM_ACID:d.rect(c-
a/2,f-a/2,2.125*a,a,{fill:"#FFFFFF",opacity:e.opacity}).text(b,c+.5*a,f+.2*a,{color:"#666666",font:.625*a,opacity:e.opacity});break;case RESOURCE_GHODIUM_ALKALIDE:d.rect(c-a/2,f-a/2,2.125*a,a,{fill:"#FFFFFF",opacity:e.opacity}).text(b,c+.5*a,f+.2*a,{color:"#666666",font:.625*a,opacity:e.opacity});break;case RESOURCE_CATALYZED_UTRIUM_ACID:d.rect(c-a/2,f-a/2,2.5*a,a,{fill:"#50D7F9",opacity:e.opacity}).text(b,c+.725*a,f+.2*a,{color:"#006181",font:.625*a,opacity:e.opacity});break;case RESOURCE_CATALYZED_UTRIUM_ALKALIDE:d.rect(c-
a/2,f-a/2,2.5*a,a,{fill:"#50D7F9",opacity:e.opacity}).text(b,c+.725*a,f+.2*a,{color:"#006181",font:.625*a,opacity:e.opacity});break;case RESOURCE_CATALYZED_KEANIUM_ACID:d.rect(c-a/2,f-a/2,2.5*a,a,{fill:"#A071FF",opacity:e.opacity}).text(b,c+.725*a,f+.2*a,{color:"#371383",font:.625*a,opacity:e.opacity});break;case RESOURCE_CATALYZED_KEANIUM_ALKALIDE:d.rect(c-a/2,f-a/2,2.5*a,a,{fill:"#A071FF",opacity:e.opacity}).text(b,c+.725*a,f+.2*a,{color:"#371383",font:.625*a,opacity:e.opacity});break;case RESOURCE_CATALYZED_LEMERGIUM_ACID:d.rect(c-
a/2,f-a/2,2.5*a,a,{fill:"#00F4A2",opacity:e.opacity}).text(b,c+.725*a,f+.2*a,{color:"#236144",font:.625*a,opacity:e.opacity});break;case RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE:d.rect(c-a/2,f-a/2,2.5*a,a,{fill:"#00F4A2",opacity:e.opacity}).text(b,c+.725*a,f+.2*a,{color:"#236144",font:.625*a,opacity:e.opacity});break;case RESOURCE_CATALYZED_ZYNTHIUM_ACID:d.rect(c-a/2,f-a/2,2.5*a,a,{fill:"#FDD388",opacity:e.opacity}).text(b,c+.725*a,f+.2*a,{color:"#5D4C2E",font:.625*a,opacity:e.opacity});break;case RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE:d.rect(c-
a/2,f-a/2,2.5*a,a,{fill:"#FDD388",opacity:e.opacity}).text(b,c+.725*a,f+.2*a,{color:"#5D4C2E",font:.625*a,opacity:e.opacity});break;case RESOURCE_CATALYZED_GHODIUM_ACID:d.rect(c-a/2,f-a/2,2.5*a,a,{fill:"#FFFFFF",opacity:e.opacity}).text(b,c+.725*a,f+.2*a,{color:"#666666",font:.625*a,opacity:e.opacity});break;case RESOURCE_CATALYZED_GHODIUM_ALKALIDE:d.rect(c-a/2,f-a/2,2.5*a,a,{fill:"#FFFFFF",opacity:e.opacity}).text(b,c+.725*a,f+.2*a,{color:"#666666",font:.625*a,opacity:e.opacity})}};Memory.profiling&&
c(1,5).registerObject(k,"Drawing");m.exports=k;return m.exports};u[6]=function(m,k){var d=c(3,6),n=c(10,6),f=function(){};f.getAllOrders=function(){if(!f.orders||Game.cpu.bucket>=Memory.marketBucket)f.orders=Game.market.getAllOrders(),delete f.filteredOrders;return f.orders};f.getFilteredOrders=function(){f.filteredOrders||(f.filteredOrders=n.nest(_.filter(f.getAllOrders(),function(a){return 0<a.amount}),[function(a){return a.type},function(a){return a.resourceType}]),_.forEach(f.filteredOrders.sell,
function(a,b){f.filteredOrders.sell[b].sort(function(a,b){return a.price-b.price})}),_.forEach(f.filteredOrders.buy,function(a,b){f.filteredOrders.buy[b].sort(function(a,b){return b.price-a.price})}));return f.filteredOrders};f.deal=function(a,b,e){var c=Game.market.deal(a,b,e),g=_.find(f.orders,function(b){return b.id===a});c===OK?g&&("sell"===g.type&&(d.credits-=g.amount*g.price),g.amount<=b?(d.log.events.push(e+" "+g.resourceType+" x"+b+" @ "+g.price+" completed, "+g.type+" sold out "+g.id),_.remove(f.filteredOrders[g.type][g.resourceType],
function(b){return b.id===a}),_.remove(f.orders,function(b){return b.id===a})):(g.amount-=b,d.log.events.push(e+" "+g.resourceType+" x"+b+" @ "+g.price+" completed, "+g.type+" "+g.amount+" remaining on "+g.id))):g&&(d.log.events.push(e+" failed to process order ID "+a+": "+c),_.remove(f.filteredOrders[g.type][g.resourceType],function(b){return b.id===a}),_.remove(f.orders,function(b){return b.id===a}));return c};Memory.profiling&&c(1,6).registerObject(f,"Market");m.exports=f;return m.exports};u[7]=
function(c,k){k={};k[RESOURCE_HYDROGEN]=[];k[RESOURCE_OXYGEN]=[];k[RESOURCE_ZYNTHIUM]=[];k[RESOURCE_KEANIUM]=[];k[RESOURCE_UTRIUM]=[];k[RESOURCE_LEMERGIUM]=[];k[RESOURCE_CATALYST]=[];k[RESOURCE_HYDROXIDE]=[RESOURCE_HYDROGEN,RESOURCE_OXYGEN];k[RESOURCE_ZYNTHIUM_KEANITE]=[RESOURCE_ZYNTHIUM,RESOURCE_KEANIUM];k[RESOURCE_UTRIUM_LEMERGITE]=[RESOURCE_UTRIUM,RESOURCE_LEMERGIUM];k[RESOURCE_GHODIUM]=[RESOURCE_ZYNTHIUM_KEANITE,RESOURCE_UTRIUM_LEMERGITE];k[RESOURCE_UTRIUM_HYDRIDE]=[RESOURCE_UTRIUM,RESOURCE_HYDROGEN];
k[RESOURCE_UTRIUM_OXIDE]=[RESOURCE_UTRIUM,RESOURCE_OXYGEN];k[RESOURCE_KEANIUM_HYDRIDE]=[RESOURCE_KEANIUM,RESOURCE_HYDROGEN];k[RESOURCE_KEANIUM_OXIDE]=[RESOURCE_KEANIUM,RESOURCE_OXYGEN];k[RESOURCE_LEMERGIUM_HYDRIDE]=[RESOURCE_LEMERGIUM,RESOURCE_HYDROGEN];k[RESOURCE_LEMERGIUM_OXIDE]=[RESOURCE_LEMERGIUM,RESOURCE_OXYGEN];k[RESOURCE_ZYNTHIUM_HYDRIDE]=[RESOURCE_ZYNTHIUM,RESOURCE_HYDROGEN];k[RESOURCE_ZYNTHIUM_OXIDE]=[RESOURCE_ZYNTHIUM,RESOURCE_OXYGEN];k[RESOURCE_GHODIUM_HYDRIDE]=[RESOURCE_GHODIUM,RESOURCE_HYDROGEN];
k[RESOURCE_GHODIUM_OXIDE]=[RESOURCE_GHODIUM,RESOURCE_OXYGEN];k[RESOURCE_UTRIUM_ACID]=[RESOURCE_UTRIUM_HYDRIDE,RESOURCE_HYDROXIDE];k[RESOURCE_UTRIUM_ALKALIDE]=[RESOURCE_UTRIUM_OXIDE,RESOURCE_HYDROXIDE];k[RESOURCE_KEANIUM_ACID]=[RESOURCE_KEANIUM_HYDRIDE,RESOURCE_HYDROXIDE];k[RESOURCE_KEANIUM_ALKALIDE]=[RESOURCE_KEANIUM_OXIDE,RESOURCE_HYDROXIDE];k[RESOURCE_LEMERGIUM_ACID]=[RESOURCE_LEMERGIUM_HYDRIDE,RESOURCE_HYDROXIDE];k[RESOURCE_LEMERGIUM_ALKALIDE]=[RESOURCE_LEMERGIUM_OXIDE,RESOURCE_HYDROXIDE];k[RESOURCE_ZYNTHIUM_ACID]=
[RESOURCE_ZYNTHIUM_HYDRIDE,RESOURCE_HYDROXIDE];k[RESOURCE_ZYNTHIUM_ALKALIDE]=[RESOURCE_ZYNTHIUM_OXIDE,RESOURCE_HYDROXIDE];k[RESOURCE_GHODIUM_ACID]=[RESOURCE_GHODIUM_HYDRIDE,RESOURCE_HYDROXIDE];k[RESOURCE_GHODIUM_ALKALIDE]=[RESOURCE_GHODIUM_OXIDE,RESOURCE_HYDROXIDE];k[RESOURCE_CATALYZED_UTRIUM_ACID]=[RESOURCE_UTRIUM_ACID,RESOURCE_CATALYST];k[RESOURCE_CATALYZED_UTRIUM_ALKALIDE]=[RESOURCE_UTRIUM_ALKALIDE,RESOURCE_CATALYST];k[RESOURCE_CATALYZED_KEANIUM_ACID]=[RESOURCE_KEANIUM_ACID,RESOURCE_CATALYST];
k[RESOURCE_CATALYZED_KEANIUM_ALKALIDE]=[RESOURCE_KEANIUM_ALKALIDE,RESOURCE_CATALYST];k[RESOURCE_CATALYZED_LEMERGIUM_ACID]=[RESOURCE_LEMERGIUM_ACID,RESOURCE_CATALYST];k[RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE]=[RESOURCE_LEMERGIUM_ALKALIDE,RESOURCE_CATALYST];k[RESOURCE_CATALYZED_ZYNTHIUM_ACID]=[RESOURCE_ZYNTHIUM_ACID,RESOURCE_CATALYST];k[RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE]=[RESOURCE_ZYNTHIUM_ALKALIDE,RESOURCE_CATALYST];k[RESOURCE_CATALYZED_GHODIUM_ACID]=[RESOURCE_GHODIUM_ACID,RESOURCE_CATALYST];k[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]=
[RESOURCE_GHODIUM_ALKALIDE,RESOURCE_CATALYST];c.exports=k;return c.exports};u[8]=function(m,k){var d=c(1,8);k=function(){};k.run=function(c,f){d.registerFN(f,"Proxy."+c)()};Memory.profiling&&d.registerObject(k,"Proxy");m.exports=k;return m.exports};u[9]=function(m,k){var d=[];k=function(c){this.id=c;if(!d[c])try{d[c]=JSON.parse(RawMemory.segments[c])}catch(f){d[c]=void 0}};k.init=function(){RawMemory.setActiveSegments([1,2,3,4,5,6,7,8,9,10])};k.prototype.set=function(){RawMemory.segments[this.id]=
JSON.stringify(d[this.id])};$jscomp.global.Object.defineProperties(k.prototype,{memory:{configurable:!0,enumerable:!0,get:function(){return d[this.id]},set:function(c){d[this.id]=c}}});Memory.profiling&&c(1,9).registerObject(k,"Segment");m.exports=k;return m.exports};u[10]=function(m,k){var d=c(3,10),n=function(){};n.nest=function(d,a){return a.length?_.mapValues(_.groupBy(d,a[0]),function(b){return n.nest(b,a.slice(1))}):d};n.creepsWithNoTask=function(d){return _.filter(d,function(a){return!a.memory.currentTask||
a.memory.currentTask.unimportant})};n.objectsClosestToObj=function(d,a){var b=a.id;if(0===d.length)return[];if(!a)return d;d=_.map(d,function(e){var d=e.id,g;Memory.ranges&&Memory.ranges[b]&&Memory.ranges[b][d]?g=Memory.ranges[b][d]:(g=a.pos.getRangeTo(e),e instanceof Creep||a instanceof Creep||(Memory.ranges||(Memory.ranges={}),Memory.ranges[b]||(Memory.ranges[b]={}),Memory.ranges[b][d]=g));return{object:e,distance:g}});d.sort(function(a,b){return a.distance-b.distance});return _.map(d,function(a){return a.object})};
n.getEmptyPosAroundPos=function(d){var a=0,b,e,f;for(b=d.x-1;b<d.x+2;b++)for(e=d.y-1;e<d.y+2;e++)if(b!==d.x||e!==d.y)f=new RoomPosition(b,e,d.roomName),a+=_.filter(f.look(),function(a){return"terrain"===a.type&&"wall"!==a.terrain}).length;return a};n.checkSiteIsClear=function(d){var a=!0,b=d.x,e=d.y,c=d.roomName,g=Game.rooms[c];if("wall"===(new RoomPosition(b,e,c)).lookFor(LOOK_TERRAIN)[0]||"wall"===(new RoomPosition(b-1,e,c)).lookFor(LOOK_TERRAIN)[0]&&"wall"===(new RoomPosition(b+1,e,c)).lookFor(LOOK_TERRAIN)[0]||
"wall"===(new RoomPosition(b,e-1,c)).lookFor(LOOK_TERRAIN)[0]&&"wall"===(new RoomPosition(b,e+1,c)).lookFor(LOOK_TERRAIN)[0])return!1;_.forEach(g.find(FIND_SOURCES),function(b){return a=1<d.getRangeTo(b)});if(!a)return!1;_.forEach(g.find(FIND_MINERALS),function(b){return a=1<d.getRangeTo(b)});if(!a||4>=d.getRangeTo(g.controller))return!1;b=_.filter(d.lookFor(LOOK_STRUCTURES),function(a){return"rampart"!==a.structureType});return 0===b.length?!0:_.filter(b,function(a){return-1!==[STRUCTURE_ROAD,STRUCTURE_WALL].indexOf(a.structureType)}).length!==
b.length?!1:b};n.buildStructures=function(d,a,b,e){var c=1,g=e.pos;e=g.x;for(var g=g.y,l,p,h;0<b&&50>c;){for(l=e-c;l<=e+c;l+=2){for(p=g-c;p<=g+c&&(1>l||48<l||1>p||48<p||0<_.filter(d.find(FIND_MY_CONSTRUCTION_SITES),function(a){return a.pos.x===l&&a.pos.y===p}).length||(h=n.checkSiteIsClear(new RoomPosition(l,p,d.name)),!1===h||(!0!==h&&_.forEach(h,function(a){a.destroy()}),d.createConstructionSite(l,p,a),b--,0!==b)));p+=Math.abs(e-l)===c?2:2*c);if(0===b)break}c++}};n.getBodypartCost=function(d){return _.sum(_.map(d,
function(a){return BODYPART_COST[a]}))};n.getSourceLabs=function(c){var a=d.labsInRoom(c),b=[];_.forEach(a,function(e){if(2>=n.objectsClosestToObj(a,e)[a.length-1].pos.getRangeTo(e)&&(b.push(e.id),2<=b.length))return!1});return b};n.getLabToBoostWith=function(c,a){var b=c.memory.labQueue,e=b&&b.sourceLabs?b.sourceLabs:[],f=[],b=null,g;a||(a=1);0===e.length&&(e=n.getSourceLabs(c));c.memory.labsInUse||(c.memory.labsInUse=[]);for(var l=0;l<a;l++){b={};g=_.filter(d.labsInRoom(c),function(a){return-1===
e.indexOf(a.id)&&-1===_.map(c.memory.labsInUse,function(a){return a.id}).indexOf(a.id)&&-1===_.map(f,function(a){return a.id}).indexOf(a.id)});0<g.length&&(b={id:g[0].id,pause:!1});if(!b||!b.id){b={id:_.filter(e,function(a){return-1===_.map(c.memory.labsInUse,function(a){return a.id}).indexOf(a)&&-1===_.map(f,function(a){return a.id}).indexOf(a)})[0],pause:!0};if(!b.id)return!1;g=Game.getObjectById(b.id);0<g.mineralAmount&&(b.status="emptying",b.oldResource=g.mineralType,b.oldAmount=g.mineralAmount)}if(!b.id)return!1;
f.push(b)}return f};n.roomLabsArePaused=function(d){return d.memory.labsInUse&&0<_.filter(d.memory.labsInUse,function(a){return a.pause}).length};n.getControllerOwner=function(d){return d.owner?d.owner.username:d.reservation?d.reservation.owner:""};Memory.profiling&&c(1,10).registerObject(n,"Utilities");m.exports=n;return m.exports};u[11]=function(m,k){var d=c(56,11),n=c(3,11),f=c(10,11);k=function(){};k.spawnSettings=function(a){var b=a.dismantler.units,e=[TOUGH,TOUGH,TOUGH,TOUGH,TOUGH],d;e.push.apply(e,
[].concat($jscomp.arrayFromIterable(Array(b).fill(WORK))));e.push.apply(e,[].concat($jscomp.arrayFromIterable(Array(b+5).fill(MOVE))));a.boostRoom&&(d={RESOURCE_CATALYZED_GHODIUM_ALKALIDE:5,RESOURCE_CATALYZED_ZYNTHIUM_ACID:b});return{body:e,boosts:d,name:"armyDismantler"}};k.assignTasks=function(a){switch(a.directive){case "building":this.assignBuildingTasks(a);break;case "staging":this.assignStagingTasks(a);break;case "dismantle":this.assignDismantleTasks(a);break;case "attack":this.assignAttackTasks(a)}};
k.assignBuildingTasks=function(a){var b=b=n.creeps[a.name],b=_.filter(f.creepsWithNoTask(b&&b.armyDismantler||[]),function(a){return!a.spawning});d.getBoost(b,"Boosting");_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==b.length&&d.moveToRoom(b,a.buildRoom,"Building")};k.assignStagingTasks=function(a){var b=b=n.creeps[a.name];d.moveToRoom(_.filter(f.creepsWithNoTask(b&&b.armyDismantler||[]),function(a){return!a.spawning}),
a.stageRoom,"Staging")};k.assignDismantleTasks=function(a){var b=n.creeps[a.name],e=b&&b.armyDismantler||[],c=a.attackRoom,g=_.filter(f.creepsWithNoTask(e),function(a){return!a.spawning});d.retreatArmyUnitOrMoveToHealer(e,b&&b.armyHealer||[],a.stageRoom,c,.8,"Ouch!");_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==g.length&&(d.dismantleArmyTarget(g,c,a.dismantle,"Dismantle"),_.remove(g,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==g.length&&d.moveToRoom(g,c,"Attacking"))};k.assignAttackTasks=function(a){var b=n.creeps[a.name],b=b&&b.armyDismantler||[],e=a.attackRoom,c=_.filter(f.creepsWithNoTask(b),function(a){return!a.spawning}),g;d.retreatArmyUnit(b,n.creeps[a.name].armyHealer,a.stageRoom,e,.8,"Ouch!");_.remove(c,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==
c.length&&(d.dismantleHostileStructures(c,e,"Dismantle"),_.remove(c,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==c.length&&(d.stomp(c,a.hostileConstructionSites,"Stomping"),_.remove(c,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==c.length&&((g=a.restPosition)?d.moveToPos(c,new RoomPosition(g.x,g.y,g.room),void 0,"Attacking"):d.moveToRoom(c,
e,"Attacking"))))};Memory.profiling&&c(1,11).registerObject(k,"RoleArmyDismantler");m.exports=k;return m.exports};u[12]=function(m,k){var d=c(56,12),n=c(3,12),f=c(10,12);k=function(){};k.spawnSettings=function(a){var b=a.healer.units,e=[TOUGH,TOUGH,TOUGH,TOUGH,TOUGH],d;e.push.apply(e,[].concat($jscomp.arrayFromIterable(Array(b-1).fill(HEAL))));e.push.apply(e,[].concat($jscomp.arrayFromIterable(Array(b+5).fill(MOVE))));e.push(HEAL);a.boostRoom&&(d={RESOURCE_CATALYZED_GHODIUM_ALKALIDE:5,RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE:b});
return{body:e,boosts:d,name:"armyHealer"}};k.assignTasks=function(a){var b=n.creeps[a.name];d.escort(b&&b.armyHealer||[],"Healing");switch(a.directive){case "building":this.assignBuildingTasks(a);break;case "staging":this.assignStagingTasks(a);break;case "dismantle":this.assignDismantleTasks(a);break;case "attack":this.assignAttackTasks(a)}};k.assignBuildingTasks=function(a){var b=n.creeps[a.name],e=_.filter(f.creepsWithNoTask(b&&b.armyHealer||[]),function(a){return!a.spawning&&!a.memory.escorting});
d.getBoost(e,"Boosting");_.remove(e,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==e.length&&(d.heal(e,_.filter(b&&b.all||[],function(a){return a.hits<a.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}),"Healing"),_.remove(e,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==e.length&&d.moveToRoom(e,a.buildRoom,"Building"))};
k.assignStagingTasks=function(a){var b=n.creeps[a.name],e=_.filter(f.creepsWithNoTask(b&&b.armyHealer||[]),function(a){return!a.spawning&&!a.memory.escorting});d.heal(e,_.filter(b&&b.all||[],function(a){return a.hits<a.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}),"Healing");_.remove(e,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==e.length&&d.moveToRoom(e,a.stageRoom,"Staging")};k.assignDismantleTasks=
function(a){var b=n.creeps[a.name],e=b&&b.armyHealer||[],c=a.attackRoom,g=_.filter(f.creepsWithNoTask(e),function(a){return!a.spawning&&!a.memory.escorting}),l;d.retreatArmyUnit(e,n.creeps[a.name].armyHealer,a.stageRoom,c,.8,"Ouch!");_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});if(0!==g.length&&(d.heal(g,_.filter(b&&b.all||[],function(a){return a.hits<a.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/
b.hitsMax}),"Healing"),_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==g.length)){if(Game.rooms[c]&&0<(l=a.dismantle).length&&(d.moveToPos(g,l[0].pos,3,"Attacking"),_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0===g.length))return;d.moveToRoom(g,c,"Attacking")}};k.assignAttackTasks=function(a){var b=n.creeps[a.name],e=b&&b.armyHealer||
[],c=a.attackRoom,g=_.filter(f.creepsWithNoTask(e),function(a){return!a.spawning&&!a.memory.escorting}),l;d.retreatArmyUnit(e,n.creeps[a.name].armyHealer,a.stageRoom,c,.8,"Ouch!");_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});if(0!==g.length&&(d.heal(g,_.filter(b&&b.all||[],function(a){return a.hits<a.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}),"Healing"),_.remove(g,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==g.length)){if(b=Game.rooms[c])if(d.heal(g,_.filter(b.find(FIND_MY_CREEPS),function(a){return a.hits<a.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}),"Healing"),_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0===g.length)return;d.stomp(g,a.hostileConstructionSites,"Stomping");_.remove(g,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==g.length&&((l=a.restPosition)?d.moveToPos(g,new RoomPosition(l.x,l.y,l.room),void 0,"Attacking"):d.moveToRoom(g,c,"Attacking"))}};Memory.profiling&&c(1,12).registerObject(k,"RoleArmyHealer");m.exports=k;return m.exports};u[13]=function(m,k){var d=c(56,13),n=c(3,13),f=c(10,13);k=function(){};k.spawnSettings=function(a){var b=a.melee.units,e=[TOUGH,TOUGH,TOUGH,TOUGH,TOUGH],d;e.push.apply(e,[].concat($jscomp.arrayFromIterable(Array(b).fill(ATTACK))));
e.push.apply(e,[].concat($jscomp.arrayFromIterable(Array(b+5).fill(MOVE))));a.boostRoom&&(d={RESOURCE_CATALYZED_GHODIUM_ALKALIDE:5,RESOURCE_CATALYZED_UTRIUM_ACID:b});return{body:e,boosts:d,name:"armyMelee"}};k.assignTasks=function(a){switch(a.directive){case "building":this.assignBuildingTasks(a);break;case "staging":this.assignStagingTasks(a);break;case "dismantle":this.assignDismantleTasks(a);break;case "attack":this.assignAttackTasks(a)}};k.assignBuildingTasks=function(a){var b=n.creeps[a.name],
b=_.filter(f.creepsWithNoTask(b&&b.armyMelee||[]),function(a){return!a.spawning});d.getBoost(b,"Boosting");_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==b.length&&(d.attack(b,a.hostiles,"Attacking"),_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==b.length&&d.moveToRoom(b,a.buildRoom,"Building"))};k.assignStagingTasks=function(a){var b=
n.creeps[a.name],b=_.filter(f.creepsWithNoTask(b&&b.armyMelee||[]),function(a){return!a.spawning});d.attack(b,a.hostiles,"Attacking");_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==b.length&&d.moveToRoom(b,a.stageRoom,"Staging")};k.assignDismantleTasks=function(a){var b=n.creeps[a.name],e=b&&b.armyMelee||[],c=a.attackRoom,g=_.filter(f.creepsWithNoTask(e),function(a){return!a.spawning}),l;d.retreatArmyUnitOrMoveToHealer(e,
b&&b.armyHealer||[],a.stageRoom,c,.8,"Ouch!");_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});if(0!==g.length&&(d.attack(g,a.hostiles,"Attacking"),_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==g.length)){if(Game.rooms[c]&&0<(l=a.dismantle).length&&(d.moveToPos(g,l[0].pos,3,"Attacking"),_.remove(g,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0===g.length))return;d.moveToRoom(g,c,"Attacking")}};k.assignAttackTasks=function(a){var b=n.creeps[a.name],e=b&&b.armyMelee||[],c=a.attackRoom,g=_.filter(f.creepsWithNoTask(e),function(a){return!a.spawning}),l;d.retreatArmyUnit(e,b&&b.armyHealer||[],a.stageRoom,c,.8,"Ouch!");_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==g.length&&
(d.attack(g,a.hostiles,"Attacking"),_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==g.length&&(d.stomp(g,a.hostileConstructionSites,"Stomping"),_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==g.length&&((l=a.restPosition)?d.moveToPos(g,new RoomPosition(l.x,l.y,l.room),void 0,"Attacking"):d.moveToRoom(g,c,"Attacking"))))};
Memory.profiling&&c(1,13).registerObject(k,"RoleArmyMelee");m.exports=k;return m.exports};u[14]=function(m,k){var d=c(56,14),n=c(3,14),f=c(10,14);k=function(){};k.spawnSettings=function(a){var b=a.ranged.units,e=[TOUGH,TOUGH,TOUGH,TOUGH,TOUGH],d;e.push.apply(e,[].concat($jscomp.arrayFromIterable(Array(b).fill(RANGED_ATTACK))));e.push.apply(e,[].concat($jscomp.arrayFromIterable(Array(b+5).fill(MOVE))));a.boostRoom&&(d={RESOURCE_CATALYZED_GHODIUM_ALKALIDE:5,RESOURCE_CATALYZED_UTRIUM_ACID:b});return{body:e,
boosts:d,name:"armyRanged"}};k.assignTasks=function(a){switch(a.directive){case "building":this.assignBuildingTasks(a);break;case "staging":this.assignStagingTasks(a);break;case "dismantle":this.assignDismantleTasks(a);break;case "attack":this.assignAttackTasks(a)}};k.assignBuildingTasks=function(a){var b=n.creeps[a.name],b=_.filter(f.creepsWithNoTask(b&&b.armyRanged||[]),function(a){return!a.spawning});d.getBoost(b,"Boosting");_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||
a.memory.currentTask.priority===Game.time)});0!==b.length&&(d.rangedAttack(b,a.hostiles,"Attacking"),_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==b.length&&d.moveToRoom(b,a.buildRoom,"Building"))};k.assignStagingTasks=function(a){var b=n.creeps[a.name],b=_.filter(f.creepsWithNoTask(b&&b.armyRanged||[]),function(a){return!a.spawning});d.rangedAttack(b,a.hostiles,"Attacking");_.remove(b,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==b.length&&d.moveToRoom(b,a.stageRoom,"Staging")};k.assignDismantleTasks=function(a){var b=n.creeps[a.name],e=b&&b.armyRanged||[],c=a.attackRoom,g=_.filter(f.creepsWithNoTask(e),function(a){return!a.spawning}),l;d.retreatArmyUnitOrMoveToHealer(e,b&&b.armyHealer||[],a.stageRoom,c,.8,"Ouch!");_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});
if(0!==g.length&&(d.rangedAttack(g,a.hostiles,"Attacking"),_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==g.length)){if(Game.rooms[c]&&0<(l=a.dismantle).length&&(d.moveToPos(g,l[0].pos,3,"Attacking"),_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0===g.length))return;d.moveToRoom(g,c,"Attacking")}};k.assignAttackTasks=function(a){var b=
n.creeps[a.name],e=b&&b.armyRanged||[],c=a.attackRoom,g=_.filter(f.creepsWithNoTask(e),function(a){return!a.spawning}),l;d.retreatArmyUnit(e,b&&b.armyHealer||[],a.stageRoom,c,.8,"Ouch!");_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==g.length&&(d.rangedAttack(g,a.hostiles,"Attacking"),_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),
0!==g.length&&(d.stomp(g,a.hostileConstructionSites,"Stomping"),_.remove(g,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==g.length&&((l=a.restPosition)?d.moveToPos(g,new RoomPosition(l.x,l.y,l.room),void 0,"Attacking"):d.moveToRoom(g,c,"Attacking"))))};Memory.profiling&&c(1,14).registerObject(k,"RoleArmyRanged");m.exports=k;return m.exports};u[15]=function(m,k){var d=c(3,15);c(4,15);var n=c(10,15),f=c(51,15),a=c(40,15),
b=function(){};b.checkSpawn=function(a){var e=Memory.maxCreeps.claimer,g=a.name,c=d.creeps[g]&&d.creeps[g].claimer||[],f=0;e&&_.forEach(e[g],function(d,e){d=_.filter(c,function(a){return a.memory.claim===e}).length;f+=1;0===d&&b.spawn(a,e)});Memory.log&&(0<c.length||0<f)&&d.log.rooms[g]&&d.log.rooms[g].creeps.push({role:"claimer",count:c.length,max:f})};b.spawn=function(a,b){var e=d.spawnsInRoom(a),c=[CLAIM,MOVE];if(0===_.filter(e,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;
e=_.filter(e,function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(c)})[0];if(!e)return!1;a=e.createCreep(c,"claimer-"+b+"-"+Game.time.toFixed(0).substring(4),{role:"claimer",home:a.name,claim:b});d.spawning[e.id]="number"!==typeof a;return"number"!==typeof a};b.assignTasks=function(b,c){b=b.name;b=n.creepsWithNoTask(d.creeps[b]&&d.creeps[b].claimer||[]);var e=[];0!==b.length&&(_.forEach(_.filter(b,function(a){return a.room.name!==a.memory.claim}),function(a){f.getClaimerTask(a).canAssign(a)&&
e.push(a.name)}),_.remove(b,function(a){return-1!==e.indexOf(a.name)}),e=[],0!==b.length&&(_.forEach(b,function(b){a.getTask(b).canAssign(b)&&(b.say("Claiming"),e.push(b.name))}),_.remove(b,function(a){return-1!==e.indexOf(a.name)}),e=[],0!==b.length&&_.forEach(b,function(a){a.room.name===a.memory.claim&&a.room.controller.my&&a.suicide()})))};Memory.profiling&&c(1,15).registerObject(b,"RoleClaimer");m.exports=b;return m.exports};u[16]=function(m,k){var d=c(3,16),n=c(10,16),f=c(46,16),a=c(50,16),b=
c(51,16),e=function(){};e.checkSpawn=function(a){var b=d.spawnsInRoom(a),c=0,f=a.name,h=d.creeps[f]&&d.creeps[f].collector||[],q,t;0!==d.containersInRoom(a).length&&a.storage&&a.storage.my||0===b.length||(b=n.objectsClosestToObj(a.find(FIND_SOURCES),b[0]),1>=b.length||(t=Math.max((2500-a.energyCapacityAvailable)/2500,.1),_.forEach(b,function(b,d){var g=b.id;0!==d&&(c+=Math.ceil(3*t),q=_.filter(h,function(a){return a.memory.homeSource===g}).length,q<3*t&&e.spawn(a,g))}),Memory.log&&(0<h.length||0<
c)&&d.log.rooms[f]&&d.log.rooms[f].creeps.push({role:"collector",count:h.length,max:c})))};e.spawn=function(a,b){var e=[],g=a.name,c,q,t;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;c=Math.min(a.energyCapacityAvailable,3300);q=Math.floor(c/200);c%=200;for(t=0;t<q;t++)e.push(WORK);150<=c&&e.push(WORK);for(t=0;t<q;t++)e.push(CARRY);100<=c&&150>c&&e.push(CARRY);for(t=0;t<q;t++)e.push(MOVE);50<=c&&e.push(MOVE);q=_.filter(Game.spawns,function(b){return!b.spawning&&
!d.spawning[b.id]&&b.room.energyAvailable>=n.getBodypartCost(e)&&b.room.memory.region===a.memory.region}).sort(function(a,b){return(a.room.name===g?0:1)-(b.room.name===g?0:1)})[0];if(!q)return!1;b=q.createCreep(e,"collector-"+g+"-"+Game.time.toFixed(0).substring(4),{role:"collector",home:g,homeSource:b});q.room.name===g&&(d.spawning[q.id]="number"!==typeof b);return"number"!==typeof b};e.assignTasks=function(e,g){var c=e.name,p=_.filter(n.creepsWithNoTask(d.creeps[c]&&d.creeps[c].collector||[]),function(a){return 0<
_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),h=d.creeps[c]&&d.creeps[c].all||[],q=[];0!==p.length&&(_.forEach(g.upgradeController.criticalTasks,function(a){0===_.filter(h,function(b){return b.memory.currentTask&&"upgradeController"===b.memory.currentTask.type&&b.memory.currentTask.room===a.room}).length&&(_.forEach(n.objectsClosestToObj(p,e.controller),function(b){if(a.canAssign(b))return b.say("CritCntrlr"),q.push(b.name),!1}),_.remove(p,function(a){return-1!==q.indexOf(a.name)}),q=[])}),0!==
p.length&&(_.forEach(p,function(a){a.carry[RESOURCE_ENERGY]<(8===e.controller.level?200:7===e.controller.level?100:50)||_.forEach(g.fillEnergy.extensionTasks.sort(function(b,d){return b.object.pos.getRangeTo(a)-d.object.pos.getRangeTo(a)}),function(b){if(0<b.object.energyCapacity-b.object.energy-_.reduce(_.filter(h,function(a){return a.memory.currentTask&&"fillEnergy"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0)&&b.canAssign(a))return a.say("Extension"),
q.push(a.name),!1})}),_.remove(p,function(a){return-1!==q.indexOf(a.name)}),q=[],0!==p.length&&(_.forEach(g.fillEnergy.spawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(h,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(n.objectsClosestToObj(p,a.object),function(d){if(a.canAssign(d)&&(d.say("Spawn"),q.push(d.name),b-=d.carry[RESOURCE_ENERGY]||
0,0>=b))return!1}),_.remove(p,function(a){return-1!==q.indexOf(a.name)}),q=[])}),0!==p.length&&(_.forEach(g.fillEnergy.towerTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(h,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(n.objectsClosestToObj(p,a.object),function(d){if(a.canAssign(d)&&(d.say("Tower"),q.push(d.name),b-=d.carry[RESOURCE_ENERGY]||
0,0>=b))return!1}),_.remove(p,function(a){return-1!==q.indexOf(a.name)}),q=[])}),0!==p.length&&(_.forEach(g.repair.criticalTasks,function(a){_.forEach(n.objectsClosestToObj(p,a.structure),function(b){if(0===_.filter(d.creeps[a.structure.room.name]&&d.creeps[a.structure.room.name].all||[],function(b){return b.memory.currentTask&&"repair"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length&&a.canAssign(b))return b.say("CritRepair"),q.push(b.name),!1});_.remove(p,function(a){return-1!==
q.indexOf(a.name)});q=[]}),0!==p.length&&(_.forEach(g.build.tasks,function(a){var b=a.constructionSite.progressTotal-a.constructionSite.progress-_.reduce(_.filter(d.creeps[a.constructionSite.room.name]&&d.creeps[a.constructionSite.room.name].all||[],function(b){return b.memory.currentTask&&"build"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(n.objectsClosestToObj(p,a.constructionSite),function(d){if(a.canAssign(d)&&
(d.say("Build"),q.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(p,function(a){return-1!==q.indexOf(a.name)}),q=[])}),0!==p.length&&(_.forEach(g.repair.tasks,function(a){var b=a.structure.hitsMax-a.structure.hits-100*_.reduce(_.filter(d.creeps[a.structure.room.name]&&d.creeps[a.structure.room.name].all||[],function(b){return b.memory.currentTask&&"repair"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0),e=
!1;0<b&&(_.forEach(n.objectsClosestToObj(p,a.structure),function(d){if(a.canAssign(d)&&(d.say("Repair"),q.push(d.name),b-=100*(d.carry[RESOURCE_ENERGY]||0),e=!0,0>=b))return!1}),_.remove(p,function(a){return-1!==q.indexOf(a.name)}),q=[]);return e}),0!==p.length&&(_.forEach(g.upgradeController.tasks,function(a){_.forEach(n.objectsClosestToObj(p,e.controller),function(b){a.canAssign(b)&&(b.say("Controller"),q.push(b.name))});_.remove(p,function(a){return-1!==q.indexOf(a.name)});q=[]}),0!==p.length&&
(0===d.hostilesInRoom(e).length&&_.forEach(p,function(b){_.forEach(a.getCollectorTasks(b.room),function(a){if(!(0<_.filter(d.creeps[a.resource.room.name]&&d.creeps[a.resource.room.name].all||[],function(b){return b.memory.currentTask&&"pickupResource"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length)&&a.canAssign(b))return b.say("Pickup"),q.push(b.name),!1})}),_.remove(p,function(a){return-1!==q.indexOf(a.name)}),q=[],0!==p.length&&(_.forEach(g.collectEnergy.tasks,function(a){_.forEach(p,
function(b){a.canAssign(b)&&(b.say("Collecting"),q.push(b.name))});_.remove(p,function(a){return-1!==q.indexOf(a.name)});q=[]}),0!==p.length&&(_.forEach(p,function(a){(new f).canAssign(a)&&(a.say("Harvesting"),q.push(a.name))}),_.remove(p,function(a){return-1!==q.indexOf(a.name)}),q=[],0!==p.length&&_.forEach(b.getHarvesterTasks(p),function(a){a.canAssign(a.creep)}))))))))))))};Memory.profiling&&c(1,16).registerObject(e,"RoleCollector");m.exports=e;return m.exports};u[17]=function(m,k){var d=c(3,
17);c(4,17);var n=c(10,17),f=c(51,17),a=c(38,17),b=function(){};b.checkSpawn=function(a){var e=Memory.maxCreeps.converter,g=a.name,c=d.creeps[g]&&d.creeps[g].converter||[],f=0;e&&_.forEach(e[g],function(d,e){d=_.filter(c,function(a){return a.memory.attack===e}).length;f+=1;0===d&&b.spawn(a,e)});Memory.log&&(0<c.length||0<f)&&d.log.rooms[g]&&d.log.rooms[g].creeps.push({role:"converter",count:c.length,max:f})};b.spawn=function(a,b){var e=[],c=d.spawnsInRoom(a),f,h;if(0===_.filter(c,function(a){return!a.spawning&&
!d.spawning[a.id]}).length)return!1;f=Math.floor(Math.min(supportRoom.energyCapacityAvailable,24400)/3050);for(h=0;h<f;h++)e.push(CLAIM),e.push(CLAIM),e.push(CLAIM),e.push(CLAIM),e.push(CLAIM);for(h=0;h<f;h++)e.push(MOVE);c=_.filter(c,function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(e)})[0];if(!c)return!1;a=c.createCreep(e,"converter-"+b+"-"+Game.time.toFixed(0).substring(4),{role:"converter",home:a.name,attack:b});d.spawning[c.id]="number"!==typeof a;return"number"!==
typeof a};b.assignTasks=function(b,c){b=b.name;b=n.creepsWithNoTask(d.creeps[b]&&d.creeps[b].converter||[]);var e=[];0!==b.length&&(_.forEach(_.filter(b,function(a){return a.room.name!==a.memory.attack}),function(a){f.getClaimerTask(a).canAssign(a)&&e.push(a.name)}),_.remove(b,function(a){return-1!==e.indexOf(a.name)}),e=[],0!==b.length&&(_.forEach(b,function(b){a.getTask(b).canAssign(b)&&(b.say("Attacking"),e.push(b.name))}),_.remove(b,function(a){return-1!==e.indexOf(a.name)}),e=[],0!==b.length&&
_.forEach(b,function(a){a.suicide()})))};Memory.profiling&&c(1,17).registerObject(b,"RoleConverter");m.exports=b;return m.exports};u[18]=function(m,k){var d=c(3,18),n=c(10,18),f=c(51,18),a=c(48,18),b=function(){};b.checkQuadrant=function(a,b){switch(b){case 0:return 25>a.x&&25>a.y;case 1:return 25>a.x&&25<a.y;case 2:return 25<a.x&&25<a.y;case 3:return 25<a.x&&25>a.y}};b.checkSpawn=function(a){var e=a.name,g=d.creeps[e]&&d.creeps[e].defender||[],c=Game.rooms[Memory.rooms[e].roomType.supportRoom];1>
_.filter(g,function(a){return a.spawning||300<=a.ticksToLive}).length&&b.spawn(a,c);Memory.log&&d.log.rooms[e]&&d.log.rooms[e].creeps.push({role:"defender",count:g.length,max:1})};b.spawn=function(a,b){var e=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,HEAL,HEAL,HEAL,HEAL,HEAL],c=
a.name,f=b.name;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;a=_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(e)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===f?0:1)-(b.room.name===f?0:1)})[0];if(!a)return!1;c=a.createCreep(e,"defender-"+c+"-"+Game.time.toFixed(0).substring(4),{role:"defender",home:c,supportRoom:f});a.room.name===f&&(d.spawning[a.id]=
"number"!==typeof c);return"number"!==typeof c};b.assignTasks=function(b,c){var e=this;c=b.name;c=_.filter(n.creepsWithNoTask(d.creeps[c]&&d.creeps[c].defender||[]),function(a){return!a.spawning});var l,p;b&&!b.unobservable&&(l=d.hostilesInRoom(b),p=d.sourceKeepersInRoom(b));_.forEach(c,function(b){b.room.name!==b.memory.home?f.getDefenderTask(b).canAssign(b):(b.memory.quadrant||(b.memory.quadrant=0),_.forEach(_.filter(l,function(a){return e.checkQuadrant(a.pos,b.memory.quadrant)}),function(d){return!(new a(d.id)).canAssign(b)}),
b.memory.currentTask||(_.forEach(_.filter(p,function(a){return 200>a.ticksToSpawn&&e.checkQuadrant(a.pos,b.memory.quadrant)}),function(a){a=new f(a.id,b);a.range=1;return!a.canAssign(b)}),b.memory.currentTask||(b.memory.quadrant=(b.memory.quadrant+1)%4)))})};Memory.profiling&&c(1,18).registerObject(b,"RoleDefender");m.exports=b;return m.exports};u[19]=function(m,k){var d=c(3,19),n=c(10,19),f=c(39,19),a=c(50,19),b=c(51,19),e=c(53,19),r=function(){};r.checkSpawn=function(a,b){var e=a.name,c=d.creeps[e]&&
d.creeps[e].dismantler||[];b||(b=a);0===d.spawnsInRoom(b).length||a.unobservable||(0===_.filter(c,function(a){return a.spawning||150<=a.ticksToLive}).length&&r.spawn(a,b),Memory.log&&d.log.rooms[e]&&d.log.rooms[e].creeps.push({role:"dismantler",count:c.length,max:1}))};r.spawn=function(a,b){var e=[];a=a.name;var c=b.name,g,t,f;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;g=Math.min(b.energyCapacityAvailable,3300);t=Math.floor(g/200);g%=200;for(f=0;f<
t;f++)e.push(WORK);150<=g&&e.push(WORK);for(f=0;f<t;f++)e.push(CARRY);100<=g&&150>g&&e.push(CARRY);for(f=0;f<t;f++)e.push(MOVE);50<=g&&e.push(MOVE);t=_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(e)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!t)return!1;a=t.createCreep(e,"dismantler-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"dismantler",home:a,supportRoom:c});
t.room.name===c&&(d.spawning[t.id]="number"!==typeof a);return"number"!==typeof a};r.assignTasks=function(c,l){var g=c.name,h=_.filter(n.creepsWithNoTask(d.creeps[g]&&d.creeps[g].dismantler||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),q=[];0!==h.length&&(_.forEach(_.filter(h,function(a){return a.room.name!==g}),function(a){_.forEach(e.getCriticalTasks(a.room),function(b){if(0===_.filter(d.creeps[b.structure.room.name]&&d.creeps[b.structure.room.name].all||[],function(a){return a.memory.currentTask&&
"repair"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length&&b.canAssign(a))return a.say("CritRepair"),q.push(a.name),!1})}),_.remove(h,function(a){return-1!==q.indexOf(a.name)}),q=[],0!==h.length&&(_.forEach(h,function(a){var b=a.room.find(FIND_MY_CONSTRUCTION_SITES);0<b.length&&(new f(b[0].id)).canAssign(a)&&(a.say("Build"),q.push(a.name))}),_.remove(h,function(a){return-1!==q.indexOf(a.name)}),q=[],0!==h.length&&(_.forEach([].concat.apply([],[l.fillEnergy.storageTasks,l.fillEnergy.containerTasks]),
function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&-1!==["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(n.objectsClosestToObj(h,a.object),function(d){if(a.canAssign(d)&&(d.say("Container"),q.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(h,function(a){return-1!==
q.indexOf(a.name)}),q=[])}),0!==h.length&&(_.forEach(l.fillMinerals.storageTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Storage"),q.push(b.name))});_.remove(h,function(a){return-1!==q.indexOf(a.name)});q=[]}),0!==h.length&&(_.forEach(l.fillMinerals.terminalTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Terminal"),q.push(b.name))});_.remove(h,function(a){return-1!==q.indexOf(a.name)});q=[]}),0!==h.length&&(_.forEach(_.filter(h,function(a){return a.room.name===
g}),function(a){_.forEach(l.dismantle.tasks,function(b){if(!(0<_.filter(b.structure.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"dismantle"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Dismantle"),q.push(a.name),!1})}),_.remove(h,function(a){return-1!==q.indexOf(a.name)}),q=[],0!==h.length&&(_.forEach(h,function(b){_.forEach(a.getTasks(b.room),function(a){if(!(0<_.filter(a.resource.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&
"pickupResource"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length)&&a.canAssign(b))return b.say("Pickup"),q.push(b.name),!1})}),_.remove(h,function(a){return-1!==q.indexOf(a.name)}),q=[],0!==h.length&&_.forEach(h,function(a){(new b(a.memory.home)).canAssign(a)}))))))))};Memory.profiling&&c(1,19).registerObject(r,"RoleDismantler");m.exports=r;return m.exports};u[20]=function(m,k){var d=c(3,20),n=c(10,20),f=c(47,20),a=c(51,20),b=function(){};b.checkSpawn=function(a){var e=a.name,
c=d.creeps[e]&&d.creeps[e].healer||[],f=Game.rooms[Memory.rooms[e].roomType.supportRoom];1>_.filter(c,function(a){return a.spawning||300<=a.ticksToLive}).length&&b.spawn(a,f);Memory.log&&d.log.rooms[e]&&d.log.rooms[e].creeps.push({role:"healer",count:c.length,max:1})};b.spawn=function(a,b){var e=[];a=a.name;var c=b.name,f,h;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;f=Math.floor(Math.min(b.energyCapacityAvailable,7500)/300);for(h=0;h<f;h++)e.push(MOVE);
for(h=0;h<f;h++)e.push(HEAL);f=_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(e)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!f)return!1;a=f.createCreep(e,"healer-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"healer",home:a,supportRoom:c});f.room.name===c&&(d.spawning[f.id]="number"!==typeof a);return"number"!==typeof a};b.assignTasks=function(b,c){b=b.name;
b=_.filter(n.creepsWithNoTask(d.creeps[b]&&d.creeps[b].healer||[]),function(a){return!a.spawning});var e=[];0!==b.length&&(_.forEach(_.filter(b,function(a){return a.room.name!==a.memory.home}),function(b){a.getDefenderTask(b).canAssign(b)&&e.push(b.name)}),_.remove(b,function(a){return-1!==e.indexOf(a.name)}),e=[],0!==b.length&&(_.forEach(b,function(a){var b=f.getDefenderTask(a);b&&b.canAssign(a)&&(a.say("Heal"),e.push(a.name))}),_.remove(b,function(a){return-1!==e.indexOf(a.name)}),e=[],0!==b.length&&
_.forEach(_.filter(b,function(a){return a.room.name===a.memory.home}),function(b){var d=a.getDefenderTask(b);d.range=1;d.canAssign(b)&&e.push(b.name)})))};Memory.profiling&&c(1,20).registerObject(b,"RoleHealer");m.exports=b;return m.exports};u[21]=function(m,k){var d=c(3,21),n=c(10,21),f=c(49,21),a=c(51,21),b=function(){};b.checkSpawn=function(a){var e=a.name,c=d.containersInRoom(a),f=0,p;0!==d.spawnsInRoom(a).length&&0!==c.length&&(p=d.creeps[e]&&d.creeps[e].miner||[],_.forEach(c,function(d){var e=
d.id;Memory.containerSource[e]||(Memory.containerSource[e]=n.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),d)[0].id);d=Game.getObjectById(Memory.containerSource[e]);d instanceof Mineral&&0===d.mineralAmount||(f+=1,0===_.filter(p,function(a){return(a.spawning||150<=a.ticksToLive)&&a.memory.container===e}).length&&b.spawn(a,e))}),Memory.log&&(0<p.length||0<f)&&d.log.rooms[e]&&d.log.rooms[e].creeps.push({role:"miner",count:p.length,max:f}))};b.spawn=function(a,
b){var e=d.spawnsInRoom(a),c=[MOVE,WORK,WORK,WORK,WORK,WORK],f=a.name,h,q;if(0===_.filter(e,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;h=Math.min(a.energyCapacityAvailable,4500);q=Math.floor(h/450);h%=450;if(n.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),Game.getObjectById(b))[0]instanceof Mineral){c=[];for(a=0;a<q;a++)c.push(MOVE);50<=h&&c.push(MOVE);for(a=0;a<q;a++)c.push(WORK),c.push(WORK),c.push(WORK),c.push(WORK);150<=h&&c.push(WORK);
250<=h&&c.push(WORK);350<=h&&c.push(WORK)}e=_.filter(e,function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(c)})[0];if(!e)return!1;b=e.createCreep(c,"miner-"+f+"-"+Game.time.toFixed(0).substring(4),{role:"miner",home:f,container:b});d.spawning[e.id]="number"!==typeof b;return"number"!==typeof b};b.assignTasks=function(b,c){b=b.name;b=n.creepsWithNoTask(d.creeps[b]&&d.creeps[b].miner||[]);var e=[];0!==b.length&&(_.forEach(_.filter(b,function(a){return a.memory.labs&&
0<a.memory.labs.length}),function(b){(new a(b.memory.labs[0])).canAssign(b);e.push(b.name)}),_.remove(b,function(a){return-1!==e.indexOf(a.name)}),e=[],0!==b.length&&_.forEach(b,function(a){(new f).canAssign(a)&&a.say("Mining")}))};Memory.profiling&&c(1,21).registerObject(b,"RoleMiner");m.exports=b;return m.exports};u[22]=function(m,k){var d=c(3,22),n=c(10,22),f=c(39,22),a=c(46,22),b=c(50,22),e=c(51,22),r=c(53,22),g=function(){};g.checkSpawn=function(a){var b=a.name,e=Game.rooms[Memory.rooms[b].roomType.supportRoom],
c;0!==d.spawnsInRoom(e).length&&(2>(c=(d.creeps[b]&&d.creeps[b].remoteBuilder||[]).length)&&g.spawn(a,e),Memory.log&&d.log.rooms[b]&&d.log.rooms[b].creeps.push({role:"remoteBuilder",count:c,max:2}))};g.spawn=function(a,b){var e=[];a=a.name;var c=b.name,g,f,v;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;g=Math.min(b.energyCapacityAvailable,3300);f=Math.floor(g/200);g%=200;for(v=0;v<f;v++)e.push(WORK);150<=g&&e.push(WORK);for(v=0;v<f;v++)e.push(CARRY);
100<=g&&150>g&&e.push(CARRY);for(v=0;v<f;v++)e.push(MOVE);50<=g&&e.push(MOVE);f=_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(e)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!f)return!1;a=f.createCreep(e,"remoteBuilder-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"remoteBuilder",home:a,supportRoom:c});f.room.name===c&&(d.spawning[f.id]="number"!==typeof a);
return"number"!==typeof a};g.assignTasks=function(c){var g=c.name,g=_.filter(n.creepsWithNoTask(d.creeps[g]&&d.creeps[g].remoteBuilder||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),h=[];if(0!==g.length&&(_.forEach(_.filter(g,function(a){return a.room.name===c.name}),function(a){0<c.find(FIND_HOSTILE_CONSTRUCTION_SITES).length&&((new e(c.find(FIND_HOSTILE_CONSTRUCTION_SITES)[0].id)).canAssign(a),a.say("Stomping"),h.push(a.name))}),_.remove(g,function(a){return-1!==h.indexOf(a.name)}),
h=[],0!==g.length&&(_.forEach(g,function(a){_.forEach(r.getCriticalTasks(a.room),function(b){if(0===_.filter(b.structure.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"repair"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length&&b.canAssign(a))return a.say("CritRepair"),h.push(a.name),!1})}),_.remove(g,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==g.length))){if(!c.unobservable&&(_.forEach(g,function(a){var b=c.find(FIND_MY_CONSTRUCTION_SITES);0<b.length&&
(new f(n.objectsClosestToObj(b,a)[0].id)).canAssign(a)&&(a.say("Build"),h.push(a.name))}),_.remove(g,function(a){return-1!==h.indexOf(a.name)}),h=[],0===g.length))return;_.forEach(g,function(a){a.room.name===a.memory.home&&_.forEach(b.getTasks(a.room),function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Pickup"),h.push(a.name),!1})});
_.remove(g,function(a){return-1!==h.indexOf(a.name)});h=[];0!==g.length&&(c.unobservable||_.forEach(g,function(b){var d=new a,e=n.objectsClosestToObj(_.filter(c.find(FIND_SOURCES),function(a){return 0<a.energy}),b);if(0===e.length)return!1;b.memory.homeSource=e[0].id;d.canAssign(b)&&(b.say("Harvesting"),h.push(b.name))}),_.remove(g,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==g.length&&_.forEach(g,function(a){(new e(a.memory.home)).canAssign(a)}))}};Memory.profiling&&c(1,22).registerObject(g,
"RoleRemoteBuilder");m.exports=g;return m.exports};u[23]=function(m,k){var d=c(3,23),n=c(10,23),f=c(50,23),a=c(51,23),b=function(){};b.checkSpawn=function(a,c,g){var e=a.name,f=d.creeps[e],f=f&&f.remoteCollector||[];c||(c=a);g||(g=a.memory.roomType&&"cleanup"===a.memory.roomType.type?c.controller?c.controller.level:3:1);0!==d.spawnsInRoom(c).length&&(_.filter(f,function(a){return a.spawning||300<=a.ticksToLive}).length<g&&b.spawn(a,c),Memory.log&&(0<f.length||0<g)&&d.log.rooms[e]&&d.log.rooms[e].creeps.push({role:"remoteCollector",
count:f.length,max:g}))};b.spawn=function(a,b){var e=[];a=a.name;var c=b.name,f,h;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;f=Math.floor(Math.min(b.energyCapacityAvailable,2400)/150);for(h=0;h<f;h++)e.push(CARRY),e.push(CARRY);for(h=0;h<f;h++)e.push(MOVE);f=_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(e)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===
c?0:1)-(b.room.name===c?0:1)})[0];if(!f)return!1;a=f.createCreep(e,"remoteCollector-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"remoteCollector",home:a,supportRoom:c});f.room.name===c&&(d.spawning[f.id]="number"!==typeof a);return"number"!==typeof a};b.assignTasks=function(b,c){var e=b.name,l=d.creeps[e],p=n.creepsWithNoTask(l&&l.remoteCollector||[]),h=[];0!==p.length&&(_.forEach(p,function(a){_.forEach(f.getTasks(a.room),function(b){if(!(_.sum(l&&l.all||[],function(a){return a.memory.currentTask&&
a.memory.currentTask.id===b.idG?a.carryCapacity-_.sum(a.carry):0})>=b.resource.amount)&&b.canAssign(a))return a.say("Pickup"),h.push(a.name),!1})}),_.remove(p,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==p.length&&(c.collectMinerals&&c.collectMinerals.cleanupTasks&&_.forEach(c.collectMinerals.cleanupTasks,function(a){_.forEach(p,function(b){a.canAssign(b)&&(b.say("Collecting"),h.push(b.name))});_.remove(p,function(a){return-1!==h.indexOf(a.name)});h=[]}),c.collectEnergy&&c.collectEnergy.cleanupTasks&&
_.forEach(c.collectEnergy.cleanupTasks,function(a){_.forEach(_.filter(p,function(a){return a.room.name===e}),function(b){a.canAssign(b)&&(b.say("Collecting"),h.push(b.name))});_.remove(p,function(a){return-1!==h.indexOf(a.name)});h=[]}),_.forEach(c.fillEnergy.storageTasks,function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===
a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(n.objectsClosestToObj(p,a.object),function(d){if(a.canAssign(d)&&(d.say("Storage"),h.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(p,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==p.length&&(_.forEach(c.fillMinerals.storageTasks,function(a){_.forEach(p,function(b){a.canAssign(b)&&(b.say("Storage"),h.push(b.name))});_.remove(p,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==p.length&&(_.forEach(c.fillMinerals.terminalTasks,
function(a){_.forEach(p,function(b){a.canAssign(b)&&(b.say("Terminal"),h.push(b.name))});_.remove(p,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==p.length&&(_.forEach(c.fillEnergy.containerTasks,function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);
0<b&&(_.forEach(n.objectsClosestToObj(p,a.object),function(d){if(a.canAssign(d)&&(d.say("Container"),h.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(p,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==p.length&&_.forEach(p,function(b){(0<_.sum(b.carry)?new a(b.memory.supportRoom):new a(b.memory.home)).canAssign(b)}))))))};Memory.profiling&&c(1,23).registerObject(b,"RoleRemoteCollector");m.exports=b;return m.exports};u[24]=function(m,k){var d=c(3,24),n=c(10,24);c(39,24);c(50,24);var f=
c(51,24),a=function(){};a.checkSpawn=function(b,e,c){var g=b.name,f=d.creeps[g]&&d.creeps[g].remoteDismantler||[];e||(e=b);0!==d.spawnsInRoom(e).length&&(_.filter(f,function(a){return a.spawning||300<=a.ticksToLive}).length<c&&a.spawn(b,e),Memory.log&&(0<f.length||0<c)&&d.log.rooms[g]&&d.log.rooms[g].creeps.push({role:"remoteDismantler",count:f.length,max:c}))};a.spawn=function(a,e){var b=[];a=a.name;var c=e.name,f,p;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;
f=Math.floor(Math.min(e.energyCapacityAvailable,3750)/150);for(p=0;p<f;p++)b.push(WORK);for(p=0;p<f;p++)b.push(MOVE);f=_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(b)&&a.room.memory.region===e.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!f)return!1;a=f.createCreep(b,"remoteDismantler-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"remoteDismantler",home:a,supportRoom:c});f.room.name===
c&&(d.spawning[f.id]="number"!==typeof a);return"number"!==typeof a};a.assignTasks=function(a,e){var b=a.name,c=_.filter(n.creepsWithNoTask(d.creeps[b]&&d.creeps[b].remoteDismantler||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),l=[];0!==c.length&&(_.forEach(_.filter(c,function(a){return a.room.name===b}),function(b){0<a.find(FIND_HOSTILE_CONSTRUCTION_SITES).length&&((new f(a.find(FIND_HOSTILE_CONSTRUCTION_SITES)[0].id)).canAssign(b),b.say("Stomping"),l.push(b.name))}),
_.remove(c,function(a){return-1!==l.indexOf(a.name)}),l=[],0!==c.length&&(_.forEach(_.filter(c,function(a){return a.room.name===b}),function(a){_.forEach(e.remoteDismantle.cleanupTasks,function(b){if(!(0<_.filter(b.structure.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"dismantle"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Dismantle"),l.push(a.name),!1})}),_.remove(c,function(a){return-1!==l.indexOf(a.name)}),l=[],0!==
c.length&&_.forEach(c,function(a){(new f(a.memory.home)).canAssign(a)})))};Memory.profiling&&c(1,24).registerObject(a,"RoleRemoteDismantler");m.exports=a;return m.exports};u[25]=function(m,k){var d=c(3,25),n=c(10,25),f=c(49,25),a=c(51,25),b=function(){};b.checkSpawn=function(a){var e=a.name,c=Game.rooms[Memory.rooms[e].roomType.supportRoom],f=c.name,p=d.creeps[e]&&d.creeps[e].remoteMiner||[],h=d.containersInRoom(a),q=0;0===d.spawnsInRoom(c).length||a.unobservable||0===h.length||(Memory.lengthToContainer||
(Memory.lengthToContainer={}),_.forEach(h,function(e){var g=e.id;Memory.lengthToContainer[g]||(Memory.lengthToContainer[g]={});Memory.lengthToContainer[g][f]||(Memory.lengthToContainer[g][f]=PathFinder.search(e.pos,{pos:d.spawnsInRoom(c)[0].pos,range:1},{swampCost:1,maxOps:1E5}).path.length);Memory.containerSource[g]||(Memory.containerSource[g]=n.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),e)[0].id);e=Game.getObjectById(Memory.containerSource[g]);e instanceof
Mineral&&(0===e.mineralAmount||a.controller&&(!a.controller.my||6>a.controller.level))||(q+=1,0===_.filter(p,function(a){return(a.spawning||a.ticksToLive>=150+3*Memory.lengthToContainer[g][f])&&a.memory.container===g}).length&&b.spawn(a,c,g))}),Memory.log&&(0<p.length||0<q)&&d.log.rooms[e]&&d.log.rooms[e].creeps.push({role:"remoteMiner",count:p.length,max:q}))};b.spawn=function(a,b,c){var e=a.memory&&a.memory.roomType&&"source"===a.memory.roomType.type||/^[EW][1-9][0-9]*5[NS][1-9][0-9]*5$/.test(a.name)?
[MOVE,MOVE,MOVE,MOVE,WORK,WORK,WORK,WORK,WORK,WORK,WORK]:[MOVE,MOVE,MOVE,WORK,WORK,WORK,WORK,WORK],g=a.name,f=b.name,q,t;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;if(n.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),Game.getObjectById(c))[0]instanceof Mineral){e=[];q=Math.min(b.energyCapacityAvailable,4500);a=Math.floor(q/450);q%=450;for(t=0;t<a;t++)e.push(MOVE);50<=q&&e.push(MOVE);for(t=0;t<a;t++)e.push(WORK),
e.push(WORK),e.push(WORK),e.push(WORK);150<=q&&e.push(WORK);250<=q&&e.push(WORK);350<=q&&e.push(WORK)}a=_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(e)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===f?0:1)-(b.room.name===f?0:1)})[0];if(!a)return!1;c=a.createCreep(e,"remoteMiner-"+g+"-"+Game.time.toFixed(0).substring(4),{role:"remoteMiner",home:g,supportRoom:f,container:c});a.room.name===f&&(d.spawning[a.id]=
"number"!==typeof c);return"number"!==typeof c};b.assignTasks=function(b,c){c=b.name;c=n.creepsWithNoTask(d.creeps[c]&&d.creeps[c].remoteMiner||[]);var e=[];0!==c.length&&(b.unobservable||_.forEach(c,function(a){(new f).canAssign(a)&&(a.say("Mining"),e.push(a.name))}),_.remove(c,function(a){return-1!==e.indexOf(a.name)}),e=[],0!==c.length&&_.forEach(c,function(b){(new a(b.memory.home)).canAssign(b)}))};Memory.profiling&&c(1,25).registerObject(b,"RoleRemoteMiner");m.exports=b;return m.exports};u[26]=
function(m,k){var d=c(3,26),n=c(4,26),f=c(10,26),a=c(51,26),b=c(54,26),e=function(){};e.checkSpawn=function(a){var b=Game.rooms[Memory.rooms[a.name].roomType.supportRoom],c=b.name,f=d.spawnsInRoom(b),h=a.controller,q=a.name,t=d.creeps[q]&&d.creeps[q].remoteReserver||[],y=0,v=0,r,x;if(0!==f.length&&!a.unobservable&&h){r=h.id;x=h.reservation;Memory.lengthToController||(Memory.lengthToController={});Memory.lengthToController[r]||(Memory.lengthToController[r]={});Memory.lengthToController[r][c]||(Memory.lengthToController[r][c]=
PathFinder.search(h.pos,{pos:f[0].pos,range:1},{swampCost:1,maxOps:1E5}).path.length);y=_.filter(t,function(a){return a.spawning||a.ticksToLive>Memory.lengthToController[r][c]}).length;if(!x||4E3>x.ticksToEnd)v+=1;y<v&&e.spawn(a,b);Memory.log&&(0<t.length||0<v)&&d.log.rooms[q]&&d.log.rooms[q].creeps.push({role:"remoteReserver",count:t.length,max:v})}};e.spawn=function(a,b){var e=[];a=a.name;var c=b.name,g,q;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;
g=Math.floor(Math.min(b.energyCapacityAvailable,3250)/650);for(q=0;q<g;q++)e.push(CLAIM);for(q=0;q<g;q++)e.push(MOVE);g=_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=f.getBodypartCost(e)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!g)return!1;a=g.createCreep(e,"remoteReserver-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"remoteReserver",home:a,supportRoom:c});g.room.name===
c&&(d.spawning[g.id]="number"!==typeof a);return"number"!==typeof a};e.assignTasks=function(e,c){c=e.name;c=f.creepsWithNoTask(d.creeps[c]&&d.creeps[c].remoteReserver||[]);var g=[];0!==c.length&&(e.unobservable||_.forEach(c,function(a){a.room.name===a.memory.home&&a.room.controller.my&&(g.push(a.name),n.setRoomType(a.room,{type:"base"}),a.suicide())}),_.remove(c,function(a){return-1!==g.indexOf(a.name)}),g=[],0!==c.length&&(e&&!e.unobservable&&e.controller&&_.forEach(c,function(a){b.getRemoteTask(a).canAssign(a)&&
(a.say("Reserving"),g.push(a.name))}),_.remove(c,function(a){return-1!==g.indexOf(a.name)}),g=[],0!==c.length&&_.forEach(c,function(b){(new a(b.memory.home)).canAssign(b)})))};Memory.profiling&&c(1,26).registerObject(e,"RoleRemoteReserver");m.exports=e;return m.exports};u[27]=function(m,k){var d=c(3,27),n=c(10,27),f=c(41,27),a=c(42,27),b=c(50,27),e=c(51,27),r=function(){};r.checkSpawn=function(a){var b=Game.rooms[Memory.rooms[a.name].roomType.supportRoom],e=d.containersInRoom(a),c=a.name,f=d.creeps[c]&&
d.creeps[c].remoteStorer||[],g=0,y=!1;0===d.spawnsInRoom(b).length||a.unobservable||0===e.length||(_.forEach(e,function(d){var e=0,c=d.id,h;Memory.containerSource[c]||(Memory.containerSource[c]=n.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),d)[0].id);d=Game.getObjectById(Memory.containerSource[c]);if(d instanceof Mineral){if(0===d.mineralAmount)return}else e=y?0:-1,y=!0;h=Memory.lengthToContainer[c][b.name];e+=Math.max(Math.ceil(h/[18,18,18,18,30,44,54,62,62][b.controller.level]),
0);g+=e;_.filter(f,function(a){return(a.spawning||a.ticksToLive>=150+2*h)&&a.memory.container===c}).length<e&&r.spawn(a,b,c)}),Memory.log&&(0<f.length||0<g)&&d.log.rooms[c]&&d.log.rooms[c].creeps.push({role:"remoteStorer",count:f.length,max:g}))};r.spawn=function(a,b,e){var c=a.name,f=b.name,g=[];if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;switch(b.controller.level){case 3:g=[MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,
CARRY,CARRY];break;case 4:g=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 5:g=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 6:g=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,
CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 7:case 8:g=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY]}a=_.filter(Game.spawns,function(a){return!a.spawning&&
!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(g)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===f?0:1)-(b.room.name===f?0:1)})[0];if(!a)return!1;e=a.createCreep(g,"remoteStorer-"+c+"-"+Game.time.toFixed(0).substring(4),{role:"remoteStorer",home:c,supportRoom:f,container:e});a.room.name===f&&(d.spawning[a.id]="number"!==typeof e);return"number"!==typeof e};r.assignTasks=function(c,l){var g=c.name,h=n.creepsWithNoTask(d.creeps[g]&&d.creeps[g].remoteStorer||
[]),q=[];0!==h.length&&(_.forEach(h,function(a){_.forEach(b.getTasks(a.room),function(b){if(!(_.sum(d.creeps[c.name]&&d.creeps[c.name].all||[],function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id?a.carryCapacity-_.sum(a.carry):0})>=b.resource.amount)&&b.canAssign(a))return a.say("Pickup"),q.push(a.name),!1})}),_.remove(h,function(a){return-1!==q.indexOf(a.name)}),q=[],0!==h.length&&(_.forEach(l.fillEnergy.storageTasks,function(a){var b=
a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(h,function(d){if(a.canAssign(d)&&(d.say("Storage"),q.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(h,function(a){return-1!==q.indexOf(a.name)}),q=[])}),0!==h.length&&(_.forEach(l.fillMinerals.storageTasks,
function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Storage"),q.push(b.name))});_.remove(h,function(a){return-1!==q.indexOf(a.name)});q=[]}),0!==h.length&&(_.forEach(l.fillMinerals.terminalTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Terminal"),q.push(b.name))});_.remove(h,function(a){return-1!==q.indexOf(a.name)});q=[]}),0!==h.length&&(_.forEach(l.fillEnergy.containerTasks,function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),
function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(h,function(d){if(a.canAssign(d)&&(d.say("Container"),q.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(h,function(a){return-1!==q.indexOf(a.name)}),q=[])}),0!==h.length&&(c.unobservable||_.forEach(h,function(b){var d=Game.getObjectById(b.memory.container),e;d&&(d.store[RESOURCE_ENERGY]?e=new f(b.memory.container):
0<_.sum(d.store)&&(e=new a(b.memory.container)),e&&e.canAssign(b)&&(b.say("Collecting"),q.push(b.name)))}),_.remove(h,function(a){return-1!==q.indexOf(a.name)}),q=[],0!==h.length&&_.forEach(h,function(a){(0<_.sum(a.carry)?new e(a.memory.supportRoom):new e(a.memory.home)).canAssign(a)})))))))};Memory.profiling&&c(1,27).registerObject(r,"RoleRemoteStorer");m.exports=r;return m.exports};u[28]=function(m,k){var d=c(3,28),n=c(10,28),f=c(39,28),a=c(41,28),b=c(46,28),e=c(50,28),r=c(51,28),g=c(53,28),l=function(){};
l.checkSpawn=function(a){var b=a.name,e=Game.rooms[Memory.rooms[b].roomType.supportRoom],c=e.name,f=d.containersInRoom(a),g=d.creeps[b]&&d.creeps[b].remoteWorker||[],p=0;0===d.spawnsInRoom(e).length||a.unobservable||0===f.length||(_.forEach(f,function(b){var d=n.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),b)[0],f=b.id;if(!(d instanceof Mineral))return p+=1,0===_.filter(g,function(a){return(a.spawning||a.ticksToLive>=150+2*(Memory.lengthToContainer&&Memory.lengthToContainer[f]&&
Memory.lengthToContainer[f][c]?Memory.lengthToContainer[f][c]:0))&&a.memory.container===f}).length&&l.spawn(a,e,f),!1}),Memory.log&&(0<g.length||0<p)&&d.log.rooms[b]&&d.log.rooms[b].creeps.push({role:"remoteWorker",count:g.length,max:p}))};l.spawn=function(a,b,e){var c=[];a=a.name;var f=b.name,g,h,q,l,p,r;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;g=Math.min(b.energyCapacityAvailable,3E3);h=Math.floor(g/200);q=Math.floor((g-2E3)/150);l=g%200;p=(g-
2E3)%150;for(r=0;r<h&&10>r;r++)c.push(WORK);2E3>g&&150<=l&&c.push(WORK);for(r=0;r<h&&10>r;r++)c.push(CARRY);for(r=0;r<q;r++)c.push(CARRY),c.push(CARRY);2E3>g&&100<=l&&150>l&&c.push(CARRY);2E3<g&&100<=p&&c.push(CARRY);for(r=0;r<h&&10>r;r++)c.push(MOVE);for(r=0;r<q;r++)c.push(MOVE);2E3>g&&50<=l&&c.push(MOVE);2E3<g&&50<=p&&c.push(MOVE);g=_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(c)&&a.room.memory.region===b.memory.region}).sort(function(a,
b){return(a.room.name===f?0:1)-(b.room.name===f?0:1)})[0];if(!g)return!1;e=g.createCreep(c,"remoteWorker-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"remoteWorker",home:a,supportRoom:f,container:e});g.room.name===f&&(d.spawning[g.id]="number"!==typeof e);return"number"!==typeof e};l.assignTasks=function(c,h){var q=c.name,t=_.filter(n.creepsWithNoTask(d.creeps[q]&&d.creeps[q].remoteWorker||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),l=[];0!==t.length&&(_.forEach(t,
function(a){var b=_.filter(a.room.find(FIND_MY_CONSTRUCTION_SITES),function(a){return 1===a.progressTotal});0<b.length&&(new f(b[0].id)).canAssign(a)&&(a.say("Build"),l.push(a.name))}),_.remove(t,function(a){return-1!==l.indexOf(a.name)}),l=[],0!==t.length&&(_.forEach(t,function(a){_.forEach(g.getCriticalTasks(a.room),function(b){if(0===_.filter(b.structure.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"repair"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length&&
b.canAssign(a))return a.say("CritRepair"),l.push(a.name),!1})}),_.remove(t,function(a){return-1!==l.indexOf(a.name)}),l=[],0!==t.length&&(_.forEach(t,function(a){var b=a.room.find(FIND_MY_CONSTRUCTION_SITES);0<b.length&&(new f(b[0].id)).canAssign(a)&&(a.say("Build"),l.push(a.name))}),_.remove(t,function(a){return-1!==l.indexOf(a.name)}),l=[],0!==t.length&&(_.forEach([].concat.apply([],[h.fillEnergy.storageTasks,h.fillEnergy.containerTasks]),function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-
_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(n.objectsClosestToObj(t,a.object),function(d){if(a.canAssign(d)&&(d.say("Container"),l.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(t,function(a){return-1!==l.indexOf(a.name)}),l=[])}),0!==t.length&&(_.forEach(h.fillMinerals.storageTasks,
function(a){_.forEach(t,function(b){a.canAssign(b)&&(b.say("Storage"),l.push(b.name))});_.remove(t,function(a){return-1!==l.indexOf(a.name)});l=[]}),0!==t.length&&(_.forEach(h.fillMinerals.terminalTasks,function(a){_.forEach(t,function(b){a.canAssign(b)&&(b.say("Terminal"),l.push(b.name))});_.remove(t,function(a){return-1!==l.indexOf(a.name)});l=[]}),0!==t.length&&(_.forEach(t,function(a){a.room.name===c.name&&_.forEach(e.getTasks(a.room),function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),
function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Pickup"),l.push(a.name),!1})}),_.remove(t,function(a){return-1!==l.indexOf(a.name)}),l=[],0!==t.length&&(c.unobservable||_.forEach(t,function(b){(new a(b.memory.container)).canAssign(b)&&(b.say("Collecting"),l.push(b.name))}),_.remove(t,function(a){return-1!==l.indexOf(a.name)}),l=[],0!==t.length&&(c.unobservable||_.forEach(t,function(a){var d=
new b,e=n.objectsClosestToObj(_.filter(c.find(FIND_SOURCES),function(a){return 0<a.energy}),a);if(0===e.length)return!1;a.memory.homeSource=e[0].id;d.canAssign(a)&&(a.say("Harvesting"),l.push(a.name))}),_.remove(t,function(a){return-1!==l.indexOf(a.name)}),l=[],0!==t.length&&_.forEach(t,function(a){(new r(a.memory.home)).canAssign(a)}))))))))))};Memory.profiling&&c(1,28).registerObject(l,"RoleRemoteWorker");m.exports=l;return m.exports};u[29]=function(m,k){var d=c(3,29),n=c(10,29),f=c(50,29),a=c(51,
29),b=function(){};b.checkSpawn=function(a){var e=a.controller,c=a.name,f=d.creeps[c]&&d.creeps[c].scientist||[];!e||6>e.level||(1>_.filter(f,function(a){return a.spawning||150<=a.ticksToLive}).length&&b.spawn(a),Memory.log&&d.log.rooms[c]&&d.log.rooms[a.name].creeps.push({role:"scientist",count:f.length,max:1}))};b.spawn=function(a){var b=d.spawnsInRoom(a),e=[],c=a.name,f,h,q;if(0===_.filter(b,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;f=Math.min(a.energyCapacityAvailable,
2500);h=Math.floor(f/150);f%=150;for(q=0;q<h;q++)e.push(CARRY),e.push(CARRY);100<=f&&e.push(CARRY);for(q=0;q<h;q++)e.push(MOVE);50<=f&&e.push(MOVE);h=_.filter(b,function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(e)})[0];if(!h)return!1;a=h.createCreep(e,"scientist-"+c+"-"+Game.time.toFixed(0).substring(4),{role:"scientist",home:c,homeSource:n.objectsClosestToObj(a.find(FIND_SOURCES),b[0])[0].id});d.spawning[h.id]="number"!==typeof a;return"number"!==typeof a};
b.assignTasks=function(b,c){var e=b.name,l=_.filter(n.creepsWithNoTask(d.creeps[e]&&d.creeps[e].scientist||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),p=d.creeps[e]&&d.creeps[e].all||[],h=[];0!==l.length&&(_.forEach(c.fillEnergy.towerTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(p,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||
0)},0);0<b&&(_.forEach(n.objectsClosestToObj(l,a.object),function(d){if(a.canAssign(d)&&(d.say("Tower"),h.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(l,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==l.length&&(_.forEach(c.collectMinerals.labTasks,function(a){_.forEach(l,function(b){a.canAssign(b)&&(b.say("Collecting"),h.push(b.name))});_.remove(l,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==l.length&&(_.forEach(c.fillMinerals.labTasks,function(a){_.forEach(l,
function(b){a.canAssign(b)&&(b.say("Lab"),h.push(b.name))});_.remove(l,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==l.length&&(_.forEach(c.fillMinerals.nukerTasks,function(a){_.forEach(l,function(b){a.canAssign(b)&&(b.say("NukeG"),h.push(b.name))});_.remove(l,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==l.length&&(_.forEach(c.fillMinerals.powerSpawnTasks,function(a){_.forEach(l,function(b){a.canAssign(b)&&(b.say("powerPower"),h.push(b.name))});_.remove(l,function(a){return-1!==h.indexOf(a.name)});
h=[]}),0!==l.length&&(_.forEach(c.fillMinerals.storageTasks,function(a){_.forEach(l,function(b){a.canAssign(b)&&(b.say("Storage"),h.push(b.name))});_.remove(l,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==l.length&&(_.forEach(c.fillMinerals.terminalTasks,function(a){_.forEach(l,function(b){a.canAssign(b)&&(b.say("Terminal"),h.push(b.name))});_.remove(l,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==l.length&&(_.forEach(c.fillEnergy.labTasks,function(a){var b=a.object.energyCapacity-
a.object.energy-_.reduce(_.filter(p,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(n.objectsClosestToObj(l,a.object),function(d){if(a.canAssign(d)&&(d.say("LabEnergy"),h.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(l,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==l.length&&(c.fillEnergy.terminalTask&&(_.forEach(l,function(a){c.fillEnergy.terminalTask.canAssign(a)&&
(a.say("Terminal"),h.push(a.name))}),_.remove(l,function(a){return-1!==h.indexOf(a.name)}),h=[]),0!==l.length&&(_.forEach(c.fillEnergy.nukerTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(p,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(n.objectsClosestToObj(l,a.object),function(d){if(a.canAssign(d)&&(d.say("NukeEnergy"),h.push(d.name),
b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(l,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==l.length&&(_.forEach(c.fillEnergy.powerSpawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(p,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(n.objectsClosestToObj(l,a.object),function(d){if(a.canAssign(d)&&(d.say("PwrEnergy"),
h.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(l,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==l.length&&(_.forEach(l,function(a){a.carry[RESOURCE_ENERGY]<(8===b.controller.level?200:7===b.controller.level?100:50)||_.forEach(c.fillEnergy.extensionTasks.sort(function(b,d){return b.object.pos.getRangeTo(a)-d.object.pos.getRangeTo(a)}),function(b){if(0<b.object.energyCapacity-b.object.energy-_.reduce(_.filter(p,function(a){return a.memory.currentTask&&"fillEnergy"===
a.memory.currentTask.type&&a.memory.currentTask.id===b.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0)&&b.canAssign(a))return a.say("Extension"),h.push(a.name),!1})}),_.remove(l,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==l.length&&(_.forEach(c.fillEnergy.spawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(p,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+
(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(n.objectsClosestToObj(l,a.object),function(d){if(a.canAssign(d)&&(d.say("Spawn"),h.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(l,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==l.length&&(_.forEach(c.fillEnergy.storageTasks,function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&
b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(n.objectsClosestToObj(l,a.object),function(d){if(!d.memory.lastCollectEnergyWasStorage&&a.canAssign(d)&&(d.say("Storage"),h.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(l,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==l.length&&(_.forEach(c.collectMinerals.terminalTasks,function(a){_.forEach(l,function(b){a.canAssign(b)&&(b.say("Collecting"),h.push(b.name))});_.remove(l,function(a){return-1!==
h.indexOf(a.name)});h=[]}),0!==l.length&&(_.forEach(c.collectMinerals.storageTasks,function(a){_.forEach(l,function(b){a.canAssign(b)&&(b.say("Collecting"),h.push(b.name))});_.remove(l,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==l.length&&(0===d.hostilesInRoom(b).length&&_.forEach(l,function(a){_.forEach(f.getTasks(a.room),function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===
b.id}).length)&&b.canAssign(a))return a.say("Pickup"),h.push(a.name),!1})}),_.remove(l,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==l.length&&(c.collectEnergy.terminalTask&&(_.forEach(l,function(a){c.collectEnergy.terminalTask.canAssign(a)&&(a.say("Collecting"),h.push(a.name))}),_.remove(l,function(a){return-1!==h.indexOf(a.name)}),h=[]),_.forEach(c.collectEnergy.tasks,function(a){_.forEach(l,function(b){a.canAssign(b)&&(b.say("Collecting"),h.push(b.name))});_.remove(l,function(a){return-1!==
h.indexOf(a.name)});h=[]}),0!==l.length&&b.terminal&&_.forEach(l,function(d){d=new a(b.terminal.id,d);d.canAssign(d.creep)})))))))))))))))))))};Memory.profiling&&c(1,29).registerObject(b,"RoleScientist");m.exports=b;return m.exports};u[30]=function(m,k){var d=c(3,30),n=c(10,30),f=c(51,30),a=function(){};a.checkSpawn=function(b){var e=d.containersInRoom(b),c=b.name,f=0,l=0,p,h,q,t;0!==d.spawnsInRoom(b).length&&0!==e.length&&b.storage&&b.storage.my&&(p=b.controller,h=Memory.army,q=d.creeps[c]&&d.creeps[c].storer||
[],Memory.lengthToStorage||(Memory.lengthToStorage={}),t=Memory.lengthToStorage,_.forEach(e,function(a){var d=a.id;Memory.containerSource[d]||(Memory.containerSource[d]=n.objectsClosestToObj([].concat.apply([],[b.find(FIND_SOURCES),b.find(FIND_MINERALS)]),a)[0].id);d=Game.getObjectById(Memory.containerSource[d]);d instanceof Mineral?0<d.mineralAmount&&(l+=1):(t[a.id]||(t[a.id]=PathFinder.search(a.pos,{pos:b.storage.pos,range:1},{swampCost:1}).path.length),f+=t[a.id])}),l+=Math.ceil(2*f/(p&&8===p.level?
35:30))+(7<=p.level&&h&&0<_.filter(h,function(a){return a.region===b.memory.region}).length?1:0),_.filter(q,function(a){return a.spawning||300<=a.ticksToLive}).length<l&&a.spawn(b),Memory.log&&(0<q.length||0<l)&&d.log.rooms[c]&&d.log.rooms[c].creeps.push({role:"storer",count:q.length,max:l}))};a.spawn=function(a){var b=d.spawnsInRoom(a),c=a.name,f,l;switch(a.controller.level){case 7:f=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,
CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 8:f=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;default:f=[MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY]}if(0===_.filter(b,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;
b=_.filter(Game.spawns,function(b){return!b.spawning&&!d.spawning[b.id]&&b.room.energyAvailable>=n.getBodypartCost(f)&&b.room.memory.region===a.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!b)return!1;l=b.createCreep(f,"storer-"+c+"-"+Game.time.toFixed(0).substring(4),{role:"storer",home:c});d.spawning[b.id]="number"!==typeof l;return"number"!==typeof l};a.assignTasks=function(a,e){var b=a.name,c=_.filter(n.creepsWithNoTask(d.creeps[b]&&d.creeps[b].storer||
[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),l=d.creeps[b]&&d.creeps[b].all||[],p=[];0!==c.length&&(_.forEach(e.fillEnergy.linkTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(l,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(n.objectsClosestToObj(c,a.object),function(d){if(a.canAssign(d)&&(d.say("Link"),
p.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(c,function(a){return-1!==p.indexOf(a.name)}),p=[])}),0!==c.length&&(_.forEach(c,function(b){b.carry[RESOURCE_ENERGY]<(8===a.controller.level?200:7===a.controller.level?100:50)||_.forEach(e.fillEnergy.extensionTasks.sort(function(a,d){return a.object.pos.getRangeTo(b)-d.object.pos.getRangeTo(b)}),function(a){if(0<a.object.energyCapacity-a.object.energy-_.reduce(_.filter(l,function(b){return b.memory.currentTask&&"fillEnergy"===
b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0)&&a.canAssign(b))return b.say("Extension"),p.push(b.name),!1})}),_.remove(c,function(a){return-1!==p.indexOf(a.name)}),p=[],0!==c.length&&(_.forEach(e.fillEnergy.spawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(l,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+
(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(n.objectsClosestToObj(c,a.object),function(d){if(a.canAssign(d)&&(d.say("Spawn"),p.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(c,function(a){return-1!==p.indexOf(a.name)}),p=[])}),0!==c.length&&(e.fillEnergy.terminalTask&&(_.forEach(c,function(a){e.fillEnergy.terminalTask.canAssign(a)&&(a.say("Terminal"),p.push(a.name))}),_.remove(c,function(a){return-1!==p.indexOf(a.name)}),p=[]),0!==c.length&&(_.forEach(e.fillEnergy.storageTasks,
function(b){var d=b.object.storeCapacity-_.sum(b.object.store)-_.reduce(_.filter(b.object.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(a.memory.currentTask.type)&&a.memory.currentTask.id===b.id}),function(a,b){return a+_.sum(b.carry)},0);0<d&&(_.forEach(n.objectsClosestToObj(c,b.object),function(e){if((!a.terminal||!e.memory.lastCollectEnergyWasStorage)&&b.canAssign(e)&&(e.say("Storage"),p.push(e.name),d-=_.sum(e.carry),0>=d))return!1}),
_.remove(c,function(a){return-1!==p.indexOf(a.name)}),p=[])}),0!==c.length&&(_.forEach(e.fillMinerals.storageTasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&(b.say("Storage"),p.push(b.name))});_.remove(c,function(a){return-1!==p.indexOf(a.name)});p=[]}),0!==c.length&&(_.forEach(e.fillMinerals.terminalTasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&(b.say("Terminal"),p.push(b.name))});_.remove(c,function(a){return-1!==p.indexOf(a.name)});p=[]}),0!==c.length&&(_.forEach([].concat.apply([],
[e.collectEnergy.storerTasks,e.collectMinerals.storerTasks]).sort(function(a,b){return(b.object.energy||_.sum(b.object.store)||0)-(a.object.energy||_.sum(a.object.store)||0)}),function(a){if(a.object.energy||_.sum(a.object.store)){var b=(a.object.energy||_.sum(a.object.store)||0)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&b.memory.currentTask.type===a.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carryCapacity-_.sum(b.carry))},
0);500<=b&&(_.forEach(c,function(d){d.memory.lastCollectEnergyWasStorage=!1;if(a.canAssign(d)&&(d.say("Collecting"),p.push(d.name),b-=d.carryCapacity-_.sum(d.carry),500>b))return!1}),_.remove(c,function(a){return-1!==p.indexOf(a.name)}),p=[])}}),0!==c.length&&(e.collectEnergy.terminalTask&&(_.forEach(c,function(a){e.collectEnergy.terminalTask.canAssign(a)&&(a.say("Collecting"),p.push(a.name),a.memory.lastCollectEnergyWasStorage=!1)}),_.remove(c,function(a){return-1!==p.indexOf(a.name)}),p=[]),0!==
c.length&&(_.forEach(e.collectEnergy.tasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&(b.say("Collecting"),p.push(b.name),a.object.structureType===STRUCTURE_STORAGE&&(b.memory.lastCollectEnergyWasStorage=!0))});_.remove(c,function(a){return-1!==p.indexOf(a.name)});p=[]}),0!==c.length&&_.forEach(c,function(a){var b=new f(a.room.terminal?a.room.terminal.id:a.room.name);b.range=0;b.canAssign(a)})))))))))))};Memory.profiling&&c(1,30).registerObject(a,"RoleStorer");m.exports=a;return m.exports};
u[31]=function(m,k){var d=c(3,31);k=function(){};k.assignTasks=function(c,f){0<f.rangedAttack.tasks.length?_.forEach(d.towersInRoom(c),function(a){a.attack(f.rangedAttack.tasks[0].enemy)}):0<f.repair.towerTasks.length?_.forEach(d.towersInRoom(c),function(a){a.repair(f.repair.towerTasks[0].structure)}):0<f.heal.tasks.length&&_.forEach(d.towersInRoom(c),function(a){a.heal(f.heal.tasks[0].ally)})};Memory.profiling&&c(1,31).registerObject(k,"RoleTower");m.exports=k;return m.exports};u[32]=function(m,
k){var d=c(3,32),n=c(10,32),f=c(41,32),a=c(46,32),b=c(50,32),e=c(51,32),r=function(){};r.checkSpawn=function(a){var b=a.name,e=d.creeps[b]&&d.creeps[b].upgrader||[],c=a.storage,f=a.controller,g,k,v;0!==d.spawnsInRoom(a).length&&(c&&(g=c.store[RESOURCE_ENERGY]),k=_.filter(e,function(a){return a.spawning||150<=a.ticksToLive}).length,v=b===Memory.rushRoom?1:!c||g<Memory.upgradeEnergy?0:1,(k<v||f&&8>f.level&&c&&9E5<g)&&r.spawn(a),Memory.log&&(0<e.length||0<v)&&d.log.rooms[b]&&d.log.rooms[b].creeps.push({role:"upgrader",
count:e.length,max:v}),_.forEach(_.filter(Game.rooms,function(b){return b.memory&&b.memory.roomType&&"base"===b.memory.roomType.type&&b.memory.region===a.memory.region&&b.name!==a.name&&b.controller&&b.controller.my&&7>b.controller.level}),function(b){0===_.filter(d.creeps[b.name]&&d.creeps[b.name].upgrader||[],function(a){return a.memory.supportRoom!==a.memory.home}).length&&r.spawn(b,a)}))};r.spawn=function(a,b){var e=[],c=a.controller,f=0,g=!1,l=a.name,v,r,x,k,m,B,u;b||(b=a);v=b.name;r=d.spawnsInRoom(b);
x=b.storage;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;if(2<=d.linksInRoom(a).length&&2>=n.objectsClosestToObj(d.linksInRoom(a),c)[0].pos.getRangeTo(c)){c=Math.min(b.energyCapacityAvailable,8===c.level?1950:4100);k=Math.floor((c-50*Math.ceil(c/3200))/250);m=(c-50*Math.ceil(c/3200))%250;for(B=0;B<k;B++)e.push(WORK),e.push(WORK),f+=2;150<=m&&(e.push(WORK),f++);for(B=0;B<Math.ceil(c/3200);B++)e.push(CARRY)}else{c=Math.min(b.energyCapacityAvailable,
8===c.level?3E3:3300);k=Math.floor(c/200);m=c%200;for(B=0;B<k;B++)e.push(WORK),f++;150<=m&&(e.push(WORK),f++);for(B=0;B<k;B++)e.push(CARRY);100<=m&&150>m&&e.push(CARRY)}for(B=0;B<k;B++)e.push(MOVE);50<=m&&e.push(MOVE);0<f&&x&&0<d.labsInRoom(b).length&&Math.max(x.store[RESOURCE_GHODIUM_HYDRIDE]||0,x.store[RESOURCE_GHODIUM_ACID]||0,x.store[RESOURCE_CATALYZED_GHODIUM_ACID]||0)>=30*f&&(g=!!(u=n.getLabToBoostWith(b)[0]));c=3>d.labsInRoom(b).length?_.filter(Game.spawns,function(a){return!a.spawning&&!d.spawning[a.id]&&
a.room.energyAvailable>=n.getBodypartCost(e)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===v?0:1)-(b.room.name===v?0:1)})[0]:_.filter(r,function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(e)})[0];if(!c)return!1;a=c.createCreep(e,"upgrader-"+l+"-"+Game.time.toFixed(0).substring(4),{role:"upgrader",home:l,supportRoom:v,homeSource:n.objectsClosestToObj(a.find(FIND_SOURCES),r[0])[0].id,labs:g?[u.id]:[]});d.spawning[c.id]="number"!==
typeof a;"number"!==typeof a&&g&&(u.creepToBoost=a,u.resource=x.store[RESOURCE_CATALYZED_GHODIUM_ACID]>=30*f?RESOURCE_CATALYZED_GHODIUM_ACID:x.store[RESOURCE_GHODIUM_ACID]>=30*f?RESOURCE_GHODIUM_ACID:RESOURCE_GHODIUM_HYDRIDE,u.amount=30*f,b.memory.labsInUse.push(u),_.forEach(_.filter(d.creeps[v]&&d.creeps[v].all||[],function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&a.memory.currentTask.id===u.id}),function(a){delete a.memory.currentTask}));return"number"!==typeof a};
r.assignTasks=function(c,l){var g=c.name,h=_.filter(n.creepsWithNoTask(d.creeps[g]&&d.creeps[g].upgrader||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),r=[],k=c.controller;if(0!==h.length&&(_.forEach(_.filter(h,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(a){(new e(a.memory.labs[0])).canAssign(a);r.push(a.name)}),_.remove(h,function(a){return-1!==r.indexOf(a.name)}),r=[],0!==h.length&&(_.forEach(l.upgradeController.tasks,function(a){_.forEach(n.objectsClosestToObj(h,
k),function(b){a.canAssign(b)&&(b.say("Controller"),r.push(b.name))});_.remove(h,function(a){return-1!==r.indexOf(a.name)});r=[]}),0!==h.length&&(_.forEach(h,function(a){var b=n.objectsClosestToObj(d.linksInRoom(c),k);0<b.length&&0<b[0].energy&&(b=new f(b[0].id),b.canAssign(a)&&(a.say("Collecting"),r.push(a.name)))}),_.remove(h,function(a){return-1!==r.indexOf(a.name)}),r=[],0!==h.length)))){if(!k||6>k.level)if(0===d.hostilesInRoom(c).length&&_.forEach(h,function(a){_.forEach(b.getTasks(a.room),function(b){if(!(0<
_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Pickup"),r.push(a.name),!1})}),_.remove(h,function(a){return-1!==r.indexOf(a.name)}),r=[],0===h.length)return;_.forEach(l.collectEnergy.tasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Collecting"),r.push(b.name))});_.remove(h,function(a){return-1!==r.indexOf(a.name)});r=[]});if(0!==
h.length){if(0===_.filter(d.containersInRoom(c),function(a){return 0<a.energy}).length&&!c.storage&&(_.forEach(h,function(b){(new a).canAssign(b)&&(b.say("Harvesting"),r.push(b.name))}),_.remove(h,function(a){return-1!==r.indexOf(a.name)}),r=[],0===h.length))return;_.forEach(h,function(a){(new e(a.memory.home)).canAssign(a)})}}};Memory.profiling&&c(1,32).registerObject(r,"RoleUpgrader");m.exports=r;return m.exports};u[33]=function(m,k){var d=c(3,33),n=c(10,33),f=c(46,33),a=c(50,33),b=c(51,33),e=function(){};
e.checkSpawn=function(a,b){var c=a.name,f=d.creeps[c]&&d.creeps[c].worker||[],g=a.storage,r;0!==a.find(FIND_SOURCES).length&&(r=_.filter(f,function(a){return a.spawning||a.ticksToLive>=(g&&g.my?150:300)}).length,b=b?g&&g.my?1:2:0,r<b&&e.spawn(a),Memory.log&&(0<f.length||0<b)&&d.log.rooms[c]&&d.log.rooms[c].creeps.push({role:"worker",count:f.length,max:b}),_.forEach(_.filter(Game.rooms,function(b){return b.memory&&b.memory.roomType&&"base"===b.memory.roomType.type&&b.memory.region===a.memory.region&&
b.name!==c&&b.controller&&b.controller.my&&6>b.controller.level}),function(b){0===_.filter(d.creeps[b.name]&&d.creeps[b.name].worker||[],function(a){return a.memory.supportRoom!==a.memory.home}).length&&e.spawn(b,a)}))};e.spawn=function(a,b){var c=[],e=0,f=!1,g=a.name,r,k,v,m,x,F,u;b||(b=a);r=b.name;k=d.spawnsInRoom(b);v=b.storage;if(0!==k.length){if(3<=d.labsInRoom(b).length&&0===_.filter(k,function(a){return!a.spawning&&!d.spawning[a.id]}).length)return!1;m=Math.min(b.energyCapacityAvailable,3300);
x=Math.floor(m/200);m%=200;for(F=0;F<x;F++)c.push(WORK),e++;150<=m&&(c.push(WORK),e++);for(F=0;F<x;F++)c.push(CARRY);100<=m&&150>m&&c.push(CARRY);for(F=0;F<x;F++)c.push(MOVE);50<=m&&c.push(MOVE);(g===r||0<a.find(FIND_MY_CONSTRUCTION_SITES).length)&&0<e&&v&&0<d.labsInRoom(b).length&&Math.max(v.store[RESOURCE_LEMERGIUM_HYDRIDE]||0,v.store[RESOURCE_LEMERGIUM_ACID]||0,v.store[RESOURCE_CATALYZED_LEMERGIUM_ACID]||0)>=30*e&&(f=!!(u=n.getLabToBoostWith(b)[0]));x=3>d.labsInRoom(b).length?_.filter(Game.spawns,
function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(c)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===r?0:1)-(b.room.name===r?0:1)})[0]:_.filter(k,function(a){return!a.spawning&&!d.spawning[a.id]&&a.room.energyAvailable>=n.getBodypartCost(c)})[0];if(!x)return!1;a=x.createCreep(c,"worker-"+g+"-"+Game.time.toFixed(0).substring(4),{role:"worker",home:g,supportRoom:r,homeSource:n.objectsClosestToObj(a.find(FIND_SOURCES),k[0])[0].id,
labs:f?[u.id]:[]});d.spawning[x.id]="number"!==typeof a;"number"!==typeof a&&f&&(u.creepToBoost=a,u.resource=v.store[RESOURCE_CATALYZED_LEMERGIUM_ACID]>=30*e?RESOURCE_CATALYZED_LEMERGIUM_ACID:v.store[RESOURCE_LEMERGIUM_ACID]>=30*e?RESOURCE_LEMERGIUM_ACID:RESOURCE_LEMERGIUM_HYDRIDE,u.amount=30*e,b.memory.labsInUse.push(u),_.forEach(_.filter(d.creeps[b.name]&&d.creeps[b.name].all||[],function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&a.memory.currentTask.id===u.id}),
function(a){delete a.memory.currentTask}));return"number"!==typeof a}};e.assignTasks=function(c,e){var g=c.name,r=d.creeps[g]&&d.creeps[g].worker||[],h=_.filter(n.creepsWithNoTask(r),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),k=d.creeps[g]&&d.creeps[g].all||[],g=d.creeps[g]&&d.creeps[g].storer||[],t=c.controller,m=[];if(0!==h.length&&(_.forEach(_.filter(h,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(a){var d=_.filter(Memory.rooms[a.memory.supportRoom].labsInUse,
function(b){return b.id===a.memory.labs[0]})[0];d&&Game.getObjectById(a.memory.labs[0]).mineralType===d.resource&&Game.getObjectById(a.memory.labs[0]).mineralAmount>=d.amount&&((new b(a.memory.labs[0])).canAssign(a),m.push(a.name))}),_.remove(h,function(a){return-1!==m.indexOf(a.name)}),m=[],0!==h.length&&(_.forEach(e.fillMinerals.storageTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Storage"),m.push(b.name))});_.remove(h,function(a){return-1!==m.indexOf(a.name)});m=[]}),0!==h.length&&
(_.forEach(e.fillMinerals.terminalTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Terminal"),m.push(b.name))});_.remove(h,function(a){return-1!==m.indexOf(a.name)});m=[]}),0!==h.length&&(_.forEach(e.upgradeController.criticalTasks,function(a){0===_.filter(r,function(b){return b.memory.currentTask&&"upgradeController"===b.memory.currentTask.type&&b.memory.currentTask.room===a.room}).length&&(_.forEach(n.objectsClosestToObj(h,t),function(b){if(a.canAssign(b))return b.say("CritCntrlr"),
m.push(b.name),!1}),_.remove(h,function(a){return-1!==m.indexOf(a.name)}),m=[])}),0!==h.length))))){if(!c.storage||0===g.length)if(_.forEach(h,function(a){a.carry[RESOURCE_ENERGY]<(8===c.controller.level?200:7===c.controller.level?100:50)||_.forEach(e.fillEnergy.extensionTasks.sort(function(b,d){return b.object.pos.getRangeTo(a)-d.object.pos.getRangeTo(a)}),function(b){if(0<b.object.energyCapacity-b.object.energy-_.reduce(_.filter(k,function(a){return a.memory.currentTask&&"fillEnergy"===a.memory.currentTask.type&&
a.memory.currentTask.id===b.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0)&&b.canAssign(a))return a.say("Extension"),m.push(a.name),!1})}),_.remove(h,function(a){return-1!==m.indexOf(a.name)}),m=[],0===h.length)return;c.storage&&0!==g.length||_.forEach(e.fillEnergy.spawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(k,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+
(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(n.objectsClosestToObj(h,a.object),function(d){if(a.canAssign(d)&&(d.say("Spawn"),m.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(h,function(a){return-1!==m.indexOf(a.name)}),m=[])});if(0!==h.length&&(_.forEach(e.fillEnergy.towerTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(k,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),
function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(n.objectsClosestToObj(h,a.object),function(d){if(a.canAssign(d)&&(d.say("Tower"),m.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(h,function(a){return-1!==m.indexOf(a.name)}),m=[])}),0!==h.length&&(_.forEach(_.filter(e.build.tasks,function(a){return 1===a.constructionSite.progressTotal}),function(a){var b=a.constructionSite.progressTotal-a.constructionSite.progress-_.reduce(_.filter(a.constructionSite.room.find(FIND_MY_CREEPS),
function(b){return b.memory.currentTask&&"build"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(n.objectsClosestToObj(h,a.constructionSite),function(d){if(a.canAssign(d)&&(d.say("Build"),m.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(h,function(a){return-1!==m.indexOf(a.name)}),m=[])}),0!==h.length&&(_.forEach(e.repair.criticalTasks,function(a){_.forEach(n.objectsClosestToObj(h,a.structure),
function(b){if(0===_.filter(a.structure.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"repair"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length&&a.canAssign(b))return b.say("CritRepair"),m.push(b.name),!1});_.remove(h,function(a){return-1!==m.indexOf(a.name)});m=[]}),0!==h.length&&(_.forEach(e.build.tasks,function(a){var b=a.constructionSite.progressTotal-a.constructionSite.progress-_.reduce(_.filter(a.constructionSite.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&
"build"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(n.objectsClosestToObj(h,a.constructionSite),function(d){if(a.canAssign(d)&&(d.say("Build"),m.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(h,function(a){return-1!==m.indexOf(a.name)}),m=[])}),0!==h.length&&(_.forEach(e.repair.tasks,function(a){var b=a.structure.hitsMax-a.structure.hits-100*_.reduce(_.filter(a.structure.room.find(FIND_MY_CREEPS),
function(b){return b.memory.currentTask&&"repair"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0),d=!1;if(0<b)return _.forEach(n.objectsClosestToObj(h,a.structure),function(e){if(a.canAssign(e)&&(e.say("Repair"),m.push(e.name),b-=100*(e.carry[RESOURCE_ENERGY]||0),d=!0,0>=b))return!1}),_.remove(h,function(a){return-1!==m.indexOf(a.name)}),m=[],d}),0!==h.length)))))){if(t&&8>t.level&&(_.forEach(e.upgradeController.tasks,function(a){_.forEach(n.objectsClosestToObj(h,
c.controller),function(b){a.canAssign(b)&&(b.say("Controller"),m.push(b.name))});_.remove(h,function(a){return-1!==m.indexOf(a.name)});m=[]}),0===h.length))return;if(!t||6>t.level)if(0===d.hostilesInRoom(c).length&&_.forEach(_.filter(h,function(a){return a.room.name===c.name}),function(b){_.forEach(a.getTasks(b.room),function(a){if(!(0<_.filter(a.resource.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"pickupResource"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length)&&
a.canAssign(b))return b.say("Pickup"),m.push(b.name),!1})}),_.remove(h,function(a){return-1!==m.indexOf(a.name)}),m=[],0===h.length)return;e.collectEnergy.terminalTask&&(_.forEach(h,function(a){e.collectEnergy.terminalTask.canAssign(a)&&(a.say("Collecting"),m.push(a.name))}),_.remove(h,function(a){return-1!==m.indexOf(a.name)}),m=[]);_.forEach(e.collectEnergy.tasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Collecting"),m.push(b.name))});_.remove(h,function(a){return-1!==m.indexOf(a.name)});
m=[]});if(0!==h.length){if(0===_.filter(d.containersInRoom(c),function(a){return 0<a.energy}).length&&!c.storage&&(_.forEach(h,function(a){(new f).canAssign(a)&&(a.say("Harvesting"),m.push(a.name))}),_.remove(h,function(a){return-1!==m.indexOf(a.name)}),m=[],0===h.length))return;_.forEach(b.getHarvesterTasks(h),function(a){a.canAssign(a.creep)})}}}};Memory.profiling&&c(1,33).registerObject(e,"RoleWorker");m.exports=e;return m.exports};u[34]=function(m,k){var d=c(3,34),n=c(4,34),f=c(6,34),a=c(7,34),
b=c(10,34),e=c(15,34),r=c(16,34),g=c(17,34),l=c(19,34),p=c(21,34),h=c(29,34),q=c(30,34),t=c(31,34),u=c(32,34),v=c(33,34),A=c(39,34),x=c(41,34),F=c(42,34),J=c(43,34),B=c(44,34),E=c(45,34),w=c(47,34),N=c(52,34),O=c(53,34),z=c(55,34),C=function(){this.type="base"};C.prototype.manage=function(a){var e=a.controller,c=e.level,f=a.find(FIND_MY_CONSTRUCTION_SITES),g=d.spawnsInRoom(a)[0],h=g.pos,l=a.storage,r=a.find(FIND_MINERALS),k=a.name,p;e&&0!==c&&(0<(p=[0,5,10,20,30,40,50,60][c-1]-(d.extensionsInRoom(a).length+
_.filter(f,function(a){return a.structureType===STRUCTURE_EXTENSION}).length))&&b.buildStructures(a,STRUCTURE_EXTENSION,p,g),3<=c&&0===d.towersInRoom(a).length&&0===_.filter(f,function(a){return a.structureType===STRUCTURE_TOWER}).length&&b.buildStructures(a,STRUCTURE_TOWER,1,g),3<=c&&_.forEach(a.find(FIND_SOURCES),function(b){b=PathFinder.search(b.pos,{pos:h,range:1},{swampCost:1}).path[0];var d=b.lookFor(LOOK_STRUCTURES),c=b.x,e=b.y;0===_.filter(d,function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&
0===_.filter(f,function(a){return a.pos.x===c&&a.pos.y===e&&a.structureType===STRUCTURE_CONTAINER}).length&&(_.forEach(_.filter(d,function(a){return-1!==[STRUCTURE_ROAD,STRUCTURE_WALL].indexOf(a.structureType)}),function(a){a.destroy()}),a.createConstructionSite(c,e,STRUCTURE_CONTAINER))}),4<=c&&!l&&0===_.filter(f,function(a){return a.structureType===STRUCTURE_STORAGE}).length&&b.buildStructures(a,STRUCTURE_STORAGE,1,g),6<=c&&l&&!a.terminal&&0===_.filter(f,function(a){return a.structureType===STRUCTURE_TERMINAL}).length&&
b.buildStructures(a,STRUCTURE_TERMINAL,1,l),6<=c&&r.length!==d.extractorsInRoom(a).length&&_.forEach(r,function(b){b=b.pos;var d=b.x,c=b.y;0===_.filter(b.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_EXTRACTOR}).length&&0===_.filter(f,function(a){return a.pos.x===d&&a.pos.y===c&&a.structureType===STRUCTURE_EXTRACTOR}).length&&a.createConstructionSite(d,c,STRUCTURE_EXTRACTOR)}),6<=c&&_.forEach(r,function(b){b=PathFinder.search(b.pos,{pos:h,range:1},{swampCost:1}).path[0];
var d=b.lookFor(LOOK_STRUCTURES),c=b.x,e=b.y;0===_.filter(d,function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&0===_.filter(f,function(a){return a.pos.x===c&&a.pos.y===e&&a.structureType===STRUCTURE_CONTAINER}).length&&(_.forEach(_.filter(d,function(a){return-1!==[STRUCTURE_ROAD,STRUCTURE_WALL].indexOf(a.structureType)}),function(a){a.destroy()}),a.createConstructionSite(c,e,STRUCTURE_CONTAINER))}),3<=c&&_.forEach(_.filter(a.find(FIND_MY_STRUCTURES),function(a){return a.structureType===
STRUCTURE_SPAWN||a.structureType===STRUCTURE_EXTENSION||a.structureType===STRUCTURE_TOWER||a.structureType===STRUCTURE_STORAGE||a.structureType===STRUCTURE_TERMINAL}),function(b){var d=b.pos.x;b=b.pos.y;_.forEach([new RoomPosition(d-1,b,k),new RoomPosition(d+1,b,k),new RoomPosition(d,b-1,k),new RoomPosition(d,b+1,k)],function(b){var d=b.x,c=b.y;0===_.filter(b.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_ROAD}).length&&0===_.filter(f,function(a){return a.pos.x===d&&a.pos.y===
c&&a.structureType===STRUCTURE_ROAD}).length&&a.createConstructionSite(d,c,STRUCTURE_ROAD)})}))};C.prototype.defend=function(a){var b=a.name,c=a.memory,e=_.filter(d.hostilesInRoom(a),function(a){return a.owner&&"Invader"!==a.owner.username});a=b+"-defense";var f,g;0<e.length?(c.lastHostile=Game.time,c.currentAttack||(c.currentAttack=Game.time),c.threats||(c.threats={}),c.edgeTicks||(c.edgeTicks={1:0,3:0,5:0,7:0}),_.forEach(_.filter(_.map(e,function(a){return{id:a.id,threat:_.filter(a.body,function(a){return-1!==
[ATTACK,RANGED_ATTACK,HEAL].indexOf(a)}).length}})),function(a){c.threats[a.id]=a.threat}),f=Math.min(Math.ceil(_.sum(c.threats)/20),3),0<_.filter(e,function(a){return 0===a.pos.x}).length&&c.edgeTicks[TOP]++,0<_.filter(e,function(a){return 49===a.pos.x}).length&&c.edgeTicks[BOTTOM]++,0<_.filter(e,function(a){return 0===a.pos.y}).length&&c.edgeTicks[LEFT]++,0<_.filter(e,function(a){return 49===a.pos.y}).length&&c.edgeTicks[RIGHT]++,0<f&&(Memory.army[a]?(e=Game.time-c.currentAttack,500<=e&&2E3>e?Memory.army[a].boostRoom=
b:2E3<=e&&2500>e?_.forEach(_.filter(Game.rooms,function(a){return a.memory&&a.memory.region===c.region}),function(a){var d=a.name+"-defense-for-"+b;Memory.army[a.name+"-defense"]||Memory.army[d]||n.createArmy(d,{reinforce:!1,region:c.region,boostRoom:b,buildRoom:b,stageRoom:b,attackRoom:b,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:f,units:17},melee:{maxCreeps:f,units:20},ranged:{maxCreeps:0,units:20}})}):2500<=e&&_.forEach(_.filter(Game.rooms,function(a){return a.memory&&a.memory.region===
c.region}),function(a){var d=a.name+"-defense-for-"+b;Memory.army[d]&&(Memory.army[d].boostRoom=a.name)}),g=Game.map.describeExits(b),_.forEach(_.keys(g),function(a){var d=b+"-"+a.toString()+"-border-defense";!Memory.army[d]&&50<=c.edgeTicks[a]&&n.createArmy(d,{reinforce:!1,region:c.region,boostRoom:b,buildRoom:b,stageRoom:b,attackRoom:g[a],dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:f,units:17},melee:{maxCreeps:f,units:20},ranged:{maxCreeps:0,units:20}})})):(Game.notify("Warning! "+
b+" is under attack!"),n.createArmy(a,{reinforce:!1,region:c.region,boostRoom:b,buildRoom:b,stageRoom:b,attackRoom:b,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:f,units:17},melee:{maxCreeps:f,units:20},ranged:{maxCreeps:0,units:20}}),Memory.army[a].creepCount=0))):Memory.army[a]&&c.lastHostile+50<Game.time&&(Memory.army[a]&&(Memory.army[a].directive="attack",Memory.army[a].success=!0),delete c.lastHostile,delete c.currentAttack,delete c.threats,delete c.edgeTicks)};C.prototype.transferEnergy=
function(a){a=b.objectsClosestToObj(d.linksInRoom(a),d.spawnsInRoom(a)[0]);var c=a[0];_.forEach(a,function(a,b){0!==b&&!c.cooldown&&0<c.energy&&300>=a.energy&&c.transferEnergy(a)})};C.prototype.terminal=function(b,c){var e=c.store,g=e[RESOURCE_ENERGY]||0,h=b.storage,l=b.name,r=b.memory,k=r.buyQueue,p=!1,m=[],q={},t=Game.market,n=Math.max.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&"base"===a.memory.roomType.type&&a.storage&&
a.storage.my&&a.terminal&&a.terminal.my}),function(a){return a.storage&&a.storage.my?a.storage.store[RESOURCE_ENERGY]:0})))),v,x,A;h&&(q=h.store);!c.cooldown&&1E3<=g&&n>=Memory.dealEnergy&&(r.buyQueue&&(d.credits<Memory.minimumCredits||(q[k.resource]||0)+(e[k.resource]||0)>(Memory.reserveMinerals[k.resource]||0))&&(delete r.buyQueue,k=void 0),k&&n>Memory.marketEnergy&&Memory.buy?((v=(f.getFilteredOrders().sell[k.resource]||[])[0])?v.price>k.price?(delete r.buyQueue,k=void 0):(x=t.calcTransactionCost(Math.min(k.amount,
v.amount),l,v.roomName),g>x&&d.credits>=k.amount*v.price?(f.deal(v.id,Math.min(k.amount,v.amount),l),p=!0,k.amount-=Math.min(k.amount,v.amount)):0<g&&(A=Math.min(Math.floor(Math.min(k.amount,v.amount)*g/x),Math.floor(d.credits/v.price)),0<A&&(f.deal(v.id,A,l),p=!0,k.amount-=A))):(delete r.buyQueue,k=void 0),k&&0>=k.amount&&(delete r.buyQueue,k=void 0)):(d.credits>=Memory.minimumCredits&&Memory.buy&&(c=_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&"base"===a.memory.roomType.type&&
a.terminal&&a.terminal.my}),_.forEach(c,function(a){var c=a.name;p=!1;if(l!==a.name)return _.forEach(_.filter(_.map(e,function(b,d){return{resource:d,amount:Math.min(Memory.reserveMinerals?b+q[d]-(d.startsWith("X")&&5===d.length?Memory.reserveMinerals[d]-5E3:Memory.reserveMinerals[d]):0,b),otherRoomAmount:(a.terminal.store[d]||0)+(a.storage&&a.storage.store[d]||0),needed:Memory.reserveMinerals?(d.startsWith("X")&&5===d.length?Memory.reserveMinerals[d]-5E3:Memory.reserveMinerals[d])||0:0}}),function(a){return Memory.reserveMinerals[a.resource]&&
a.otherRoomAmount<a.needed&&0<a.amount&&0<a.needed-a.otherRoomAmount&&100<=Math.min(a.amount,a.needed-a.otherRoomAmount)}),function(a){var e=Math.min(a.amount,a.needed-a.otherRoomAmount);x=t.calcTransactionCost(e,l,c);if(g>x){if(b.terminal.send(a.resource,e,c)===OK)return d.log.events.push("Sending "+e+" "+a.resource+" from "+l+" to "+c),p=!0,!1}else if(0<g&&(e=Math.floor(e*g/x),0<e&&b.terminal.send(a.resource,e,c)===OK))return d.log.events.push("Sending "+e+" "+a.resource+" from "+l+" to "+c),p=
!0,!1}),!p})),p||(c=_.filter(_.map(e,function(a,b){return{resource:b,amount:Math.min(a,a-(Memory.reserveMinerals?(b.startsWith("X")&&5===b.length?Memory.reserveMinerals[b]-5E3:Memory.reserveMinerals[b])||0:0)+(q[b]||0))}}),function(a){return a.resource!==RESOURCE_ENERGY&&0<a.amount}),0<c.length&&_.forEach(c.sort(function(a,b){return b.amount-a.amount}),function(a){var b=a.resource;if(v=_.filter(f.getFilteredOrders().buy[b]||[],function(c){return 5005<=a.amount&&d.credits<Memory.minimumCredits||!Memory.minimumSell[b]&&
!Memory.flipPrice[b]||Memory.minimumSell[b]&&c.price>=Memory.minimumSell[b]||Memory.flipPrice[b]&&c.price>=Memory.flipPrice[b].price||Memory.flipPrice[b]&&Game.time>Memory.flipPrice[b].expiration})[0]){x=t.calcTransactionCost(Math.min(a.amount,v.amount),l,v.roomName);if(g>x)return f.deal(v.id,Math.min(a.amount,v.amount),l),p=!0,5005>a.amount&&delete Memory.minimumSell[v.resourceType],!1;if(0<g&&(A=Math.floor(Math.min(a.amount,v.amount)*g/x),0<A))return f.deal(v.id,A,l),p=!0,!1}})),!p&&h&&n>Memory.marketEnergy&&
(_.forEach(a,function(a,b){var c;!q||q[b]<Memory.reserveMinerals[b]||-1!==[RESOURCE_ENERGY,SUBSCRIPTION_TOKEN].indexOf(b)||(a=(f.getFilteredOrders().sell[b]||[])[0],c=(f.getFilteredOrders().buy[b]||[])[0],a&&c&&a.price<c.price&&a.price<d.credits&&m.push({resource:b,buy:c,sell:a}))}),_.forEach(m.sort(function(a,b){return a.sell.price-a.buy.price-(b.sell.price-b.buy.price)}),function(a,b){var c=a.buy,e=a.sell;A=Math.min(c.amount,e.amount);A*e.price>d.credits&&(A=Math.floor(d.credits/e.price));0===b&&
d.log.events.push("Biggest flip: "+a.resource+" x"+A+" "+e.price.toFixed(2)+" to "+c.price.toFixed(2));x=t.calcTransactionCost(A,l,e.roomName);if(g>x||0<g&&(A=Math.floor(A*g/x),0<A))return f.deal(e.id,A,l),Memory.flipPrice[a.resource]={price:e.price,expiration:Game.time+100},p=!0,!1}))))};C.prototype.tasks=function(a){var c=a.terminal,e=Memory.dismantle,f=a.name,g=0,h=0,l,k=d.creeps[f]&&d.creeps[f].worker||[],r=0<_.filter(k,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&
0<a.carry[RESOURCE_ENERGY]}).length,p=0<_.filter(k,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&a.carry[RESOURCE_ENERGY]!==_.sum(a.carry)}).length,m=0<_.filter(k,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,q=d.creeps[f]&&d.creeps[f].collector||[],t=0<_.filter(q,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,n=0<_.filter(q,function(a){return(!a.memory.currentTask||
a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,v=d.creeps[f]&&d.creeps[f].storer||[],u=0<_.filter(v,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,y=0<_.filter(v,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&a.carry[RESOURCE_ENERGY]!==_.sum(a.carry)}).length,v=0<_.filter(v,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,G=d.creeps[f]&&
d.creeps[f].scientist||[],D=0<_.filter(G,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,C=0<_.filter(G,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&a.carry[RESOURCE_ENERGY]!==_.sum(a.carry)}).length,G=0<_.filter(G,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,K=d.creeps[f]&&d.creeps[f].upgrader||[],P=0<_.filter(K,function(a){return(!a.memory.currentTask||
a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,K=0<_.filter(K,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,I=0<b.creepsWithNoTask(d.creeps[f]&&d.creeps[f].dismantler||[]).length,k=0===Game.time%10&&0===k.length+q.length,H={build:{tasks:r||t?A.getTasks(a):[]},collectEnergy:{tasks:m||v||G||n||K?x.getTasks(a):[],storerTasks:v?x.getStorerTasks(a):[]},collectMinerals:{storerTasks:v||y?F.getStorerTasks(a):[],labTasks:G||
C?F.getLabTasks(a):[],storageTasks:G||C?F.getStorageTasks(a):[],terminalTasks:G||C?F.getTerminalTasks(a):[]},fillEnergy:{extensionTasks:r||u||D||t?B.getExtensionTasks(a):[],spawnTasks:r||u||D||t?B.getSpawnTasks(a):[],powerSpawnTasks:D?B.getPowerSpawnTasks(a):[],towerTasks:r||D||t?B.getTowerTasks(a):[],storageTasks:u||D||I?B.getStorageTasks(a):[],containerTasks:I?B.getContainerTasks(a):[],labTasks:D?B.getLabTasks(a):[],linkTasks:u?B.getLinkTasks(a):[],nukerTasks:D?B.getNukerTasks(a):[]},fillMinerals:{labTasks:C?
E.getLabTasks(a):[],storageTasks:p||y||C||I?E.getStorageTasks(a):[],terminalTasks:p||y||C||I?E.getTerminalTasks(a):[],nukerTasks:C?E.getNukerTasks(a):[],powerSpawnTasks:C?E.getPowerSpawnTasks(a):[]},heal:{tasks:w.getTasks(a)},rangedAttack:{tasks:N.getTasks(a)},repair:{tasks:k||r||t?O.getTasks(a):[],criticalTasks:k||r||t?O.getCriticalTasks(a):[],towerTasks:Memory.towerTasks[f]||0===Game.time%10?O.getTowerTasks(a):[]},upgradeController:{tasks:r||t||P?z.getTasks(a):[],criticalTasks:k||r||t?z.getCriticalTasks(a):
[]},dismantle:{tasks:[]}};Memory.towerTasks[f]=H.repair.towerTasks.length;c&&c.my&&(g=c.store[RESOURCE_ENERGY]||0,l=c.id);a.storage&&(h=a.storage.store[RESOURCE_ENERGY]||0);(v||G)&&c&&(!c.my||5E3<=g&&(!a.memory.buyQueue||h<Memory.marketEnergy||d.credits<Memory.minimumCredits))&&(H.collectEnergy.terminalTask=new x(l));(r||u||D)&&c&&c.my&&1E3>g&&(H.fillEnergy.terminalTask=new B(l));if(e&&e[f]&&0<e[f].length){var L=[];_.forEach(e[f],function(b){var d=a.lookForAt(LOOK_STRUCTURES,b.x,b.y);0===d.length?
L.push(b):I&&(H.dismantle.tasks=H.dismantle.tasks.concat(_.map(d,function(a){return new J(a.id)})))});_.forEach(L,function(a){_.remove(e[f],function(b){return b.x===a.x&&b.y===a.y})})}else _.forEach(d.creeps[f]&&d.creeps[f].dismantler||[],function(b){b.memory.role="remoteWorker";b.memory.container=d.containersInRoom(a)[0].id});return H};C.prototype.spawn=function(a,b){var d=Memory.dismantle,c=a.name,f=a.controller;v.checkSpawn(a,b);p.checkSpawn(a);q.checkSpawn(a);h.checkSpawn(a);d&&d[c]&&0<d[c].length&&
l.checkSpawn(a);r.checkSpawn(a);e.checkSpawn(a);g.checkSpawn(a);f&&(8>f.level||0<_.filter(Game.rooms,function(a){return a.controller&&a.controller.my&&8>a.controller.level}).length)&&u.checkSpawn(a)};C.prototype.assignTasks=function(a,b){v.assignTasks(a,b);p.assignTasks(a,b);q.assignTasks(a,b);h.assignTasks(a,b);l.assignTasks(a,b);r.assignTasks(a,b);e.assignTasks(a,b);g.assignTasks(a,b);u.assignTasks(a,b);t.assignTasks(a,b)};C.prototype.labQueue=function(a,c){var e=a.memory,f=d.labsInRoom(a),g=e.labsInUse,
h=c.sourceLabs||[],l=c.children||[],k=Game.getObjectById(h[0]),r=Game.getObjectById(h[1]),p=c.resource;switch(c.status){case "clearing":if(!g||2<f.length-g.length&&0===_.filter(f,function(a){return-1===g.indexOf(a.id)&&0<a.mineralAmount}).length)c.status="moving";break;case "moving":if(!c.start||c.start+500<Game.time)delete e.labQueue,c=void 0;else{var m=!0;_.forEach(l,function(a){if(_.sum(_.filter(f,function(b){return b.mineralType===a}),function(a){return a.mineralAmount})<c.amount)return m=!1});
k.mineralType===l[0]&&r.mineralType===l[1]&&_.forEach(_.filter(f,function(a){return-1===h.indexOf(a.id)&&(!g||-1===_.map(_.filter(g,function(a){return a.resource!==p}),function(a){return a.id}).indexOf(a.id))}),function(a){a.runReaction(k,r)===OK&&(c.amount-=5)});m&&(c.status="creating")}break;case "creating":_.forEach(_.filter(f,function(a){return-1===h.indexOf(a.id)&&(!g||-1===_.map(_.filter(g,function(a){return a.resource!==p}),function(a){return a.id}).indexOf(a.id))}),function(a){a.mineralAmount===
LAB_MINERAL_CAPACITY&&(c.status="returning");a.runReaction(k,r)===OK&&(c.amount-=5)});0===_.sum(_.filter(f,function(a){return-1!==h.indexOf(a.id)}),function(a){return a.mineralAmount})&&(c.status="returning");break;case "returning":0===_.sum(_.filter(f,function(a){return a.mineralType===p}),function(a){return a.mineralAmount})&&(delete e.labQueue,c=void 0);break;default:c.status="clearing",c.sourceLabs=b.getSourceLabs(a)}};C.prototype.labsInUse=function(a,b){var d=[];_.forEach(b,function(a){var b=
Game.getObjectById(a.id);switch(a.status){case "emptying":0===b.mineralAmount&&(a.status="filling");break;case "filling":b.mineralAmount===a.amount&&b.mineralType===a.resource&&(a.status="waiting");break;default:var c=Game.creeps[a.creepToBoost];1>=b.pos.getRangeTo(c)&&b.mineralType===a.resource&&b.mineralAmount>=a.amount&&b.boostCreep(c)===OK&&(_.remove(c.memory.labs,function(b){return b===a.id}),a.status&&0!==a.oldAmount?a.status="refilling":d.push(a));break;case "refilling":b.mineralAmount===a.oldAmount&&
b.mineralType===a.oldResource&&d.push(a)}});_.forEach(d,function(a){_.remove(b,function(b){return b.id===a.id})})};C.prototype.processPower=function(a){_.forEach(d.powerSpawnsInRoom(a),function(a){1<=a.power&&50<=a.energy&&a.processPower()})};C.prototype.run=function(a){var c,e,f,g,h;a.unobservable?Game.notify("Base Room "+c+" is unobservable, something is wrong!"):(c=a.name,e=d.spawnsInRoom(a),f=a.terminal,c=a.storage,g=a.memory,h=g.labQueue,g=g.labsInUse,0===Game.time%100&&0<e.length&&this.manage(a),
this.defend(a),0<e.length&&this.transferEnergy(a),f&&this.terminal(a,f),e=this.tasks(a),this.spawn(a,!c||c.store[RESOURCE_ENERGY]>=Memory.workerEnergy||3500>a.controller.ticksToDowngrade||0<a.find(FIND_MY_CONSTRUCTION_SITES).length||e.repair.criticalTasks&&0<e.repair.criticalTasks.length||e.repair.tasks&&0<_.filter(e.repair.tasks,function(a){return(a.structure.structureType===STRUCTURE_WALL||a.structure.structureType===STRUCTURE_RAMPART)&&1E6>a.structure.hits}).length),this.assignTasks(a,e),c&&3<=
d.labsInRoom(a).length&&h&&!b.roomLabsArePaused(a)&&this.labQueue(a,h),g&&this.labsInUse(a,g),this.processPower(a))};C.prototype.toObj=function(a){Memory.rooms[a.name].roomType={type:this.type}};C.fromObj=function(a){return new C};Memory.profiling&&c(1,34).registerObject(C,"RoomBase");m.exports=C;return m.exports};u[35]=function(m,k){var d=c(3,35),n=c(4,35),f=c(10,35),a=c(24,35),b=c(23,35),e=c(41,35),r=c(42,35),g=c(43,35),l=c(44,35),p=c(45,35),h=c(50,35),q=function(a){this.type="cleanup";this.supportRoom=
a};q.prototype.run=function(c){var k=c.name,m=[],q=[],t=[],u=[],J=[],B=[],E,D;if(E=Game.rooms[Memory.rooms[c.name].roomType.supportRoom])D={collectEnergy:{cleanupTasks:[]},collectMinerals:{cleanupTasks:[]},fillEnergy:{storageTasks:l.getStorageTasks(E),containerTasks:l.getContainerTasks(E)},fillMinerals:{labTasks:p.getLabTasks(E),storageTasks:p.getStorageTasks(E),terminalTasks:p.getTerminalTasks(E)},remoteDismantle:{cleanupTasks:[]},dismantle:{tasks:[]},pickupResource:{tasks:[]}},c.unobservable||(Memory.dismantle&&
Memory.dismantle[c.name]&&0<Memory.dismantle[c.name].length&&(_.forEach(Memory.dismantle[c.name],function(a){var b=c.lookForAt(LOOK_STRUCTURES,a.x,a.y);0===b.length?J.push(a):D.dismantle.tasks=D.dismantle.tasks.concat(_.map(b,function(a){return new g(a.id)}))}),_.forEach(J,function(a){_.remove(Memory.dismantle[k],function(b){return b.x===a.x&&b.y===a.y})})),m=_.filter(c.find(FIND_STRUCTURES),function(a){return a.structureType===STRUCTURE_RAMPART}),q=_.filter(c.find(FIND_STRUCTURES),function(a){return a.structureType!==
STRUCTURE_RAMPART&&a.structureType!==STRUCTURE_CONTROLLER&&a.structureType!==STRUCTURE_ROAD&&a.structureType!==STRUCTURE_WALL&&(0===m.length||0<a.pos.getRangeTo(f.objectsClosestToObj(m,a)[0]))}),t=_.filter(q,function(a){return a.structureType===STRUCTURE_NUKER||(!a.energy||0===a.energy)&&(!a.store||0===_.sum(a.store))&&(!a.mineralAmount||0===a.mineralAmount)}),u=_.filter(q,function(a){return a.structureType!==STRUCTURE_NUKER&&(a.energy&&0<a.energy||a.store&&0<_.sum(a.store)||a.mineralAmount&&0<a.mineralAmount)}),
B=_.filter(c.find(FIND_STRUCTURES),function(a){return-1!==[STRUCTURE_WALL,STRUCTURE_ROAD].indexOf(a.structureType)}),D.collectEnergy.cleanupTasks=e.getCleanupTasks(u),D.collectMinerals.cleanupTasks=r.getCleanupTasks(u),D.pickupResource.tasks=h.getTasks(c),D.remoteDismantle.cleanupTasks=[].concat.apply([],[g.getCleanupTasks(t),g.getCleanupTasks(m),g.getCleanupTasks(B)]),0===u.length&&0===D.remoteDismantle.cleanupTasks.length&&0===D.pickupResource.tasks.length&&(Game.notify("Cleanup Room "+c.name+" is squeaky clean!"),
_.forEach(d.creeps[k]&&d.creeps[k].remoteCollector||[],function(a){a.memory.role="storer";a.memory.home=E.name}),_.forEach(d.creeps[k]&&d.creeps[k].remoteDismantler||[],function(a){a.memory.role="upgrader";a.memory.home=E.name}),n.setRoomType(c.name))),(c.unobservable||0<q.length||0<m.length||0<B.length)&&a.checkSpawn(c,E,Math.min(q.length+m.length+B.length,8)),b.checkSpawn(c,E,0<D.collectEnergy.cleanupTasks||D.collectMinerals.cleanupTasks?E.controller?E.controller.level:3:1),a.assignTasks(c,D),b.assignTasks(c,
D)};q.prototype.toObj=function(a){Memory.rooms[a.name].roomType={type:this.type,supportRoom:this.supportRoom}};q.fromObj=function(a){return new q(a.roomType.supportRoom)};Memory.profiling&&c(1,35).registerObject(q,"RoomCleanup");m.exports=q;return m.exports};u[36]=function(m,k){var d=c(3,36),n=c(4,36),f=c(10,36),a=c(19,36),b=c(22,36),e=c(25,36),r=c(26,36),g=c(27,36),l=c(28,36),p=c(39,36),h=c(43,36),q=c(44,36),t=c(45,36),u=function(a,b){this.type="mine";this.supportRoom=a;this.stage=b||1};u.prototype.convert=
function(a,b){var c=this,e=a.name;b=Memory.rooms[e];var g=b.roomType.type;n.setRoomType(e,{type:"base",region:b.region});n.claimRoom(this.supportRoom,e,!1);switch(g){case "mine":_.forEach(d.creeps[e]&&d.creeps[e].all||[],function(b){var d=b.memory;switch(d.role){case "remoteBuilder":case "remoteWorker":d.role="worker";d.home=e;d.homeSource=f.objectsClosestToObj(a.find(FIND_SOURCES),b)[0].id;break;case "remoteReserver":b.suicide();break;case "remoteStorer":d.role="storer";d.home=c.supportRoom;break;
case "dismantler":d.home=e,d.supportRoom=e}})}};u.prototype.stage1Tasks=function(a,b){b={fillEnergy:{storageTasks:q.getStorageTasks(b),containerTasks:q.getContainerTasks(b)},fillMinerals:{storageTasks:t.getStorageTasks(b),terminalTasks:t.getTerminalTasks(b)},dismantle:{tasks:[]}};a.unobservable||(b.build={tasks:p.getTasks(a)});return b};u.prototype.stage1Spawn=function(a){r.checkSpawn(a);b.checkSpawn(a)};u.prototype.stage1AssignTasks=function(d,c){r.assignTasks(d,c);b.assignTasks(d);e.assignTasks(d,
c);l.assignTasks(d,c);g.assignTasks(d,c);a.assignTasks(d,c)};u.prototype.stage1Manage=function(a,b){var c=b.name,e,g,h,l,k;a.unobservable||(e=[].concat.apply([],[a.find(FIND_SOURCES),/^[EW][1-9][0-9]*5[NS][1-9][0-9]*5$/.test(a.name)?a.find(FIND_MINERALS):[]]),g=d.containersInRoom(a),h=a.name,g.length>=e.length?(this.stage=2,_.forEach(g,function(b){var c=f.objectsClosestToObj([].concat.apply([],[e,a.find(FIND_MINERALS)]),b)[0];if(!(c instanceof Mineral))return _.forEach(d.creeps[h]&&d.creeps[h].remoteBuilder||
[],function(a){a.memory.role="remoteWorker";a.memory.container=f.objectsClosestToObj(g,c)[0].id}),!1})):(k=a.find(FIND_MY_CONSTRUCTION_SITES),0===k.length&&_.forEach(e,function(c){var e=PathFinder.search(c.pos,{pos:d.spawnsInRoom(b)[0].pos,range:1},{swampCost:1}).path[0];0===_.filter(e.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&0===_.filter(k,function(a){return a.pos.x===e.x&&a.pos.y===e.y&&a.structureType===STRUCTURE_CONTAINER}).length&&a.createConstructionSite(e.x,
e.y,STRUCTURE_CONTAINER)}),l=h+"-defense",0<_.filter(d.hostilesInRoom(a),function(a){return a.owner&&"Invader"===a.owner.username}).length?Memory.army[l]||n.createArmy(l,{reinforce:!1,region:a.memory.region,boostRoom:void 0,buildRoom:c,stageRoom:c,attackRoom:h,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:1,units:Math.min(Math.floor((b.energyCapacityAvailable-300)/300),20)},melee:{maxCreeps:1,units:Math.min(Math.floor((b.energyCapacityAvailable-300)/130),20)},ranged:{maxCreeps:0,
units:20}}):Memory.army[l]&&(Memory.army[l].directive="attack",Memory.army[l].success=!0)))};u.prototype.stage1=function(a,b){var d=this.stage1Tasks(a,b);this.stage1Spawn(a);this.stage1AssignTasks(a,d);this.stage1Manage(a,b)};u.prototype.stage2Manage=function(a,b){var c=a.name,e=b.name,f;a.unobservable?0===(d.creeps[c]&&d.creeps[c].remoteMiner||[]).length&&0===(d.creeps[c]&&d.creeps[c].remoteWorker||[]).length&&0===(d.creeps[c]&&d.creeps[c].remoteStorer||[]).length&&0===(d.creeps[c]&&d.creeps[c].remoteReserver||
[]).length&&(this.stage=1):(f=[].concat.apply([],[a.find(FIND_SOURCES),/^[EW][1-9][0-9]*5[NS][1-9][0-9]*5$/.test(a.name)?a.find(FIND_MINERALS):[]]),d.containersInRoom(a).length<f.length?this.stage=1:(f=c+"-defense",0<_.filter(d.hostilesInRoom(a),function(a){return a.owner&&"Invader"===a.owner.username}).length?Memory.army[f]||n.createArmy(f,{reinforce:!1,region:a.memory.region,boostRoom:void 0,buildRoom:e,stageRoom:e,attackRoom:c,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:1,
units:Math.min(Math.floor((b.energyCapacityAvailable-300)/300),20)},melee:{maxCreeps:1,units:Math.min(Math.floor((b.energyCapacityAvailable-300)/130),20)},ranged:{maxCreeps:0,units:20}}):Memory.army[f]&&(Memory.army[f].directive="attack",Memory.army[f].success=!0)))};u.prototype.stage2Spawn=function(b,c){var f=Memory.dismantle;0<d.hostilesInRoom(b).length||(r.checkSpawn(b),e.checkSpawn(b),l.checkSpawn(b),g.checkSpawn(b),f&&f[b.name]&&0<f[b.name].length&&a.checkSpawn(b,c))};u.prototype.stage2Tasks=
function(a,b){var c=a.name,e=0<f.creepsWithNoTask(d.creeps[c]&&d.creeps[c].remoteWorker||[]).length||0<f.creepsWithNoTask(d.creeps[c]&&d.creeps[c].remoteStorer||[]).length||0<f.creepsWithNoTask(d.creeps[c]&&d.creeps[c].remoteDismantler||[]).length,g={fillEnergy:{storageTasks:e?q.getStorageTasks(b):[],containerTasks:e?q.getContainerTasks(b):[]},fillMinerals:{storageTasks:e?t.getStorageTasks(b):[],terminalTasks:e?t.getTerminalTasks(b):[]}};if(!a.unobservable){var l=Memory.dismantle;g.dismantle={tasks:[]};
if(l&&l[c]&&0<l[c].length){var k=[];_.forEach(l[c],function(b){var c=a.lookForAt(LOOK_STRUCTURES,b.x,b.y);0===c.length?k.push(b):g.dismantle.tasks=g.dismantle.tasks.concat(_.map(c,function(a){return new h(a.id)}))});_.forEach(k,function(a){_.remove(l[c],function(b){return b.x===a.x&&b.y===a.y})})}else _.forEach(d.creeps[c]&&d.creeps[c].dismantler||[],function(b){b.memory.role="remoteWorker";b.memory.container=d.containersInRoom(a)[0].id})}return g};u.prototype.stage2AssignTasks=function(b,c){r.assignTasks(b,
c);e.assignTasks(b,c);l.assignTasks(b,c);g.assignTasks(b,c);a.assignTasks(b,c)};u.prototype.stage2=function(a,b){this.stage2Manage(a,b);1!==this.stage&&(a.unobservable||this.stage2Spawn(a,b),b=this.stage2Tasks(a,b),this.stage2AssignTasks(a,b))};u.prototype.run=function(a){var b;if(a.unobservable||0!==a.find(FIND_SOURCES).length)if(b=Game.rooms[Memory.rooms[a.name].roomType.supportRoom])a.controller&&a.controller.my?this.convert(a,b):(1===this.stage&&this.stage1(a,b),2===this.stage&&this.stage2(a,
b))};u.prototype.toObj=function(a){Memory.rooms[a.name].roomType={type:this.type,supportRoom:this.supportRoom,stage:this.stage}};u.fromObj=function(a){return new u(a.roomType.supportRoom,a.roomType.stage)};Memory.profiling&&c(1,36).registerObject(u,"RoomMine");m.exports=u;return m.exports};u[37]=function(m,k){var d=c(3,37),n=c(4,37),f=c(10,37),a=c(18,37),b=c(19,37),e=c(20,37),r=c(22,37),g=c(23,37),l=c(25,37),p=c(27,37),h=c(28,37),q=c(39,37),t=c(43,37),u=c(44,37),v=c(45,37),A=function(a,b){this.type=
"source";this.supportRoom=a;this.stage=b||1};A.prototype.stage1Tasks=function(a,b){b={fillEnergy:{storageTasks:u.getStorageTasks(b),containerTasks:u.getContainerTasks(b)},fillMinerals:{storageTasks:v.getStorageTasks(b),terminalTasks:v.getTerminalTasks(b)},dismantle:{tasks:[]}};a.unobservable||(b.build={tasks:q.getTasks(a)});return b};A.prototype.stage1Spawn=function(b){var c=b.name;a.checkSpawn(b);e.checkSpawn(b);d.creeps[c]&&d.creeps[c].defender&&0!==_.filter(d.creeps[c].defender,function(a){return!a.spawning}).length&&
r.checkSpawn(b)};A.prototype.stage1AssignTasks=function(c,d){a.assignTasks(c,d);e.assignTasks(c,d);r.assignTasks(c);l.assignTasks(c,d);h.assignTasks(c,d);p.assignTasks(c,d);g.assignTasks(c,d);b.assignTasks(c,d)};A.prototype.stage1Manage=function(a,b){var c=b.name,e,g,h,l,k;a.unobservable||(e=[].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),g=d.containersInRoom(a),h=a.name,g.length===e.length?(this.stage=2,_.forEach(g,function(b){var c=f.objectsClosestToObj([].concat.apply([],[e,a.find(FIND_MINERALS)]),
b)[0];if(!(c instanceof Mineral))return _.forEach(d.creeps[h]&&d.creeps[h].remoteBuilder||[],function(a){a.memory.role="remoteWorker";a.memory.container=f.objectsClosestToObj(g,c)[0].id}),!1})):(k=a.find(FIND_MY_CONSTRUCTION_SITES),0===k.length&&_.forEach(e,function(c){var e=PathFinder.search(c.pos,{pos:d.spawnsInRoom(b)[0].pos,range:1},{swampCost:1}).path[0];0===_.filter(e.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&0===_.filter(k,function(a){return a.pos.x===
e.x&&a.pos.y===e.y&&a.structureType===STRUCTURE_CONTAINER}).length&&a.createConstructionSite(e.x,e.y,STRUCTURE_CONTAINER)}),l=h+"-defense",0<_.filter(d.hostilesInRoom(a),function(a){return a.owner&&"Invader"===a.owner.username}).length?Memory.army[l]||n.createArmy(l,{reinforce:!1,region:a.memory.region,boostRoom:void 0,buildRoom:c,stageRoom:c,attackRoom:h,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:2,units:17},melee:{maxCreeps:2,units:20},ranged:{maxCreeps:0,units:20}}):Memory.army[l]&&
(Memory.army[l].directive="attack",Memory.army[l].success=!0)))};A.prototype.stage1=function(a,b){var c=this.stage1Tasks(a,b);this.stage1Spawn(a);this.stage1AssignTasks(a,c);this.stage1Manage(a,b)};A.prototype.stage2Manage=function(a,b){var c=a.name;b=b.name;var e=d.creeps[c];a.unobservable?0===(e&&e.remoteMiner||[]).length&&0===(e&&e.remoteWorker||[]).length&&0===(e&&e.remoteStorer||[]).length&&(this.stage=1):(e=[].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),d.containersInRoom(a).length!==
e.length&&(this.stage=1),e=c+"-defense",0<_.filter(d.hostilesInRoom(a),function(a){return a.owner&&"Invader"===a.owner.username}).length?Memory.army[e]||n.createArmy(e,{reinforce:!1,region:a.memory.region,boostRoom:void 0,buildRoom:b,stageRoom:b,attackRoom:c,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:2,units:17},melee:{maxCreeps:2,units:20},ranged:{maxCreeps:0,units:20}}):Memory.army[e]&&(Memory.army[e].directive="attack",Memory.army[e].success=!0))};A.prototype.stage2Spawn=
function(c,f){var k=c.name,r=Memory.dismantle;a.checkSpawn(c);e.checkSpawn(c);d.creeps[k]&&d.creeps[k].defender&&0!==_.filter(d.creeps[k].defender,function(a){return!a.spawning}).length&&(l.checkSpawn(c),h.checkSpawn(c),p.checkSpawn(c),g.checkSpawn(c,f),r&&r[k]&&0<r[k].length&&b.checkSpawn(c,f))};A.prototype.stage2Tasks=function(a,b){var c=a.name,e=0<f.creepsWithNoTask(d.creeps[c]&&d.creeps[c].remoteWorker||[]).length||0<f.creepsWithNoTask(d.creeps[c]&&d.creeps[c].remoteStorer||[]).length||0<f.creepsWithNoTask(d.creeps[c]&&
d.creeps[c].remoteDismantler||[]).length,g={fillEnergy:{storageTasks:e?u.getStorageTasks(b):[],containerTasks:e?u.getContainerTasks(b):[]},fillMinerals:{storageTasks:e?v.getStorageTasks(b):[],terminalTasks:e?v.getTerminalTasks(b):[]}};if(!a.unobservable){var h=Memory.dismantle;g.dismantle={tasks:[]};if(h&&h[c]&&0<h[c].length){var l=[];_.forEach(h[c],function(b){var c=a.lookForAt(LOOK_STRUCTURES,b.x,b.y);0===c.length?l.push(b):g.dismantle.tasks=g.dismantle.tasks.concat(_.map(c,function(a){return new t(a.id)}))});
_.forEach(l,function(a){_.remove(h[c],function(b){return b.x===a.x&&b.y===a.y})})}else _.forEach(d.creeps[c]&&d.creeps[c].dismantler||[],function(b){b.memory.role="remoteWorker";b.memory.container=d.containersInRoom(a)[0].id})}return g};A.prototype.stage2AssignTasks=function(c,d){a.assignTasks(c,d);e.assignTasks(c,d);l.assignTasks(c,d);h.assignTasks(c,d);p.assignTasks(c,d);g.assignTasks(c,d);b.assignTasks(c,d)};A.prototype.stage2=function(a,b){this.stage2Manage(a,b);1!==this.stage&&(a.unobservable||
this.stage2Spawn(a,b),b=this.stage2Tasks(a,b),this.stage2AssignTasks(a,b))};A.prototype.run=function(a){var b;if(a.unobservable||0!==a.find(FIND_SOURCES).length)if(b=Game.rooms[Memory.rooms[a.name].roomType.supportRoom])a.controller&&a.controller.my?this.convert(a,b):(1===this.stage&&this.stage1(a,b),2===this.stage&&this.stage2(a,b))};A.prototype.toObj=function(a){Memory.rooms[a.name].roomType={type:this.type,supportRoom:this.supportRoom,stage:this.stage}};A.fromObj=function(a){return new A(a.roomType.supportRoom,
a.roomType.stage)};Memory.profiling&&c(1,37).registerObject(A,"RoomSource");m.exports=A;return m.exports};u[38]=function(m,k){var d=c(3,38),n=c(57,38),f=function(){this.type="attack"};f.prototype.canAssign=function(a){var b=a.room.controller;if(a.spawning||"converter"!==a.memory.role||!b||0===b.level||0===a.getActiveBodyparts(CLAIM))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};f.prototype.run=function(a){a.room.controller&&0!==a.room.controller.level&&0!==!a.getActiveBodyparts(CLAIM)?
(n.moveTo(a,a.room.controller,1),a.attackController(a.room.controller)):delete a.memory.currentTask};f.prototype.toObj=function(a){a.room.controller?a.memory.currentTask={type:this.type}:delete a.memory.currentTask};f.fromObj=function(a){return new f};f.getTask=function(a){if(a.room.controller)return new f};Memory.profiling&&c(1,38).registerObject(f,"TaskAttack");m.exports=f;return m.exports};u[39]=function(m,k){var d=c(3,39),n=c(57,39),f=function(a){this.type="build";this.id=a;this.constructionSite=
Game.getObjectById(a);this.force=!0};f.prototype.canAssign=function(a){if(a.spawning||!a.carry[RESOURCE_ENERGY]||0===a.getActiveBodyparts(WORK))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};f.prototype.run=function(a){var b=this.constructionSite;a.carry[RESOURCE_ENERGY]&&b&&0!==a.getActiveBodyparts(WORK)?(n.moveTo(a,b,Math.max(Math.min(a.pos.getRangeTo(b)-1,3),1)),a.build(b,RESOURCE_ENERGY)===OK&&(Math.min(5*a.getActiveBodyparts(WORK),a.carry[RESOURCE_ENERGY])>=b.progressTotal-b.progress||
a.carry[RESOURCE_ENERGY]<=Math.min(5*a.getActiveBodyparts(WORK)))&&delete a.memory.currentTask):delete a.memory.currentTask};f.prototype.toObj=function(a){this.constructionSite?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};f.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new f(a.memory.currentTask.id)};f.getTasks=function(a){return _.map(a.find(FIND_MY_CONSTRUCTION_SITES),function(a){return new f(a.id)})};Memory.profiling&&c(1,39).registerObject(f,
"TaskBuild");m.exports=f;return m.exports};u[40]=function(m,k){var d=c(3,40),n=c(57,40),f=function(){this.type="claim"};f.prototype.canAssign=function(a){var b=a.room.controller;if(a.spawning||"claimer"!==a.memory.role||!b||b.my||0===a.getActiveBodyparts(CLAIM))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};f.prototype.run=function(a){!a.room.controller||a.room.controller.my||0===!a.getActiveBodyparts(CLAIM)?delete a.memory.currentTask:(n.moveTo(a,a.room.controller,1),a.claimController(a.room.controller))};
f.prototype.toObj=function(a){a.room.controller?a.memory.currentTask={type:this.type}:delete a.memory.currentTask};f.fromObj=function(a){return new f};f.getTask=function(a){if(a.room.controller)return new f};Memory.profiling&&c(1,40).registerObject(f,"TaskClaim");m.exports=f;return m.exports};u[41]=function(m,k){var d=c(3,41),n=c(57,41),f=function(a){this.type="collectEnergy";this.id=a;this.object=Game.getObjectById(a)};f.prototype.canAssign=function(a){var b=this.object;if(a.spawning||150>a.ticksToLive||
_.sum(a.carry)===a.carryCapacity||!b||0===(b.energy||b.store&&b.store[RESOURCE_ENERGY]||0))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};f.prototype.run=function(a){var b=this.object,c,d;150>a.ticksToLive||!b?delete a.memory.currentTask:(c=b.energy||b.store&&b.store[RESOURCE_ENERGY]||0,_.sum(a.carry)===a.carryCapacity||0===c?delete a.memory.currentTask:(n.moveTo(a,b,1),1===a.pos.getRangeTo(b)&&0<(d=_.filter(b.pos.lookFor(LOOK_RESOURCES),function(a){return 50<a.amount})).length?a.pickup(d[0]):
a.withdraw(b,RESOURCE_ENERGY)===OK&&delete a.memory.currentTask))};f.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};f.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new f(a.memory.currentTask.id)};f.getTasks=function(a){var b=_.filter(a.find(FIND_HOSTILE_STRUCTURES),function(a){return(0<a.energy||a.store&&0<a.store[RESOURCE_ENERGY])&&a.structureType!==STRUCTURE_NUKER});return 0<b.length?_.map(b,function(a){return new f(a.id)}):
a.storage&&0<a.storage.store[RESOURCE_ENERGY]?[new f(a.storage.id)]:_.map(_.filter(d.containersInRoom(a),function(a){return 500<=a.store[RESOURCE_ENERGY]}).sort(function(a,b){return b.store[RESOURCE_ENERGY]-a.store[RESOURCE_ENERGY]}),function(a){return new f(a.id)})};f.getStorerTasks=function(a){return _.map(_.filter(d.containersInRoom(a),function(a){return a.store[RESOURCE_ENERGY]&&500<=a.store[RESOURCE_ENERGY]}),function(a){return new f(a.id)})};f.getCleanupTasks=function(a){return _.map(_.filter(a,
function(a){return a.energy||a.store&&a.store[RESOURCE_ENERGY]}).sort(function(a,c){return(a.energy||a.store[RESOURCE_ENERGY])-(c.energy||c.store[RESOURCE_ENERGY])}),function(a){return new f(a.id)})};Memory.profiling&&c(1,41).registerObject(f,"TaskCollectEnergy");m.exports=f;return m.exports};u[42]=function(m,k){var d=c(3,42),n=c(57,42),f=c(10,42),a=function(a,c,d){this.type="collectMinerals";this.id=a;this.resource=c;this.amount=d;this.object=Game.getObjectById(a)};a.prototype.canAssign=function(a){var b=
this.object;if(0>this.amount||a.spawning||150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||this.resource&&this.amount&&(b.structureType===STRUCTURE_LAB&&b.mineralType!==this.resource&&b.mineralAmount<this.amount||b.structureType!==STRUCTURE_LAB&&(b.store[this.resource]||0)<this.amount))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){var b=this.object,c=this.resource,d=a.carry,f=a.carryCapacity,k=this.amount,h;if(0>k||150>a.ticksToLive||!b)delete a.memory.currentTask;
else if(h=b.store,_.sum(a.carry)===a.carryCapacity)delete a.memory.currentTask;else{if(b.structureType===STRUCTURE_LAB){if(null===b.mineralType){delete a.memory.currentTask;return}c=[b.mineralType]}else c=c?[c]:_.filter(_.keys(h),function(a){return a!==RESOURCE_ENERGY&&0<h[a]});0===c.length?delete a.memory.currentTask:(n.moveTo(a,b,1),k?a.withdraw(b,c[0],Math.min(k,f-_.sum(d)))===OK&&delete a.memory.currentTask:a.withdraw(b,c[0])===OK&&delete a.memory.currentTask)}};a.prototype.toObj=function(a){this.object?
a.memory.currentTask={type:this.type,id:this.id,resource:this.resource,amount:this.amount}:delete a.memory.currentTask};a.fromObj=function(b){if(Game.getObjectById(b.memory.currentTask.id))return new a(b.memory.currentTask.id,b.memory.currentTask.resource,b.memory.currentTask.amount)};a.getStorerTasks=function(b){return _.map(_.filter(d.containersInRoom(b),function(a){return 0<_.filter(_.keys(a.store),function(b){return b!==RESOURCE_ENERGY&&500<=a.store[b]}).length}).sort(function(a,b){return _.sum(b.store)-
_.sum(a.store)}),function(b){return new a(b.id)})};a.getCleanupTasks=function(b){return _.map(_.filter(b,function(a){return(a.store||-1!==[STRUCTURE_LAB,STRUCTURE_NUKER,STRUCTURE_POWER_SPAWN].indexOf(a.structureType))&&(0<_.sum(a.store)&&a.store[RESOURCE_ENERGY]<_.sum(a.store)||0<a.mineralAmount||0<a.ghodium||0<a.power)}).sort(function(a,b){return(a.mineralAmount||a.ghodium||a.power||_.sum(a.store)-a.store[RESOURCE_ENERGY])-(b.mineralAmount||b.ghodium||b.power||_.sum(b.store)-b.store[RESOURCE_ENERGY])}),
function(b){return new a(b.id)})};a.getLabTasks=function(b){var c=b.memory,k=c.labsInUse,g=c.labQueue,c=b.storage,l=d.labsInRoom(b),p=[],h,m;g&&(h=g.status,m=g.sourceLabs);k&&(_.forEach(k,function(b){Game.creeps[b.creepToBoost]||p.push(new a(b.id))}),_.forEach(p,function(a){_.remove(k,function(b){return b.id===a.id})}));c&&g&&"clearing"===h&&_.forEach(_.filter(l,function(a){return-1===_.map(k,function(a){return a.id}).indexOf(a.id)&&0<a.mineralAmount}),function(b){p.push(new a(b.id))});c&&k&&_.forEach(_.filter(k,
function(a){return(!a.status||"emptying"===a.status)&&Game.getObjectById(a.id).mineralType&&Game.getObjectById(a.id).mineralType!==a.resource}),function(b){p.push(new a(b.id))});c&&g&&"creating"===h&&!f.roomLabsArePaused(b)&&(0===Game.getObjectById(m[0]).mineralAmount&&0!==Game.getObjectById(m[1]).mineralAmount&&p.push(new a(m[1])),0!==Game.getObjectById(m[0]).mineralAmount&&0===Game.getObjectById(m[1]).mineralAmount&&p.push(new a(m[0])));c&&g&&"returning"===h&&_.forEach(_.filter(l,function(a){return a.mineralType===
g.resource}),function(b){p.push(new a(b.id))});return p};a.getStorageTasks=function(b){var c=[],k;b.controller&&6<=b.controller.level&&(b.storage&&b.memory.labsInUse&&_.forEach(_.filter(b.memory.labsInUse,function(a){return(!a.status||-1!==["filling","refilling"].indexOf(a.status))&&(!Game.getObjectById(a.id).mineralType||Game.getObjectById(a.id).mineralType===("refilling"===a.status?a.oldResource:a.resource))}),function(d){0<("refilling"===d.status?d.oldAmount-Game.getObjectById(d.id).mineralAmount:
d.amount-Game.getObjectById(d.id).mineralAmount)&&c.push(new a(b.storage.id,"refilling"===d.status?d.oldResource:d.resource,"refilling"===d.status?d.oldAmount-Game.getObjectById(d.id).mineralAmount:d.amount-Game.getObjectById(d.id).mineralAmount))}),b.storage&&b.memory.labQueue&&"moving"===b.memory.labQueue.status&&3<=d.labsInRoom(b).length&&!f.roomLabsArePaused(b)&&_.forEach(b.memory.labQueue.children,function(e){(k=_.sum(_.filter(d.labsInRoom(b),function(a){return a.mineralType===e}),function(a){return a.mineralAmount}))<
b.memory.labQueue.amount&&c.push(new a(b.storage.id,e,b.memory.labQueue.amount-k))}),b.storage&&b.terminal&&Memory.reserveMinerals&&_.forEach(b.storage.store,function(d,e){e!==RESOURCE_ENERGY&&(Memory.reserveMinerals[e]?(e.startsWith("X")&&5===e.length?Memory.reserveMinerals[e]-5E3:Memory.reserveMinerals[e])<d&&c.push(new a(b.storage.id,e,d-(e.startsWith("X")&&5===e.length?Memory.reserveMinerals[e]-5E3:Memory.reserveMinerals[e]))):c.push(new a(b.storage.id,e,d)))}),0<d.nukersInRoom(b).length&&8<=
b.controller.level&&(_.forEach(d.nukersInRoom(b),function(d){d.ghodium<d.ghodiumCapacity&&c.push(new a(b.storage.id,RESOURCE_GHODIUM,d.ghodiumCapacity-d.ghodium))}),_.forEach(d.powerSpawnsInRoom(b),function(d){d.power<d.powerCapacity&&b.storage.store[RESOURCE_POWER]&&c.push(new a(b.storage.id,RESOURCE_POWER,Math.min(d.powerCapacity-d.power,b.storage.store[RESOURCE_POWER])))})));return c};a.getTerminalTasks=function(b){var c=[];b.storage&&b.terminal&&Memory.reserveMinerals&&_.forEach(b.terminal.store,
function(d,e){e!==RESOURCE_ENERGY&&Memory.reserveMinerals[e]&&(b.storage.store[e]?b.storage.store[e]<(e.startsWith("X")&&5===e.length?Memory.reserveMinerals[e]-5E3:Memory.reserveMinerals[e])&&c.push(new a(b.terminal.id,e,Math.min(d,(e.startsWith("X")&&5===e.length?Memory.reserveMinerals[e]-5E3:Memory.reserveMinerals[e])-b.storage.store[e]))):c.push(new a(b.terminal.id,e,Math.min(d,e.startsWith("X")&&5===e.length?Memory.reserveMinerals[e]-5E3:Memory.reserveMinerals[e]))))});return c};Memory.profiling&&
c(1,42).registerObject(a,"TaskCollectMinerals");m.exports=a;return m.exports};u[43]=function(m,k){var d=c(3,43),n=c(57,43),f=function(a){this.type="dismantle";this.id=a;this.structure=Game.getObjectById(a);this.force=this.unimportant=!0};f.prototype.canAssign=function(a){if(a.spawning||0<a.carryCapacity&&_.sum(a.carry)===a.carryCapacity||a.spawning||0===a.getActiveBodyparts(WORK))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};f.prototype.run=function(a){var b=this.structure;0<a.carryCapacity&&
_.sum(a.carry)===a.carryCapacity||!this.structure||0===a.getActiveBodyparts(WORK)?delete a.memory.currentTask:(n.moveTo(a,b,1),a.dismantle(b),50*Math.min(a.getActiveBodyparts(WORK),a.carry[RESOURCE_ENERGY])>=b.hits&&delete a.memory.currentTask)};f.prototype.toObj=function(a){this.structure?a.memory.currentTask={type:this.type,id:this.structure.id}:delete a.memory.currentTask};f.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new f(a.memory.currentTask.id)};f.getCleanupTasks=
function(a){return _.map(a,function(a){return new f(a.id)})};Memory.profiling&&c(1,43).registerObject(f,"TaskDismantle");m.exports=f;return m.exports};u[44]=function(m,k){var d=c(3,44),n=c(57,44),f=c(10,44),a=function(a){this.type="fillEnergy";this.id=a;this.object=Game.getObjectById(a)};a.prototype.canAssign=function(a){var b;if(a.spawning||!a.carry[RESOURCE_ENERGY]||this.object.energyCapacity&&this.object.energy===this.object.energyCapacity)return!1;if(this.object.structureType===STRUCTURE_EXTENSION){switch(this.object.room.controller.level){case 7:b=
100;break;case 8:b=200;break;default:b=50}if(a.carry[RESOURCE_ENERGY]<b)return!1}d.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){var b=this.object;b&&(b.energy||_.sum(b.store))!==(b.energyCapacity||b.storeCapacity)?b&&a.carry[RESOURCE_ENERGY]?(n.moveTo(a,b,1),a.transfer(b,RESOURCE_ENERGY)===OK&&delete a.memory.currentTask):delete a.memory.currentTask:delete a.memory.currentTask};a.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id}:
delete a.memory.currentTask};a.fromObj=function(b){if(Game.getObjectById(b.memory.currentTask.id))return new a(b.memory.currentTask.id)};a.getExtensionTasks=function(b){return _.map(_.filter(d.extensionsInRoom(b),function(a){return a.energy<a.energyCapacity}),function(b){return new a(b.id)})};a.getSpawnTasks=function(b){return _.map(_.filter(d.spawnsInRoom(b),function(a){return a.energy<a.energyCapacity}),function(b){return new a(b.id)})};a.getTowerTasks=function(b){return _.map(_.filter(d.towersInRoom(b),
function(a){return.8>a.energy/a.energyCapacity}).sort(function(a,b){return a.energy-b.energy}),function(b){return new a(b.id)})};a.getLabTasks=function(b){return _.map(_.filter(d.labsInRoom(b),function(a){return a.energy<a.energyCapacity}),function(b){return new a(b.id)})};a.getContainerTasks=function(b){var c=_.filter(d.containersInRoom(b),function(a){return _.sum(a.store)<a.storeCapacity});b.storage&&b.storage.my&&_.sum(b.storage.store)<b.storage.storeCapacity&&c.unshift(b.storage);return _.map(c,
function(b){return new a(b.id)})};a.getStorageTasks=function(b){return b.storage&&b.storage.my&&_.sum(b.storage.store)<b.storage.storeCapacity?[new a(b.storage.id)]:[]};a.getLinkTasks=function(b){var c=d.linksInRoom(b);b=d.spawnsInRoom(b);if(0===c.length||0===b.length)return[];c=f.objectsClosestToObj(c,b[0]);return[new a(c[0].id)]};a.getNukerTasks=function(b){b=d.nukersInRoom(b);return 0===b.length?[]:[new a(b[0].id)]};a.getPowerSpawnTasks=function(b){b=d.powerSpawnsInRoom(b);return 0===b.length?
[]:[new a(b[0].id)]};Memory.profiling&&c(1,44).registerObject(a,"TaskFillEnergy");m.exports=a;return m.exports};u[45]=function(m,k){var d=c(3,45),n=c(57,45),f=c(10,45),a=function(a,c){this.type="fillMinerals";this.id=a;this.resources=c;this.object=Game.getObjectById(a)};a.prototype.canAssign=function(a){if(a.spawning||_.sum(a.carry)===a.carry[RESOURCE_ENERGY]||this.resources&&0===_.intersection(_.keys(this.resources),_.filter(_.keys(a.carry),function(b){return b!==RESOURCE_ENERGY&&a.carry[b]})).length||
this.object.structureType===STRUCTURE_NUKER&&this.object.ghodium===this.object.ghodiumCapacity||this.object.structureType===STRUCTURE_POWER_SPAWN&&this.object.power===this.object.powerCapacity)return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){var b=this,c=this.object,d;if(c){if(c.storeCapacity&&0===_.filter(_.keys(a.carry),function(b){return b!==RESOURCE_ENERGY&&0<a.carry[b]}).length||(_.sum(c.store)||0)===c.storeCapacity)return delete a.memory.currentTask,!0;
this.resources?(d=_.intersection(_.keys(this.resources),_.filter(_.keys(a.carry),function(b){return a.carry[b]})).sort(function(a,c){a=b.resources[a];c=b.resources[c];return a===c?0:null===a?1:null===c?-1:a-c}),0===d.length?delete a.memory.currentTask:(n.moveTo(a,c,1),a.transfer(c,d[0],null!==this.resources[d[0]]?Math.min(this.resources[d[0]],a.carry[d[0]]):void 0)===OK&&1===d.length&&delete a.memory.currentTask)):(d=_.filter(_.keys(a.carry),function(b){return b!==RESOURCE_ENERGY&&0<a.carry[b]}),
0===d.length?delete a.memory.currentTask:(n.moveTo(a,c,1),a.transfer(c,d[0])===OK&&0===_.filter(_.keys(a.carry),function(b){return b!==RESOURCE_ENERGY&&0<a.carry[b]}).length&&delete a.memory.currentTask))}else delete a.memory.currentTask};a.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id,resources:this.resources}:delete a.memory.currentTask};a.fromObj=function(b){if(Game.getObjectById(b.memory.currentTask.id))return new a(b.memory.currentTask.id,b.memory.currentTask.resources)};
a.getLabTasks=function(b){var c,k=[];_.forEach(_.filter(b.memory.labsInUse,function(a){return(!a.status||-1!==["filling","refilling"].indexOf(a.status))&&(!Game.getObjectById(a.id).mineralType||Game.getObjectById(a.id).mineralType===("refilling"===a.status?a.oldResource:a.resource))&&Game.getObjectById(a.id).mineralAmount<("refilling"===a.status?a.oldAmount:a.amount)}),function(b){c={};c["refilling"===b.status?b.oldResource:b.resource]=("refilling"===b.status?b.oldAmount:b.amount)-Game.getObjectById(b.id).mineralAmount;
k.push(new a(b.id,c))});b.storage&&3<=d.labsInRoom(b).length&&b.memory.labQueue&&"moving"===b.memory.labQueue.status&&!f.roomLabsArePaused(b)&&(Game.getObjectById(b.memory.labQueue.sourceLabs[0]).mineralAmount<b.memory.labQueue.amount&&(c={},c[b.memory.labQueue.children[0]]=b.memory.labQueue.amount-Game.getObjectById(b.memory.labQueue.sourceLabs[0]).mineralAmount,k.push(new a(b.memory.labQueue.sourceLabs[0],c))),Game.getObjectById(b.memory.labQueue.sourceLabs[1]).mineralAmount<b.memory.labQueue.amount&&
(c={},c[b.memory.labQueue.children[1]]=b.memory.labQueue.amount-Game.getObjectById(b.memory.labQueue.sourceLabs[1]).mineralAmount,k.push(new a(b.memory.labQueue.sourceLabs[1],c))));return k};a.getStorageTasks=function(b){var c=b.storage,d,f;if(c&&c.my&&(!b.terminal||!b.terminal.my))return[new a(c.id)];if(c&&c.my&&_.sum(d=c.store)<c.storeCapacity&&Memory.reserveMinerals)return f={},_.forEach(_.keys(Memory.reserveMinerals),function(a){var b=(a.startsWith("X")&&5===a.length?Memory.reserveMinerals[a]-
5E3:Memory.reserveMinerals[a])-(d[a]||0);0<b&&(f[a]=b)}),[new a(c.id,f)]};a.getTerminalTasks=function(b){return b.terminal&&b.terminal.my&&_.sum(b.terminal.store)<b.terminal.storeCapacity?[new a(b.terminal.id)]:[]};a.getNukerTasks=function(b){b=d.nukersInRoom(b);var c;if(0===b.length)return[];c={};c[RESOURCE_GHODIUM]=b[0].ghodiumCapacity-b[0].ghodium;return 0>=c[RESOURCE_GHODIUM]?[]:[new a(b[0].id,c)]};a.getPowerSpawnTasks=function(b){b=d.powerSpawnsInRoom(b);var c;if(0===b.length)return[];c={};c[RESOURCE_POWER]=
b[0].powerCapacity-b[0].power;return 0>=c[RESOURCE_POWER]?[]:[new a(b[0].id,c)]};Memory.profiling&&c(1,45).registerObject(a,"TaskFillMinerals");m.exports=a;return m.exports};u[46]=function(m,k){var d=c(3,46),n=c(57,46),f=function(a,b){this.type="harvest";this.failIn=a||10;this.source=b};f.prototype.canAssign=function(a){var b=Game.getObjectById(a.memory.homeSource);if(a.spawning||150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||!b||0===a.getActiveBodyparts(WORK)||0===b.energy&&(b=a.room.find(FIND_SOURCES_ACTIVE)[0],
!b))return!1;this.source=b.id;d.creepTasks[a.name]=this;this.toObj(a);return!0};f.prototype.run=function(a){var b=Game.getObjectById(this.source||a.memory.homeSource);150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||!b||0===b.energy||0===a.getActiveBodyparts(WORK)?delete a.memory.currentTask:(n.moveTo(a,b,1),a.harvest(b)!==OK&&(this.failIn--,0===this.failIn&&delete a.memory.currentTask))};f.prototype.toObj=function(a){a.memory.currentTask={type:this.type,failIn:this.failIn,source:this.source}};
f.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.source))return new f(a.memory.currentTask.failIn,a.memory.currentTask.source)};Memory.profiling&&c(1,46).registerObject(f,"TaskHarvest");m.exports=f;return m.exports};u[47]=function(m,k){var d=c(3,47),n=c(57,47),f=function(a){this.type="heal";this.id=a;this.ally=Game.getObjectById(a);this.unimportant=!0};f.prototype.canAssign=function(a,b){if(a.spawning||0===a.getActiveBodyparts(HEAL))return!1;d.creepTasks[a.name]=this;this.toObj(a);
return!0};f.prototype.run=function(a){var b=this.ally;a.hits<a.hitsMax&&a.heal(a);if(!b)return delete a.memory.currentTask,!0;n.moveTo(a,b);b.hits!==b.hitsMax&&a.id!==b.id&&(1>=a.pos.getRangeTo(b)?a.heal(b):3>=a.pos.getRangeTo(b)&&a.rangedHeal(b))};f.prototype.toObj=function(a){this.ally?a.memory.currentTask={type:this.type,id:this.ally.id,unimportant:this.unimportant}:delete a.memory.currentTask};f.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new f(a.memory.currentTask.id)};
f.getTasks=function(a){return _.map(_.filter(a.find(FIND_MY_CREEPS),function(a){return a.hits<a.hitsMax}).sort(function(a,c){return a.hits-c.hits}),function(a){return new f(a.id)})};f.getDefenderTask=function(a){return _.map(_.filter(a.room.find(FIND_MY_CREEPS),function(b){return b.hits<b.hitsMax&&b.id!==a.id}).sort(function(a,c){return a.hits-c.hits}),function(a){return new f(a.id)})[0]};Memory.profiling&&c(1,47).registerObject(f,"TaskHeal");m.exports=f;return m.exports};u[48]=function(m,k){var d=
c(3,48),n=c(57,48),f=function(a){this.type="meleeAttack";this.id=a;this.enemy=Game.getObjectById(a)};f.prototype.canAssign=function(a){if(a.spawning||0===a.getActiveBodyparts(ATTACK))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};f.prototype.run=function(a){this.enemy?0===a.getActiveBodyparts(ATTACK)?(a.say("Help!"),delete a.memory.currentTask):(n.moveTo(a,this.enemy),a.attack(this.enemy)===ERR_NOT_IN_RANGE&&a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a),0<a.getActiveBodyparts(RANGED_ATTACK)&&
a.rangedAttack(this.enemy)):(a.say("Get Rekt!",!0),delete a.memory.currentTask)};f.prototype.toObj=function(a){this.enemy?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};f.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new f(a.memory.currentTask.id)};f.getTasks=function(a){return _.map(d.hostilesInRoom(a).sort(function(a,c){return a.hits-c.hits}),function(a){return new f(a.id)})};Memory.profiling&&c(1,48).registerObject(f,"TaskMeleeAttack");
m.exports=f;return m.exports};u[49]=function(m,k){var d=c(3,49),n=c(57,49),f=c(10,49),a=function(a){this.type="mine";this.id=a;this.source=Game.getObjectById(a);this.force=!0};a.prototype.canAssign=function(a){var b=Game.getObjectById(a.memory.container);if(a.spawning||!b||0===a.getActiveBodyparts(WORK))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){var b=Game.getObjectById(a.memory.container),c;b?(b.pos.x===a.pos.x&&b.pos.y===a.pos.y&&b.pos.roomName===a.pos.roomName||
n.moveTo(a,b,0),b.pos.x===a.pos.x&&b.pos.y===a.pos.y&&b.pos.roomName===a.pos.roomName&&(this.source?c=this.source:(c=Memory.containerSource[a.memory.container]?Game.getObjectById(Memory.containerSource[a.memory.container]):f.objectsClosestToObj([].concat.apply([],[b.room.find(FIND_SOURCES),b.room.find(FIND_MINERALS)]),a)[0],this.id=c.id),c instanceof Mineral&&0===c.mineralAmount&&(a.say(":(",!0),a.suicide()),c instanceof Mineral&&1500<=_.sum(b.store)||(a.harvest(c),0<_.filter([].concat.apply([],[d.creeps[a.room.name]&&
d.creeps[a.room.name].miner||[],d.creeps[a.room.name]&&d.creeps[a.room.name].remoteMiner||[]]),function(b){return b.room.name===a.room.name&&b.memory.container===a.memory.container&&1===b.pos.getRangeTo(a)&&b.ticksToLive>a.ticksToLive&&0===b.fatigue}).length&&(a.say(":(",!0),a.suicide())))):delete a.memory.currentTask};a.prototype.toObj=function(a){a.memory.currentTask={type:this.type,id:this.id}};a.fromObj=function(b){if(!b.memory.currentTask.id||Game.getObjectById(b.memory.currentTask.id))return new a(b.memory.currentTask.id)};
Memory.profiling&&c(1,49).registerObject(a,"TaskMine");m.exports=a;return m.exports};u[50]=function(m,k){var d=c(3,50),n=c(41,50),f=c(10,50),a=c(57,50),b=function(a){this.type="pickupResource";this.id=a;this.resource=Game.getObjectById(a);this.force=!0};b.prototype.canAssign=function(a){if(a.spawning||150>a.ticksToLive||!this.resource||_.sum(a.carry)===a.carryCapacity||this.resource.amount<a.pos.getRangeTo(this.resource)||this.resource.resourceType===RESOURCE_ENERGY&&50>this.resource.amount||this.resource.room.controller&&
-1!==Memory.allies.indexOf(f.getControllerOwner(this.resource.room.controller)))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};b.prototype.run=function(b){if(this.resource&&_.sum(b.carry)!==b.carryCapacity){if(a.moveTo(b,this.resource,1),b.pickup(this.resource)===OK){delete b.memory.currentTask;var c=_.filter(b.room.lookForAt(LOOK_STRUCTURES,this.resource),function(a){return a.structureType===STRUCTURE_CONTAINER&&a.store[RESOURCE_ENERGY]});0<c.length&&(new n(c[0].id)).canAssign(b)}}else delete b.memory.currentTask};
b.prototype.toObj=function(a){this.resource?a.memory.currentTask={type:this.type,id:this.resource.id}:delete a.memory.currentTask};b.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new b(a.memory.currentTask.id)};b.getTasks=function(a){return _.map(d.resourcesInRoom(a),function(a){return new b(a.id)})};b.getCollectorTasks=function(a){return _.map(_.filter(d.resourcesInRoom(a),function(a){return a.resourceType===RESOURCE_ENERGY}),function(a){return new b(a.id)})};Memory.profiling&&
c(1,50).registerObject(b,"TaskPickupResource");m.exports=b;return m.exports};u[51]=function(m,k){var d=c(3,51),n=c(57,51),f=function(a,b){this.type="rally";this.id=a;this.creep=b;a instanceof RoomPosition?this.rallyPoint=new RoomPosition(a.x,a.y,a.roomName):(this.rallyPoint=Game.getObjectById(a),this.rallyPoint||(this.rallyPoint=new RoomPosition(25,25,a),this.range=5));this.unimportant=!0};f.prototype.canAssign=function(a){if(a.spawning)return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};f.prototype.run=
function(a){var b=this.rallyPoint,c;b?(c=a.room.name===b.roomName||!(b instanceof RoomPosition)||b.pos&&a.room.name===b.pos.roomName?this.range||0:20,a.pos.getRangeTo(b)<=c?0===a.pos.x?a.move(RIGHT):49===a.pos.x?a.move(LEFT):0===a.pos.y?a.move(BOTTOM):49===a.pos.y?a.move(TOP):0<_.filter(a.pos.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_ROAD||a.structureType===STRUCTURE_CONTAINER}).length&&a.move(Math.floor(8*Math.random())):n.moveTo(a,b,c),0<a.getActiveBodyparts(HEAL)&&
(this.heal?a.heal(Game.getObjectById(this.heal)):this.rangedHeal?a.rangedHeal(Game.getObjectById(this.rangedHeal)):a.hits<a.hitsMax&&a.heal(a)),0<a.getActiveBodyparts(ATTACK)&&this.attack&&a.attack(Game.getObjectById(this.attack)),0<a.getActiveBodyparts(RANGED_ATTACK)&&(this.rangedAttack?a.rangedAttack(Game.getObjectById(this.rangedAttack)):a.rangedMassAttack())):delete a.memory.currentTask};f.prototype.toObj=function(a){this.rallyPoint?a.memory.currentTask={type:this.type,id:this.id,unimportant:this.unimportant,
range:this.range}:delete a.memory.currentTask};f.fromObj=function(a){var b;if(b=a.memory.currentTask.id.roomName?new f(new RoomPosition(a.memory.currentTask.id.x,a.memory.currentTask.id.y,a.memory.currentTask.id.roomName)):new f(a.memory.currentTask.id),a.memory.currentTask.range)b.range=a.memory.currentTask.range;return b};f.getHarvesterTasks=function(a){return _.map(_.filter(a,function(a){return!a.spawning&&150<=a.ticksToLive&&a.memory.homeSource}),function(a){return new f(a.memory.homeSource,a)})};
f.getDefenderTask=function(a){var b=d.sourceKeepersInRoom(a.room).sort(function(a,b){return a.ticksToSpawn-b.ticksToSpawn})[0];return b&&a.room.name===a.memory.home?new f(b.id,a):new f(a.memory.home,a)};f.getClaimerTask=function(a){return new f(a.memory.claim,a)};Memory.profiling&&c(1,51).registerObject(f,"TaskRally");m.exports=f;return m.exports};u[52]=function(m,k){var d=c(3,52),n=c(57,52),f=function(a){this.type="rangedAttack";this.id=a;this.enemy=Game.getObjectById(a)};f.prototype.canAssign=function(a){if(a.spawning||
0===a.getActiveBodyparts(RANGED_ATTACK))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};f.prototype.run=function(a){this.enemy?0===a.getActiveBodyparts(RANGED_ATTACK)?(a.say("Help!"),delete a.memory.currentTask):0<a.getActiveBodyparts(ATTACK)?(n.moveTo(a,this.enemy),a.attack(this.enemy)===ERR_NOT_IN_RANGE&&a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a),0<a.getActiveBodyparts(RANGED_ATTACK)&&a.rangedAttack(this.enemy)):(n.moveTo(a,this.enemy,3),a.rangedAttack(this.enemy),a.hits<
a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a)):(a.say("Get Rekt!",!0),delete a.memory.currentTask)};f.prototype.toObj=function(a){this.enemy?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};f.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new f(a.memory.currentTask.id)};f.getTasks=function(a){return _.map(d.hostilesInRoom(a).sort(function(a,c){return a.hits-c.hits}),function(a){return new f(a.id)})};Memory.profiling&&c(1,52).registerObject(f,
"TaskRangedAttack");m.exports=f;return m.exports};u[53]=function(m,k){var d=c(3,53),n=c(57,53),f=function(a){this.type="repair";this.id=a;this.structure=Game.getObjectById(a);this.force=!0};f.prototype.canAssign=function(a){if(a.spawning||!a.carry[RESOURCE_ENERGY]||0===a.carry[RESOURCE_ENERGY]||0===a.getActiveBodyparts(WORK)||1E6<=this.structure.hits&&"worker"===a.memory.role&&a.room.name===a.memory.home&&8>a.room.controller.level&&!_.find(a.body,function(a){return a.type===WORK&&-1!==[RESOURCE_CATALYZED_LEMERGIUM_ACID,
RESOURCE_LEMERGIUM_ACID,RESOURCE_LEMERGIUM_HYDRIDE].indexOf(a.boost)}))return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};f.prototype.run=function(a){var b=this.structure;a.carry[RESOURCE_ENERGY]&&b&&b.hits!==b.hitsMax&&0!==a.getActiveBodyparts(WORK)?(n.moveTo(a,b,Math.max(Math.min(a.pos.getRangeTo(b)-1,3),1)),a.repair(b)===OK&&100*Math.min(a.getActiveBodyparts(WORK),a.carry[RESOURCE_ENERGY])>=b.hitsMax-b.hits&&delete a.memory.currentTask):delete a.memory.currentTask};f.prototype.toObj=function(a){this.structure?
a.memory.currentTask={type:this.type,id:this.structure.id}:delete a.memory.currentTask};f.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new f(a.memory.currentTask.id)};f.getTowerTasks=function(a){return _.map(_.take(_.filter(d.sortedRepairableStructuresInRoom(a),function(a){return 1E4>a.hits&&.25>a.hits/a.hitsMax}),5),function(a){return new f(a.id)})};f.getCriticalTasks=function(a){return _.map(_.take(_.filter(d.sortedRepairableStructuresInRoom(a),function(a){return 125E3>
a.hits&&.5>a.hits/a.hitsMax}),5),function(a){return new f(a.id)})};f.getTasks=function(a){return _.map(_.take(_.filter(d.sortedRepairableStructuresInRoom(a),function(a){return.9>a.hits/a.hitsMax||1E5<a.hitsMax-a.hits}),5),function(a){return new f(a.id)})};Memory.profiling&&c(1,53).registerObject(f,"TaskRepair");m.exports=f;return m.exports};u[54]=function(m,k){var d=c(3,54),n=c(57,54),f=function(a){this.type="reserve";this.force=!0};f.prototype.canAssign=function(a){if(a.spawning||0===a.getActiveBodyparts(CLAIM)||
!Game.rooms[a.memory.home]||!Game.rooms[a.memory.home].controller||Game.rooms[a.memory.home].controller.my)return!1;d.creepTasks[a.name]=this;this.toObj(a);return!0};f.prototype.run=function(a){a.say("You;spin;me;right;round;baby;right;round;like a;record;baby;right;round;round;round;".split(";")[Game.time%16],!0);Game.rooms[a.memory.home]&&Game.rooms[a.memory.home].controller&&!Game.rooms[a.memory.home].controller.my&&0!==a.getActiveBodyparts(CLAIM)?(n.moveTo(a,Game.rooms[a.memory.home].controller,
1),a.reserveController(Game.rooms[a.memory.home].controller),!Memory.signs||!Memory.signs[a.room.name]||a.room.controller.sign&&"roncli"===a.room.controller.sign.username||a.signController(a.room.controller,Memory.signs[a.room.name])):delete a.memory.currentTask};f.prototype.toObj=function(a){a.memory.currentTask={type:this.type}};f.fromObj=function(a){return new f};f.getTask=function(a){if(a.room.controller)return new f};f.getRemoteTask=function(a){if(Game.rooms[a.memory.home]&&Game.rooms[a.memory.home].controller)return new f};
Memory.profiling&&c(1,54).registerObject(f,"TaskReserve");m.exports=f;return m.exports};u[55]=function(m,k){var d=c(3,55),n=c(57,55),f=c(10,55),a=function(a){this.type="upgradeController";this.room=a;this.controller=Game.rooms[a].controller;this.force=!0};a.prototype.canAssign=function(a){if(a.spawning||!a.carry[RESOURCE_ENERGY]||"upgrader"!==a.memory.role&&_.sum(a.carry)!==a.carryCapacity&&150<=a.ticksToLive&&1E3<=this.controller.ticksToDowngrade||0===a.getActiveBodyparts(WORK))return!1;d.creepTasks[a.name]=
this;this.toObj(a);return!0};a.prototype.run=function(a){a.say("I've;got to;celebrate;you baby;I've got;to praise;GCL like;I should!;".split(";")[Game.time%9],!0);if(this.controller&&a.carry[RESOURCE_ENERGY]&&0!==a.getActiveBodyparts(WORK)){if("upgrader"===a.memory.role){var b=f.objectsClosestToObj(d.linksInRoom(a.room),a);0<b.length&&0<b[0].energy&&1>=a.pos.getRangeTo(b[0])&&a.withdraw(b[0],RESOURCE_ENERGY)}n.moveTo(a,this.controller,Math.max(Math.min(a.pos.getRangeTo(this.controller)-1,3),1));a.transfer(this.controller,
RESOURCE_ENERGY);!Memory.signs||!Memory.signs[a.room.name]||this.controller.sign&&"roncli"===this.controller.sign.username||a.signController(this.controller,Memory.signs[a.room.name]);a.carry[RESOURCE_ENERGY]<=a.getActiveBodyparts(WORK)&&delete a.memory.currentTask}else delete a.memory.currentTask};a.prototype.toObj=function(a){a.memory.currentTask={type:this.type,room:this.room}};a.fromObj=function(b){return new a(b.memory.currentTask.room)};a.getCriticalTasks=function(b){var c;if(b.controller&&
b.controller.my){switch(b.controller.level){case 1:c=1E4;break;case 2:c=3500;break;case 3:c=5E3;break;case 4:c=1E4;break;case 5:c=2E4;break;case 6:c=3E4;break;case 7:c=5E4;break;case 8:c=1E5}if(b.controller.ticksToDowngrade<c)return[new a(b.name)]}return[]};a.getTasks=function(b){if(b.controller&&b.controller.my)return[new a(b.name)]};Memory.profiling&&c(1,55).registerObject(a,"TaskUpgradeController");m.exports=a;return m.exports};u[56]=function(m,k){var d=c(3,56),n=c(10,56),f=c(48,56),a=c(43,56),
b=c(47,56),e=c(51,56),r=c(52,56);k=function(){};k.attack=function(a,b,c){var d;b&&0!==b.length&&_.forEach(a,function(a){var g;d=b[0];if(1>=a.pos.getRangeTo(d))g=new f(d.id);else{var h=_.filter(b,function(b){return 1>=a.pos.getRangeTo(b)});g=new e(d.id);0<h.length&&(g.attack=h[0].id)}g.canAssign(a)&&(a.memory.currentTask.priority=Game.time,a.say(c))})};k.dismantleArmyTarget=function(b,c,d,e){if(Game.rooms[c]&&d&&0<d.length){var f=new a(d[0]);_.forEach(b,function(a){f.canAssign(a)&&a.say(e)})}};k.dismantleHostileStructures=
function(b,c,d){if(c=Game.rooms[c])if(c=_.filter(c.find(FIND_HOSTILE_STRUCTURES),function(a){return-1===[STRUCTURE_CONTROLLER,STRUCTURE_RAMPART,STRUCTURE_KEEPER_LAIR].indexOf(a.structureType)}),0<c.length){var e=new a(c[0].id);_.forEach(b,function(a){e.canAssign(a)&&a.say(d)})}};k.escort=function(a,c){_.forEach(_.filter(a,function(a){return!a.spawning&&a.memory.escorting}),function(a){var d=Game.getObjectById(a.memory.escorting);d?0===d.hitsMax-d.hits||d.hits/d.hitsMax>a.hits/a.hitsMax||!(new b(d.id)).canAssign(a)?
(new e(d.id)).canAssign(a):a.say(c):delete a.memory.escorting})};k.getBoost=function(a,b){_.forEach(_.filter(a,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(a){(new e(a.memory.labs[0])).canAssign(a)&&(a.memory.currentTask.priority=Game.time,a.say(b))})};k.heal=function(a,c,d){var f;c&&0!==c.length&&_.forEach(a,function(a){var g;f=c[0];if(a.id===f.id&&2<=c.length)g=new e(c[1].id);else if(3>=a.pos.getRangeTo(f))g=new b(f.id);else{var h;g=new e(f.id);a.hits===a.hitsMax&&(h=_.filter(c,
function(b){return 1>=a.pos.getRangeTo(b)}),0<h.length?g.heal=h[0].id:(h=_.filter(c,function(b){return 3>=a.pos.getRangeTo(b)}),0<h.length&&(g.rangedHeal=h[0].id)))}g.canAssign(a)&&(a.memory.currentTask.priority=Game.time,a.say(d))})};k.moveToPos=function(a,b,c,d){var f=new e(b);c&&(f.range=c);_.forEach(a,function(a){f.canAssign(a)&&a.say(d)})};k.moveToRoom=function(a,b,c){_.forEach(a,function(a){var f=a.memory.portals;a.memory.portaling&&f[0]!==a.room.name&&f.shift();f&&0<f.length?f[0]===a.room.name?
(a.memory.portaling=!0,f=new e(d.portalsInRoom(a.room)[0].id)):f=new e(f[0]):f=new e(b);f.canAssign(a)&&a.say(c)})};k.rangedAttack=function(a,b,c){var d;b&&0!==b.length&&_.forEach(a,function(a){var f;d=b[0];if(1>=a.pos.getRangeTo(d))f=new r(d.id);else{var g=_.filter(b,function(b){return 3>=a.pos.getRangeTo(b)});f=new e(d.id);0<g.length&&(f.rangedAttack=g[0].id)}f.canAssign(a)&&(a.memory.currentTask.priority=Game.time,a.say(c))})};k.retreatArmyUnit=function(a,b,c,d,f,k){if(b&&0!==b.length&&c!==d){var g=
new e(c);_.forEach(_.filter(a,function(a){return(a.room.name===d||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&a.hits/a.hitsMax<f}),function(a){g.canAssign(a)&&(a.memory.currentTask.priority=Game.time,a.say(k))})}};k.retreatArmyUnitOrMoveToHealer=function(a,b,c,d,f,k){var g;if(b&&0!==b.length){if(c!==d){var h=new e(c);_.forEach(_.filter(a,function(a){return(a.room.name===d||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&a.hits/a.hitsMax<f}),function(a){h.canAssign(a)&&(a.memory.currentTask.priority=
Game.time,a.say(k))})}g=_.filter(b,function(a){return!a.memory.escorting});0<g.length&&_.forEach(a,function(a){var b=n.objectsClosestToObj(g,a);2<b[0].pos.getRangeTo(a)&&(b=new e(b[0].id),b.canAssign(a)&&(a.memory.currentTask.priority=Game.time))})}};k.stomp=function(a,b,c){b&&0!==b.length&&_.forEach(a,function(a){(new e(n.objectsClosestToObj(b,a)[0])).canAssign(a)&&(a.memory.currentTask.priority=Game.time,a.say(c))})};k.tasks=function(a,b,c,d){_.forEach(b,function(b){_.forEach(a,function(a){b.canAssign(a)&&
a.say(d);return c})})};Memory.profiling&&c(1,56).registerObject(k,"Assign");m.exports=k;return m.exports};u[57]=function(m,k){var d={1:{dx:0,dy:-1},2:{dx:1,dy:-1},3:{dx:1,dy:0},4:{dx:1,dy:1},5:{dx:0,dy:1},6:{dx:-1,dy:1},7:{dx:-1,dy:0},8:{dx:-1,dy:-1}},n=c(3,57),f=c(9,57);k=function(){};k.moveTo=function(a,b,c){var e=a.memory._pathing,g=[],k=a.pos,m=k.x,h=k.y,q=k.roomName,t=Game.time,u,v,w,x,z;b instanceof RoomObject&&(b=b.pos);u=b.x;v=b.y;w=b.roomName;c||(c=0);if(!(k.getRangeTo(b)<=c)){!e||e.dest.x===
u&&e.dest.y===v&&e.dest.room===w||(delete a.memory._pathing,e=void 0);e&&e.restartOn&&-1!==e.restartOn.indexOf(q)&&(delete e.path,delete e.restartOn);e&&((x=m===e.start.x&&h===e.start.y&&q===e.start.room||(49===Math.abs(m-e.start.x)||49===Math.abs(h-e.start.y))&&q!==e.start.room,e.stationary=x?e.stationary+1:0,2<=e.stationary)?(e.path&&0<e.path.length&&(x=d[+e.path[0]],x={x:m+x.dx,y:h+x.dy,room:q,blockedUntil:t+12},x.x!==m||x.y!==h)&&(e.blocked||(e.blocked=[]),e.blocked.push(x)),e.stationary=0,delete e.path,
delete e.restartOn):e.path&&!x&&(1===e.path.length?(delete a.memory._pathing,e=void 0):(e.start={x:m,y:h,room:q},e.path=e.path.substring(1))));if(!e||!e.path)if(x=a.getActiveBodyparts(MOVE),new f(4),z=1+(_.filter(a.body,function(a){return 0<a.hits&&-1===[MOVE,CARRY].indexOf(a.type)}).length+Math.ceil(_.sum(a.carry)/50)-x)/x,e&&e.blocked&&_.remove(e.blocked,function(a){return a.blockedUntil<=t}),x=q+"."+m+"."+h+"."+w+"."+u+"."+v+"."+c+"."+(1>=z?0:1),e&&0!==e.blocked.length||!Memory.paths[x]){b=PathFinder.search(k,
{pos:b,range:c},{plainCost:Math.ceil(1*z),swampCost:Math.ceil(5*z),maxOps:q===w?2E3:1E5,roomCallback:function(b){var c=Game.rooms[b],d;if(q!==b&&(-1!==Memory.avoidRooms.indexOf(b)||q===w&&b!==w&&!a.memory.role.startsWith("remote")&&!a.memory.role.startsWith("army")))return!1;if(c)return d=n.costMatrixForRoom(c),e&&b===q&&_.forEach(e.blocked,function(a){b===a.room&&t<a.blockedUntil&&d.set(a.x,a.y,255)}),d;g.push(b)}});if(!b.path||0===b.path.length)return;e?(e.path=this.serializePath(k,b.path),e.restartOn=
g):e={start:{x:m,y:h,room:q},dest:{x:u,y:v,room:w},path:this.serializePath(k,b.path),stationary:0,blocked:[],restartOn:g};0===e.blocked.length&&10<e.path.length&&(Memory.paths[x]=[e.path,[],t,t],g&&0<g.length&&(Memory.paths[x][1]=g))}else e?(e.path=Memory.paths[x][0],e.restartOn=Memory.paths[x][1]):e={start:{x:m,y:h,room:q},dest:{x:u,y:v,room:w},path:Memory.paths[x][0],stationary:0,blocked:[],restartOn:Memory.paths[x][1]},Memory.paths[x][3]=t;a.move(+e.path[0])!==OK&&--e.stationary;a.memory._pathing=
e}};k.serializePath=function(a,b){return _.map(b,function(c,d){d=0===d?a:b[d-1];switch(c.x-d.x){case 0:case -49:case 49:switch(c.y-d.y){case 0:case -49:case 49:return"";case 1:case -48:return BOTTOM.toString();case -1:case 48:return TOP.toString()}break;case 1:case -48:switch(c.y-d.y){case 0:case -49:case 49:return RIGHT.toString();case 1:case -48:return BOTTOM_RIGHT.toString();case -1:case 48:return TOP_RIGHT.toString()}break;case -1:case 48:switch(c.y-d.y){case 0:case -49:case 49:return LEFT.toString();
case 1:case -48:return BOTTOM_LEFT.toString();case -1:case 48:return TOP_LEFT.toString()}}}).join("")};Memory.profiling&&c(1,57).registerObject(k,"Pathing");m.exports=k;return m.exports};if("object"===typeof module)module.exports=c(0);else return c(0)})();