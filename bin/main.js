var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,v,z){if(z.get||z.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[v]=z.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var v=0;return $jscomp.iteratorPrototype(function(){return v<c.length?{done:!1,value:c[v++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.makeIterator=function(c){$jscomp.initSymbolIterator();var v=c[Symbol.iterator];return v?v.call(c):$jscomp.arrayIterator(c)};$jscomp.arrayFromIterator=function(c){for(var v,z=[];!(v=c.next()).done;)z.push(v.value);return z};$jscomp.arrayFromIterable=function(c){return c instanceof Array?c:$jscomp.arrayFromIterator($jscomp.makeIterator(c))};
$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(c,v){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var z=0,D={next:function(){if(z<c.length){var q=z++;return{value:v(q,c[q]),done:!1}}D.next=function(){return{done:!0,value:void 0}};return D.next()}};D[Symbol.iterator]=function(){return D};return D};
$jscomp.polyfill=function(c,v,z,D){if(v){z=$jscomp.global;c=c.split(".");for(D=0;D<c.length-1;D++){var q=c[D];q in z||(z[q]={});z=z[q]}c=c[c.length-1];D=z[c];v=v(D);v!=D&&null!=v&&$jscomp.defineProperty(z,c,{configurable:!0,writable:!0,value:v})}};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.values",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c,z){return z})}},"es6","es3");$jscomp.findInternal=function(c,v,z){c instanceof String&&(c=String(c));for(var D=c.length,q=0;q<D;q++){var t=c[q];if(v.call(z,t,q,c))return{i:q,v:t}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,z){return $jscomp.findInternal(this,c,z).v}},"es6-impl","es3");
$jscomp.checkStringArgs=function(c,v,z){if(null==c)throw new TypeError("The 'this' value for String.prototype."+z+" must not be null or undefined");if(v instanceof RegExp)throw new TypeError("First argument to String.prototype."+z+" must not be a regular expression");return c+""};
$jscomp.polyfill("String.prototype.startsWith",function(c){return c?c:function(c,z){var v=$jscomp.checkStringArgs(this,c,"startsWith");c+="";var q=v.length,t=c.length;z=Math.max(0,Math.min(z|0,v.length));for(var g=0;g<t&&z<q;)if(v[z++]!=c[g++])return!1;return g>=t}},"es6-impl","es3");$jscomp.polyfill("Number.isFinite",function(c){return c?c:function(c){return"number"!==typeof c?!1:!isNaN(c)&&Infinity!==c&&-Infinity!==c}},"es6-impl","es3");
$jscomp.polyfill("Number.isInteger",function(c){return c?c:function(c){return Number.isFinite(c)?c===Math.floor(c):!1}},"es6-impl","es3");
(function(){function c(c,t){D[c]||(z[c]={exports:{},loaded:!1},D[c]=!0,0===c&&"function"===typeof require?require.main=z[0]:z[c].parent=z[t],v[c].call(this,z[c],z[c].exports),z[c].loaded=!0);return z[c].exports}var v={},z={},D={};v[0]=function(q,t){c(1,0)({optimizePathFinding:!1,cleanUpCreepMemory:!1});var g=c(2,0),m=c(3,0),e=c(4,0),a=c(5,0),b=c(6,0),f=c(7,0),u=c(8,0),d=c(9,0),r=c(10,0),p=c(11,0),h=c(12,0),k=c(13,0),l=c(14,0),n=c(15,0),w=c(16,0),x=c(17,0),A=c(18,0),y=c(19,0),F=c(20,0),B=c(21,0),H=
c(22,0),E=c(23,0),v=c(24,0),z=c(25,0),L=c(26,0),D=c(27,0),C=c(28,0),I=c(29,0),S=c(30,0),T=c(31,0),U=c(32,0),V=c(33,0),W=c(34,0),X=c(35,0),Y=c(36,0),Z=c(37,0),aa=c(38,0),ba=c(39,0),O,N,G={loop:function(){if(10<=Game.cpu.getUsed()){if(9E3>Game.cpu.bucket){Game.notify("CPU started at "+Game.cpu.getUsed().toFixed(2)+" with bucket at "+Game.cpu.bucket.toFixed(0)+", aborting! "+Game.time.toFixed(0));return}Game.notify("CPU started at "+Game.cpu.getUsed().toFixed(2)+", warning! "+Game.time.toFixed(0))}if(Game.cpu.bucket<
Game.cpu.tickLimit)Game.notify("Bucket at "+Game.cpu.bucket.toFixed(0)+", aborting! "+Game.time.toFixed(0));else{var a=function(){var a,b=Game.cpu.getUsed(),d;a="Started at "+b.toFixed(2);G.init();d=Game.cpu.getUsed();a+=(0<a.length?" - ":"")+"init took "+(d-b).toFixed(2);b=d;G.minerals();d=Game.cpu.getUsed();a+=(0<a.length?" - ":"")+"minerals took "+(d-b).toFixed(2);b=d;G.baseMatrixes();d=Game.cpu.getUsed();a+=(0<a.length?" - ":"")+"baseMatrixes took "+(d-b).toFixed(2);b=d;G.deserializeCreeps();
d=Game.cpu.getUsed();a+=(0<a.length?" - ":"")+"deserializeCreeps took "+(d-b).toFixed(2);b=d;G.deserializeRooms();d=Game.cpu.getUsed();a+=(0<a.length?" - ":"")+"deserializeRooms took "+(d-b).toFixed(2);b=d;G.balanceEnergy();d=Game.cpu.getUsed();a+=(0<a.length?" - ":"")+"balanceEnergy took "+(d-b).toFixed(2);b=d;Memory.log&&(G.log(),d=Game.cpu.getUsed(),a+=(0<a.length?" - ":"")+"log took "+(d-b).toFixed(2),b=d);G.rooms();d=Game.cpu.getUsed();a+=(0<a.length?" - ":"")+"rooms took "+(d-b).toFixed(2);
b=d;G.army();d=Game.cpu.getUsed();a+=(0<a.length?" - ":"")+"army took "+(d-b).toFixed(2);b=d;G.creeps();d=Game.cpu.getUsed();a+=(0<a.length?" - ":"")+"creeps took "+(d-b).toFixed(2);b=d;G.debug();d=Game.cpu.getUsed();a+=(0<a.length?" - ":"")+"debug took "+(d-b).toFixed(2);b=d;G.finalize();d=Game.cpu.getUsed();a+=(0<a.length?" - ":"")+"finalize took "+(d-b).toFixed(2);b=d;G.drawGlobal();d=Game.cpu.getUsed();a+=(0<a.length?" - ":"")+"drawGlobal took "+(d-b).toFixed(2);Memory.logCpu&&e.log.events.push(a)};
Memory.profiling?g.wrap(a):a()}},init:function(){var b=Game.time%1500;r.init();e.reset();O||(O=!0,e.log.events.push("System reset."));e.credits<Memory.minimumCredits&&delete Memory.buy;e.credits>=1.5*Memory.minimumCredits&&(Memory.buy=!0);Game.cmd={Army:m,Cache:e,Commands:a,Market:f,Minerals:u,Role:{ArmyDismantler:h,ArmyHealer:k,ArmyMelee:l,ArmyRanged:n,Claimer:w,Collector:x,Converter:A,Defender:y,Dismantler:F,Healer:B,Miner:H,RemoteBuilder:E,RemoteCollector:v,RemoteDismantler:z,RemoteMiner:L,RemoteReserver:D,
RemoteStorer:C,RemoteWorker:I,Scientist:S,Storer:T,Tower:U,Upgrader:V,Worker:W},Room:{Base:X,Cleanup:Y,Mine:Z},Utilities:p};Memory.maxCreeps||(Memory.maxCreeps={});Memory.containerSource||(Memory.containerSource={});Memory.army||(Memory.army={});Memory.avoidRooms||(Memory.avoidRooms=[]);Memory.avoidSquares||(Memory.avoidSquares={});Memory.paths||(Memory.paths={});Memory.lengthToStorage||(Memory.lengthToStorage={});Memory.towerTasks||(Memory.towerTasks={});Memory.stats||(Memory.stats={});Memory.stats.cpu||
(Memory.stats.cpu=[]);Memory.stats.bucket||(Memory.stats.bucket=[]);Memory.stats.gclProgress||(Memory.stats.gclProgress=[]);0===Game.time%10&&(_.forEach(Memory.creeps,function(a,b){Game.creeps[b]||delete Memory.creeps[b]}),_.forEach(Memory.lengthToContainer,function(a,b){Game.getObjectById(b)||delete Memory.lengthToContainer[b]}),_.forEach(Memory.lengthToController,function(a,b){Game.getObjectById(b)||delete Memory.lengthToController[b]}),_.forEach(Memory.lengthToStorage,function(a,b){Game.getObjectById(b)||
delete Memory.lengthToStorage[b]}),_.forEach(Memory.containerSource,function(a,b){Game.getObjectById(b)||delete Memory.containerSource[b]}),_.forEach(Memory.dismantle,function(a,b){0===a.length&&delete Memory.dismantle[b]}),_.forEach(Memory.rooms,function(a,b){a&&a.roomType||delete Memory.rooms[b]}),_.forEach(Memory.maxCreeps,function(a,b){_.forEach(Memory.maxCreeps[b],function(b,d){0===Object.keys(b).length&&delete a[d]})}),_.forEach(Memory.paths,function(a,b){(a[3]<=Game.time-500||a[2]<=Game.time-
1500)&&delete Memory.paths[b]}));delete Memory.flags;switch(b){case 0:Memory.lengthToStorage={};break;case 100:Memory.lengthToContainer={};break;case 200:Memory.lengthToController={};break;case 300:Memory.ranges={}}e.creeps=p.nest(_.filter(Game.creeps,function(a){return a.memory.home||a.memory.army}),[function(a){return a.memory.home||a.memory.army},function(a){return a.memory.role}]);_.forEach(e.creeps,function(a,b){e.creeps[b].all=_.flatten(_.values(a))})},minerals:function(){var a={},b,d;Game.cpu.bucket>=
Memory.marketBucket&&(b=[{resource:RESOURCE_HYDROGEN,amount:3E3},{resource:RESOURCE_OXYGEN,amount:3E3},{resource:RESOURCE_ZYNTHIUM,amount:3E3},{resource:RESOURCE_KEANIUM,amount:3E3},{resource:RESOURCE_UTRIUM,amount:3E3},{resource:RESOURCE_LEMERGIUM,amount:3E3},{resource:RESOURCE_CATALYST,amount:3E3},{resource:RESOURCE_HYDROXIDE,amount:3E3},{resource:RESOURCE_ZYNTHIUM_KEANITE,amount:3E3},{resource:RESOURCE_UTRIUM_LEMERGITE,amount:3E3},{resource:RESOURCE_GHODIUM,amount:3E3},{resource:RESOURCE_UTRIUM_HYDRIDE,
amount:3E3},{resource:RESOURCE_KEANIUM_OXIDE,amount:3E3},{resource:RESOURCE_LEMERGIUM_HYDRIDE,amount:3E3},{resource:RESOURCE_LEMERGIUM_OXIDE,amount:3E3},{resource:RESOURCE_ZYNTHIUM_HYDRIDE,amount:3E3},{resource:RESOURCE_GHODIUM_HYDRIDE,amount:3E3},{resource:RESOURCE_GHODIUM_OXIDE,amount:3E3},{resource:RESOURCE_UTRIUM_ACID,amount:3E3},{resource:RESOURCE_KEANIUM_ALKALIDE,amount:3E3},{resource:RESOURCE_LEMERGIUM_ACID,amount:3E3},{resource:RESOURCE_LEMERGIUM_ALKALIDE,amount:3E3},{resource:RESOURCE_ZYNTHIUM_ACID,
amount:3E3},{resource:RESOURCE_GHODIUM_ACID,amount:3E3},{resource:RESOURCE_GHODIUM_ALKALIDE,amount:3E3},{resource:RESOURCE_CATALYZED_UTRIUM_ACID,amount:15E3},{resource:RESOURCE_CATALYZED_KEANIUM_ALKALIDE,amount:15E3},{resource:RESOURCE_CATALYZED_LEMERGIUM_ACID,amount:15E3},{resource:RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE,amount:15E3},{resource:RESOURCE_CATALYZED_ZYNTHIUM_ACID,amount:15E3},{resource:RESOURCE_CATALYZED_GHODIUM_ACID,amount:15E3},{resource:RESOURCE_CATALYZED_GHODIUM_ALKALIDE,amount:15E3},
{resource:RESOURCE_POWER,amount:3E3}],_.forEach(b,function(a){var b=function(a,b){a.children=_.map(u[a.resource],function(a){return{resource:a}});_.forEach(a.children,function(d){d.amount=a.amount;b(d,b)})};b(a,b)}),Memory.reserveMinerals={},_.forEach(b,function(a){var b=function(a,b){Memory.reserveMinerals[a.resource]||(Memory.reserveMinerals[a.resource]=0);Memory.reserveMinerals[a.resource]=Math.min(Memory.reserveMinerals[a.resource]+a.amount,2E4);_.forEach(a.children,function(a){b(a,b)})};b(a,
b)}),_.forEach(_.uniq(_.map(f.getAllOrders(),function(a){return a.resourceType})),function(b){(d=(f.getFilteredOrders().sell[b]||[])[0])&&(a[b]=d)}),_.forEach(Game.rooms,function(d,f){var l=Infinity,r=d.memory,k=e.creeps[f]&&e.creeps[f].all,x;!d.unobservable&&d.storage&&d.terminal&&d.terminal.my&&d.memory.roomType&&"base"===d.memory.roomType.type&&!(3>e.labsInRoom(d))&&(e.minerals[f]=_.cloneDeep(b),delete r.use,_.forEach(e.minerals[f],function(b){var f=function(b,f){var n,h=b.resource,w=(d.storage.store[h]||
0)+(d.terminal.store[h]||0)+_.sum(k,function(a){return a.carry[h]||0});b.buyPrice=a[h]?a[h].price:Infinity;b.amount=Math.max(b.amount-w,0);_.forEach(b.children,function(a){f(a,f)});if(b.children&&0!==b.children.length)if(n=1.2*_.sum(_.map(b.children,function(a){return a.buyPrice})),b.buyPrice>n){var p=5*Math.floor(((d.storage.store[b.children[0].resource]||0)+(d.terminal.store[b.children[0].resource]||0)+_.sum(k,function(a){return a.carry[b.children[0].resource]||0}))/5),g=5*Math.floor(((d.storage.store[b.children[1].resource]||
0)+(d.terminal.store[b.children[1].resource]||0)+_.sum(k,function(a){return a.carry[b.children[1].resource]||0}))/5);b.amount=Math.min(Math.min(b.amount,p),g);b.action="create";b.buyPrice=n;w<=l&&0<b.amount&&(x=b,l=w)}else b.action="buy";else b.action="buy";0<b.amount&&"buy"===b.action&&!r.buyQueue&&e.credits>=Memory.minimumCredits&&Memory.buy&&(r.buyQueue={resource:h,amount:b.amount,price:b.buyPrice,start:Game.time});b.buyPrice&&(Memory.minimumSell[h]=Math.min(Memory.minimumSell[h]||Infinity,b.buyPrice),
0!==Memory.minimumSell[h]&&Infinity!==Memory.minimumSell[h]||delete Memory.minimumSell[h])};f(b,f)}),x&&!r.labQueue&&(f=function(a,b){var f=a.resource,l;if(!(0>=a.amount)&&"create"===a.action){l=5*Math.floor(((d.storage.store[a.children[0].resource]||0)+(d.terminal.store[a.children[0].resource]||0)+_.sum(k,function(b){return b.carry[a.children[0].resource]||0}))/5);var x=5*Math.floor(((d.storage.store[a.children[1].resource]||0)+(d.terminal.store[a.children[1].resource]||0)+_.sum(k,function(b){return b.carry[a.children[1].resource]||
0}))/5);r.labQueue={resource:f,amount:Math.min(5*Math.ceil(Math.min(Math.min(Math.min(a.amount,l),x),LAB_MINERAL_CAPACITY)/5),3E3),children:_.map(a.children,function(a){return a.resource}),start:Game.time};_.forEach(a.children,function(a){b(a,b)});l=_.sum(a.children,function(a){return a.price});0<a.children.length&&0<l&&(Memory.minimumSell[f]=Math.min(Memory.minimumSell[f]||Infinity,l),0===Memory.minimumSell[f]&&delete Memory.minimumSell[f])}},f(x,f)))}))},baseMatrixes:function(){Memory.baseMatrixes||
(Memory.baseMatrixes={});_.forEach(Memory.baseMatrixes,function(a,b){var d=Game.rooms[b],f,l,r;if(d&&!d.unobservable&&"complete"!==a.status&&0!==e.spawnsInRoom(d).length&&(r=e.repairableStructuresInRoom(d),a.status||(l=new PathFinder.CostMatrix,_.forEach(_.filter(r,function(a){return a.structureType!==STRUCTURE_ROAD}),function(a){l.set(a.pos.x,a.pos.y,255)}),a.tempMatrix=l.serialize(),a.costMatrix=l.serialize(),a.status="building",a.x=0,a.y=0),"building"===a.status)){f=PathFinder.CostMatrix.deserialize(a.tempMatrix);
for(l=PathFinder.CostMatrix.deserialize(a.costMatrix);50>a.x;a.x++){for(;50>a.y;a.y++){if(250<=Game.cpu.getUsed())return a.costMatrix=l.serialize(),!1;PathFinder.search(new RoomPosition(a.x,a.y,b),{pos:e.spawnsInRoom(d)[0].pos,range:1},{roomCallback:function(){return f},maxOps:1E4,maxRooms:1}).incomplete&&l.set(a.x,a.y,255)}a.y=0}_.forEach(_.filter(r,function(a){return a.structureType===STRUCTURE_RAMPART}),function(a){l.set(a.pos.x,a.pos.y,0)});delete a.tempMatrix;delete a.x;delete a.y;a.costMatrix=
l.serialize();a.status="complete"}})},deserializeCreeps:function(){_.forEach(Game.creeps,function(a){a.memory.currentTask&&aa(a)})},deserializeRooms:function(){N=[];_.forEach(Memory.rooms,function(a,b){a.roomType&&(ba(a,b),Game.rooms[b]||N.push({name:b,unobservable:!0}))})},balanceEnergy:function(){var a,b;a=_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&"base"===a.memory.roomType.type&&a.storage&&a.storage.my&&a.terminal&&a.terminal.my}).sort(function(a,b){return a.storage.store[RESOURCE_ENERGY]+
a.terminal.store[RESOURCE_ENERGY]-(b.storage.store[RESOURCE_ENERGY]+b.terminal.store[RESOURCE_ENERGY])});1<a.length&&(b=Math.min(_.sum(_.map(a,function(a){return a.storage.store[RESOURCE_ENERGY]+a.terminal.store[RESOURCE_ENERGY]}))/a.length,5E5),_.forEach(a,function(d,f){f=a[a.length-f-1];var l=d.storage.store[RESOURCE_ENERGY],r=f.storage.store[RESOURCE_ENERGY],k=f.terminal,x=k.store[RESOURCE_ENERGY];if(l>=r||l+d.terminal.store[RESOURCE_ENERGY]>b||r+x<b+1E4)return!1;1E3<=x&&(l=Game.market.calcTransactionCost(x,
f.name,d.name),k.send(RESOURCE_ENERGY,Math.floor(x/(x+l)*x),d.name),e.log.events.push("Sending "+Math.floor(x/(x+l)*x)+" energy from "+f.name+" to "+d.name))}))},log:function(){e.log.creeps=_.map(Game.creeps,function(a){return{creepId:a.id,name:a.name,creepType:a.memory.role,home:a.memory.home,army:a.memory.army,room:a.pos.roomName,x:a.pos.x,y:a.pos.y,spawning:a.spawning,ttl:a.ticksToLive,carryCapacity:a.carryCapacity,carry:a.carry,hits:a.hits,hitsMax:a.hitsMax}});e.log.spawns=_.map(Game.spawns,function(a){return{spawnId:a.id,
name:a.name,room:a.room.name,spawningName:a.spawning?a.spawning.name:void 0,spawningNeedTime:a.spawning?a.spawning.needTime:void 0,spawningRemainingTime:a.spawning?a.spawning.remainingTime:void 0}});_.forEach([].concat.apply([],[_.filter(Game.rooms),N]),function(a){var b=a.name,d=Memory.rooms[b],f=d&&d.roomType&&d.roomType.type?d.roomType.type:"unknown",l,r,k,x,n,h;a.unobservable?e.log.rooms[b]={type:f,supportRoom:d&&d.roomType?d.roomType.supportRoom:void 0,region:d?d.region:void 0,unobservable:!0,
store:{},labs:[],source:[],creeps:[]}:(0===Game.time%10&&(l=e.repairableStructuresInRoom(a)),r=a.find(FIND_MY_CONSTRUCTION_SITES),k=e.towersInRoom(a),x=e.labsInRoom(a),n=e.nukersInRoom(a),h=e.powerSpawnsInRoom(a),e.log.rooms[b]={type:f,supportRoom:d&&d.roomType?d.roomType.supportRoom:void 0,region:d?d.region:void 0,unobservable:!1,controller:!!a.controller,store:{},labs:[],source:[],creeps:[]},e.log.rooms[b].controller&&(e.log.rooms[b].rcl=a.controller.level,a.controller.owner&&(e.log.rooms[b].ownerUsername=
a.controller.owner.username),e.log.rooms[b].progress=a.controller.progress,e.log.rooms[b].progressTotal=a.controller.progressTotal,e.log.rooms[b].ttd=a.controller.ticksToDowngrade),a.controller&&a.controller.reservation&&(e.log.rooms[b].reservedUsername=a.controller.reservation.username,e.log.rooms[b].tte=a.controller.reservation.ticksToEnd),e.log.rooms[b].lowestWall=0===Game.time%10?Math.min.apply(Math,_.map(_.filter(l,function(a){return a.structureType===STRUCTURE_WALL||a.structureType===STRUCTURE_RAMPART}),
function(a){return a.hits})):Memory.console&&Memory.console.rooms&&Memory.console.rooms[b]&&Memory.console.rooms[b].lowestWall||null,a.energyCapacityAvailable&&0<a.energyCapacityAvailable&&(e.log.rooms[b].energyAvailable=a.energyAvailable,e.log.rooms[b].energyCapacityAvailable=a.energyCapacityAvailable),e.log.rooms[b].constructionProgress=_.sum(_.map(r,function(a){return a.progress})),e.log.rooms[b].constructionProgressTotal=_.sum(_.map(r,function(a){return a.progressTotal})),e.log.rooms[b].towerEnergy=
_.sum(_.map(k,function(a){return a.energy})),e.log.rooms[b].towerEnergyCapacity=_.sum(_.map(k,function(a){return a.energyCapacity})),e.log.rooms[b].labEnergy=_.sum(_.map(x,function(a){return a.energy})),e.log.rooms[b].labEnergyCapacity=_.sum(_.map(x,function(a){return a.energyCapacity})),e.log.rooms[b].nukerEnergy=_.sum(_.map(n,function(a){return a.energy})),e.log.rooms[b].nukerEnergyCapacity=_.sum(_.map(n,function(a){return a.energyCapacity})),e.log.rooms[b].nukerGhodium=_.sum(_.map(n,function(a){return a.ghodium})),
e.log.rooms[b].nukerGhodiumCapacity=_.sum(_.map(n,function(a){return a.ghodiumCapacity})),e.log.rooms[b].powerSpawnEnergy=_.sum(_.map(h,function(a){return a.energy})),e.log.rooms[b].powerSpawnEnergyCapacity=_.sum(_.map(h,function(a){return a.energyCapacity})),e.log.rooms[b].powerSpawnPower=_.sum(_.map(h,function(a){return a.power})),e.log.rooms[b].powerSpawnPowerCapacity=_.sum(_.map(h,function(a){return a.powerCapacity})),a.storage&&(e.log.rooms[b].store.storage=_.map(a.storage.store,function(a,b){return{resource:b,
amount:a}})),a.terminal&&(e.log.rooms[b].store.terminal=_.map(a.terminal.store,function(a,b){return{resource:b,amount:a}})),e.log.rooms[b].labs=_.map(x,function(a){return{resource:a.mineralType,amount:a.mineralAmount}}),e.log.rooms[b].labQueue=d.labQueue,e.log.rooms[b].buyQueue=d.buyQueue,_.forEach(a.find(FIND_SOURCES),function(a){e.log.rooms[b].source.push({sourceId:a.id,resource:RESOURCE_ENERGY,amount:a.energy,capacity:a.energyCapacity,ttr:a.ticksToRegeneration})}),_.forEach(a.find(FIND_MINERALS),
function(a){e.log.rooms[b].source.push({sourceId:a.id,resource:a.mineralType,amount:a.mineralAmount,ttr:a.ticksToRegeneration})}),e.log.hostiles=[].concat.apply([],[e.log.hostiles,_.map(e.hostilesInRoom(a),function(a){return{creepId:a.id,ownerUsername:a.owner.username,room:b,x:a.pos.x,y:a.pos.y,ttl:a.ticksToLive,hits:a.hits,hitsMax:a.hitsMax}})]))})},rooms:function(){var a=["base","source","mine","cleanup",""],b=Memory.rooms,d=["source","cleanup"],f=9E3<=Game.cpu.bucket||0===Game.time%2;Memory.rushRoom=
(_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&"base"===a.memory.roomType.type&&a.controller&&8>a.controller.level}).sort(function(a,b){return b.controller.level-a.controller.level||b.controller.progress-a.controller.progress})[0]||{name:""}).name;_.forEach([].concat.apply([],[_.filter(Game.rooms),N]).sort(function(d,f){return a.indexOf(b[d.name]&&b[d.name].roomType&&b[d.name].roomType.type||"")-a.indexOf(b[f.name]&&b[f.name].roomType&&b[f.name].roomType.type||"")}),function(a){var l=
a.name,r=b[l].roomType;e.roomTypes[l]&&((-1!==d.indexOf(r.type)||f)&&e.roomTypes[l].run(a),r.type===e.roomTypes[l].type&&e.roomTypes[l].toObj(a));Memory.visualizations&&!a.unobservable&&G.drawRoom(a)})},drawRoom:function(a){var d=a.visual,f,l,r,k;d||(d=new RoomVisual(a.name));d&&(a.memory&&a.memory.roomType&&d.text(_.capitalize(a.memory.roomType.type),-.5,49.325,{align:"left",font:"0.5 Arial"}),a.controller&&a.controller.level&&(d.text("RCL "+a.controller.level,2.5,49.325,{align:"left",font:"0.5 Arial"}),
a.controller.progress&&a.controller.progressTotal&&b.progressBar(d,5.5,48.9,20,.5,a.controller.progress,a.controller.progressTotal,{background:"#808080",bar:"#00ff00",showDetails:!0,color:"#ffffff",font:"0.5 Arial"})),l=2.125,a.energyCapacityAvailable&&(l+=.7,d.text("Energy",-.5,l,{align:"left",font:"0.5 Arial"}),b.progressBar(d,2.5,l-.425,5,.5,a.energyAvailable,a.energyCapacityAvailable,{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),r=e.towersInRoom(a),0<r.length&&
(l+=.7,d.text("Towers",-.5,l,{align:"left",font:"0.5 Arial"}),b.progressBar(d,2.5,l-.425,5,.5,_.sum(_.map(r,function(a){return a.energy})),_.sum(_.map(r,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),r=e.labsInRoom(a),0<r.length&&(l+=.7,d.text("Labs",-.5,l,{align:"left",font:"0.5 Arial"}),b.progressBar(d,2.5,l-.425,5,.5,_.sum(_.map(r,function(a){return a.energy})),_.sum(_.map(r,function(a){return a.energyCapacity})),{background:"#808080",
bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),k=e.nukersInRoom(a),0<k.length&&(l+=.7,d.text("Nuker",-.5,l,{align:"left",font:"0.5 Arial"}),b.progressBar(d,2.5,l-.425,5,.5,_.sum(_.map(k,function(a){return a.energy})),_.sum(_.map(k,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"}),b.progressBar(d,8.5,l-.425,5,.5,_.sum(_.map(k,function(a){return a.ghodium})),_.sum(_.map(k,function(a){return a.ghodiumCapacity})),
{background:"#808080",bar:"#ffff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),k=e.powerSpawnsInRoom(a),0<k.length&&(l+=.7,d.text("Power Spawn",-.5,l,{align:"left",font:"0.5 Arial"}),b.progressBar(d,2.5,l-.425,5,.5,_.sum(_.map(k,function(a){return a.energy})),_.sum(_.map(k,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"}),b.progressBar(d,8.5,l-.425,5,.5,_.sum(_.map(k,function(a){return a.power})),_.sum(_.map(k,function(a){return a.powerCapacity})),
{background:"#808080",bar:"#ff0000",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),a.memory&&a.memory.buyQueue&&(l+=.7,d.text("Buy",-.5,l,{align:"left",font:"bold 0.5 Arial"}),d.text(a.memory.buyQueue.amount,2.5,l,{align:"right",font:"0.5 Arial"}),b.resource(d,2.8,l-.175,.5,a.memory.buyQueue.resource,{opacity:1})),a.memory&&a.memory.labQueue&&(l+=.7,d.text("Create",-.5,l,{align:"left",font:"bold 0.5 Arial"}),d.text(a.memory.labQueue.amount,2.5,l,{align:"right",font:"0.5 Arial"}),b.resource(d,
2.8,l-.175,.5,a.memory.labQueue.resource,{opacity:1})),0<r.length&&(l+=.7,d.text("Labs",-.5,l,{align:"left",font:"bold 0.5 Arial"}),f=0,_.forEach(r,function(a){f+=2.5;0===a.mineralAmount?d.text("Empty",f,l,{align:"right",font:"0.5 Arial"}):(d.text(a.mineralAmount,f,l,{align:"right",font:"0.5 Arial"}),b.resource(d,f+.3,l-.175,.5,a.mineralType,{opacity:1}))})),a.storage&&(l+=1.4,d.text("Storage",-.5,l,{align:"left",font:"bold 0.5 Arial"}),_.forEach(a.storage.store,function(a,f){f!==RESOURCE_ENERGY&&
(l+=.7,d.text(a,1,l,{align:"right",font:"0.5 Arial"}),b.resource(d,1.3,l-.175,.5,f,{opacity:1}))})),a.storage&&(l+=1.4,d.text("Terminal",-.5,l,{align:"left",font:"bold 0.5 Arial"}),_.forEach(a.terminal.store,function(a,f){f!==RESOURCE_ENERGY&&(l+=.7,d.text(a,1,l,{align:"right",font:"0.5 Arial"}),b.resource(d,1.3,l-.175,.5,f,{opacity:1}))})))},army:function(){_.forEach(Memory.army,function(a,b){e.log.army[b]={directive:a.directive,scheduled:a.scheduled,portals:a.portals,boostRoom:a.boostRoom,buildRoom:a.buildRoom,
stageRoom:a.stageRoom,attackRoom:a.attackRoom,dismantle:a.dismantle.length,creeps:[]};Game.rooms[a.attackRoom]&&(e.log.army[b].structures=_.filter(Game.rooms[Memory.army[b].attackRoom].find(FIND_HOSTILE_STRUCTURES),function(a){return a.structureType!==STRUCTURE_CONTROLLER&&a.structureType!==STRUCTURE_RAMPART&&a.structureType!==STRUCTURE_KEEPER_LAIR}).length,e.log.army[b].constructionSites=Game.rooms[Memory.army[b].attackRoom].find(FIND_HOSTILE_CONSTRUCTION_SITES).length);d.run("main.army.run",function(){return m.run(b)})})},
creeps:function(){_.forEach(Game.creeps,function(a){if(!a.spawning&&!a.memory.stop){if(150>=a.ticksToLive||500>a.ticksToLive&&1===a.ticksToLive%10||1===a.ticksToLive%100)switch(a.ticksToLive-1){case 3:a.say("R.I.P. and",!0);break;case 2:a.say("Pepperonis",!0);break;case 1:a.say(":(",!0);break;default:a.say("TTL "+(a.ticksToLive-1).toString())}a.memory.army&&Memory.army[a.memory.army]&&a.room.name===Memory.army[a.memory.army].attackRoom&&a.say("All my friends are heathens, take it slow.  Wait for them to ask you who you know.  Please don't make any sudden moves.  You don't know the half of the abuse. ".split(" ")[Game.time%
35],!0);switch(Game.time%1E6){case 999990:a.say("TEN!",!0);break;case 999991:a.say("NINE!",!0);break;case 999992:a.say("EIGHT!",!0);break;case 999993:a.say("SEVEN!",!0);break;case 999994:a.say("SIX!",!0);break;case 999995:a.say("FIVE!",!0);break;case 999996:a.say("FOUR!",!0);break;case 999997:a.say("THREE!",!0);break;case 999998:a.say("TWO!",!0);break;case 999999:a.say("ONE!",!0);break;case 0:a.say("HAPPY NEW",!0);break;case 1:a.say("MILLION!",!0)}if(a.memory.currentTask&&e.creepTasks[a.name]){if(0===
a.pos.x)switch(Math.floor(3*Math.random())){case 0:a.move(RIGHT);break;case 1:a.move(TOP_RIGHT);break;case 2:a.move(BOTTOM_RIGHT)}if(49===a.pos.x)switch(Math.floor(3*Math.random())){case 0:a.move(LEFT);break;case 1:a.move(TOP_LEFT);break;case 2:a.move(BOTTOM_LEFT)}if(0===a.pos.y)switch(Math.floor(3*Math.random())){case 0:a.move(BOTTOM);break;case 1:a.move(BOTTOM_RIGHT);break;case 2:a.move(BOTTOM_LEFT)}if(49===a.pos.y)switch(Math.floor(3*Math.random())){case 0:a.move(TOP);break;case 1:a.move(TOP_RIGHT);
break;case 2:a.move(TOP_LEFT)}d.run("main.creeps.run",function(){return e.creepTasks[a.name].run(a)});!a.memory.lastRoom||a.memory.lastRoom===a.room.name||e.creepTasks[a.name]&&e.creepTasks[a.name].force||delete a.memory.currentTask;a.memory.lastRoom=a.room.name;a.memory.currentTask&&e.creepTasks[a.name]&&e.creepTasks[a.name].toObj(a);0<a.carry[RESOURCE_ENERGY]&&0<a.getActiveBodyparts(WORK)&&_.forEach(_.filter(a.pos.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_ROAD&&a.hits<
a.hitsMax}),function(b){a.repair(b)});a.spawning||!(150>a.ticksToLive)||0!==_.sum(a.carry)||a.memory.currentTask&&"rally"!==a.memory.currentTask.type||-1!=="armyDismantler armyHealer armyMelee armyRanged claimer converter defender healer remoteReserver".split(" ").indexOf(a.memory.role)||a.suicide()}else delete a.memory.currentTask,!a.spawning&&150>a.ticksToLive&&0===_.sum(a.carry)&&-1==="armyDismantler armyHealer armyMelee armyRanged claimer converter defender healer remoteReserver".split(" ").indexOf(a.memory.role)?
a.suicide():a.say("Idle")}})},debug:function(){Memory.debug&&_.forEach(Game.creeps,function(a){a.room.visual.text(a.name,a.pos.x,a.pos.y+1,{align:"center",font:"0.5 Arial"});a.room.visual.text(a.memory.role,a.pos.x,a.pos.y+1.5,{align:"center",font:"0.5 Arial"});a.room.visual.text(a.memory.currentTask?a.memory.currentTask.type:"",a.pos.x,a.pos.y+2,{align:"center",font:"0.5 Arial"})})},finalize:function(){e.log.tick=Game.time;e.log.date=new Date;e.log.gcl=Game.gcl.level;e.log.progress=Game.gcl.progress;
e.log.progressTotal=Game.gcl.progressTotal;e.log.limit=Game.cpu.limit;e.log.tickLimit=Game.cpu.tickLimit;e.log.bucket=Game.cpu.bucket;e.log.credits=Game.market.credits},drawGlobal:function(){var a;Memory.visualizations&&(e.globalVisual.text("GCL "+Game.gcl.level,-.5,.025,{align:"left",font:"0.5 Arial"}),b.progressBar(e.globalVisual,2.5,-.4,20,.5,Game.gcl.progress,Game.gcl.progressTotal,{background:"#808080",bar:"#00ff00",showDetails:!0,color:"#ffffff",font:"0.5 Arial"}),b.progressBar(e.globalVisual,
34.5,-.4,10,.5,Game.cpu.bucket,1E4,{label:"Bucket",background:"#808080",showMax:!1,bar:9990<=Game.cpu.bucket?"#00ffff":9E3<=Game.cpu.bucket?"#00ff00":5E3<=Game.cpu.bucket?"#cccc00":"#ff0000",color:"#ffffff",font:"0.5 Arial"}),e.globalVisual.text("Tick "+Game.time,49.5,.025,{align:"right",font:"0.5 Arial"}),e.globalVisual.text(e.time,49.5,.725,{align:"right",font:"0.5 Arial"}),e.globalVisual.text("Credits "+Game.market.credits.toFixed(2),-.5,.725,{align:"left",font:"0.5 Arial"}),e.globalVisual.text("Creeps "+
_.keys(Game.creeps).length,-.5,1.425,{align:"left",font:"0.5 Arial"}),a=.725,_.forEach(_.filter(Game.rooms,function(a){return!a.unobservable&&a.memory.roomType&&"base"===a.memory.roomType.type}),function(d){a+=.7;e.globalVisual.text(d.name,43.5,a,{align:"right",font:"bold 0.5 Arial"});d.storage&&(e.globalVisual.text(d.storage.store[RESOURCE_ENERGY],45.8,a,{align:"right",font:"0.5 Arial"}),b.resource(e.globalVisual,46.15,a-.175,.5,RESOURCE_ENERGY,{opacity:1}));d.terminal&&(e.globalVisual.text(d.terminal.store[RESOURCE_ENERGY],
48.8,a,{align:"right",font:"0.5 Arial"}),b.resource(e.globalVisual,49.15,a-.175,.5,RESOURCE_ENERGY,{opacity:1}))}));for(Memory.stats.cpu.push(Game.cpu.getUsed());100<Memory.stats.cpu.length;)Memory.stats.cpu.shift();for(Memory.stats.bucket.push(Game.cpu.bucket);100<Memory.stats.bucket.length;)Memory.stats.bucket.shift();for(Memory.stats.gclProgress.push(Game.gcl.progress);100<Memory.stats.gclProgress.length;)Memory.stats.gclProgress.shift();Memory.visualizations&&b.sparkline(e.globalVisual,23.5,1,
18,2,_.map(Memory.stats.cpu,function(a,b){return{cpu:Memory.stats.cpu[b],bucket:Memory.stats.bucket[b],limit:Game.cpu.limit}}),[{key:"limit",min:.5*Game.cpu.limit,max:1.5*Game.cpu.limit,stroke:"#c0c0c0",opacity:.25},{key:"cpu",min:.5*Game.cpu.limit,max:1.5*Game.cpu.limit,stroke:"#ffff00",opacity:.5},{key:"bucket",min:0,max:1E4,stroke:"#00ffff",opacity:.5,font:"0.5 Arial"}]);e.log.cpuUsed=Game.cpu.getUsed();Memory.stats.cpu[Memory.stats.cpu.length-1]=Game.cpu.getUsed();Memory.console=e.log;Memory.visualizations&&
b.progressBar(e.globalVisual,23.5,-.4,10,.5,Game.cpu.getUsed(),Game.cpu.limit,{label:"CPU",background:"#808080",valueDecimals:2,bar:e.log.cpuUsed>Game.cpu.limit?"#ff0000":"#00ff00",color:"#ffffff",font:"0.5 Arial"})}};Memory.profiling&&(g.registerObject(G,"main"),g.enable());q.exports=G;return q.exports};v[1]=function(c,t){function g(){100<Game.time-Memory.screepsPerf.lastMemoryCleanUp&&(Object.keys(Memory.creeps).forEach(function(a){Game.creeps[a]||(Memory.creeps[a]=void 0)}),Memory.screepsPerf.lastMemoryCleanUp=
Game.time)}var m=Room.prototype.findPath,e=!1;c.exports=function(a){if(!e){a=a||{};Memory.screepsPerf=Memory.screepsPerf||{lastMemoryCleanUp:Game.time};if(a.speedUpArrayFunctions||void 0===a.speedUpArrayFunctions)Array.prototype.filter=function(a,b){for(var d=[],f=0;f<this.length;f++)a.call(b,this[f],f,this)&&d.push(this[f]);return d},Array.prototype.forEach=function(a,b){for(var d=0;d<this.length;d++)a.call(b,this[d],d,this)},Array.prototype.map=function(a,b){for(var d=[],f=0;f<this.length;f++)d.push(a.call(b,
this[f],f,this));return d};if(a.cleanUpCreepMemory||void 0===a.cleanUpCreepMemory){var b=Spawn.prototype.createCreep;Spawn.prototype.createCreep=function(){g();return b.apply(this,arguments)}}if(a.optimizePathFinding||void 0===a.optimizePathFinding)Room.prototype.findPath=function(a,b,d){g();Memory.pathOptimizer||(Memory.pathOptimizer={lastCleaned:Game.time});40<Game.time-Memory.pathOptimizer.lastCleaned&&!this._cleanedUp&&(Object.keys(Memory.pathOptimizer).forEach(function(a){var b=Memory.pathOptimizer[a];
b&&(b.used/(Game.time-b.tick)<1/300||2E3<Game.time-b.tick)&&(Memory.pathOptimizer[a]=void 0)}),this._cleanedUp=!0,Memory.pathOptimizer.lastCleaned=Game.time);var f=a.roomName+"x"+a.x+"y"+a.y+(b.roomName+"x"+b.x+"y"+b.y);if(Memory.pathOptimizer[f])Memory.pathOptimizer[f].used++;else{var e=m.apply(this,arguments);Memory.pathOptimizer[f]={tick:Game.time,path:Room.serializePath(e),used:1}}return Room.deserializePath(Memory.pathOptimizer[f].path)};e=!0}return{originalFindPath:m}};return c.exports};v[2]=
function(c,t){function g(){k=0;Game.profiler={stream:function(a,b,d){m("stream",a||10,b,d)},email:function(a,b,d){m("email",a||100,b,d)},profile:function(a,b,d){m("profile",a||100,b,d)},background:function(a,b){m("background",!1,a,b)},restart:function(){if(n.isProfiling()){var a=Memory.profiler.filter,b=!1;Memory.profiler.disableTick&&(b=Memory.profiler.disableTick-Memory.profiler.enabledTick+1);m(Memory.profiler.type,b,a)}},reset:e,output:n.output};a()}function m(a,b,d,f){e();b=Number.isInteger(b)?
Game.time+b:!1;Memory.profiler||(Memory.profiler={map:{},totalTime:0,enabledTick:Game.time+1,disableTick:b,type:a,filter:d,startsWith:f})}function e(){Memory.profiler=null}function a(){Game.rooms.sim&&(p=0,Game.cpu.getUsed=function(){return performance.now()-p})}function b(a,b){return function(){if(n.isProfiling()){var d=Memory.profiler.startsWith?a.startsWith(Memory.profiler.filter):a===Memory.profiler.filter,f=Game.cpu.getUsed();d&&k++;var l=b.apply(this,arguments);if(0<k||!Memory.profiler.filter){var r=
Game.cpu.getUsed();n.record(a,r-f)}d&&k--;return l}return b.apply(this,arguments)}}function f(){n.prototypes.forEach(function(a){d(a.val,a.name)})}function u(a,b){Object.getOwnPropertyNames(a).forEach(function(d){var f=b+"."+d;try{var k="function"===typeof a[d],n=-1===l.indexOf(d);k&&n&&(a[d]=r(a[d],f))}catch(H){}});return a}function d(a,b){a.prototype&&u(a.prototype,b);u(a,b)}function r(a,d){d=d||a.name;return d?b(d,a):(console.log("Couldn't find a function name for - ",a),console.log("Will not profile this function."),
a)}var p=0,h=!1,k=0,l=["getUsed","constructor"],n={printProfile:function(){console.log(n.output())},emailProfile:function(){Game.notify(n.output())},output:function(a){a=a?a:20;if(!Memory.profiler||!Memory.profiler.enabledTick)return"Profiler not active.";var b=Game.time-Memory.profiler.enabledTick+1,b=["Avg: "+(Memory.profiler.totalTime/b).toFixed(2),"Total: "+Memory.profiler.totalTime.toFixed(2),"Ticks: "+b].join("\t");return[].concat("calls\t\ttime\t\tavg\t\tfunction",n.lines().slice(0,a),b).join("\n")},
lines:function(){return Object.keys(Memory.profiler.map).map(function(a){var b=Memory.profiler.map[a];return{name:a,calls:b.calls,totalTime:b.time,averageTime:b.time/b.calls}}).sort(function(a,b){return b.totalTime-a.totalTime}).map(function(a){return[a.calls,a.totalTime.toFixed(1),a.averageTime.toFixed(3),a.name].join("\t\t")})},prototypes:[{name:"Game",val:Game},{name:"Room",val:Room},{name:"Structure",val:Structure},{name:"Spawn",val:Spawn},{name:"Creep",val:Creep},{name:"RoomPosition",val:RoomPosition},
{name:"Source",val:Source},{name:"Flag",val:Flag}],record:function(a,b){Memory.profiler.map[a]||(Memory.profiler.map[a]={time:0,calls:0});Memory.profiler.map[a].calls++;Memory.profiler.map[a].time+=b},endTick:function(){if(Game.time>=Memory.profiler.enabledTick){var a=Game.cpu.getUsed();Memory.profiler.totalTime+=a;n.report()}},report:function(){n.shouldPrint()?n.printProfile():n.shouldEmail()&&n.emailProfile()},isProfiling:function(){return h&&Memory.profiler?!Memory.profiler.disableTick||Game.time<=
Memory.profiler.disableTick:!1},type:function(){return Memory.profiler.type},shouldPrint:function(){var a="stream"===n.type(),b="profile"===n.type(),d=Memory.profiler.disableTick===Game.time;return a||b&&d},shouldEmail:function(){return"email"===n.type()&&Memory.profiler.disableTick===Game.time}};c.exports={wrap:function(a){h&&g();return n.isProfiling()?(p=Game.cpu.getUsed(),a=a(),n.endTick(),a):a()},enable:function(){h=!0;f()},output:n.output,registerObject:d,registerFN:r,registerClass:d};return c.exports};
v[3]=function(q,t){var g=c(4,3),m=c(11,3),e=c(12,3),a=c(13,3),b=c(14,3),f=c(15,3),u=c(40,3),d=c(41,3),r=c(42,3),p=c(43,3);t={run:function(h){var k=Memory.army[h],l=g.creeps[h]&&g.creeps[h].all||[],n=Game.rooms[k.attackRoom],w=k.dismantler,x=k.healer,c=k.melee,y=k.ranged,F,B;if(!(k.scheduled&&k.scheduled>Game.time))if(n&&(B=n.find(FIND_HOSTILE_CONSTRUCTION_SITES)),k.boostRoom&&(F=Game.rooms[k.boostRoom].storage.store),0===l.length&&k.success)Game.notify("Army "+h+" operation successful!"),delete Memory.army[h];
else{"preparing"===k.directive||"building"===k.directive||0!==l.length||k.success||(Game.notify("Army "+h+" operation failed, restarting."),k.directive="preparing");k.safeMode&&n&&n.controller&&n.controller.safeMode&&(k.directive="staging",k.stageRoom=k.safeMode.stageRoom,k.attackRoom=k.safeMode.attackRoom,k.dismantle=k.safeMode.dismantle,k.safeMode=k.safeMode.safeMode);switch(k.directive){case "preparing":k.boostRoom?(F[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]||0)>=150*(w.maxCreeps+c.maxCreeps+y.maxCreeps+
x.maxCreeps)&&(F[RESOURCE_CATALYZED_ZYNTHIUM_ACID]||0)>=30*w.units*w.maxCreeps&&(F[RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE]||0)>=30*x.units*x.maxCreeps&&(k.directive="building"):k.directive="building";break;case "building":0===_.filter(l,function(a){return a.room.name!==k.buildRoom}).length&&_.filter(l,function(a){return a.room.name===k.buildRoom}).length>=w.maxCreeps+x.maxCreeps+c.maxCreeps+y.maxCreeps&&(k.directive="staging");break;case "staging":0===_.filter(l,function(a){return a.room.name!==k.stageRoom}).length&&
(k.directive="dismantle");break;case "dismantle":n&&(k.dismantle=_.filter(k.dismantle,function(a){return Game.getObjectById(a)}),0===k.dismantle.length&&(k.directive="attack"));break;case "attack":n&&!k.reinforce&&0===_.filter(n.find(FIND_HOSTILE_STRUCTURES),function(a){return a.structureType!==STRUCTURE_CONTROLLER&&a.structureType!==STRUCTURE_RAMPART&&a.structureType!==STRUCTURE_KEEPER_LAIR}).length&&0===B.length&&(k.success=!0)}if("building"===k.directive||k.reinforce)e.checkSpawn(h,k.portals),
a.checkSpawn(h,k.portals),b.checkSpawn(h,k.portals),f.checkSpawn(h,k.portals);(w.escort||c.escort||y.escort)&&_.forEach(_.filter(g.creeps[h]&&g.creeps[h].armyHealer||[],function(a){return!a.memory.escorting&&!a.spawning}),function(a){var b=[].concat.apply([],[w.escort&&g.creeps[h].armyDismantler?_.filter(g.creeps[h].armyDismantler,function(a){return!a.memory.escortedBy&&!a.spawning}):[],c.escort&&g.creeps[h].armyMelee?_.filter(g.creeps[h].armyMelee,function(a){return!a.memory.escortedBy&&!a.spawning}):
[],y.escort&&g.creeps[h].armyRanged?_.filter(g.creeps[h].armyRanged,function(a){return!a.memory.escortedBy&&!a.spawning}):[]])[0];if(b)a.memory.escorting=b.id,b.memory.escortedBy=a.id;else return!1});x={melee:{tasks:[]},ranged:{tasks:[]},heal:{tasks:_.map(_.filter(l,function(a){return a.hits<a.hitsMax}).sort(function(a,b){return b.hitsMax-b.hits-(a.hitsMax-a.hits)}),function(a){return new u(a.id)})},rally:{tasks:[]}};if(n)switch(k.directive){case "dismantle":n=_.filter(g.hostilesInRoom(n),function(a){return 3>=
m.objectsClosestToObj(l,a)[0].pos.getRangeTo(a)});x.ranged.tasks=_.map(n,function(a){return new p(a.id)});x.melee.tasks=_.map(n,function(a){return new d(a.id)});break;case "attack":n=g.hostilesInRoom(n),x.melee.tasks=_.map(n,function(a){return new d(a.id)}),x.ranged.tasks=_.map(n,function(a){return new p(a.id)}),x.rally.tasks=_.map(B,function(a){return new r(a.id)})}e.assignTasks(h,k.directive,x);a.assignTasks(h,k.directive,x);b.assignTasks(h,k.directive,x);f.assignTasks(h,k.directive,x)}}};Memory.profiling&&
c(2,3).registerObject(t,"Army");q.exports=t;return q.exports};v[4]=function(q,t){var g={},m={},e={},a={},b={},f={},u={},d={},r={},p={},h={},k={},l={},n={},w={},x={},A={creepTasks:{},roomTypes:{},spawning:{},minerals:{},log:{},reset:function(){g={};m={};e={};a={};b={};f={};u={};d={};r={};p={};h={};k={};l={};n={};w={};x={};A.creepTasks={};A.roomTypes={};A.spawning={};A.minerals={};A.log={events:[],hostiles:[],creeps:[],spawns:[],structures:[],rooms:{},army:{}};A.credits=Game.market.credits;Memory.visualizations&&
(A.globalVisual=new RoomVisual);Memory.visualizations&&(A.time=(new Date).toLocaleString("en-US",{timeZone:"America/Los_Angeles"}).replace(",",""))},spawnsInRoom:function(a){return g[a.name]?g[a.name]:g[a.name]=_.filter(a.find(FIND_MY_STRUCTURES),function(a){return a.structureType===STRUCTURE_SPAWN})},powerSpawnsInRoom:function(a){return m[a.name]?m[a.name]:m[a.name]=_.filter(a.find(FIND_MY_STRUCTURES),function(a){return a.structureType===STRUCTURE_POWER_SPAWN})},extensionsInRoom:function(a){return e[a.name]?
e[a.name]:e[a.name]=_.filter(a.find(FIND_MY_STRUCTURES),function(a){return a.structureType===STRUCTURE_EXTENSION})},towersInRoom:function(b){return a[b.name]?a[b.name]:a[b.name]=_.filter(b.find(FIND_MY_STRUCTURES),function(a){return a.structureType===STRUCTURE_TOWER})},labsInRoom:function(a){return b[a.name]?b[a.name]:b[a.name]=_.filter(a.find(FIND_MY_STRUCTURES),function(a){return a.structureType===STRUCTURE_LAB})},nukersInRoom:function(a){return f[a.name]?f[a.name]:f[a.name]=_.filter(a.find(FIND_MY_STRUCTURES),
function(a){return a.structureType===STRUCTURE_NUKER})},containersInRoom:function(a){return u[a.name]?u[a.name]:u[a.name]=_.filter(a.find(FIND_STRUCTURES),function(a){return a.structureType===STRUCTURE_CONTAINER})},linksInRoom:function(a){return d[a.name]?d[a.name]:d[a.name]=a.find(FIND_STRUCTURES,{filter:function(a){return a.structureType===STRUCTURE_LINK}})},repairableStructuresInRoom:function(a){return r[a.name]?r[a.name]:r[a.name]=a.find(FIND_STRUCTURES,{filter:function(a){return(a.my||a.structureType===
STRUCTURE_WALL||a.structureType===STRUCTURE_ROAD||a.structureType===STRUCTURE_CONTAINER)&&a.hits}})},sortedRepairableStructuresInRoom:function(a){return p[a.name]?p[a.name]:p[a.name]=A.repairableStructuresInRoom(a).sort(function(a,b){return a.hits-b.hits})},extractorsInRoom:function(a){return h[a.name]?h[a.name]:h[a.name]=a.find(FIND_STRUCTURES,{filter:function(a){return a.structureType===STRUCTURE_EXTRACTOR}})},portalsInRoom:function(a){return k[a.name]?k[a.name]:k[a.name]=a.find(FIND_STRUCTURES,
{filter:function(a){return a.structureType===STRUCTURE_PORTAL}})},hostilesInRoom:function(a){var b=a.name,d;if(!a||a.unobservable)return[];d=l[a.name]?l[a.name]:l[a.name]=_.filter(a.find(FIND_HOSTILE_CREEPS),function(a){return!a.owner||-1===Memory.allies.indexOf(a.owner.username)});Memory.rooms[b].hostiles||(Memory.rooms[b].hostiles=[]);_.forEach(d,function(a){-1!==Memory.rooms[b].hostiles.indexOf(a.id)&&(Memory.rooms[b].harvested=0)});a.memory.hostiles=_.map(d,function(a){return a.id});return d},
sourceKeepersInRoom:function(a){return n[a.name]?n[a.name]:n[a.name]=a.find(FIND_HOSTILE_STRUCTURES,{filter:function(a){return a.structureType===STRUCTURE_KEEPER_LAIR}})},powerBanksInRoom:function(a){return w[a.name]?w[a.name]:w[a.name]=a.find(FIND_STRUCTURES,{filter:function(a){return a.structureType===STRUCTURE_POWER_BANK}})},getCostMatrix:function(a){var b=a.name;if(!a||a.unobservable)return new PathFinder.CostMatrix;if(!x[b]){var d=new PathFinder.CostMatrix;_.forEach(a.find(FIND_STRUCTURES),function(a){var b=
a.pos;a.structureType===STRUCTURE_ROAD?d.set(b.x,b.y,Math.max(1,d.get(b.x,b.y))):a.structureType===STRUCTURE_WALL?d.set(b.x,b.y,Math.max(255,d.get(b.x,b.y))):a.structureType===STRUCTURE_CONTAINER?d.set(b.x,b.y,Math.max(10,d.get(b.x,b.y))):a.structureType===STRUCTURE_RAMPART&&a.my||d.set(b.x,b.y,255)});_.forEach(a.find(FIND_MY_CONSTRUCTION_SITES),function(a){a=a.pos;d.set(a.x,a.y,Math.max(5,d.get(a.x,a.y)))});_.forEach(A.portalsInRoom(a),function(a){a=a.pos;d.set(a.x,a.y,5)});Memory.avoidSquares[b]&&
_.forEach(Memory.avoidSquares[b],function(a){d.set(a.x,a.y,255)});Memory.rooms[b]&&Memory.rooms[b].roomType&&"source"===Memory.rooms[b].roomType.type||_.forEach(_.filter(a.find(FIND_HOSTILE_CREEPS),function(a){return"Source Keeper"===a.owner.username}),function(a){a=a.pos;for(var b=a.x-3;b<a.x+3;b++)for(var d=a.y-3;d<a.y+3;d++);});x[b]=d}return x[b]}};Memory.profiling&&c(2,4).registerObject(A,"Cache");q.exports=A;return q.exports};v[5]=function(q,t){var g=c(4,5);t={setRoomType:function(g,e){void 0===
e?delete Memory.rooms[g].roomType:(Memory.rooms[g]||(Memory.rooms[g]={}),Memory.rooms[g].roomType=e)},claimRoom:function(g,e,a){Memory.maxCreeps.claimer||(Memory.maxCreeps.claimer={});Memory.maxCreeps.claimer[g]||(Memory.maxCreeps.claimer[g]={});a?Memory.maxCreeps.claimer[g][e]=!0:delete Memory.maxCreeps.claimer[g][e]},attackRoom:function(g,e,a){Memory.maxCreeps.converter||(Memory.maxCreeps.converter={});Memory.maxCreeps.converter[g]||(Memory.maxCreeps.converter[g]={});a?Memory.maxCreeps.converter[g][e]=
!0:delete Memory.maxCreeps.converter[g][e]},claimMine:function(c){Game.rooms[c]&&g.creeps[c]&&_.forEach(g.creeps[c].remoteReserver,function(e){e.claimController(Game.rooms[c].controller)})},dismantle:function(g,e,a){Memory.dismantle||(Memory.dismantle={});Memory.dismantle[a]||(Memory.dismantle[a]=[]);Memory.dismantle[a].push({x:g,y:e})},stopCreep:function(g){Game.creeps[g]&&(Game.creeps[g].memory.stop=!0)},startCreep:function(g){Game.creeps[g]&&delete Game.creeps[g].memory.stop},startAllCreeps:function(){_.forEach(Game.creeps,
function(g){delete g.memory.stop})},setContainerSource:function(g,e){Memory.containerSource[g]=e},addAlly:function(g){Memory.allies||(Memory.allies=[]);Memory.allies.push(g)},removeAlly:function(g){_.pull(Memory.allies,g)},createArmy:function(g,e){void 0===e?delete Memory.army[g]:(Memory.army[g]=e,Memory.army[g].directive="preparing")},avoidRoom:function(g,e){e&&-1===Memory.avoidRooms.indexOf(g)&&Memory.avoidRooms.push(g);e||_.remove(Memory.avoidRooms,function(a){return a===g})},avoidSquare:function(g,
e,a,b){b&&(Memory.avoidSquares[a]||(Memory.avoidSquares[a]=[]),Memory.avoidSquares[a].push({x:g,y:e}));b||Memory.avoidSquares[a]&&_.remove(Memory.avoidSquares[a],function(a){return a.x===g&&a.y===e})},addSign:function(g,e){Memory.signs||(Memory.signs={});e?Memory.signs[g]=e:delete Memory.signs[g]},resetMatrix:function(g){Memory.baseMatrixes[g]={}},recover:function(){_.forEach(Game.spawns,function(g){g.createCreep([MOVE,MOVE,CARRY,CARRY,CARRY,CARRY],"storer-emerg-"+g.room.name,{role:"storer",home:g.room.name})})}};
Memory.profiling&&c(2,5).registerObject(t,"Commands");q.exports=t;return q.exports};v[6]=function(q,t){t={progressBar:function(g,c,e,a,b,f,u,d){void 0===d.showMax&&(d.showMax=!0);void 0===d.valueDecimals&&(d.valueDecimals=0);g.rect(c,e,a,b,{fill:d.background}).rect(c,e,a*Math.min(f/u,1),b,{fill:d.bar}).text((d.label?d.label+" ":"")+f.toFixed(d.valueDecimals)+(d.showMax?"/"+u.toFixed(0):"")+(d.showDetails?" ("+(100*f/u).toFixed(3)+"%) "+(u-f).toFixed(0)+" to go":""),c+a/2,e+b/2+.175,{align:"center",
color:d.color,font:d.font})},sparkline:function(g,c,e,a,b,f,u){g.rect(c,e,a,b,{fill:"#404040",opacity:.5});_.forEach(u,function(d){g.poly(_.map(f,function(r,g){return[c+g/(f.length-1)*a,e+b*(1-(r[d.key]-d.min)/(d.max-d.min))]}),d)})},resource:function(g,c,e,a,b,f){switch(b){case RESOURCE_ENERGY:g.circle(c,e,{radius:.625*a/2,fill:"#FFE664",opacity:f.opacity});break;case RESOURCE_POWER:g.circle(c,e,{radius:.625*a/2,fill:"#FF1930",opacity:f.opacity});break;case RESOURCE_HYDROGEN:g.circle(c,e,{radius:.4375*
a,fill:"#B4B4B4",opacity:f.opacity}).circle(c,e,{radius:.375*a,fill:"#4C4C4C",opacity:f.opacity}).text(b,c,e+.2*a,{color:"#B4B4B4",size:.625*a,opacity:f.opacity});break;case RESOURCE_OXYGEN:g.circle(c,e,{radius:.4375*a,fill:"#B4B4B4",opacity:f.opacity}).circle(c,e,{radius:.375*a,fill:"#4C4C4C",opacity:f.opacity}).text(b,c,e+.2*a,{color:"#B4B4B4",size:.625*a,opacity:f.opacity});break;case RESOURCE_UTRIUM:g.circle(c,e,{radius:.4375*a,fill:"#50D7F9",opacity:f.opacity}).circle(c,e,{radius:.375*a,fill:"#006181",
opacity:f.opacity}).text(b,c,e+.2*a,{color:"#50D7F9",size:.625*a,opacity:f.opacity});break;case RESOURCE_KEANIUM:g.circle(c,e,{radius:.4375*a,fill:"#A071FF",opacity:f.opacity}).circle(c,e,{radius:.375*a,fill:"#371383",opacity:f.opacity}).text(b,c,e+.2*a,{color:"#A071FF",size:.625*a,opacity:f.opacity});break;case RESOURCE_LEMERGIUM:g.circle(c,e,{radius:.4375*a,fill:"#00F4A2",opacity:f.opacity}).circle(c,e,{radius:.375*a,fill:"#236144",opacity:f.opacity}).text(b,c,e+.2*a,{color:"#00F4A2",size:.625*
a,opacity:f.opacity});break;case RESOURCE_ZYNTHIUM:g.circle(c,e,{radius:.4375*a,fill:"#FDD388",opacity:f.opacity}).circle(c,e,{radius:.375*a,fill:"#5D4C2E",opacity:f.opacity}).text(b,c,e+.2*a,{color:"#FDD388",size:.625*a,opacity:f.opacity});break;case RESOURCE_CATALYST:g.circle(c,e,{radius:.4375*a,fill:"#FF7B7B",opacity:f.opacity}).circle(c,e,{radius:.375*a,fill:"#592121",opacity:f.opacity}).text(b,c,e+.2*a,{color:"#FF7B7B",size:.625*a,opacity:f.opacity});break;case RESOURCE_HYDROXIDE:g.rect(c-a/
2,e-a/2,1.375*a,a,{fill:"#B4B4B4",opacity:f.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#666666",size:.625*a,opacity:f.opacity});break;case RESOURCE_ZYNTHIUM_KEANITE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#B4B4B4",opacity:f.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#666666",size:.625*a,opacity:f.opacity});break;case RESOURCE_UTRIUM_LEMERGITE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#B4B4B4",opacity:f.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#666666",size:.625*a,opacity:f.opacity});break;case RESOURCE_GHODIUM:g.rect(c-
a/2,e-a/2,a,a,{fill:"#FFFFFF",opacity:f.opacity}).text(b,c,e+.2*a,{color:"#666666",size:.625*a,opacity:f.opacity});break;case RESOURCE_UTRIUM_HYDRIDE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#50D7F9",opacity:f.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#006181",font:.625*a,opacity:f.opacity});break;case RESOURCE_UTRIUM_OXIDE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#50D7F9",opacity:f.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#006181",font:.625*a,opacity:f.opacity});break;case RESOURCE_KEANIUM_HYDRIDE:g.rect(c-
a/2,e-a/2,1.375*a,a,{fill:"#A071FF",opacity:f.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#371383",font:.625*a,opacity:f.opacity});break;case RESOURCE_KEANIUM_OXIDE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#A071FF",opacity:f.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#371383",font:.625*a,opacity:f.opacity});break;case RESOURCE_LEMERGIUM_HYDRIDE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#00F4A2",opacity:f.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#236144",font:.625*a,opacity:f.opacity});break;case RESOURCE_LEMERGIUM_OXIDE:g.rect(c-
a/2,e-a/2,1.375*a,a,{fill:"#00F4A2",opacity:f.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#236144",font:.625*a,opacity:f.opacity});break;case RESOURCE_ZYNTHIUM_HYDRIDE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#FDD388",opacity:f.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:f.opacity});break;case RESOURCE_ZYNTHIUM_OXIDE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#FDD388",opacity:f.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:f.opacity});break;case RESOURCE_GHODIUM_HYDRIDE:g.rect(c-
a/2,e-a/2,1.375*a,a,{fill:"#FFFFFF",opacity:f.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#666666",font:.625*a,opacity:f.opacity});break;case RESOURCE_GHODIUM_OXIDE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#FFFFFF",opacity:f.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#666666",font:.625*a,opacity:f.opacity});break;case RESOURCE_UTRIUM_ACID:g.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#50D7F9",opacity:f.opacity}).text(b,c+.5*a,e+.2*a,{color:"#006181",font:.625*a,opacity:f.opacity});break;case RESOURCE_UTRIUM_ALKALIDE:g.rect(c-
a/2,e-a/2,2.125*a,a,{fill:"#50D7F9",opacity:f.opacity}).text(b,c+.5*a,e+.2*a,{color:"#006181",font:.625*a,opacity:f.opacity});break;case RESOURCE_KEANIUM_ACID:g.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#A071FF",opacity:f.opacity}).text(b,c+.5*a,e+.2*a,{color:"#371383",font:.625*a,opacity:f.opacity});break;case RESOURCE_KEANIUM_ALKALIDE:g.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#A071FF",opacity:f.opacity}).text(b,c+.5*a,e+.2*a,{color:"#371383",font:.625*a,opacity:f.opacity});break;case RESOURCE_LEMERGIUM_ACID:g.rect(c-
a/2,e-a/2,2.125*a,a,{fill:"#00F4A2",opacity:f.opacity}).text(b,c+.5*a,e+.2*a,{color:"#236144",font:.625*a,opacity:f.opacity});break;case RESOURCE_LEMERGIUM_ALKALIDE:g.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#00F4A2",opacity:f.opacity}).text(b,c+.5*a,e+.2*a,{color:"#236144",font:.625*a,opacity:f.opacity});break;case RESOURCE_ZYNTHIUM_ACID:g.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#FDD388",opacity:f.opacity}).text(b,c+.5*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:f.opacity});break;case RESOURCE_ZYNTHIUM_ALKALIDE:g.rect(c-
a/2,e-a/2,2.125*a,a,{fill:"#FDD388",opacity:f.opacity}).text(b,c+.5*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:f.opacity});break;case RESOURCE_GHODIUM_ACID:g.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#FFFFFF",opacity:f.opacity}).text(b,c+.5*a,e+.2*a,{color:"#666666",font:.625*a,opacity:f.opacity});break;case RESOURCE_GHODIUM_ALKALIDE:g.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#FFFFFF",opacity:f.opacity}).text(b,c+.5*a,e+.2*a,{color:"#666666",font:.625*a,opacity:f.opacity});break;case RESOURCE_CATALYZED_UTRIUM_ACID:g.rect(c-
a/2,e-a/2,2.5*a,a,{fill:"#50D7F9",opacity:f.opacity}).text(b,c+.725*a,e+.2*a,{color:"#006181",font:.625*a,opacity:f.opacity});break;case RESOURCE_CATALYZED_UTRIUM_ALKALIDE:g.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#50D7F9",opacity:f.opacity}).text(b,c+.725*a,e+.2*a,{color:"#006181",font:.625*a,opacity:f.opacity});break;case RESOURCE_CATALYZED_KEANIUM_ACID:g.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#A071FF",opacity:f.opacity}).text(b,c+.725*a,e+.2*a,{color:"#371383",font:.625*a,opacity:f.opacity});break;case RESOURCE_CATALYZED_KEANIUM_ALKALIDE:g.rect(c-
a/2,e-a/2,2.5*a,a,{fill:"#A071FF",opacity:f.opacity}).text(b,c+.725*a,e+.2*a,{color:"#371383",font:.625*a,opacity:f.opacity});break;case RESOURCE_CATALYZED_LEMERGIUM_ACID:g.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#00F4A2",opacity:f.opacity}).text(b,c+.725*a,e+.2*a,{color:"#236144",font:.625*a,opacity:f.opacity});break;case RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE:g.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#00F4A2",opacity:f.opacity}).text(b,c+.725*a,e+.2*a,{color:"#236144",font:.625*a,opacity:f.opacity});break;case RESOURCE_CATALYZED_ZYNTHIUM_ACID:g.rect(c-
a/2,e-a/2,2.5*a,a,{fill:"#FDD388",opacity:f.opacity}).text(b,c+.725*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:f.opacity});break;case RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE:g.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#FDD388",opacity:f.opacity}).text(b,c+.725*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:f.opacity});break;case RESOURCE_CATALYZED_GHODIUM_ACID:g.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#FFFFFF",opacity:f.opacity}).text(b,c+.725*a,e+.2*a,{color:"#666666",font:.625*a,opacity:f.opacity});break;case RESOURCE_CATALYZED_GHODIUM_ALKALIDE:g.rect(c-
a/2,e-a/2,2.5*a,a,{fill:"#FFFFFF",opacity:f.opacity}).text(b,c+.725*a,e+.2*a,{color:"#666666",font:.625*a,opacity:f.opacity})}}};Memory.profiling&&c(2,6).registerObject(t,"Drawing");q.exports=t;return q.exports};v[7]=function(q,t){var g=c(4,7),m=c(11,7),e={getAllOrders:function(){if(!e.orders||Game.cpu.bucket>=Memory.marketBucket)e.orders=Game.market.getAllOrders(),delete e.filteredOrders;return e.orders},getFilteredOrders:function(){e.filteredOrders||(e.filteredOrders=m.nest(_.filter(e.getAllOrders(),
function(a){return 0<a.amount}),[function(a){return a.type},function(a){return a.resourceType}]),_.forEach(e.filteredOrders.sell,function(a,b){e.filteredOrders.sell[b].sort(function(a,b){return a.price-b.price})}),_.forEach(e.filteredOrders.buy,function(a,b){e.filteredOrders.buy[b].sort(function(a,b){return b.price-a.price})}));return e.filteredOrders},deal:function(a,b,f){var c=Game.market.deal(a,b,f),d=_.find(e.orders,function(b){return b.id===a});c===OK?d&&("sell"===d.type&&(g.credits-=d.amount*
d.price),d.amount<=b?(g.log.events.push(f+" "+d.resourceType+" x"+b+" @ "+d.price+" completed, "+d.type+" sold out "+d.id),_.remove(e.filteredOrders[d.type][d.resourceType],function(b){return b.id===a}),_.remove(e.orders,function(b){return b.id===a})):(d.amount-=b,g.log.events.push(f+" "+d.resourceType+" x"+b+" @ "+d.price+" completed, "+d.type+" "+d.amount+" remaining on "+d.id))):d&&(g.log.events.push(f+" failed to process order ID "+a+": "+c),_.remove(e.filteredOrders[d.type][d.resourceType],function(b){return b.id===
a}),_.remove(e.orders,function(b){return b.id===a}));return c}};Memory.profiling&&c(2,7).registerObject(e,"Market");q.exports=e;return q.exports};v[8]=function(c,t){t={};t[RESOURCE_HYDROGEN]=[];t[RESOURCE_OXYGEN]=[];t[RESOURCE_ZYNTHIUM]=[];t[RESOURCE_KEANIUM]=[];t[RESOURCE_UTRIUM]=[];t[RESOURCE_LEMERGIUM]=[];t[RESOURCE_CATALYST]=[];t[RESOURCE_HYDROXIDE]=[RESOURCE_HYDROGEN,RESOURCE_OXYGEN];t[RESOURCE_ZYNTHIUM_KEANITE]=[RESOURCE_ZYNTHIUM,RESOURCE_KEANIUM];t[RESOURCE_UTRIUM_LEMERGITE]=[RESOURCE_UTRIUM,
RESOURCE_LEMERGIUM];t[RESOURCE_GHODIUM]=[RESOURCE_ZYNTHIUM_KEANITE,RESOURCE_UTRIUM_LEMERGITE];t[RESOURCE_UTRIUM_HYDRIDE]=[RESOURCE_UTRIUM,RESOURCE_HYDROGEN];t[RESOURCE_UTRIUM_OXIDE]=[RESOURCE_UTRIUM,RESOURCE_OXYGEN];t[RESOURCE_KEANIUM_HYDRIDE]=[RESOURCE_KEANIUM,RESOURCE_HYDROGEN];t[RESOURCE_KEANIUM_OXIDE]=[RESOURCE_KEANIUM,RESOURCE_OXYGEN];t[RESOURCE_LEMERGIUM_HYDRIDE]=[RESOURCE_LEMERGIUM,RESOURCE_HYDROGEN];t[RESOURCE_LEMERGIUM_OXIDE]=[RESOURCE_LEMERGIUM,RESOURCE_OXYGEN];t[RESOURCE_ZYNTHIUM_HYDRIDE]=
[RESOURCE_ZYNTHIUM,RESOURCE_HYDROGEN];t[RESOURCE_ZYNTHIUM_OXIDE]=[RESOURCE_ZYNTHIUM,RESOURCE_OXYGEN];t[RESOURCE_GHODIUM_HYDRIDE]=[RESOURCE_GHODIUM,RESOURCE_HYDROGEN];t[RESOURCE_GHODIUM_OXIDE]=[RESOURCE_GHODIUM,RESOURCE_OXYGEN];t[RESOURCE_UTRIUM_ACID]=[RESOURCE_UTRIUM_HYDRIDE,RESOURCE_HYDROXIDE];t[RESOURCE_UTRIUM_ALKALIDE]=[RESOURCE_UTRIUM_OXIDE,RESOURCE_HYDROXIDE];t[RESOURCE_KEANIUM_ACID]=[RESOURCE_KEANIUM_HYDRIDE,RESOURCE_HYDROXIDE];t[RESOURCE_KEANIUM_ALKALIDE]=[RESOURCE_KEANIUM_OXIDE,RESOURCE_HYDROXIDE];
t[RESOURCE_LEMERGIUM_ACID]=[RESOURCE_LEMERGIUM_HYDRIDE,RESOURCE_HYDROXIDE];t[RESOURCE_LEMERGIUM_ALKALIDE]=[RESOURCE_LEMERGIUM_OXIDE,RESOURCE_HYDROXIDE];t[RESOURCE_ZYNTHIUM_ACID]=[RESOURCE_ZYNTHIUM_HYDRIDE,RESOURCE_HYDROXIDE];t[RESOURCE_ZYNTHIUM_ALKALIDE]=[RESOURCE_ZYNTHIUM_OXIDE,RESOURCE_HYDROXIDE];t[RESOURCE_GHODIUM_ACID]=[RESOURCE_GHODIUM_HYDRIDE,RESOURCE_HYDROXIDE];t[RESOURCE_GHODIUM_ALKALIDE]=[RESOURCE_GHODIUM_OXIDE,RESOURCE_HYDROXIDE];t[RESOURCE_CATALYZED_UTRIUM_ACID]=[RESOURCE_UTRIUM_ACID,RESOURCE_CATALYST];
t[RESOURCE_CATALYZED_UTRIUM_ALKALIDE]=[RESOURCE_UTRIUM_ALKALIDE,RESOURCE_CATALYST];t[RESOURCE_CATALYZED_KEANIUM_ACID]=[RESOURCE_KEANIUM_ACID,RESOURCE_CATALYST];t[RESOURCE_CATALYZED_KEANIUM_ALKALIDE]=[RESOURCE_KEANIUM_ALKALIDE,RESOURCE_CATALYST];t[RESOURCE_CATALYZED_LEMERGIUM_ACID]=[RESOURCE_LEMERGIUM_ACID,RESOURCE_CATALYST];t[RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE]=[RESOURCE_LEMERGIUM_ALKALIDE,RESOURCE_CATALYST];t[RESOURCE_CATALYZED_ZYNTHIUM_ACID]=[RESOURCE_ZYNTHIUM_ACID,RESOURCE_CATALYST];t[RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE]=
[RESOURCE_ZYNTHIUM_ALKALIDE,RESOURCE_CATALYST];t[RESOURCE_CATALYZED_GHODIUM_ACID]=[RESOURCE_GHODIUM_ACID,RESOURCE_CATALYST];t[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]=[RESOURCE_GHODIUM_ALKALIDE,RESOURCE_CATALYST];c.exports=t;return c.exports};v[9]=function(q,t){var g=c(2,9);t={run:function(c,e){g.registerFN(e,"Proxy."+c)()}};Memory.profiling&&g.registerObject(t,"Proxy");q.exports=t;return q.exports};v[10]=function(q,t){var g=[];t=function(c){this.id=c;if(!g[c])try{g[c]=JSON.parse(RawMemory.segments[c])}catch(e){g[c]=
void 0}};t.init=function(){RawMemory.setActiveSegments([1,2,3,4,5,6,7,8,9,10])};t.prototype={get memory(){return g[this.id]},set memory(c){g[this.id]=c}};t.prototype.set=function(){RawMemory.segments[this.id]=JSON.stringify(g[this.id])};Memory.profiling&&c(2,10).registerObject(t,"Segment");q.exports=t;return q.exports};v[11]=function(q,t){var g=c(4,11),m={nest:function(c,a){return a.length?_.mapValues(_.groupBy(c,a[0]),function(b){return m.nest(b,a.slice(1))}):c},creepsWithNoTask:function(c){return _.filter(c,
function(a){return!a.memory.currentTask||a.memory.currentTask.unimportant})},objectsClosestToObj:function(c,a){var b=a.id;if(0===c.length)return[];if(!a)return c;c=_.map(c,function(f){var c=f.id,d;Memory.ranges&&Memory.ranges[b]&&Memory.ranges[b][c]?d=Memory.ranges[b][c]:(d=a.pos.getRangeTo(f),f instanceof Creep||a instanceof Creep||(Memory.ranges||(Memory.ranges={}),Memory.ranges[b]||(Memory.ranges[b]={}),Memory.ranges[b][c]=d));return{object:f,distance:d}});c.sort(function(a,b){return a.distance-
b.distance});return _.map(c,function(a){return a.object})},getEmptyPosAroundPos:function(c){var a=0,b,f,g;for(b=c.x-1;b<c.x+2;b++)for(f=c.y-1;f<c.y+2;f++)if(b!==c.x||f!==c.y)g=new RoomPosition(b,f,c.roomName),a+=_.filter(g.look(),function(a){return"terrain"===a.type&&"wall"!==a.terrain}).length;return a},checkSiteIsClear:function(c){var a=!0,b=c.x,f=c.y,g=c.roomName,d=Game.rooms[g];if("wall"===(new RoomPosition(b,f,g)).lookFor(LOOK_TERRAIN)[0]||"wall"===(new RoomPosition(b-1,f,g)).lookFor(LOOK_TERRAIN)[0]&&
"wall"===(new RoomPosition(b+1,f,g)).lookFor(LOOK_TERRAIN)[0]||"wall"===(new RoomPosition(b,f-1,g)).lookFor(LOOK_TERRAIN)[0]&&"wall"===(new RoomPosition(b,f+1,g)).lookFor(LOOK_TERRAIN)[0])return!1;_.forEach(d.find(FIND_SOURCES),function(b){return a=1<c.getRangeTo(b)});if(!a)return!1;_.forEach(d.find(FIND_MINERALS),function(b){return a=1<c.getRangeTo(b)});if(!a||4>=c.getRangeTo(d.controller))return!1;b=_.filter(c.lookFor(LOOK_STRUCTURES),function(a){return"rampart"!==a.structureType});return 0===b.length?
!0:_.filter(b,function(a){return-1!==[STRUCTURE_ROAD,STRUCTURE_WALL].indexOf(a.structureType)}).length!==b.length?!1:b},buildStructures:function(c,a,b,f){var g=1,d=f.pos;f=d.x;for(var d=d.y,r,e,h;0<b&&50>g;){for(r=f-g;r<=f+g;r+=2){for(e=d-g;e<=d+g&&(1>r||48<r||1>e||48<e||0<_.filter(c.find(FIND_MY_CONSTRUCTION_SITES),function(a){return a.pos.x===r&&a.pos.y===e}).length||(h=m.checkSiteIsClear(new RoomPosition(r,e,c.name)),!1===h||(!0!==h&&_.forEach(h,function(a){a.destroy()}),c.createConstructionSite(r,
e,a),b--,0!==b)));e+=Math.abs(f-r)===g?2:2*g);if(0===b)break}g++}},getBodypartCost:function(c){return _.sum(_.map(c,function(a){return BODYPART_COST[a]}))},getSourceLabs:function(c){var a=g.labsInRoom(c),b=[];_.forEach(a,function(f){if(2>=m.objectsClosestToObj(a,f)[a.length-1].pos.getRangeTo(f)&&(b.push(f.id),2<=b.length))return!1});return b},getLabToBoostWith:function(c,a){var b=c.memory.labQueue,f=b&&b.sourceLabs?b.sourceLabs:[],e=[],b=null,d;a||(a=1);0===f.length&&(f=m.getSourceLabs(c));c.memory.labsInUse||
(c.memory.labsInUse=[]);for(var r=0;r<a;r++){b={};d=_.filter(g.labsInRoom(c),function(a){return-1===f.indexOf(a.id)&&-1===_.map(c.memory.labsInUse,function(a){return a.id}).indexOf(a.id)&&-1===_.map(e,function(a){return a.id}).indexOf(a.id)});0<d.length&&(b={id:d[0].id,pause:!1});if(!b||!b.id){b={id:_.filter(f,function(a){return-1===_.map(c.memory.labsInUse,function(a){return a.id}).indexOf(a)&&-1===_.map(e,function(a){return a.id}).indexOf(a)})[0],pause:!0};if(!b.id)return!1;d=Game.getObjectById(b.id);
0<d.mineralAmount&&(b.status="emptying",b.oldResource=d.mineralType,b.oldAmount=d.mineralAmount)}if(!b.id)return!1;e.push(b)}return e},roomLabsArePaused:function(c){return c.memory.labsInUse&&0<_.filter(c.memory.labsInUse,function(a){return a.pause}).length}};Memory.profiling&&c(2,11).registerObject(m,"Utilities");q.exports=m;return q.exports};v[12]=function(q,t){var g=c(4,12),m=c(11,12),e=c(44,12),a=c(42,12),b={checkSpawn:function(a,c){var d=_.filter(g.creeps[a]&&g.creeps[a].armyDismantler||[],function(a){return a.spawning||
300<a.ticksToLive}).length,f=Memory.army[a].dismantler.maxCreeps;d<f&&b.spawn(a,c);Memory.log&&0<f&&g.log.army[a].creeps.push({role:"armyDismantler",count:d,max:f})},spawn:function(a,b){var d=Memory.army[a],f=d.dismantler.units,c=[],h,k,l,n;d.boostRoom&&(h=Game.rooms[d.boostRoom],k=h.memory.labsInUse);if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;for(l=0;5>l;l++)c.push(TOUGH);for(l=0;l<f;l++)c.push(WORK);for(l=0;l<f+5;l++)c.push(MOVE);if(h&&!(n=m.getLabToBoostWith(h,
2)))return!1;l=_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(c)&&a.room.memory.region===d.region})[0];if(!l)return!1;a=l.createCreep(c,"armyDismantler-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"armyDismantler",army:a,labs:h?_.map(n,function(a){return a.id}):[],portals:b});g.spawning[l.id]="number"!==typeof a;"number"!==typeof a&&h&&(n[0].creepToBoost=a,n[0].resource=RESOURCE_CATALYZED_GHODIUM_ALKALIDE,n[0].amount=150,k.push(n[0]),
n[1].creepToBoost=a,n[1].resource=RESOURCE_CATALYZED_ZYNTHIUM_ACID,n[1].amount=30*f,k.push(n[1]),g.creeps[h.name]&&_.forEach(_.filter(g.creeps[h.name].all,function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&-1!==_.map(n,function(a){return a.id}).indexOf(a.memory.currentTask.id)}),function(a){delete a.memory.currentTask}));return"number"!==typeof a},assignTasks:function(b,c,d){var f=_.filter(m.creepsWithNoTask(g.creeps[b]&&g.creeps[b].armyDismantler||[]),function(a){return!a.spawning}),
p=[],h=Memory.army[b],k=h.stageRoom,l=h.attackRoom,n=Game.rooms[l],w=h.dismantle,x,u;switch(c){case "building":_.forEach(_.filter(f,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(b){(new a(b.memory.labs[0])).canAssign(b);p.push(b.name)});_.remove(f,function(a){return-1!==p.indexOf(a.name)});p=[];if(0===f.length)break;x=new a(h.buildRoom);_.forEach(f,function(b){b.say("Building");b.memory.portaling&&b.memory.portals[0]!==b.room.name&&b.memory.portals.shift();b.memory.portals&&
0<b.memory.portals.length?b.memory.portals[0]===b.room.name?(b.memory.portaling=!0,x=new a(g.portalsInRoom(b.room)[0].id)):x=new a(b.memory.portals[0]):x=new a(h.buildRoom);x.canAssign(b)});break;case "staging":x=new a(k);_.forEach(f,function(a){a.say("Staging");x.canAssign(a)});break;case "dismantle":u=g.creeps[b].armyHealer||[];if(0<u.length&&k!==l&&(x=new a(k),x.range=22,_.forEach(_.filter(g.creeps[b].armyDismantler,function(a){return(a.room.name===l||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&
1E3<=a.hitsMax-a.hits}),function(a){a.say("Ouch!");x.canAssign(a);p.push(a.name)}),_.remove(f,function(a){return-1!==p.indexOf(a.name)}),p=[],0===f.length))break;if(0<u.length&&(_.forEach(f,function(b){var d=m.objectsClosestToObj(u,b);2<d[0].pos.getRangeTo(b)&&(d=new a(d[0].id),d.canAssign(b),p.push(b.name))}),_.remove(f,function(a){return-1!==p.indexOf(a.name)}),p=[],0===f.length))break;0<u.length&&_.remove(f,function(a){return 1E3<=a.hitsMax-a.hits});if(n&&0<w.length&&(x=new e(w[0]),_.forEach(f,
function(a){x.canAssign(a)&&(a.say("Dismantle"),p.push(a.name))}),_.remove(f,function(a){return-1!==p.indexOf(a.name)}),p=[],0===f.length))break;x=new a(l);_.forEach(f,function(a){x.canAssign(a)});break;case "attack":u=g.creeps[b].armyHealer||[];if(0<u.length&&k!==l&&(x=new a(k),x.range=22,_.forEach(_.filter(g.creeps[b].armyDismantler,function(a){return(a.room.name===l||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&1E3<=a.hitsMax-a.hits}),function(a){a.say("Ouch!");x.canAssign(a);p.push(a.name)}),
_.remove(f,function(a){return-1!==p.indexOf(a.name)}),p=[],0===f.length))break;0<u.length&&_.remove(f,function(a){return 1E3<=a.hitsMax-a.hits});if(n&&(b=_.filter(n.find(FIND_HOSTILE_STRUCTURES),function(a){return a.structureType!==STRUCTURE_CONTROLLER&&a.structureType!==STRUCTURE_RAMPART&&a.structureType!==STRUCTURE_KEEPER_LAIR}),0<b.length&&(x=new e(b[0].id),_.forEach(f,function(a){x.canAssign(a)&&(a.say("Dismantle"),p.push(a.name))}),_.remove(f,function(a){return-1!==p.indexOf(a.name)}),p=[],0===
f.length)))break;_.forEach(d.rally.tasks,function(a){_.forEach(f,function(b){a.canAssign(b);p.push(b.name);return!1});_.remove(f,function(a){return-1!==p.indexOf(a.name)});p=[]});x=h.restPosition?new a(new RoomPosition(h.restPosition.x,h.restPosition.y,h.restPosition.room)):new a(l);_.forEach(f,function(a){x.canAssign(a)})}}};Memory.profiling&&c(2,12).registerObject(b,"ArmyDismantler");q.exports=b;return q.exports};v[13]=function(q,t){var g=c(4,13),m=c(11,13),e=c(40,13),a=c(42,13),b={checkSpawn:function(a,
c){var d=_.filter(g.creeps[a]&&g.creeps[a].armyHealer||[],function(a){return a.spawning||300<a.ticksToLive}).length,f=Memory.army[a].healer.maxCreeps;d<f&&b.spawn(a,c);Memory.log&&0<f&&g.log.army[a].creeps.push({role:"armyHealer",count:d,max:f})},spawn:function(a,b){var d=Memory.army[a],f=d.healer.units,c=[],h,k,l,n;d.boostRoom&&(h=Game.rooms[d.boostRoom],k=h.memory.labsInUse);if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;for(l=0;5>l;l++)c.push(TOUGH);
for(l=0;l<f-1;l++)c.push(HEAL);for(l=0;l<f+5;l++)c.push(MOVE);c.push(HEAL);if(h&&!(n=m.getLabToBoostWith(h,2)))return!1;l=_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(c)&&a.room.memory.region===d.region})[0];if(!l)return!1;a=l.createCreep(c,"armyHealer-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"armyHealer",army:a,labs:h?_.map(n,function(a){return a.id}):[],portals:b});g.spawning[l.id]="number"!==typeof a;"number"!==typeof a&&
h&&(n[0].creepToBoost=a,n[0].resource=RESOURCE_CATALYZED_GHODIUM_ALKALIDE,n[0].amount=150,k.push(n[0]),n[1].creepToBoost=a,n[1].resource=RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE,n[1].amount=30*f,k.push(n[1]),g.creeps[h.name]&&_.forEach(_.filter(g.creeps[h.name].all,function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&-1!==_.map(n,function(a){return a.id}).indexOf(a.memory.currentTask.id)}),function(a){delete a.memory.currentTask}));return"number"!==typeof a},assignTasks:function(b,
c,d){var f=[],p=Memory.army[b],h=p.stageRoom,k=p.attackRoom,l=p.dismantle,n,w;_.forEach(_.filter(g.creeps[b]&&g.creeps[b].armyHealer||[],function(a){return!a.spawning&&a.memory.escorting}),function(b){Game.getObjectById(b.memory.escorting)?1E3>b.hitsMax-b.hits&&!(new e(b.memory.escorting)).canAssign(b)&&(new a(b.memory.escorting)).canAssign(b):delete b.memory.escorting});n=_.filter(m.creepsWithNoTask(g.creeps[b]&&g.creeps[b].armyHealer||[]),function(a){return!a.spawning&&!a.memory.escorting});switch(c){case "building":_.forEach(_.filter(n,
function(a){return a.memory.labs&&0<a.memory.labs.length}),function(b){(new a(b.memory.labs[0])).canAssign(b);f.push(b.name)});_.remove(n,function(a){return-1!==f.indexOf(a.name)});f=[];if(0===n.length)break;w=new a(p.buildRoom);_.forEach(n,function(b){b.say("Building");b.memory.portaling&&b.memory.portals[0]!==b.room.name&&b.memory.portals.shift();b.memory.portals&&0<b.memory.portals.length?b.memory.portals[0]===b.room.name?(b.memory.portaling=!0,w=new a(g.portalsInRoom(b.room)[0].id)):w=new a(b.memory.portals[0]):
w=new a(p.buildRoom);w.canAssign(b)});break;case "staging":w=new a(h);_.forEach(n,function(a){a.say("Staging");w.canAssign(a)});break;case "dismantle":if(h!==k&&(w=new a(h),w.range=22,_.forEach(_.filter(g.creeps[b].armyHealer,function(a){return(a.room.name===k||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&1E3<=a.hitsMax-a.hits}),function(a){a.say("Ouch!");w.canAssign(a);f.push(a.name)}),_.remove(n,function(a){return-1!==f.indexOf(a.name)}),f=[],0===n.length))break;_.forEach(d.heal.tasks,function(a){_.forEach(n,
function(b){a.canAssign(b)&&(b.say("Heal"),f.push(b.name))});_.remove(n,function(a){return-1!==f.indexOf(a.name)});f=[]});if(Game.rooms[k]&&0<l.length&&(w=new a(l[0]),w.range=3,_.forEach(n,function(a){w.canAssign(a);f.push(a.name)}),_.remove(n,function(a){return-1!==f.indexOf(a.name)}),f=[],0===n.length))break;w=new a(k);_.forEach(n,function(a){w.canAssign(a)});break;case "attack":if(h!==k&&(w=new a(h),w.range=22,_.forEach(_.filter(g.creeps[b].armyHealer,function(a){return(a.room.name===k||1>=a.pos.x||
48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&1E3<=a.hitsMax-a.hits}),function(a){a.say("Ouch!");w.canAssign(a);f.push(a.name)}),_.remove(n,function(a){return-1!==f.indexOf(a.name)}),f=[],0===n.length))break;_.forEach(d.heal.tasks,function(a){_.forEach(n,function(b){a.canAssign(b)&&(b.say("Heal"),f.push(b.name))});_.remove(n,function(a){return-1!==f.indexOf(a.name)});f=[]});Game.rooms[k]&&!Game.rooms[k].unobservable&&_.forEach(e.getTasks(Game.rooms[k]),function(a){_.forEach(n,function(b){a.canAssign(b)&&
(b.say("Heal"),f.push(b.name))});_.remove(n,function(a){return-1!==f.indexOf(a.name)});f=[]});_.forEach(d.rally.tasks,function(a){_.forEach(n,function(b){a.canAssign(b);f.push(b.name);return!1});_.remove(n,function(a){return-1!==f.indexOf(a.name)});f=[]});w=p.restPosition?new a(new RoomPosition(p.restPosition.x,p.restPosition.y,p.restPosition.room)):new a(k);_.forEach(n,function(a){w.canAssign(a)})}}};Memory.profiling&&c(2,13).registerObject(b,"ArmyHealer");q.exports=b;return q.exports};v[14]=function(q,
t){var g=c(4,14),m=c(11,14),e=c(42,14),a={checkSpawn:function(b,f){var c=_.filter(g.creeps[b]&&g.creeps[b].armyMelee||[],function(a){return a.spawning||300<a.ticksToLive}).length,d=Memory.army[b].melee.maxCreeps;c<d&&a.spawn(b,f);Memory.log&&0<d&&g.log.army[b].creeps.push({role:"armyMelee",count:c,max:d})},spawn:function(a,f){var b=Memory.army[a],d=b.melee.units,c=[],e,h,k,l;b.boostRoom&&(e=Game.rooms[b.boostRoom],h=e.memory.labsInUse);if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;
for(k=0;5>k;k++)c.push(TOUGH);for(k=0;k<d;k++)c.push(ATTACK);for(k=0;k<d+5;k++)c.push(MOVE);if(e&&!(l=m.getLabToBoostWith(e,2)))return!1;k=_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(c)&&a.room.memory.region===b.region})[0];if(!k)return!1;a=k.createCreep(c,"armyMelee-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"armyMelee",army:a,labs:e?_.map(l,function(a){return a.id}):[],portals:f});g.spawning[k.id]="number"!==typeof a;"number"!==
typeof a&&e&&(l[0].creepToBoost=a,l[0].resource=RESOURCE_CATALYZED_GHODIUM_ALKALIDE,l[0].amount=150,h.push(l[0]),l[1].creepToBoost=a,l[1].resource=RESOURCE_CATALYZED_UTRIUM_ACID,l[1].amount=30*d,h.push(l[1]),g.creeps[e.name]&&_.forEach(_.filter(g.creeps[e.name].all,function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&-1!==_.map(l,function(a){return a.id}).indexOf(a.memory.currentTask.id)}),function(a){delete a.memory.currentTask}));return"number"!==typeof a},assignTasks:function(a,
f,c){var b=_.filter(m.creepsWithNoTask(g.creeps[a]&&g.creeps[a].armyMelee||[]),function(a){return!a.spawning}),r=[],p=Memory.army[a],h=p.stageRoom,k=p.attackRoom,l=p.dismantle,n,w;switch(f){case "building":_.forEach(_.filter(b,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(a){(new e(a.memory.labs[0])).canAssign(a);r.push(a.name)});_.remove(b,function(a){return-1!==r.indexOf(a.name)});r=[];if(0===b.length)break;n=new e(p.buildRoom);_.forEach(b,function(a){a.say("Building");a.memory.portaling&&
a.memory.portals[0]!==a.room.name&&a.memory.portals.shift();a.memory.portals&&0<a.memory.portals.length?a.memory.portals[0]===a.room.name?(a.memory.portaling=!0,n=new e(g.portalsInRoom(a.room)[0].id)):n=new e(a.memory.portals[0]):n=new e(p.buildRoom);n.canAssign(a)});break;case "staging":n=new e(h);_.forEach(b,function(a){a.say("Staging");n.canAssign(a)});break;case "dismantle":w=g.creeps[a].armyHealer||[];if(0<w.length&&h!==k&&(n=new e(h),n.range=22,_.forEach(_.filter(g.creeps[a].armyMelee,function(a){return(a.room.name===
k||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&1E3<=a.hitsMax-a.hits}),function(a){a.say("Ouch!");n.canAssign(a);r.push(a.name)}),_.remove(b,function(a){return-1!==r.indexOf(a.name)}),r=[],0===b.length))break;if(0<w.length&&(_.forEach(b,function(a){var b=m.objectsClosestToObj(w,a);2<b[0].pos.getRangeTo(a)&&(b=new e(b[0].id),b.canAssign(a),r.push(a.name))}),_.remove(b,function(a){return-1!==r.indexOf(a.name)}),r=[],0===b.length))break;0<w.length&&_.remove(b,function(a){return 1E3<=a.hitsMax-
a.hits});_.forEach(c.melee.tasks,function(a){_.forEach(b,function(b){a.canAssign(b)&&(b.say("Die!",!0),r.push(b.name))});_.remove(b,function(a){return-1!==r.indexOf(a.name)});r=[];if(0===b.length)return!1});if(0===b.length)break;if(Game.rooms[k]&&0<l.length&&(n=new e(l[0]),n.range=3,_.forEach(b,function(a){n.canAssign(a);r.push(a.name)}),_.remove(b,function(a){return-1!==r.indexOf(a.name)}),r=[],0===b.length))break;n=new e(k);_.forEach(b,function(a){n.canAssign(a)});break;case "attack":w=g.creeps[a].armyHealer||
[];if(0<w.length&&h!==k&&(n=new e(h),n.range=22,_.forEach(_.filter(g.creeps[a].armyMelee,function(a){return(a.room.name===k||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&1E3<=a.hitsMax-a.hits}),function(a){a.say("Ouch!");n.canAssign(a);r.push(a.name)}),_.remove(b,function(a){return-1!==r.indexOf(a.name)}),r=[],0===b.length))break;0<w.length&&_.remove(b,function(a){return 1E3<=a.hitsMax-a.hits});_.forEach(c.melee.tasks,function(a){_.forEach(b,function(b){a.canAssign(b)&&(b.say("Die!",!0),r.push(b.name))});
_.remove(b,function(a){return-1!==r.indexOf(a.name)});r=[];if(0===b.length)return!1});0!==b.length&&(_.forEach(c.rally.tasks,function(a){_.forEach(b,function(b){a.canAssign(b);r.push(b.name);return!1});_.remove(b,function(a){return-1!==r.indexOf(a.name)});r=[]}),n=p.restPosition?new e(new RoomPosition(p.restPosition.x,p.restPosition.y,p.restPosition.room)):new e(k),_.forEach(b,function(a){n.canAssign(a)}))}}};Memory.profiling&&c(2,14).registerObject(a,"ArmyMelee");q.exports=a;return q.exports};v[15]=
function(q,t){var g=c(4,15),m=c(11,15),e=c(42,15),a={checkSpawn:function(b,f){var c=_.filter(g.creeps[b]&&g.creeps[b].armyRanged||[],function(a){return a.spawning||300<a.ticksToLive}).length,d=Memory.army[b].ranged.maxCreeps;c<d&&a.spawn(b,f);Memory.log&&0<d&&g.log.army[b].creeps.push({role:"armyRanged",count:c,max:d})},spawn:function(a,f){var b=Memory.army[a],d=b.ranged.units,c=[],e,h,k,l;b.boostRoom&&(e=Game.rooms[b.boostRoom],h=e.memory.labsInUse);if(0===_.filter(Game.spawns,function(a){return!a.spawning&&
!g.spawning[a.id]}).length)return!1;for(k=0;5>k;k++)c.push(TOUGH);for(k=0;k<d;k++)c.push(RANGED_ATTACK);for(k=0;k<d+5;k++)c.push(MOVE);if(e&&!(l=m.getLabToBoostWith(e,2)))return!1;k=_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(c)&&a.room.memory.region===b.region})[0];if(!k)return!1;a=k.createCreep(c,"armyRanged-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"armyRanged",army:a,labs:e?_.map(l,function(a){return a.id}):[],portals:f});
g.spawning[k.id]="number"!==typeof a;"number"!==typeof a&&e&&(l[0].creepToBoost=a,l[0].resource=RESOURCE_CATALYZED_GHODIUM_ALKALIDE,l[0].amount=150,h.push(l[0]),l[1].creepToBoost=a,l[1].resource=RESOURCE_CATALYZED_KEANIUM_ALKALIDE,l[1].amount=30*d,h.push(l[1]),g.creeps[e.name]&&_.forEach(_.filter(g.creeps[e.name].all,function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&-1!==_.map(l,function(a){return a.id}).indexOf(a.memory.currentTask.id)}),function(a){delete a.memory.currentTask}));
return"number"!==typeof a},assignTasks:function(a,f,c){var b=_.filter(m.creepsWithNoTask(g.creeps[a]&&g.creeps[a].armyRanged||[]),function(a){return!a.spawning}),r=[],p=Memory.army[a],h=p.stageRoom,k=p.attackRoom,l=p.dismantle,n,w;switch(f){case "building":_.forEach(_.filter(b,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(a){(new e(a.memory.labs[0])).canAssign(a);r.push(a.name)});_.remove(b,function(a){return-1!==r.indexOf(a.name)});r=[];if(0===b.length)break;_.forEach(b,function(a){a.say("Building");
a.memory.portaling&&a.memory.portals[0]!==a.room.name&&a.memory.portals.shift();a.memory.portals&&0<a.memory.portals.length?a.memory.portals[0]===a.room.name?(a.memory.portaling=!0,n=new e(g.portalsInRoom(a.room)[0].id)):n=new e(a.memory.portals[0]):n=new e(p.buildRoom);n.canAssign(a)});break;case "staging":n=new e(h);_.forEach(b,function(a){a.say("Staging");n.canAssign(a)});break;case "dismantle":w=g.creeps[a].armyHealer||[];if(0<w.length&&h!==k&&(n=new e(h),n.range=22,_.forEach(_.filter(g.creeps[a].armyRanged,
function(a){return(a.room.name===k||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&1E3<=a.hitsMax-a.hits}),function(a){a.say("Ouch!");n.canAssign(a);r.push(a.name)}),_.remove(b,function(a){return-1!==r.indexOf(a.name)}),r=[],0===b.length))break;if(0<w.length&&(_.forEach(b,function(a){var b=m.objectsClosestToObj(w,a);2<b[0].pos.getRangeTo(a)&&(b=new e(b[0].id),b.canAssign(a),r.push(a.name))}),_.remove(b,function(a){return-1!==r.indexOf(a.name)}),r=[],0===b.length))break;0<w.length&&_.remove(b,
function(a){return 1E3<=a.hitsMax-a.hits});_.forEach(c.ranged.tasks,function(a){_.forEach(b,function(b){a.canAssign(b)&&(b.say("Die!",!0),r.push(b.name))});_.remove(b,function(a){return-1!==r.indexOf(a.name)});r=[];if(0===b.length)return!1});if(0===b.length)break;if(Game.rooms[k]&&0<l.length&&(n=new e(l[0]),n.range=3,_.forEach(b,function(a){n.canAssign(a);r.push(a.name)}),_.remove(b,function(a){return-1!==r.indexOf(a.name)}),r=[],0===b.length))break;n=new e(k);_.forEach(b,function(a){n.canAssign(a)});
break;case "attack":w=g.creeps[a].armyHealer||[];if(0<w.length&&h!==k&&(n=new e(h),n.range=22,_.forEach(_.filter(g.creeps[a].armyRanged,function(a){return(a.room.name===k||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&1E3<=a.hitsMax-a.hits}),function(a){a.say("Ouch!");n.canAssign(a);r.push(a.name)}),_.remove(b,function(a){return-1!==r.indexOf(a.name)}),r=[],0===b.length))break;0<w.length&&_.remove(b,function(a){return 1E3<=a.hitsMax-a.hits});_.forEach(c.ranged.tasks,function(a){_.forEach(b,function(b){a.canAssign(b)&&
(b.say("Die!",!0),r.push(b.name))});_.remove(b,function(a){return-1!==r.indexOf(a.name)});r=[];if(0===b.length)return!1});0!==b.length&&(_.forEach(c.rally.tasks,function(a){_.forEach(b,function(b){a.canAssign(b);r.push(b.name);return!1});_.remove(b,function(a){return-1!==r.indexOf(a.name)});r=[]}),n=p.restPosition?new e(new RoomPosition(p.restPosition.x,p.restPosition.y,p.restPosition.room)):new e(k),_.forEach(b,function(a){n.canAssign(a)}))}}};Memory.profiling&&c(2,15).registerObject(a,"ArmyRanged");
q.exports=a;return q.exports};v[16]=function(q,t){var g=c(4,16);c(5,16);var m=c(11,16),e=c(42,16),a=c(45,16),b={checkSpawn:function(a){var f=Memory.maxCreeps.claimer,d=a.name,c=g.creeps[d]&&g.creeps[d].claimer||[],e=0;f&&_.forEach(f[d],function(d,f){d=_.filter(c,function(a){return a.memory.claim===f}).length;e+=1;0===d&&b.spawn(a,f)});Memory.log&&(0<c.length||0<e)&&g.log.rooms[d].creeps.push({role:"claimer",count:c.length,max:e})},spawn:function(a,b){var d=g.spawnsInRoom(a),f=[CLAIM,MOVE];if(0===
_.filter(d,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;d=_.filter(d,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(f)})[0];if(!d)return!1;a=d.createCreep(f,"claimer-"+b+"-"+Game.time.toFixed(0).substring(4),{role:"claimer",home:a.name,claim:b});g.spawning[d.id]="number"!==typeof a;return"number"!==typeof a},assignTasks:function(b,c){b=b.name;b=m.creepsWithNoTask(g.creeps[b]&&g.creeps[b].claimer||[]);var d=[];0!==b.length&&(_.forEach(_.filter(b,
function(a){return a.room.name!==a.memory.claim}),function(a){e.getClaimerTask(a).canAssign(a)&&d.push(a.name)}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&(_.forEach(b,function(b){a.getTask(b).canAssign(b)&&(b.say("Claiming"),d.push(b.name))}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&_.forEach(b,function(a){a.room.name===a.memory.claim&&a.room.controller.my&&a.suicide()})))}};Memory.profiling&&c(2,16).registerObject(b,"RoleClaimer");q.exports=
b;return q.exports};v[17]=function(q,t){var g=c(4,17),m=c(11,17),e=c(46,17),a=c(47,17),b=c(42,17),f={checkSpawn:function(a){var b=g.spawnsInRoom(a),c=0,e=a.name,h=g.creeps[e]&&g.creeps[e].collector||[],k,l;0!==g.containersInRoom(a).length&&a.storage&&a.storage.my||0===b.length||(b=m.objectsClosestToObj(a.find(FIND_SOURCES),b[0]),1>=b.length||(l=Math.max((2500-a.energyCapacityAvailable)/2500,.1),_.forEach(b,function(b,d){var n=b.id;0!==d&&(c+=Math.ceil(3*l),k=_.filter(h,function(a){return a.memory.homeSource===
n}).length,k<3*l&&f.spawn(a,n))}),Memory.log&&(0<h.length||0<c)&&g.log.rooms[e].creeps.push({role:"collector",count:h.length,max:c})))},spawn:function(a,b){var d=[],f=a.name,c,k,l;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;c=Math.min(a.energyCapacityAvailable,3300);k=Math.floor(c/200);c%=200;for(l=0;l<k;l++)d.push(WORK);150<=c&&d.push(WORK);for(l=0;l<k;l++)d.push(CARRY);100<=c&&150>c&&d.push(CARRY);for(l=0;l<k;l++)d.push(MOVE);50<=c&&d.push(MOVE);
k=_.filter(Game.spawns,function(b){return!b.spawning&&!g.spawning[b.id]&&b.room.energyAvailable>=m.getBodypartCost(d)&&b.room.memory.region===a.memory.region}).sort(function(a,b){return(a.room.name===f?0:1)-(b.room.name===f?0:1)})[0];if(!k)return!1;b=k.createCreep(d,"collector-"+f+"-"+Game.time.toFixed(0).substring(4),{role:"collector",home:f,homeSource:b});k.room.name===f&&(g.spawning[k.id]="number"!==typeof b);return"number"!==typeof b},assignTasks:function(f,d){var c=f.name,p=_.filter(m.creepsWithNoTask(g.creeps[c]&&
g.creeps[c].collector||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),h=g.creeps[c]&&g.creeps[c].all||[],k=[];0!==p.length&&(_.forEach(d.upgradeController.criticalTasks,function(a){0===_.filter(h,function(b){return b.memory.currentTask&&"upgradeController"===b.memory.currentTask.type&&b.memory.currentTask.room===a.room}).length&&(_.forEach(m.objectsClosestToObj(p,f.controller),function(b){if(a.canAssign(b))return b.say("CritCntrlr"),k.push(b.name),!1}),_.remove(p,function(a){return-1!==
k.indexOf(a.name)}),k=[])}),0!==p.length&&(_.forEach(p,function(a){a.carry[RESOURCE_ENERGY]<(8===f.controller.level?200:7===f.controller.level?100:50)||_.forEach(d.fillEnergy.extensionTasks.sort(function(b,d){return b.object.pos.getRangeTo(a)-d.object.pos.getRangeTo(a)}),function(b){if(0<b.object.energyCapacity-b.object.energy-_.reduce(_.filter(h,function(a){return a.memory.currentTask&&"fillEnergy"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||
0)},0)&&b.canAssign(a))return a.say("Extension"),k.push(a.name),!1})}),_.remove(p,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==p.length&&(_.forEach(d.fillEnergy.spawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(h,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(m.objectsClosestToObj(p,a.object),function(d){if(a.canAssign(d)&&
(d.say("Spawn"),k.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(p,function(a){return-1!==k.indexOf(a.name)}),k=[])}),0!==p.length&&(_.forEach(d.fillEnergy.towerTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(h,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(m.objectsClosestToObj(p,a.object),function(d){if(a.canAssign(d)&&
(d.say("Tower"),k.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(p,function(a){return-1!==k.indexOf(a.name)}),k=[])}),0!==p.length&&(_.forEach(d.repair.criticalTasks,function(a){_.forEach(m.objectsClosestToObj(p,a.structure),function(b){if(0===_.filter(g.creeps[a.structure.room.name]&&g.creeps[a.structure.room.name].all||[],function(b){return b.memory.currentTask&&"repair"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length&&a.canAssign(b))return b.say("CritRepair"),
k.push(b.name),!1});_.remove(p,function(a){return-1!==k.indexOf(a.name)});k=[]}),0!==p.length&&(_.forEach(d.build.tasks,function(a){var b=a.constructionSite.progressTotal-a.constructionSite.progress-_.reduce(_.filter(g.creeps[a.constructionSite.room.name]&&g.creeps[a.constructionSite.room.name].all||[],function(b){return b.memory.currentTask&&"build"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(m.objectsClosestToObj(p,
a.constructionSite),function(d){if(a.canAssign(d)&&(d.say("Build"),k.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(p,function(a){return-1!==k.indexOf(a.name)}),k=[])}),0!==p.length&&(_.forEach(d.repair.tasks,function(a){var b=a.structure.hitsMax-a.structure.hits-100*_.reduce(_.filter(g.creeps[a.structure.room.name]&&g.creeps[a.structure.room.name].all||[],function(b){return b.memory.currentTask&&"repair"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,
b){return a+(b.carry[RESOURCE_ENERGY]||0)},0),d=!1;0<b&&(_.forEach(m.objectsClosestToObj(p,a.structure),function(f){if(a.canAssign(f)&&(f.say("Repair"),k.push(f.name),b-=100*(f.carry[RESOURCE_ENERGY]||0),d=!0,0>=b))return!1}),_.remove(p,function(a){return-1!==k.indexOf(a.name)}),k=[]);return d}),0!==p.length&&(_.forEach(d.upgradeController.tasks,function(a){_.forEach(m.objectsClosestToObj(p,f.controller),function(b){a.canAssign(b)&&(b.say("Controller"),k.push(b.name))});_.remove(p,function(a){return-1!==
k.indexOf(a.name)});k=[]}),0!==p.length&&(0===g.hostilesInRoom(f).length&&_.forEach(p,function(b){_.forEach(a.getTasks(b.room),function(a){if(!(0<_.filter(g.creeps[a.resource.room.name]&&g.creeps[a.resource.room.name].all||[],function(b){return b.memory.currentTask&&"pickupResource"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length)&&a.canAssign(b))return b.say("Pickup"),k.push(b.name),!1})}),_.remove(p,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==p.length&&(_.forEach(d.collectEnergy.tasks,
function(a){_.forEach(p,function(b){a.canAssign(b)&&(b.say("Collecting"),k.push(b.name))});_.remove(p,function(a){return-1!==k.indexOf(a.name)});k=[]}),0!==p.length&&(_.forEach(p,function(a){(new e).canAssign(a)&&(a.say("Harvesting"),k.push(a.name))}),_.remove(p,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==p.length&&_.forEach(b.getHarvesterTasks(p),function(a){a.canAssign(a.creep)}))))))))))))}};Memory.profiling&&c(2,17).registerObject(f,"RoleCollector");q.exports=f;return q.exports};v[18]=
function(q,t){var g=c(4,18);c(5,18);var m=c(11,18),e=c(42,18),a=c(48,18),b={checkSpawn:function(a){var f=Memory.maxCreeps.converter,d=a.name,c=g.creeps[d]&&g.creeps[d].converter||[],e=0;f&&_.forEach(f[d],function(d,f){d=_.filter(c,function(a){return a.memory.attack===f}).length;e+=1;0===d&&b.spawn(a,f)});Memory.log&&(0<c.length||0<e)&&g.log.rooms[d].creeps.push({role:"converter",count:c.length,max:e})},spawn:function(a,b){var d=[],f=g.spawnsInRoom(a),c,h;if(0===_.filter(f,function(a){return!a.spawning&&
!g.spawning[a.id]}).length)return!1;c=Math.floor(Math.min(supportRoom.energyCapacityAvailable,24400)/3050);for(h=0;h<c;h++)d.push(CLAIM),d.push(CLAIM),d.push(CLAIM),d.push(CLAIM),d.push(CLAIM);for(h=0;h<c;h++)d.push(MOVE);f=_.filter(f,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(d)})[0];if(!f)return!1;a=f.createCreep(d,"converter-"+b+"-"+Game.time.toFixed(0).substring(4),{role:"converter",home:a.name,attack:b});g.spawning[f.id]="number"!==typeof a;return"number"!==
typeof a},assignTasks:function(b,c){b=b.name;b=m.creepsWithNoTask(g.creeps[b]&&g.creeps[b].converter||[]);var d=[];0!==b.length&&(_.forEach(_.filter(b,function(a){return a.room.name!==a.memory.attack}),function(a){e.getClaimerTask(a).canAssign(a)&&d.push(a.name)}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&(_.forEach(b,function(b){a.getTask(b).canAssign(b)&&(b.say("Attacking"),d.push(b.name))}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&
_.forEach(b,function(a){a.suicide()})))}};Memory.profiling&&c(2,18).registerObject(b,"RoleConverter");q.exports=b;return q.exports};v[19]=function(q,t){var g=c(4,19),m=c(11,19),e=c(42,19),a=c(41,19),b=function(a,b){switch(b){case 0:return 25>a.x&&25>a.y;case 1:return 25>a.x&&25<a.y;case 2:return 25<a.x&&25<a.y;case 3:return 25<a.x&&25>a.y}},f={checkSpawn:function(a){var b=a.name,c=g.creeps[b]&&g.creeps[b].defender||[],e=Game.rooms[Memory.rooms[b].roomType.supportRoom];1>_.filter(c,function(a){return a.spawning||
300<=a.ticksToLive}).length&&f.spawn(a,e);Memory.log&&g.log.rooms[b].creeps.push({role:"defender",count:c.length,max:1})},spawn:function(a,b){var d=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,HEAL,HEAL,HEAL,HEAL,HEAL],f=a.name,c=b.name;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&
!g.spawning[a.id]}).length)return!1;a=_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(d)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!a)return!1;f=a.createCreep(d,"defender-"+f+"-"+Game.time.toFixed(0).substring(4),{role:"defender",home:f,supportRoom:c});a.room.name===c&&(g.spawning[a.id]="number"!==typeof f);return"number"!==typeof f},assignTasks:function(f,
d){d=f.name;d=_.filter(m.creepsWithNoTask(g.creeps[d]&&g.creeps[d].defender||[]),function(a){return!a.spawning});var c,p;f&&!f.unobservable&&(c=g.hostilesInRoom(f),p=g.sourceKeepersInRoom(f));_.forEach(d,function(d){d.room.name!==d.memory.home?e.getDefenderTask(d).canAssign(d):(d.memory.quadrant||(d.memory.quadrant=0),_.forEach(_.filter(c,function(a){return b(a.pos,d.memory.quadrant)}),function(b){return!(new a(b.id)).canAssign(d)}),d.memory.currentTask||(_.forEach(_.filter(p,function(a){return 200>
a.ticksToSpawn&&b(a.pos,d.memory.quadrant)}),function(a){a=new e(a.id,d);a.range=1;return!a.canAssign(d)}),d.memory.currentTask||(d.memory.quadrant=(d.memory.quadrant+1)%4)))})}};Memory.profiling&&c(2,19).registerObject(f,"RoleDefender");q.exports=f;return q.exports};v[20]=function(q,t){var g=c(4,20),m=c(11,20),e=c(49,20),a=c(47,20),b=c(42,20),f=c(50,20),u={checkSpawn:function(a,b){var d=a.name,f=g.creeps[d]&&g.creeps[d].dismantler||[];b||(b=a);0===g.spawnsInRoom(b).length||a.unobservable||(0===_.filter(f,
function(a){return a.spawning||150<=a.ticksToLive}).length&&u.spawn(a,b),Memory.log&&g.log.rooms[d].creeps.push({role:"dismantler",count:f.length,max:1}))},spawn:function(a,b){var d=[];a=a.name;var f=b.name,c,l,e;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;c=Math.min(b.energyCapacityAvailable,3300);l=Math.floor(c/200);c%=200;for(e=0;e<l;e++)d.push(WORK);150<=c&&d.push(WORK);for(e=0;e<l;e++)d.push(CARRY);100<=c&&150>c&&d.push(CARRY);for(e=0;e<l;e++)d.push(MOVE);
50<=c&&d.push(MOVE);l=_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(d)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===f?0:1)-(b.room.name===f?0:1)})[0];if(!l)return!1;a=l.createCreep(d,"dismantler-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"dismantler",home:a,supportRoom:f});l.room.name===f&&(g.spawning[l.id]="number"!==typeof a);return"number"!==typeof a},assignTasks:function(d,c){var r=d.name,
h=_.filter(m.creepsWithNoTask(g.creeps[r]&&g.creeps[r].dismantler||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),k=[];0!==h.length&&(_.forEach(_.filter(h,function(a){return a.room.name!==r}),function(a){_.forEach(f.getCriticalTasks(a.room),function(b){if(0===_.filter(g.creeps[b.structure.room.name]&&g.creeps[b.structure.room.name].all||[],function(a){return a.memory.currentTask&&"repair"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length&&b.canAssign(a))return a.say("CritRepair"),
k.push(a.name),!1})}),_.remove(h,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==h.length&&(_.forEach(h,function(a){var b=a.room.find(FIND_MY_CONSTRUCTION_SITES);0<b.length&&(new e(b[0].id)).canAssign(a)&&(a.say("Build"),k.push(a.name))}),_.remove(h,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==h.length&&(_.forEach([].concat.apply([],[c.fillEnergy.storageTasks,c.fillEnergy.containerTasks]),function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),
function(b){return b.memory.currentTask&&-1!==["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(m.objectsClosestToObj(h,a.object),function(d){if(a.canAssign(d)&&(d.say("Container"),k.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(h,function(a){return-1!==k.indexOf(a.name)}),k=[])}),0!==h.length&&(_.forEach(c.fillMinerals.storageTasks,function(a){_.forEach(h,
function(b){a.canAssign(b)&&(b.say("Storage"),k.push(b.name))});_.remove(h,function(a){return-1!==k.indexOf(a.name)});k=[]}),0!==h.length&&(_.forEach(c.fillMinerals.terminalTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Terminal"),k.push(b.name))});_.remove(h,function(a){return-1!==k.indexOf(a.name)});k=[]}),0!==h.length&&(_.forEach(_.filter(h,function(a){return a.room.name===r}),function(a){_.forEach(c.dismantle.tasks,function(b){if(!(0<_.filter(b.structure.room.find(FIND_MY_CREEPS),
function(a){return a.memory.currentTask&&"dismantle"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Dismantle"),k.push(a.name),!1})}),_.remove(h,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==h.length&&(_.forEach(h,function(b){_.forEach(a.getTasks(b.room),function(a){if(!(0<_.filter(a.resource.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"pickupResource"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length)&&
a.canAssign(b))return b.say("Pickup"),k.push(b.name),!1})}),_.remove(h,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==h.length&&_.forEach(h,function(a){(new b(a.memory.home)).canAssign(a)}))))))))}};Memory.profiling&&c(2,20).registerObject(u,"RoleDismantler");q.exports=u;return q.exports};v[21]=function(q,t){var g=c(4,21),m=c(11,21),e=c(40,21),a=c(42,21),b={checkSpawn:function(a){var f=a.name,d=g.creeps[f]&&g.creeps[f].healer||[],c=Game.rooms[Memory.rooms[f].roomType.supportRoom];1>_.filter(d,
function(a){return a.spawning||300<=a.ticksToLive}).length&&b.spawn(a,c);Memory.log&&g.log.rooms[f].creeps.push({role:"healer",count:d.length,max:1})},spawn:function(a,b){var d=[];a=a.name;var f=b.name,c,h;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;c=Math.floor(Math.min(b.energyCapacityAvailable,7500)/300);for(h=0;h<c;h++)d.push(MOVE);for(h=0;h<c;h++)d.push(HEAL);c=_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=
m.getBodypartCost(d)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===f?0:1)-(b.room.name===f?0:1)})[0];if(!c)return!1;a=c.createCreep(d,"healer-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"healer",home:a,supportRoom:f});c.room.name===f&&(g.spawning[c.id]="number"!==typeof a);return"number"!==typeof a},assignTasks:function(b,c){b=b.name;b=_.filter(m.creepsWithNoTask(g.creeps[b]&&g.creeps[b].healer||[]),function(a){return!a.spawning});var d=[];0!==b.length&&(_.forEach(_.filter(b,
function(a){return a.room.name!==a.memory.home}),function(b){a.getDefenderTask(b).canAssign(b)&&d.push(b.name)}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&(_.forEach(b,function(a){var b=e.getDefenderTask(a);b&&b.canAssign(a)&&(a.say("Heal"),d.push(a.name))}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&_.forEach(_.filter(b,function(a){return a.room.name===a.memory.home}),function(b){var f=a.getDefenderTask(b);f.range=1;f.canAssign(b)&&d.push(b.name)})))}};
Memory.profiling&&c(2,21).registerObject(b,"RoleHealer");q.exports=b;return q.exports};v[22]=function(q,t){var g=c(4,22),m=c(11,22),e=c(51,22),a=c(42,22),b={checkSpawn:function(a){var f=a.name,d=g.containersInRoom(a),c=0,e;0!==g.spawnsInRoom(a).length&&0!==d.length&&(e=g.creeps[f]&&g.creeps[f].miner||[],_.forEach(d,function(d){var f=d.id;Memory.containerSource[f]||(Memory.containerSource[f]=m.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),d)[0].id);d=Game.getObjectById(Memory.containerSource[f]);
d instanceof Mineral&&0===d.mineralAmount||(c+=1,0===_.filter(e,function(a){return(a.spawning||150<=a.ticksToLive)&&a.memory.container===f}).length&&b.spawn(a,f))}),Memory.log&&(0<e.length||0<c)&&g.log.rooms[f].creeps.push({role:"miner",count:e.length,max:c}))},spawn:function(a,b){var d=g.spawnsInRoom(a),f=[MOVE,WORK,WORK,WORK,WORK,WORK],c=a.name,e,k;if(0===_.filter(d,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;e=Math.min(a.energyCapacityAvailable,4500);k=Math.floor(e/450);
e%=450;if(m.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),Game.getObjectById(b))[0]instanceof Mineral){f=[];for(a=0;a<k;a++)f.push(MOVE);50<=e&&f.push(MOVE);for(a=0;a<k;a++)f.push(WORK),f.push(WORK),f.push(WORK),f.push(WORK);150<=e&&f.push(WORK);250<=e&&f.push(WORK);350<=e&&f.push(WORK)}d=_.filter(d,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(f)})[0];if(!d)return!1;b=d.createCreep(f,"miner-"+c+"-"+Game.time.toFixed(0).substring(4),
{role:"miner",home:c,container:b});g.spawning[d.id]="number"!==typeof b;return"number"!==typeof b},assignTasks:function(b,c){b=b.name;b=m.creepsWithNoTask(g.creeps[b]&&g.creeps[b].miner||[]);var d=[];0!==b.length&&(_.forEach(_.filter(b,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(b){(new a(b.memory.labs[0])).canAssign(b);d.push(b.name)}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&_.forEach(b,function(a){(new e).canAssign(a)&&a.say("Mining")}))}};
Memory.profiling&&c(2,22).registerObject(b,"RoleMiner");q.exports=b;return q.exports};v[23]=function(q,t){var g=c(4,23),m=c(11,23),e=c(49,23),a=c(46,23),b=c(47,23),f=c(42,23),u=c(50,23),d={checkSpawn:function(a){var b=a.name,f=Game.rooms[Memory.rooms[b].roomType.supportRoom],c;0!==g.spawnsInRoom(f).length&&(2>(c=(g.creeps[b]&&g.creeps[b].remoteBuilder||[]).length)&&d.spawn(a,f),Memory.log&&g.log.rooms[b].creeps.push({role:"remoteBuilder",count:c,max:2}))},spawn:function(a,b){var d=[];a=a.name;var f=
b.name,c,e,r;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;c=Math.min(b.energyCapacityAvailable,3300);e=Math.floor(c/200);c%=200;for(r=0;r<e;r++)d.push(WORK);150<=c&&d.push(WORK);for(r=0;r<e;r++)d.push(CARRY);100<=c&&150>c&&d.push(CARRY);for(r=0;r<e;r++)d.push(MOVE);50<=c&&d.push(MOVE);e=_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(d)&&a.room.memory.region===b.memory.region}).sort(function(a,
b){return(a.room.name===f?0:1)-(b.room.name===f?0:1)})[0];if(!e)return!1;a=e.createCreep(d,"remoteBuilder-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"remoteBuilder",home:a,supportRoom:f});e.room.name===f&&(g.spawning[e.id]="number"!==typeof a);return"number"!==typeof a},assignTasks:function(d){var c=d.name,c=_.filter(m.creepsWithNoTask(g.creeps[c]&&g.creeps[c].remoteBuilder||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),h=[];if(0!==c.length&&(_.forEach(_.filter(c,
function(a){return a.room.name===d.name}),function(a){0<d.find(FIND_HOSTILE_CONSTRUCTION_SITES).length&&((new f(d.find(FIND_HOSTILE_CONSTRUCTION_SITES)[0].id)).canAssign(a),a.say("Stomping"),h.push(a.name))}),_.remove(c,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==c.length&&(_.forEach(c,function(a){_.forEach(u.getCriticalTasks(a.room),function(b){if(0===_.filter(b.structure.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"repair"===a.memory.currentTask.type&&a.memory.currentTask.id===
b.id}).length&&b.canAssign(a))return a.say("CritRepair"),h.push(a.name),!1})}),_.remove(c,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==c.length))){if(!d.unobservable&&(_.forEach(c,function(a){var b=d.find(FIND_MY_CONSTRUCTION_SITES);0<b.length&&(new e(m.objectsClosestToObj(b,a)[0].id)).canAssign(a)&&(a.say("Build"),h.push(a.name))}),_.remove(c,function(a){return-1!==h.indexOf(a.name)}),h=[],0===c.length))return;_.forEach(c,function(a){a.room.name===a.memory.home&&_.forEach(b.getTasks(a.room),
function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Pickup"),h.push(a.name),!1})});_.remove(c,function(a){return-1!==h.indexOf(a.name)});h=[];0!==c.length&&(d.unobservable||_.forEach(c,function(b){var c=new a,f=m.objectsClosestToObj(_.filter(d.find(FIND_SOURCES),function(a){return 0<a.energy}),b);if(0===f.length)return!1;b.memory.homeSource=
f[0].id;c.canAssign(b)&&(b.say("Harvesting"),h.push(b.name))}),_.remove(c,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==c.length&&_.forEach(c,function(a){(new f(a.memory.home)).canAssign(a)}))}}};Memory.profiling&&c(2,23).registerObject(d,"RoleRemoteBuilder");q.exports=d;return q.exports};v[24]=function(q,t){var g=c(4,24),m=c(11,24),e=c(47,24),a=c(42,24),b={checkSpawn:function(a,c,d){var f=a.name,e=g.creeps[f]&&g.creeps[f].remoteCollector||[];c||(c=a);d||(d=a.memory.roomType&&"cleanup"===a.memory.roomType.type?
c.controller?c.controller.level:3:1);0!==g.spawnsInRoom(c).length&&(_.filter(e,function(a){return a.spawning||300<=a.ticksToLive}).length<d&&b.spawn(a,c),Memory.log&&(0<e.length||0<d)&&g.log.rooms[f].creeps.push({role:"remoteCollector",count:e.length,max:d}))},spawn:function(a,b){var d=[];a=a.name;var c=b.name,f,e;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;f=Math.floor(Math.min(b.energyCapacityAvailable,2400)/150);for(e=0;e<f;e++)d.push(CARRY),d.push(CARRY);
for(e=0;e<f;e++)d.push(MOVE);f=_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(d)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!f)return!1;a=f.createCreep(d,"remoteCollector-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"remoteCollector",home:a,supportRoom:c});f.room.name===c&&(g.spawning[f.id]="number"!==typeof a);return"number"!==typeof a},assignTasks:function(b,
c){var d=b.name,f=m.creepsWithNoTask(g.creeps[d]&&g.creeps[d].remoteCollector||[]),p=[];0!==f.length&&(_.forEach(f,function(a){_.forEach(e.getTasks(a.room),function(d){if(!(_.sum(g.creeps[b.name]&&g.creeps[b.name].all||[],function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===d.id?a.carryCapacity-_.sum(a.carry):0})>=d.resource.amount)&&d.canAssign(a))return a.say("Pickup"),p.push(a.name),!1})}),_.remove(f,function(a){return-1!==p.indexOf(a.name)}),
p=[],0!==f.length&&(c.collectMinerals&&c.collectMinerals.cleanupTasks&&_.forEach(c.collectMinerals.cleanupTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("Collecting"),p.push(b.name))});_.remove(f,function(a){return-1!==p.indexOf(a.name)});p=[]}),c.collectEnergy&&c.collectEnergy.cleanupTasks&&_.forEach(c.collectEnergy.cleanupTasks,function(a){_.forEach(_.filter(f,function(a){return a.room.name===d}),function(b){a.canAssign(b)&&(b.say("Collecting"),p.push(b.name))});_.remove(f,function(a){return-1!==
p.indexOf(a.name)});p=[]}),_.forEach(c.fillEnergy.storageTasks,function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(m.objectsClosestToObj(f,a.object),function(d){if(a.canAssign(d)&&(d.say("Storage"),p.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),
_.remove(f,function(a){return-1!==p.indexOf(a.name)}),p=[])}),0!==f.length&&(_.forEach(c.fillMinerals.storageTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("Storage"),p.push(b.name))});_.remove(f,function(a){return-1!==p.indexOf(a.name)});p=[]}),0!==f.length&&(_.forEach(c.fillMinerals.terminalTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("Terminal"),p.push(b.name))});_.remove(f,function(a){return-1!==p.indexOf(a.name)});p=[]}),0!==f.length&&(_.forEach(c.fillEnergy.containerTasks,
function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(m.objectsClosestToObj(f,a.object),function(d){if(a.canAssign(d)&&(d.say("Container"),p.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(f,function(a){return-1!==p.indexOf(a.name)}),
p=[])}),0!==f.length&&_.forEach(f,function(b){(0<_.sum(b.carry)?new a(b.memory.supportRoom):new a(b.memory.home)).canAssign(b)}))))))}};Memory.profiling&&c(2,24).registerObject(b,"RoleRemoteCollector");q.exports=b;return q.exports};v[25]=function(q,t){var g=c(4,25),m=c(11,25);c(49,25);c(47,25);var e=c(42,25),a={checkSpawn:function(b,c,e){var d=b.name,f=g.creeps[d]&&g.creeps[d].remoteDismantler||[];c||(c=b);0!==g.spawnsInRoom(c).length&&(_.filter(f,function(a){return a.spawning||300<=a.ticksToLive}).length<
e&&a.spawn(b,c),Memory.log&&(0<f.length||0<e)&&g.log.rooms[d].creeps.push({role:"remoteDismantler",count:f.length,max:e}))},spawn:function(a,c){var b=[];a=a.name;var d=c.name,f,e;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;f=Math.floor(Math.min(c.energyCapacityAvailable,3750)/150);for(e=0;e<f;e++)b.push(WORK);for(e=0;e<f;e++)b.push(MOVE);f=_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(b)&&
a.room.memory.region===c.memory.region}).sort(function(a,b){return(a.room.name===d?0:1)-(b.room.name===d?0:1)})[0];if(!f)return!1;a=f.createCreep(b,"remoteDismantler-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"remoteDismantler",home:a,supportRoom:d});f.room.name===d&&(g.spawning[f.id]="number"!==typeof a);return"number"!==typeof a},assignTasks:function(a,c){var b=a.name,d=_.filter(m.creepsWithNoTask(g.creeps[b]&&g.creeps[b].remoteDismantler||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&
150<a.ticksToLive}),f=[];0!==d.length&&(_.forEach(_.filter(d,function(a){return a.room.name===b}),function(b){0<a.find(FIND_HOSTILE_CONSTRUCTION_SITES).length&&((new e(a.find(FIND_HOSTILE_CONSTRUCTION_SITES)[0].id)).canAssign(b),b.say("Stomping"),f.push(b.name))}),_.remove(d,function(a){return-1!==f.indexOf(a.name)}),f=[],0!==d.length&&(_.forEach(_.filter(d,function(a){return a.room.name===b}),function(a){_.forEach(c.remoteDismantle.cleanupTasks,function(b){if(!(0<_.filter(b.structure.room.find(FIND_MY_CREEPS),
function(a){return a.memory.currentTask&&"dismantle"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Dismantle"),f.push(a.name),!1})}),_.remove(d,function(a){return-1!==f.indexOf(a.name)}),f=[],0!==d.length&&_.forEach(d,function(a){(new e(a.memory.home)).canAssign(a)})))}};Memory.profiling&&c(2,25).registerObject(a,"RoleRemoteDismantler");q.exports=a;return q.exports};v[26]=function(q,t){var g=c(4,26),m=c(11,26),e=c(51,26),a=c(42,26),b={checkSpawn:function(a){var c=
a.name,d=Game.rooms[Memory.rooms[c].roomType.supportRoom],f=d.name,e=g.creeps[c]&&g.creeps[c].remoteMiner||[],h=g.containersInRoom(a),k=0;0===g.spawnsInRoom(d).length||a.unobservable||0===h.length||(Memory.lengthToContainer||(Memory.lengthToContainer={}),_.forEach(h,function(c){var l=c.id;Memory.lengthToContainer[l]||(Memory.lengthToContainer[l]={});Memory.lengthToContainer[l][f]||(Memory.lengthToContainer[l][f]=PathFinder.search(c.pos,{pos:g.spawnsInRoom(d)[0].pos,range:1},{swampCost:1,maxOps:1E5}).path.length);
Memory.containerSource[l]||(Memory.containerSource[l]=m.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),c)[0].id);c=Game.getObjectById(Memory.containerSource[l]);c instanceof Mineral&&(0===c.mineralAmount||a.controller&&(!a.controller.my||6>a.controller.level))||(k+=1,0===_.filter(e,function(a){return(a.spawning||a.ticksToLive>=150+3*Memory.lengthToContainer[l][f])&&a.memory.container===l}).length&&b.spawn(a,d,l))}),Memory.log&&(0<e.length||0<k)&&g.log.rooms[c].creeps.push({role:"remoteMiner",
count:e.length,max:k}))},spawn:function(a,b,d){var c=a.memory&&a.memory.roomType&&"source"===a.memory.roomType.type||/^[EW][1-9][0-9]*5[NS][1-9][0-9]*5$/.test(a.name)?[MOVE,MOVE,MOVE,MOVE,WORK,WORK,WORK,WORK,WORK,WORK,WORK]:[MOVE,MOVE,MOVE,WORK,WORK,WORK,WORK,WORK],f=a.name,e=b.name,k,l;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;if(m.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),Game.getObjectById(d))[0]instanceof
Mineral){c=[];k=Math.min(b.energyCapacityAvailable,4500);a=Math.floor(k/450);k%=450;for(l=0;l<a;l++)c.push(MOVE);50<=k&&c.push(MOVE);for(l=0;l<a;l++)c.push(WORK),c.push(WORK),c.push(WORK),c.push(WORK);150<=k&&c.push(WORK);250<=k&&c.push(WORK);350<=k&&c.push(WORK)}a=_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(c)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===e?0:1)-(b.room.name===e?0:1)})[0];if(!a)return!1;
d=a.createCreep(c,"remoteMiner-"+f+"-"+Game.time.toFixed(0).substring(4),{role:"remoteMiner",home:f,supportRoom:e,container:d});a.room.name===e&&(g.spawning[a.id]="number"!==typeof d);return"number"!==typeof d},assignTasks:function(b,c){c=b.name;c=m.creepsWithNoTask(g.creeps[c]&&g.creeps[c].remoteMiner||[]);var d=[];0!==c.length&&(b.unobservable||_.forEach(c,function(a){(new e).canAssign(a)&&(a.say("Mining"),d.push(a.name))}),_.remove(c,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==c.length&&
_.forEach(c,function(b){(new a(b.memory.home)).canAssign(b)}))}};Memory.profiling&&c(2,26).registerObject(b,"RoleRemoteMiner");q.exports=b;return q.exports};v[27]=function(q,t){var g=c(4,27),m=c(5,27),e=c(11,27),a=c(42,27),b=c(52,27),f={checkSpawn:function(a){var b=Game.rooms[Memory.rooms[a.name].roomType.supportRoom],c=b.name,e=g.spawnsInRoom(b),h=a.controller,k=a.name,l=g.creeps[k]&&g.creeps[k].remoteReserver||[],n=0,w=0,x,m;if(0!==e.length&&!a.unobservable&&h){x=h.id;m=h.reservation;Memory.lengthToController||
(Memory.lengthToController={});Memory.lengthToController[x]||(Memory.lengthToController[x]={});Memory.lengthToController[x][c]||(Memory.lengthToController[x][c]=PathFinder.search(h.pos,{pos:e[0].pos,range:1},{swampCost:1,maxOps:1E5}).path.length);n=_.filter(l,function(a){return a.spawning||a.ticksToLive>Memory.lengthToController[x][c]}).length;if(!m||4E3>m.ticksToEnd)w+=1;n<w&&f.spawn(a,b);Memory.log&&(0<l.length||0<w)&&g.log.rooms[k].creeps.push({role:"remoteReserver",count:l.length,max:w})}},spawn:function(a,
b){var d=[];a=a.name;var c=b.name,f,k;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;f=Math.floor(Math.min(b.energyCapacityAvailable,3250)/650);for(k=0;k<f;k++)d.push(CLAIM);for(k=0;k<f;k++)d.push(MOVE);f=_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=e.getBodypartCost(d)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!f)return!1;a=
f.createCreep(d,"remoteReserver-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"remoteReserver",home:a,supportRoom:c});f.room.name===c&&(g.spawning[f.id]="number"!==typeof a);return"number"!==typeof a},assignTasks:function(c,d){d=c.name;d=e.creepsWithNoTask(g.creeps[d]&&g.creeps[d].remoteReserver||[]);var f=[];0!==d.length&&(c.unobservable||_.forEach(d,function(a){a.room.name===a.memory.home&&a.room.controller.my&&(f.push(a.name),m.setRoomType(a.room,{type:"base"}),a.suicide())}),_.remove(d,function(a){return-1!==
f.indexOf(a.name)}),f=[],0!==d.length&&(c&&!c.unobservable&&c.controller&&_.forEach(d,function(a){b.getRemoteTask(a).canAssign(a)&&(a.say("Reserving"),f.push(a.name))}),_.remove(d,function(a){return-1!==f.indexOf(a.name)}),f=[],0!==d.length&&_.forEach(d,function(b){(new a(b.memory.home)).canAssign(b)})))}};Memory.profiling&&c(2,27).registerObject(f,"RoleRemoteReserver");q.exports=f;return q.exports};v[28]=function(q,t){var g=c(4,28),m=c(11,28),e=c(53,28),a=c(54,28),b=c(47,28),f=c(42,28),u={checkSpawn:function(a){var b=
Game.rooms[Memory.rooms[a.name].roomType.supportRoom],d=g.containersInRoom(a),c=a.name,f=g.creeps[c]&&g.creeps[c].remoteStorer||[],e=0,n=!1;0===g.spawnsInRoom(b).length||a.unobservable||0===d.length||(_.forEach(d,function(d){var c=0,g=d.id,l;Memory.containerSource[g]||(Memory.containerSource[g]=m.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),d)[0].id);d=Game.getObjectById(Memory.containerSource[g]);if(d instanceof Mineral){if(0===d.mineralAmount)return}else c=
n?0:-1,n=!0;l=Memory.lengthToContainer[g][b.name];c+=Math.max(Math.ceil(l/[18,18,18,18,30,44,54,58,58][b.controller.level]),0);e+=c;_.filter(f,function(a){return(a.spawning||a.ticksToLive>=150+2*l)&&a.memory.container===g}).length<c&&u.spawn(a,b,g)}),Memory.log&&(0<f.length||0<e)&&g.log.rooms[c].creeps.push({role:"remoteStorer",count:f.length,max:e}))},spawn:function(a,b,c){var d=a.name,f=b.name,e=[];if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;switch(b.controller.level){case 3:e=
[MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 4:e=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 5:e=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 6:e=[MOVE,MOVE,MOVE,MOVE,MOVE,
MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 7:case 8:e=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,
CARRY,CARRY,CARRY,CARRY]}a=_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(e)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===f?0:1)-(b.room.name===f?0:1)})[0];if(!a)return!1;c=a.createCreep(e,"remoteStorer-"+d+"-"+Game.time.toFixed(0).substring(4),{role:"remoteStorer",home:d,supportRoom:f,container:c});a.room.name===f&&(g.spawning[a.id]="number"!==typeof c);return"number"!==typeof c},assignTasks:function(d,
c){var r=d.name,h=m.creepsWithNoTask(g.creeps[r]&&g.creeps[r].remoteStorer||[]),k=[];0!==h.length&&(_.forEach(h,function(a){_.forEach(b.getTasks(a.room),function(b){if(!(_.sum(g.creeps[d.name]&&g.creeps[d.name].all||[],function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id?a.carryCapacity-_.sum(a.carry):0})>=b.resource.amount)&&b.canAssign(a))return a.say("Pickup"),k.push(a.name),!1})}),_.remove(h,function(a){return-1!==k.indexOf(a.name)}),
k=[],0!==h.length&&(_.forEach(c.fillEnergy.storageTasks,function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(h,function(d){if(a.canAssign(d)&&(d.say("Storage"),k.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(h,function(a){return-1!==
k.indexOf(a.name)}),k=[])}),0!==h.length&&(_.forEach(c.fillMinerals.storageTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Storage"),k.push(b.name))});_.remove(h,function(a){return-1!==k.indexOf(a.name)});k=[]}),0!==h.length&&(_.forEach(c.fillMinerals.terminalTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Terminal"),k.push(b.name))});_.remove(h,function(a){return-1!==k.indexOf(a.name)});k=[]}),0!==h.length&&(_.forEach(c.fillEnergy.containerTasks,function(a){var b=
a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(h,function(d){if(a.canAssign(d)&&(d.say("Container"),k.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(h,function(a){return-1!==k.indexOf(a.name)}),k=[])}),0!==h.length&&(d.unobservable||_.forEach(h,
function(b){var d=Game.getObjectById(b.memory.container),c;d&&(d.store[RESOURCE_ENERGY]?c=new e(b.memory.container):0<_.sum(d.store)&&(c=new a(b.memory.container)),c&&c.canAssign(b)&&(b.say("Collecting"),k.push(b.name)))}),_.remove(h,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==h.length&&_.forEach(h,function(a){(0<_.sum(a.carry)?new f(a.memory.supportRoom):new f(a.memory.home)).canAssign(a)})))))))}};Memory.profiling&&c(2,28).registerObject(u,"RoleRemoteStorer");q.exports=u;return q.exports};
v[29]=function(q,t){var g=c(4,29),m=c(11,29),e=c(49,29),a=c(53,29),b=c(46,29),f=c(47,29),u=c(42,29),d=c(50,29),r={checkSpawn:function(a){var b=a.name,d=Game.rooms[Memory.rooms[b].roomType.supportRoom],c=d.name,f=g.containersInRoom(a),e=g.creeps[b]&&g.creeps[b].remoteWorker||[],x=0;0===g.spawnsInRoom(d).length||a.unobservable||0===f.length||(_.forEach(f,function(b){var f=m.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),b)[0],g=b.id;if(!(f instanceof Mineral))return x+=
1,0===_.filter(e,function(a){return(a.spawning||a.ticksToLive>=150+2*(Memory.lengthToContainer&&Memory.lengthToContainer[g]&&Memory.lengthToContainer[g][c]?Memory.lengthToContainer[g][c]:0))&&a.memory.container===g}).length&&r.spawn(a,d,g),!1}),Memory.log&&(0<e.length||0<x)&&g.log.rooms[b].creeps.push({role:"remoteWorker",count:e.length,max:x}))},spawn:function(a,b,d){var c=[];a=a.name;var f=b.name,e,k,h,r,p,u;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;
e=Math.min(b.energyCapacityAvailable,3E3);k=Math.floor(e/200);h=Math.floor((e-2E3)/150);r=e%200;p=(e-2E3)%150;for(u=0;u<k&&10>u;u++)c.push(WORK);2E3>e&&150<=r&&c.push(WORK);for(u=0;u<k&&10>u;u++)c.push(CARRY);for(u=0;u<h;u++)c.push(CARRY),c.push(CARRY);2E3>e&&100<=r&&150>r&&c.push(CARRY);2E3<e&&100<=p&&c.push(CARRY);for(u=0;u<k&&10>u;u++)c.push(MOVE);for(u=0;u<h;u++)c.push(MOVE);2E3>e&&50<=r&&c.push(MOVE);2E3<e&&50<=p&&c.push(MOVE);e=_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&
a.room.energyAvailable>=m.getBodypartCost(c)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===f?0:1)-(b.room.name===f?0:1)})[0];if(!e)return!1;d=e.createCreep(c,"remoteWorker-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"remoteWorker",home:a,supportRoom:f,container:d});e.room.name===f&&(g.spawning[e.id]="number"!==typeof d);return"number"!==typeof d},assignTasks:function(c,h){var k=c.name,l=_.filter(m.creepsWithNoTask(g.creeps[k]&&g.creeps[k].remoteWorker||[]),
function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),n=[];0!==l.length&&(_.forEach(l,function(a){var b=_.filter(a.room.find(FIND_MY_CONSTRUCTION_SITES),function(a){return 1===a.progressTotal});0<b.length&&(new e(b[0].id)).canAssign(a)&&(a.say("Build"),n.push(a.name))}),_.remove(l,function(a){return-1!==n.indexOf(a.name)}),n=[],0!==l.length&&(_.forEach(l,function(a){_.forEach(d.getCriticalTasks(a.room),function(b){if(0===_.filter(b.structure.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&
"repair"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length&&b.canAssign(a))return a.say("CritRepair"),n.push(a.name),!1})}),_.remove(l,function(a){return-1!==n.indexOf(a.name)}),n=[],0!==l.length&&(_.forEach(l,function(a){var b=a.room.find(FIND_MY_CONSTRUCTION_SITES);0<b.length&&(new e(b[0].id)).canAssign(a)&&(a.say("Build"),n.push(a.name))}),_.remove(l,function(a){return-1!==n.indexOf(a.name)}),n=[],0!==l.length&&(_.forEach([].concat.apply([],[h.fillEnergy.storageTasks,h.fillEnergy.containerTasks]),
function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(m.objectsClosestToObj(l,a.object),function(d){if(a.canAssign(d)&&(d.say("Container"),n.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(l,function(a){return-1!==
n.indexOf(a.name)}),n=[])}),0!==l.length&&(_.forEach(h.fillMinerals.storageTasks,function(a){_.forEach(l,function(b){a.canAssign(b)&&(b.say("Storage"),n.push(b.name))});_.remove(l,function(a){return-1!==n.indexOf(a.name)});n=[]}),0!==l.length&&(_.forEach(h.fillMinerals.terminalTasks,function(a){_.forEach(l,function(b){a.canAssign(b)&&(b.say("Terminal"),n.push(b.name))});_.remove(l,function(a){return-1!==n.indexOf(a.name)});n=[]}),0!==l.length&&(_.forEach(l,function(a){a.room.name===c.name&&_.forEach(f.getTasks(a.room),
function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Pickup"),n.push(a.name),!1})}),_.remove(l,function(a){return-1!==n.indexOf(a.name)}),n=[],0!==l.length&&(c.unobservable||_.forEach(l,function(b){(new a(b.memory.container)).canAssign(b)&&(b.say("Collecting"),n.push(b.name))}),_.remove(l,function(a){return-1!==n.indexOf(a.name)}),
n=[],0!==l.length&&(c.unobservable||_.forEach(l,function(a){var d=new b,f=m.objectsClosestToObj(_.filter(c.find(FIND_SOURCES),function(a){return 0<a.energy}),a);if(0===f.length)return!1;a.memory.homeSource=f[0].id;d.canAssign(a)&&(a.say("Harvesting"),n.push(a.name))}),_.remove(l,function(a){return-1!==n.indexOf(a.name)}),n=[],0!==l.length&&_.forEach(l,function(a){(new u(a.memory.home)).canAssign(a)}))))))))))}};Memory.profiling&&c(2,29).registerObject(r,"RoleRemoteWorker");q.exports=r;return q.exports};
v[30]=function(q,t){var g=c(4,30),m=c(11,30),e=c(47,30),a=c(42,30),b={checkSpawn:function(a){var c=a.controller,d=a.name,d=g.creeps[d]&&g.creeps[d].scientist||[];!c||6>c.level||(1>_.filter(d,function(a){return a.spawning||150<=a.ticksToLive}).length&&b.spawn(a),Memory.log&&g.log.rooms[a.name].creeps.push({role:"scientist",count:d.length,max:1}))},spawn:function(a){var b=g.spawnsInRoom(a),d=[],c=a.name,f,e,k;if(0===_.filter(b,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;f=Math.min(a.energyCapacityAvailable,
2500);e=Math.floor(f/150);f%=150;for(k=0;k<e;k++)d.push(CARRY),d.push(CARRY);100<=f&&d.push(CARRY);for(k=0;k<e;k++)d.push(MOVE);50<=f&&d.push(MOVE);e=_.filter(b,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(d)})[0];if(!e)return!1;a=e.createCreep(d,"scientist-"+c+"-"+Game.time.toFixed(0).substring(4),{role:"scientist",home:c,homeSource:m.objectsClosestToObj(a.find(FIND_SOURCES),b[0])[0].id});g.spawning[e.id]="number"!==typeof a;return"number"!==typeof a},
assignTasks:function(b,c){var d=b.name,f=_.filter(m.creepsWithNoTask(g.creeps[d]&&g.creeps[d].scientist||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),p=g.creeps[d]&&g.creeps[d].all||[],h=[];0!==f.length&&(_.forEach(c.fillEnergy.towerTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(p,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||
0)},0);0<b&&(_.forEach(m.objectsClosestToObj(f,a.object),function(d){if(a.canAssign(d)&&(d.say("Tower"),h.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(f,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==f.length&&(_.forEach(c.collectMinerals.labTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("Collecting"),h.push(b.name))});_.remove(f,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==f.length&&(_.forEach(c.fillMinerals.labTasks,function(a){_.forEach(f,
function(b){a.canAssign(b)&&(b.say("Lab"),h.push(b.name))});_.remove(f,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==f.length&&(_.forEach(c.fillMinerals.nukerTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("NukeG"),h.push(b.name))});_.remove(f,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==f.length&&(_.forEach(c.fillMinerals.powerSpawnTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("powerPower"),h.push(b.name))});_.remove(f,function(a){return-1!==h.indexOf(a.name)});
h=[]}),0!==f.length&&(_.forEach(c.fillMinerals.storageTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("Storage"),h.push(b.name))});_.remove(f,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==f.length&&(_.forEach(c.fillMinerals.terminalTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("Terminal"),h.push(b.name))});_.remove(f,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==f.length&&(_.forEach(c.fillEnergy.labTasks,function(a){var b=a.object.energyCapacity-
a.object.energy-_.reduce(_.filter(p,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(m.objectsClosestToObj(f,a.object),function(d){if(a.canAssign(d)&&(d.say("LabEnergy"),h.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(f,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==f.length&&(c.fillEnergy.terminalTask&&(_.forEach(f,function(a){c.fillEnergy.terminalTask.canAssign(a)&&
(a.say("Terminal"),h.push(a.name))}),_.remove(f,function(a){return-1!==h.indexOf(a.name)}),h=[]),0!==f.length&&(_.forEach(c.fillEnergy.nukerTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(p,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(m.objectsClosestToObj(f,a.object),function(d){if(a.canAssign(d)&&(d.say("NukeEnergy"),h.push(d.name),
b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(f,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==f.length&&(_.forEach(c.fillEnergy.powerSpawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(p,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(m.objectsClosestToObj(f,a.object),function(d){if(a.canAssign(d)&&(d.say("PwrEnergy"),
h.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(f,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==f.length&&(_.forEach(f,function(a){a.carry[RESOURCE_ENERGY]<(8===b.controller.level?200:7===b.controller.level?100:50)||_.forEach(c.fillEnergy.extensionTasks.sort(function(b,d){return b.object.pos.getRangeTo(a)-d.object.pos.getRangeTo(a)}),function(b){if(0<b.object.energyCapacity-b.object.energy-_.reduce(_.filter(p,function(a){return a.memory.currentTask&&"fillEnergy"===
a.memory.currentTask.type&&a.memory.currentTask.id===b.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0)&&b.canAssign(a))return a.say("Extension"),h.push(a.name),!1})}),_.remove(f,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==f.length&&(_.forEach(c.fillEnergy.spawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(p,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+
(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(m.objectsClosestToObj(f,a.object),function(d){if(a.canAssign(d)&&(d.say("Spawn"),h.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(f,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==f.length&&(_.forEach(c.fillEnergy.storageTasks,function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&
b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(m.objectsClosestToObj(f,a.object),function(d){if(!d.memory.lastCollectEnergyWasStorage&&a.canAssign(d)&&(d.say("Storage"),h.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(f,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==f.length&&(_.forEach(c.collectMinerals.terminalTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("Collecting"),h.push(b.name))});_.remove(f,function(a){return-1!==
h.indexOf(a.name)});h=[]}),0!==f.length&&(_.forEach(c.collectMinerals.storageTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("Collecting"),h.push(b.name))});_.remove(f,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==f.length&&(0===g.hostilesInRoom(b).length&&_.forEach(f,function(a){_.forEach(e.getTasks(a.room),function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===
b.id}).length)&&b.canAssign(a))return a.say("Pickup"),h.push(a.name),!1})}),_.remove(f,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==f.length&&(c.collectEnergy.terminalTask&&(_.forEach(f,function(a){c.collectEnergy.terminalTask.canAssign(a)&&(a.say("Collecting"),h.push(a.name))}),_.remove(f,function(a){return-1!==h.indexOf(a.name)}),h=[]),_.forEach(c.collectEnergy.tasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("Collecting"),h.push(b.name))});_.remove(f,function(a){return-1!==
h.indexOf(a.name)});h=[]}),0!==f.length&&_.forEach(f,function(d){d=new a(b.terminal.id,d);d.canAssign(d.creep)})))))))))))))))))))}};Memory.profiling&&c(2,30).registerObject(b,"RoleScientist");q.exports=b;return q.exports};v[31]=function(q,t){var g=c(4,31),m=c(11,31),e=c(42,31),a={checkSpawn:function(b){var c=g.containersInRoom(b),e=b.name,d=0,r=0,p,h,k,l;0!==g.spawnsInRoom(b).length&&0!==c.length&&b.storage&&b.storage.my&&(p=b.controller,h=Memory.army,k=g.creeps[e]&&g.creeps[e].storer||[],Memory.lengthToStorage||
(Memory.lengthToStorage={}),l=Memory.lengthToStorage,_.forEach(c,function(a){var c=a.id;Memory.containerSource[c]||(Memory.containerSource[c]=m.objectsClosestToObj([].concat.apply([],[b.find(FIND_SOURCES),b.find(FIND_MINERALS)]),a)[0].id);c=Game.getObjectById(Memory.containerSource[c]);c instanceof Mineral?0<c.mineralAmount&&(r+=1):(l[a.id]||(l[a.id]=PathFinder.search(a.pos,{pos:b.storage.pos,range:1},{swampCost:1}).path.length),d+=l[a.id])}),r+=Math.ceil(2*d/(p&&8==p.level?35:30))+(7<=p.level&&h&&
0<_.filter(h,function(a){return a.region===b.memory.region}).length?1:0),_.filter(k,function(a){return a.spawning||300<=a.ticksToLive}).length<r&&a.spawn(b),Memory.log&&(0<k.length||0<r)&&g.log.rooms[e].creeps.push({role:"storer",count:k.length,max:r}))},spawn:function(a){var b=g.spawnsInRoom(a),c=a.name,d,e;switch(a.controller.level){case 7:d=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,
CARRY,CARRY];break;case 8:d=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;default:d=[MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY]}if(0===_.filter(b,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;b=_.filter(Game.spawns,function(b){return!b.spawning&&
!g.spawning[b.id]&&b.room.energyAvailable>=m.getBodypartCost(d)&&b.room.memory.region===a.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!b)return!1;e=b.createCreep(d,"storer-"+c+"-"+Game.time.toFixed(0).substring(4),{role:"storer",home:c});g.spawning[b.id]="number"!==typeof e;return"number"!==typeof e},assignTasks:function(a,c){var b=a.name,d=_.filter(m.creepsWithNoTask(g.creeps[b]&&g.creeps[b].storer||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&
150<a.ticksToLive}),f=g.creeps[b]&&g.creeps[b].all||[],p=[];0!==d.length&&(_.forEach(c.fillEnergy.linkTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(f,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(m.objectsClosestToObj(d,a.object),function(d){if(a.canAssign(d)&&(d.say("Link"),p.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,
0>=b))return!1}),_.remove(d,function(a){return-1!==p.indexOf(a.name)}),p=[])}),0!==d.length&&(_.forEach(d,function(b){b.carry[RESOURCE_ENERGY]<(8===a.controller.level?200:7===a.controller.level?100:50)||_.forEach(c.fillEnergy.extensionTasks.sort(function(a,d){return a.object.pos.getRangeTo(b)-d.object.pos.getRangeTo(b)}),function(a){if(0<a.object.energyCapacity-a.object.energy-_.reduce(_.filter(f,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===
a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0)&&a.canAssign(b))return b.say("Extension"),p.push(b.name),!1})}),_.remove(d,function(a){return-1!==p.indexOf(a.name)}),p=[],0!==d.length&&(_.forEach(c.fillEnergy.spawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(f,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(m.objectsClosestToObj(d,
a.object),function(d){if(a.canAssign(d)&&(d.say("Spawn"),p.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(d,function(a){return-1!==p.indexOf(a.name)}),p=[])}),0!==d.length&&(c.fillEnergy.terminalTask&&(_.forEach(d,function(a){c.fillEnergy.terminalTask.canAssign(a)&&(a.say("Terminal"),p.push(a.name))}),_.remove(d,function(a){return-1!==p.indexOf(a.name)}),p=[]),0!==d.length&&(_.forEach(c.fillEnergy.storageTasks,function(b){var c=b.object.storeCapacity-_.sum(b.object.store)-_.reduce(_.filter(b.object.room.find(FIND_MY_CREEPS),
function(a){return a.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(a.memory.currentTask.type)&&a.memory.currentTask.id===b.id}),function(a,b){return a+_.sum(b.carry)},0);0<c&&(_.forEach(m.objectsClosestToObj(d,b.object),function(d){if((!a.terminal||!d.memory.lastCollectEnergyWasStorage)&&b.canAssign(d)&&(d.say("Storage"),p.push(d.name),c-=_.sum(d.carry),0>=c))return!1}),_.remove(d,function(a){return-1!==p.indexOf(a.name)}),p=[])}),0!==d.length&&(_.forEach(c.fillMinerals.storageTasks,function(a){_.forEach(d,
function(b){a.canAssign(b)&&(b.say("Storage"),p.push(b.name))});_.remove(d,function(a){return-1!==p.indexOf(a.name)});p=[]}),0!==d.length&&(_.forEach(c.fillMinerals.terminalTasks,function(a){_.forEach(d,function(b){a.canAssign(b)&&(b.say("Terminal"),p.push(b.name))});_.remove(d,function(a){return-1!==p.indexOf(a.name)});p=[]}),0!==d.length&&(_.forEach([].concat.apply([],[c.collectEnergy.storerTasks,c.collectMinerals.storerTasks]).sort(function(a,b){return(b.object.energy||_.sum(b.object.store)||0)-
(a.object.energy||_.sum(a.object.store)||0)}),function(a){if(a.object.energy||_.sum(a.object.store)){var b=(a.object.energy||_.sum(a.object.store)||0)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&b.memory.currentTask.type===a.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carryCapacity-_.sum(b.carry))},0);500<=b&&(_.forEach(d,function(d){d.memory.lastCollectEnergyWasStorage=!1;if(a.canAssign(d)&&(d.say("Collecting"),p.push(d.name),
b-=d.carryCapacity-_.sum(d.carry),500>b))return!1}),_.remove(d,function(a){return-1!==p.indexOf(a.name)}),p=[])}}),0!==d.length&&(c.collectEnergy.terminalTask&&(_.forEach(d,function(a){c.collectEnergy.terminalTask.canAssign(a)&&(a.say("Collecting"),p.push(a.name),a.memory.lastCollectEnergyWasStorage=!1)}),_.remove(d,function(a){return-1!==p.indexOf(a.name)}),p=[]),0!==d.length&&(_.forEach(c.collectEnergy.tasks,function(a){_.forEach(d,function(b){a.canAssign(b)&&(b.say("Collecting"),p.push(b.name),
a.object.structureType===STRUCTURE_STORAGE&&(b.memory.lastCollectEnergyWasStorage=!0))});_.remove(d,function(a){return-1!==p.indexOf(a.name)});p=[]}),0!==d.length&&_.forEach(d,function(a){var b=new e(a.room.terminal?a.room.terminal.id:a.room.name);b.range=0;b.canAssign(a)})))))))))))}};Memory.profiling&&c(2,31).registerObject(a,"RoleStorer");q.exports=a;return q.exports};v[32]=function(q,t){var g=c(4,32);t={assignTasks:function(c,e){0<e.rangedAttack.tasks.length?_.forEach(g.towersInRoom(c),function(a){a.attack(e.rangedAttack.tasks[0].enemy)}):
0<e.repair.towerTasks.length?_.forEach(g.towersInRoom(c),function(a){a.repair(e.repair.towerTasks[0].structure)}):0<e.heal.tasks.length&&_.forEach(g.towersInRoom(c),function(a){a.heal(e.heal.tasks[0].ally)})}};Memory.profiling&&c(2,32).registerObject(t,"RoleTower");q.exports=t;return q.exports};v[33]=function(q,t){var g=c(4,33),m=c(11,33),e=c(53,33),a=c(46,33),b=c(47,33),f=c(42,33),u={checkSpawn:function(a){var b=a.name,d=g.creeps[b]&&g.creeps[b].upgrader||[],c=a.storage,f=a.controller,e,n,m;0!==
g.spawnsInRoom(a).length&&(c&&(e=c.store[RESOURCE_ENERGY]),n=_.filter(d,function(a){return a.spawning||150<=a.ticksToLive}).length,m=b===Memory.rushRoom?1:!c||e<Memory.upgradeEnergy?0:1,(n<m||f&&8>f.level&&c&&9E5<e)&&u.spawn(a),Memory.log&&(0<d.length||0<m)&&g.log.rooms[b].creeps.push({role:"upgrader",count:d.length,max:m}),_.forEach(_.filter(Game.rooms,function(b){return b.memory&&b.memory.roomType&&"base"===b.memory.roomType.type&&b.memory.region===a.memory.region&&b.name!==a.name&&b.controller&&
b.controller.my&&7>b.controller.level}),function(b){0===_.filter(g.creeps[b.name]&&g.creeps[b.name].upgrader||[],function(a){return a.memory.supportRoom!==a.memory.home}).length&&u.spawn(b,a)}))},spawn:function(a,b){var d=[],c=a.controller,f=0,e=!1,n=a.name,w,x,r,u,q,B,t;b||(b=a);w=b.name;x=g.spawnsInRoom(b);r=b.storage;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;if(2<=g.linksInRoom(a).length&&2>=m.objectsClosestToObj(g.linksInRoom(a),c)[0].pos.getRangeTo(c)){c=
Math.min(b.energyCapacityAvailable,8===c.level?1950:4100);u=Math.floor((c-50*Math.ceil(c/3200))/250);q=(c-50*Math.ceil(c/3200))%250;for(B=0;B<u;B++)d.push(WORK),d.push(WORK),f+=2;150<=q&&(d.push(WORK),f++);for(B=0;B<Math.ceil(c/3200);B++)d.push(CARRY)}else{c=Math.min(b.energyCapacityAvailable,8===c.level?3E3:3300);u=Math.floor(c/200);q=c%200;for(B=0;B<u;B++)d.push(WORK),f++;150<=q&&(d.push(WORK),f++);for(B=0;B<u;B++)d.push(CARRY);100<=q&&150>q&&d.push(CARRY)}for(B=0;B<u;B++)d.push(MOVE);50<=q&&d.push(MOVE);
0<f&&r&&0<g.labsInRoom(b).length&&Math.max(r.store[RESOURCE_GHODIUM_HYDRIDE]||0,r.store[RESOURCE_GHODIUM_ACID]||0,r.store[RESOURCE_CATALYZED_GHODIUM_ACID]||0)>=30*f&&(e=!!(t=m.getLabToBoostWith(b)[0]));c=3>g.labsInRoom(b).length?_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(d)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===w?0:1)-(b.room.name===w?0:1)})[0]:_.filter(x,function(a){return!a.spawning&&
!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(d)})[0];if(!c)return!1;a=c.createCreep(d,"upgrader-"+n+"-"+Game.time.toFixed(0).substring(4),{role:"upgrader",home:n,supportRoom:w,homeSource:m.objectsClosestToObj(a.find(FIND_SOURCES),x[0])[0].id,labs:e?[t.id]:[]});g.spawning[c.id]="number"!==typeof a;"number"!==typeof a&&e&&(t.creepToBoost=a,t.resource=r.store[RESOURCE_CATALYZED_GHODIUM_ACID]>=30*f?RESOURCE_CATALYZED_GHODIUM_ACID:r.store[RESOURCE_GHODIUM_ACID]>=30*f?RESOURCE_GHODIUM_ACID:
RESOURCE_GHODIUM_HYDRIDE,t.amount=30*f,b.memory.labsInUse.push(t),_.forEach(_.filter(g.creeps[w]&&g.creeps[w].all||[],function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&a.memory.currentTask.id===t.id}),function(a){delete a.memory.currentTask}));return"number"!==typeof a},assignTasks:function(d,c){var r=d.name,h=_.filter(m.creepsWithNoTask(g.creeps[r]&&g.creeps[r].upgrader||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),k=[],l=d.controller;
if(0!==h.length&&(_.forEach(_.filter(h,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(a){(new f(a.memory.labs[0])).canAssign(a);k.push(a.name)}),_.remove(h,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==h.length&&(_.forEach(c.upgradeController.tasks,function(a){_.forEach(m.objectsClosestToObj(h,l),function(b){a.canAssign(b)&&(b.say("Controller"),k.push(b.name))});_.remove(h,function(a){return-1!==k.indexOf(a.name)});k=[]}),0!==h.length&&(_.forEach(h,function(a){var b=m.objectsClosestToObj(g.linksInRoom(d),
l);0<b.length&&0<b[0].energy&&(b=new e(b[0].id),b.canAssign(a)&&(a.say("Collecting"),k.push(a.name)))}),_.remove(h,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==h.length)))){if(!l||6>l.level)if(0===g.hostilesInRoom(d).length&&_.forEach(h,function(a){_.forEach(b.getTasks(a.room),function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Pickup"),
k.push(a.name),!1})}),_.remove(h,function(a){return-1!==k.indexOf(a.name)}),k=[],0===h.length)return;_.forEach(c.collectEnergy.tasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Collecting"),k.push(b.name))});_.remove(h,function(a){return-1!==k.indexOf(a.name)});k=[]});if(0!==h.length){if(0===_.filter(g.containersInRoom(d),function(a){return 0<a.energy}).length&&!d.storage&&(_.forEach(h,function(b){(new a).canAssign(b)&&(b.say("Harvesting"),k.push(b.name))}),_.remove(h,function(a){return-1!==
k.indexOf(a.name)}),k=[],0===h.length))return;_.forEach(h,function(a){(new f(a.memory.home)).canAssign(a)})}}}};Memory.profiling&&c(2,33).registerObject(u,"RoleUpgrader");q.exports=u;return q.exports};v[34]=function(q,t){var g=c(4,34),m=c(11,34),e=c(46,34),a=c(47,34),b=c(42,34),f={checkSpawn:function(a,b){var c=a.name,d=g.creeps[c]&&g.creeps[c].worker||[],e=a.storage,k;0!==a.find(FIND_SOURCES).length&&(k=_.filter(d,function(a){return a.spawning||a.ticksToLive>=(e&&e.my?150:300)}).length,b=b?e&&e.my?
1:2:0,k<b&&f.spawn(a),Memory.log&&(0<d.length||0<b)&&g.log.rooms[c].creeps.push({role:"worker",count:d.length,max:b}),_.forEach(_.filter(Game.rooms,function(b){return b.memory&&b.memory.roomType&&"base"===b.memory.roomType.type&&b.memory.region===a.memory.region&&b.name!==c&&b.controller&&b.controller.my&&6>b.controller.level}),function(b){0===_.filter(g.creeps[b.name]&&g.creeps[b.name].worker||[],function(a){return a.memory.supportRoom!==a.memory.home}).length&&f.spawn(b,a)}))},spawn:function(a,
b){var c=[],d=0,f=!1,e=a.name,l,n,w,x,u,y,q;b||(b=a);l=b.name;n=g.spawnsInRoom(b);w=b.storage;if(0!==n.length){if(3<=g.labsInRoom(b).length&&0===_.filter(n,function(a){return!a.spawning&&!g.spawning[a.id]}).length)return!1;x=Math.min(b.energyCapacityAvailable,3300);u=Math.floor(x/200);x%=200;for(y=0;y<u;y++)c.push(WORK),d++;150<=x&&(c.push(WORK),d++);for(y=0;y<u;y++)c.push(CARRY);100<=x&&150>x&&c.push(CARRY);for(y=0;y<u;y++)c.push(MOVE);50<=x&&c.push(MOVE);(e===l||0<a.find(FIND_MY_CONSTRUCTION_SITES).length)&&
0<d&&w&&0<g.labsInRoom(b).length&&Math.max(w.store[RESOURCE_LEMERGIUM_HYDRIDE]||0,w.store[RESOURCE_LEMERGIUM_ACID]||0,w.store[RESOURCE_CATALYZED_LEMERGIUM_ACID]||0)>=30*d&&(f=!!(q=m.getLabToBoostWith(b)[0]));u=3>g.labsInRoom(b).length?_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(c)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===l?0:1)-(b.room.name===l?0:1)})[0]:_.filter(n,function(a){return!a.spawning&&
!g.spawning[a.id]&&a.room.energyAvailable>=m.getBodypartCost(c)})[0];if(!u)return!1;a=u.createCreep(c,"worker-"+e+"-"+Game.time.toFixed(0).substring(4),{role:"worker",home:e,supportRoom:l,homeSource:m.objectsClosestToObj(a.find(FIND_SOURCES),n[0])[0].id,labs:f?[q.id]:[]});g.spawning[u.id]="number"!==typeof a;"number"!==typeof a&&f&&(q.creepToBoost=a,q.resource=w.store[RESOURCE_CATALYZED_LEMERGIUM_ACID]>=30*d?RESOURCE_CATALYZED_LEMERGIUM_ACID:w.store[RESOURCE_LEMERGIUM_ACID]>=30*d?RESOURCE_LEMERGIUM_ACID:
RESOURCE_LEMERGIUM_HYDRIDE,q.amount=30*d,b.memory.labsInUse.push(q),_.forEach(_.filter(g.creeps[b.name]&&g.creeps[b.name].all||[],function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&a.memory.currentTask.id===q.id}),function(a){delete a.memory.currentTask}));return"number"!==typeof a}},assignTasks:function(c,d){var f=c.name,p=g.creeps[f]&&g.creeps[f].worker||[],h=_.filter(m.creepsWithNoTask(p),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),k=
g.creeps[f]&&g.creeps[f].all||[],f=g.creeps[f]&&g.creeps[f].storer||[],l=c.controller,n=[];if(0!==h.length&&(_.forEach(_.filter(h,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(a){var c=_.filter(Memory.rooms[a.memory.supportRoom].labsInUse,function(b){return b.id===a.memory.labs[0]})[0];c&&Game.getObjectById(a.memory.labs[0]).mineralType===c.resource&&Game.getObjectById(a.memory.labs[0]).mineralAmount>=c.amount&&((new b(a.memory.labs[0])).canAssign(a),n.push(a.name))}),_.remove(h,
function(a){return-1!==n.indexOf(a.name)}),n=[],0!==h.length&&(_.forEach(d.fillMinerals.storageTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Storage"),n.push(b.name))});_.remove(h,function(a){return-1!==n.indexOf(a.name)});n=[]}),0!==h.length&&(_.forEach(d.fillMinerals.terminalTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Terminal"),n.push(b.name))});_.remove(h,function(a){return-1!==n.indexOf(a.name)});n=[]}),0!==h.length&&(_.forEach(d.upgradeController.criticalTasks,
function(a){0===_.filter(p,function(b){return b.memory.currentTask&&"upgradeController"===b.memory.currentTask.type&&b.memory.currentTask.room===a.room}).length&&(_.forEach(m.objectsClosestToObj(h,l),function(b){if(a.canAssign(b))return b.say("CritCntrlr"),n.push(b.name),!1}),_.remove(h,function(a){return-1!==n.indexOf(a.name)}),n=[])}),0!==h.length))))){if(!c.storage||0===f.length)if(_.forEach(h,function(a){a.carry[RESOURCE_ENERGY]<(8===c.controller.level?200:7===c.controller.level?100:50)||_.forEach(d.fillEnergy.extensionTasks.sort(function(b,
c){return b.object.pos.getRangeTo(a)-c.object.pos.getRangeTo(a)}),function(b){if(0<b.object.energyCapacity-b.object.energy-_.reduce(_.filter(k,function(a){return a.memory.currentTask&&"fillEnergy"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0)&&b.canAssign(a))return a.say("Extension"),n.push(a.name),!1})}),_.remove(h,function(a){return-1!==n.indexOf(a.name)}),n=[],0===h.length)return;c.storage&&0!==f.length||_.forEach(d.fillEnergy.spawnTasks,
function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(k,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(m.objectsClosestToObj(h,a.object),function(c){if(a.canAssign(c)&&(c.say("Spawn"),n.push(c.name),b-=c.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(h,function(a){return-1!==n.indexOf(a.name)}),n=[])});if(0!==h.length&&(_.forEach(d.fillEnergy.towerTasks,
function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(k,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(m.objectsClosestToObj(h,a.object),function(c){if(a.canAssign(c)&&(c.say("Tower"),n.push(c.name),b-=c.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(h,function(a){return-1!==n.indexOf(a.name)}),n=[])}),0!==h.length&&(_.forEach(_.filter(d.build.tasks,
function(a){return 1===a.constructionSite.progressTotal}),function(a){var b=a.constructionSite.progressTotal-a.constructionSite.progress-_.reduce(_.filter(a.constructionSite.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"build"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(m.objectsClosestToObj(h,a.constructionSite),function(c){if(a.canAssign(c)&&(c.say("Build"),n.push(c.name),b-=c.carry[RESOURCE_ENERGY]||
0,0>=b))return!1}),_.remove(h,function(a){return-1!==n.indexOf(a.name)}),n=[])}),0!==h.length&&(_.forEach(d.repair.criticalTasks,function(a){_.forEach(m.objectsClosestToObj(h,a.structure),function(b){if(0===_.filter(a.structure.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"repair"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length&&a.canAssign(b))return b.say("CritRepair"),n.push(b.name),!1});_.remove(h,function(a){return-1!==n.indexOf(a.name)});n=[]}),0!==
h.length&&(_.forEach(d.build.tasks,function(a){var b=a.constructionSite.progressTotal-a.constructionSite.progress-_.reduce(_.filter(a.constructionSite.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"build"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(m.objectsClosestToObj(h,a.constructionSite),function(c){if(a.canAssign(c)&&(c.say("Build"),n.push(c.name),b-=c.carry[RESOURCE_ENERGY]||0,0>=
b))return!1}),_.remove(h,function(a){return-1!==n.indexOf(a.name)}),n=[])}),0!==h.length&&(_.forEach(d.repair.tasks,function(a){var b=a.structure.hitsMax-a.structure.hits-100*_.reduce(_.filter(a.structure.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"repair"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0),c=!1;if(0<b)return _.forEach(m.objectsClosestToObj(h,a.structure),function(d){if(a.canAssign(d)&&(d.say("Repair"),
n.push(d.name),b-=100*(d.carry[RESOURCE_ENERGY]||0),c=!0,0>=b))return!1}),_.remove(h,function(a){return-1!==n.indexOf(a.name)}),n=[],c}),0!==h.length)))))){if(l&&8>l.level&&(_.forEach(d.upgradeController.tasks,function(a){_.forEach(m.objectsClosestToObj(h,c.controller),function(b){a.canAssign(b)&&(b.say("Controller"),n.push(b.name))});_.remove(h,function(a){return-1!==n.indexOf(a.name)});n=[]}),0===h.length))return;if(!l||6>l.level)if(0===g.hostilesInRoom(c).length&&_.forEach(_.filter(h,function(a){return a.room.name===
c.name}),function(b){_.forEach(a.getTasks(b.room),function(a){if(!(0<_.filter(a.resource.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"pickupResource"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length)&&a.canAssign(b))return b.say("Pickup"),n.push(b.name),!1})}),_.remove(h,function(a){return-1!==n.indexOf(a.name)}),n=[],0===h.length)return;d.collectEnergy.terminalTask&&(_.forEach(h,function(a){d.collectEnergy.terminalTask.canAssign(a)&&(a.say("Collecting"),
n.push(a.name))}),_.remove(h,function(a){return-1!==n.indexOf(a.name)}),n=[]);_.forEach(d.collectEnergy.tasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Collecting"),n.push(b.name))});_.remove(h,function(a){return-1!==n.indexOf(a.name)});n=[]});if(0!==h.length){if(0===_.filter(g.containersInRoom(c),function(a){return 0<a.energy}).length&&!c.storage&&(_.forEach(h,function(a){(new e).canAssign(a)&&(a.say("Harvesting"),n.push(a.name))}),_.remove(h,function(a){return-1!==n.indexOf(a.name)}),
n=[],0===h.length))return;_.forEach(b.getHarvesterTasks(h),function(a){a.canAssign(a.creep)})}}}}};Memory.profiling&&c(2,34).registerObject(f,"RoleWorker");q.exports=f;return q.exports};v[35]=function(q,t){var g=c(55,35),m=c(4,35),e=c(5,35),a=c(7,35),b=c(8,35),f=c(11,35),u=c(16,35),d=c(17,35),r=c(18,35),p=c(20,35),h=c(22,35),k=c(30,35),l=c(31,35),n=c(32,35),w=c(33,35),x=c(34,35),A=c(49,35),y=c(53,35),F=c(54,35),B=c(44,35),v=c(56,35),E=c(57,35),Q=c(40,35),z=c(43,35),L=c(50,35),D=c(58,35),C=function(){this.init()};
C.prototype=Object.create(g.prototype);C.prototype.constructor=C;C.prototype.init=function(){g.call(this);this.type="base"};C.prototype.manage=function(a){var b=a.controller,c=b.level,d=a.find(FIND_MY_CONSTRUCTION_SITES),e=m.spawnsInRoom(a)[0],g=e.pos,h=a.storage,k=a.find(FIND_MINERALS),l=a.name,n;b&&0!==c&&(0<(n=[0,5,10,20,30,40,50,60][c-1]-(m.extensionsInRoom(a).length+_.filter(d,function(a){return a.structureType===STRUCTURE_EXTENSION}).length))&&f.buildStructures(a,STRUCTURE_EXTENSION,n,e),3<=
c&&0===m.towersInRoom(a).length&&0===_.filter(d,function(a){return a.structureType===STRUCTURE_TOWER}).length&&f.buildStructures(a,STRUCTURE_TOWER,1,e),3<=c&&_.forEach(a.find(FIND_SOURCES),function(b){b=PathFinder.search(b.pos,{pos:g,range:1},{swampCost:1}).path[0];var c=b.lookFor(LOOK_STRUCTURES),f=b.x,e=b.y;0===_.filter(c,function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&0===_.filter(d,function(a){return a.pos.x===f&&a.pos.y===e&&a.structureType===STRUCTURE_CONTAINER}).length&&
(_.forEach(_.filter(c,function(a){return-1!==[STRUCTURE_ROAD,STRUCTURE_WALL].indexOf(a.structureType)}),function(a){a.destroy()}),a.createConstructionSite(f,e,STRUCTURE_CONTAINER))}),4<=c&&!h&&0===_.filter(d,function(a){return a.structureType===STRUCTURE_STORAGE}).length&&f.buildStructures(a,STRUCTURE_STORAGE,1,e),6<=c&&h&&!a.terminal&&0===_.filter(d,function(a){return a.structureType===STRUCTURE_TERMINAL}).length&&f.buildStructures(a,STRUCTURE_TERMINAL,1,h),6<=c&&k.length!==m.extractorsInRoom(a).length&&
_.forEach(k,function(b){b=b.pos;var c=b.x,f=b.y;0===_.filter(b.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_EXTRACTOR}).length&&0===_.filter(d,function(a){return a.pos.x===c&&a.pos.y===f&&a.structureType===STRUCTURE_EXTRACTOR}).length&&a.createConstructionSite(c,f,STRUCTURE_EXTRACTOR)}),6<=c&&_.forEach(k,function(b){b=PathFinder.search(b.pos,{pos:g,range:1},{swampCost:1}).path[0];var c=b.lookFor(LOOK_STRUCTURES),f=b.x,e=b.y;0===_.filter(c,function(a){return a.structureType===
STRUCTURE_CONTAINER}).length&&0===_.filter(d,function(a){return a.pos.x===f&&a.pos.y===e&&a.structureType===STRUCTURE_CONTAINER}).length&&(_.forEach(_.filter(c,function(a){return-1!==[STRUCTURE_ROAD,STRUCTURE_WALL].indexOf(a.structureType)}),function(a){a.destroy()}),a.createConstructionSite(f,e,STRUCTURE_CONTAINER))}),3<=c&&_.forEach(_.filter(a.find(FIND_MY_STRUCTURES),function(a){return a.structureType===STRUCTURE_SPAWN||a.structureType===STRUCTURE_EXTENSION||a.structureType===STRUCTURE_TOWER||
a.structureType===STRUCTURE_STORAGE||a.structureType===STRUCTURE_TERMINAL}),function(b){var c=b.pos.x;b=b.pos.y;_.forEach([new RoomPosition(c-1,b,l),new RoomPosition(c+1,b,l),new RoomPosition(c,b-1,l),new RoomPosition(c,b+1,l)],function(b){var c=b.x,f=b.y;0===_.filter(b.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_ROAD}).length&&0===_.filter(d,function(a){return a.pos.x===c&&a.pos.y===f&&a.structureType===STRUCTURE_ROAD}).length&&a.createConstructionSite(c,f,STRUCTURE_ROAD)})}))};
C.prototype.defend=function(a){var b=a.name,c=a.memory,d=_.filter(m.hostilesInRoom(a),function(a){return a.owner&&"Invader"!==a.owner.username});a=b+"-defense";var f,g;0<d.length?(c.lastHostile=Game.time,c.currentAttack||(c.currentAttack=Game.time),c.threats||(c.threats={}),c.edgeTicks||(c.edgeTicks={1:0,3:0,5:0,7:0}),_.forEach(_.filter(_.map(d,function(a){return{id:a.id,threat:_.filter(a.body,function(a){return-1!==[ATTACK,RANGED_ATTACK,HEAL].indexOf(a)}).length}})),function(a){c.threats[a.id]=a.threat}),
f=Math.min(Math.ceil(_.sum(c.threats)/20),3),0<_.filter(d,function(a){return 0===a.pos.x}).length&&c.edgeTicks[TOP]++,0<_.filter(d,function(a){return 49===a.pos.x}).length&&c.edgeTicks[BOTTOM]++,0<_.filter(d,function(a){return 0===a.pos.y}).length&&c.edgeTicks[LEFT]++,0<_.filter(d,function(a){return 49===a.pos.y}).length&&c.edgeTicks[RIGHT]++,0<f&&(Memory.army[a]?(d=Game.time-c.currentAttack,500<=d&&2E3>d?Memory.army[a].boostRoom=b:2E3<=d&&2500>d?_.forEach(_.filter(Game.rooms,function(a){return a.memory&&
a.memory.region===c.region}),function(a){var d=a.name+"-defense-for-"+b;Memory.army[a.name+"-defense"]||Memory.army[d]||e.createArmy(d,{reinforce:!1,region:c.region,boostRoom:b,buildRoom:b,stageRoom:b,attackRoom:b,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:f,units:17},melee:{maxCreeps:f,units:20},ranged:{maxCreeps:0,units:20}})}):2500<=d&&_.forEach(_.filter(Game.rooms,function(a){return a.memory&&a.memory.region===c.region}),function(a){var c=a.name+"-defense-for-"+b;Memory.army[c]&&
(Memory.army[c].boostRoom=a.name)}),g=Game.map.describeExits(b),_.forEach(_.keys(g),function(a){var d=b+"-"+a.toString()+"-border-defense";!Memory.army[d]&&50<=c.edgeTicks[a]&&e.createArmy(d,{reinforce:!1,region:c.region,boostRoom:b,buildRoom:b,stageRoom:b,attackRoom:g[a],dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:f,units:17},melee:{maxCreeps:f,units:20},ranged:{maxCreeps:0,units:20}})})):(Game.notify("Warning! "+b+" is under attack!"),e.createArmy(a,{reinforce:!1,region:c.region,
boostRoom:b,buildRoom:b,stageRoom:b,attackRoom:b,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:f,units:17},melee:{maxCreeps:f,units:20},ranged:{maxCreeps:0,units:20}}),Memory.army[a].creepCount=0))):Memory.army[b+"-defense"]&&c.lastHostile+50<Game.time&&(Memory.army[b+"-defense"]&&(Memory.army[b+"-defense"].directive="attack",Memory.army[b+"-defense"].success=!0),delete c.lastHostile,delete c.currentAttack,delete c.threats,delete c.edgeTicks)};C.prototype.transferEnergy=function(a){a=
f.objectsClosestToObj(m.linksInRoom(a),m.spawnsInRoom(a)[0]);var b=a[0];_.forEach(a,function(a,c){0!==c&&!b.cooldown&&0<b.energy&&300>=a.energy&&b.transferEnergy(a)})};C.prototype.terminal=function(c,d){var f=d.store,e=f[RESOURCE_ENERGY]||0,g=c.storage,h=c.name,k=c.memory,l=k.buyQueue,n=!1,r=[],p={},q=Game.market,x=Math.max.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&"base"===a.memory.roomType.type&&a.storage&&a.storage.my&&
a.terminal&&a.terminal.my}),function(a){return a.storage&&a.storage.my?a.storage.store[RESOURCE_ENERGY]:0})))),u,y,t;g&&(p=g.store);d&&1E3<=e&&x>=Memory.dealEnergy&&(Memory.minimumSell||(Memory.minimumSell={}),k.buyQueue&&(m.credits<Memory.minimumCredits||(p[l.resource]||0)+(f[l.resource]||0)>(Memory.reserveMinerals[l.resource]||0))&&(delete k.buyQueue,l=void 0),l&&x>Memory.marketEnergy&&Memory.buy?((u=(a.getFilteredOrders().sell[l.resource]||[])[0])?u.price>l.price?(delete k.buyQueue,l=void 0):(y=
q.calcTransactionCost(Math.min(l.amount,u.amount),h,u.roomName),e>y&&m.credits>=l.amount*u.price?(a.deal(u.id,Math.min(l.amount,u.amount),h),n=!0,l.amount-=Math.min(l.amount,u.amount)):0<e&&(t=Math.min(Math.floor(Math.min(l.amount,u.amount)*e/y),Math.floor(m.credits/u.price)),0<t&&(a.deal(u.id,t,h),n=!0,l.amount-=t))):(delete k.buyQueue,l=void 0),l&&0>=l.amount&&(delete k.buyQueue,l=void 0)):(m.credits>=Memory.minimumCredits&&Memory.buy&&(d=_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&
"base"===a.memory.roomType.type&&a.terminal&&a.terminal.my}),_.forEach(d,function(a){var b=a.name;n=!1;if(h!==a.name)return _.forEach(_.filter(_.map(f,function(b,c){return{resource:c,amount:Math.min(Memory.reserveMinerals?b+p[c]-(c.startsWith("X")&&5===c.length?Memory.reserveMinerals[c]-5E3:Memory.reserveMinerals[c]):0,b),otherRoomAmount:(a.terminal.store[c]||0)+(a.storage&&a.storage.store[c]||0),needed:Memory.reserveMinerals?(c.startsWith("X")&&5===c.length?Memory.reserveMinerals[c]-5E3:Memory.reserveMinerals[c])||
0:0}}),function(a){return Memory.reserveMinerals[a.resource]&&a.otherRoomAmount<a.needed&&0<a.amount&&0<a.needed-a.otherRoomAmount&&100<=Math.min(a.amount,a.needed-a.otherRoomAmount)}),function(a){var d=Math.min(a.amount,a.needed-a.otherRoomAmount);y=q.calcTransactionCost(d,h,b);if(e>y){if(c.terminal.send(a.resource,d,b)===OK)return m.log.events.push("Sending "+d+" "+a.resource+" from "+h+" to "+b),n=!0,!1}else if(0<e&&(d=Math.floor(d*e/y),0<d&&c.terminal.send(a.resource,d,b)===OK))return m.log.events.push("Sending "+
d+" "+a.resource+" from "+h+" to "+b),n=!0,!1}),!n})),n||(d=_.filter(_.map(f,function(a,b){return{resource:b,amount:Math.min(a,a-(Memory.reserveMinerals?(b.startsWith("X")&&5===b.length?Memory.reserveMinerals[b]-5E3:Memory.reserveMinerals[b])||0:0)+(p[b]||0))}}),function(a){return a.resource!==RESOURCE_ENERGY&&0<a.amount}),0<d.length&&_.forEach(d.sort(function(a,b){return b.amount-a.amount}),function(b){var c=b.resource;if(u=_.filter(a.getFilteredOrders().buy[c]||[],function(a){return 5005<=b.amount&&
m.credits<Memory.minimumCredits||!Memory.minimumSell[c]||a.price>=Memory.minimumSell[c]})[0]){y=q.calcTransactionCost(Math.min(b.amount,u.amount),h,u.roomName);if(e>y)return a.deal(u.id,Math.min(b.amount,u.amount),h),n=!0,5005>b.amount&&delete Memory.minimumSell[u.resourceType],!1;if(0<e&&(t=Math.floor(Math.min(b.amount,u.amount)*e/y),0<t))return a.deal(u.id,t,h),n=!0,!1}})),!n&&g&&x>Memory.marketEnergy&&(_.forEach(b,function(b,c){var d;!p||p[c]<Memory.reserveMinerals[c]||-1!==[RESOURCE_ENERGY,SUBSCRIPTION_TOKEN].indexOf(c)||
(b=(a.getFilteredOrders().sell[c]||[])[0],d=(a.getFilteredOrders().buy[c]||[])[0],b&&d&&b.price<d.price&&b.price<m.credits&&r.push({resource:c,buy:d,sell:b}))}),_.forEach(r.sort(function(a,b){return a.sell.price-a.buy.price-(b.sell.price-b.buy.price)}),function(b,c){var d=b.buy,f=b.sell;t=Math.min(d.amount,f.amount);t*f.price>m.credits&&(t=Math.floor(m.credits/f.price));0===c&&m.log.events.push("Biggest flip: "+b.resource+" x"+t+" "+f.price.toFixed(2)+" to "+d.price.toFixed(2));y=q.calcTransactionCost(t,
h,f.roomName);if(e>y||0<e&&(t=Math.floor(t*e/y),0<t))return a.deal(f.id,t,h),Memory.minimumSell[b.resource]=f.price,n=!0,!1}))))};C.prototype.tasks=function(a){var b=a.terminal,c=Memory.dismantle,d=a.name,e=0,g=0,h,l=m.creeps[d]&&m.creeps[d].worker||[],k=0<_.filter(l,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,n=0<_.filter(l,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&a.carry[RESOURCE_ENERGY]!==_.sum(a.carry)}).length,
p=0<_.filter(l,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,r=m.creeps[d]&&m.creeps[d].collector||[],u=0<_.filter(r,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,q=0<_.filter(r,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,x=m.creeps[d]&&m.creeps[d].storer||[],t=0<_.filter(x,function(a){return(!a.memory.currentTask||
a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,w=0<_.filter(x,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&a.carry[RESOURCE_ENERGY]!==_.sum(a.carry)}).length,x=0<_.filter(x,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,H=m.creeps[d]&&m.creeps[d].scientist||[],I=0<_.filter(H,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,
J=0<_.filter(H,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&a.carry[RESOURCE_ENERGY]!==_.sum(a.carry)}).length,H=0<_.filter(H,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,C=m.creeps[d]&&m.creeps[d].upgrader||[],R=0<_.filter(C,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,C=0<_.filter(C,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&
0===_.sum(a.carry)}).length,M=0<f.creepsWithNoTask(m.creeps[d]&&m.creeps[d].dismantler||[]).length,l=0===Game.time%10&&0===l.length+r.length,K={build:{tasks:k||u?A.getTasks(a):[]},collectEnergy:{tasks:p||x||H||q||C?y.getTasks(a):[],storerTasks:x?y.getStorerTasks(a):[]},collectMinerals:{storerTasks:x||w?F.getStorerTasks(a):[],labTasks:H||J?F.getLabTasks(a):[],storageTasks:H||J?F.getStorageTasks(a):[],terminalTasks:H||J?F.getTerminalTasks(a):[]},fillEnergy:{extensionTasks:k||t||I||u?v.getExtensionTasks(a):
[],spawnTasks:k||t||I||u?v.getSpawnTasks(a):[],powerSpawnTasks:I?v.getPowerSpawnTasks(a):[],towerTasks:k||I||u?v.getTowerTasks(a):[],storageTasks:t||I||M?v.getStorageTasks(a):[],containerTasks:M?v.getContainerTasks(a):[],labTasks:I?v.getLabTasks(a):[],linkTasks:t?v.getLinkTasks(a):[],nukerTasks:I?v.getNukerTasks(a):[]},fillMinerals:{labTasks:J?E.getLabTasks(a):[],storageTasks:n||w||J||M?E.getStorageTasks(a):[],terminalTasks:n||w||J||M?E.getTerminalTasks(a):[],nukerTasks:J?E.getNukerTasks(a):[],powerSpawnTasks:J?
E.getPowerSpawnTasks(a):[]},heal:{tasks:Q.getTasks(a)},rangedAttack:{tasks:z.getTasks(a)},repair:{tasks:l||k||u?L.getTasks(a):[],criticalTasks:l||k||u?L.getCriticalTasks(a):[],towerTasks:Memory.towerTasks[d]||0===Game.time%10?L.getTowerTasks(a):[]},upgradeController:{tasks:k||u||R?D.getTasks(a):[],criticalTasks:l||k||u?D.getCriticalTasks(a):[]},dismantle:{tasks:[]}};Memory.towerTasks[d]=K.repair.towerTasks.length;b&&b.my&&(e=b.store[RESOURCE_ENERGY]||0,h=b.id);a.storage&&(g=a.storage.store[RESOURCE_ENERGY]||
0);(x||H)&&b&&(!b.my||5E3<=e&&(!a.memory.buyQueue||g<Memory.dealEnergy||m.credits<Memory.minimumCredits))&&(K.collectEnergy.terminalTask=new y(h));(k||t||I)&&b&&b.my&&1E3>e&&(K.fillEnergy.terminalTask=new v(h));if(c&&c[d]&&0<c[d].length){var P=[];_.forEach(c[d],function(b){var c=a.lookForAt(LOOK_STRUCTURES,b.x,b.y);0===c.length?P.push(b):M&&(K.dismantle.tasks=K.dismantle.tasks.concat(_.map(c,function(a){return new B(a.id)})))});_.forEach(P,function(a){_.remove(c[d],function(b){return b.x===a.x&&b.y===
a.y})})}else _.forEach(m.creeps[d]&&m.creeps[d].dismantler||[],function(b){b.memory.role="remoteWorker";b.memory.container=m.containersInRoom(a)[0].id});return K};C.prototype.spawn=function(a,b){var c=Memory.dismantle,f=a.name,e=a.controller;x.checkSpawn(a,b);h.checkSpawn(a);l.checkSpawn(a);k.checkSpawn(a);c&&c[f]&&0<c[f].length&&p.checkSpawn(a);d.checkSpawn(a);u.checkSpawn(a);r.checkSpawn(a);e&&(8>e.level||0<_.filter(Game.rooms,function(a){return a.controller&&a.controller.my&&8>a.controller.level}).length)&&
w.checkSpawn(a)};C.prototype.assignTasks=function(a,b){x.assignTasks(a,b);h.assignTasks(a,b);l.assignTasks(a,b);k.assignTasks(a,b);p.assignTasks(a,b);d.assignTasks(a,b);u.assignTasks(a,b);r.assignTasks(a,b);w.assignTasks(a,b);n.assignTasks(a,b)};C.prototype.labQueue=function(a,b){var c=a.memory,d=m.labsInRoom(a),e=c.labsInUse,g=b.sourceLabs||[],h=b.children||[],l=Game.getObjectById(g[0]),k=Game.getObjectById(g[1]),n=b.resource;switch(b.status){case "clearing":if(!e||2<d.length-e.length&&0===_.filter(d,
function(a){return-1===e.indexOf(a.id)&&0<a.mineralAmount}).length)b.status="moving";break;case "moving":if(!b.start||b.start+500<Game.time)delete c.labQueue,b=void 0;else{var p=!0;_.forEach(h,function(a){if(_.sum(_.filter(d,function(b){return b.mineralType===a}),function(a){return a.mineralAmount})<b.amount)return p=!1});l.mineralType===h[0]&&k.mineralType===h[1]&&_.forEach(_.filter(d,function(a){return-1===g.indexOf(a.id)&&(!e||-1===_.map(_.filter(e,function(a){return a.resource!==n}),function(a){return a.id}).indexOf(a.id))}),
function(a){a.runReaction(l,k)===OK&&(b.amount-=5)});p&&(b.status="creating")}break;case "creating":_.forEach(_.filter(d,function(a){return-1===g.indexOf(a.id)&&(!e||-1===_.map(_.filter(e,function(a){return a.resource!==n}),function(a){return a.id}).indexOf(a.id))}),function(a){a.mineralAmount===LAB_MINERAL_CAPACITY&&(b.status="returning");a.runReaction(l,k)===OK&&(b.amount-=5)});0===_.sum(_.filter(d,function(a){return-1!==g.indexOf(a.id)}),function(a){return a.mineralAmount})&&(b.status="returning");
break;case "returning":0===_.sum(_.filter(d,function(a){return a.mineralType===n}),function(a){return a.mineralAmount})&&(delete c.labQueue,b=void 0);break;default:b.status="clearing",b.sourceLabs=f.getSourceLabs(a)}};C.prototype.labsInUse=function(a,b){var c=[];_.forEach(b,function(a){var b=Game.getObjectById(a.id);switch(a.status){case "emptying":0===b.mineralAmount&&(a.status="filling");break;case "filling":b.mineralAmount===a.amount&&b.mineralType===a.resource&&(a.status="waiting");break;default:var d=
Game.creeps[a.creepToBoost];1>=b.pos.getRangeTo(d)&&b.mineralType===a.resource&&b.mineralAmount>=a.amount&&b.boostCreep(d)===OK&&(_.remove(d.memory.labs,function(b){return b===a.id}),a.status&&0!==a.oldAmount?a.status="refilling":c.push(a));break;case "refilling":b.mineralAmount===a.oldAmount&&b.mineralType===a.oldResource&&c.push(a)}});_.forEach(c,function(a){_.remove(b,function(b){return b.id===a.id})})};C.prototype.run=function(a){var b,c,d,e,g;a.unobservable?Game.notify("Base Room "+b+" is unobservable, something is wrong!"):
(b=a.name,c=m.spawnsInRoom(a),d=a.terminal,b=a.storage,e=a.memory,g=e.labQueue,e=e.labsInUse,0===Game.time%100&&0<c.length&&this.manage(a),this.defend(a),0<c.length&&this.transferEnergy(a),d&&this.terminal(a,d),c=this.tasks(a),this.spawn(a,!b||b.store[RESOURCE_ENERGY]>=Memory.workerEnergy||3500>a.controller.ticksToDowngrade||0<a.find(FIND_MY_CONSTRUCTION_SITES).length||c.repair.criticalTasks&&0<c.repair.criticalTasks.length||c.repair.tasks&&0<_.filter(c.repair.tasks,function(a){return(a.structure.structureType===
STRUCTURE_WALL||a.structure.structureType===STRUCTURE_RAMPART)&&1E6>a.structure.hits}).length),this.assignTasks(a,c),b&&3<=m.labsInRoom(a).length&&g&&!f.roomLabsArePaused(a)&&this.labQueue(a,g),e&&this.labsInUse(a,e))};C.prototype.toObj=function(a){Memory.rooms[a.name].roomType={type:this.type}};C.fromObj=function(a){return new C};Memory.profiling&&c(2,35).registerObject(C,"RoomBase");q.exports=C;return q.exports};v[36]=function(q,t){var g=c(55,36),m=c(4,36),e=c(5,36),a=c(11,36),b=c(25,36),f=c(24,
36),u=c(53,36),d=c(54,36),r=c(44,36),p=c(56,36),h=c(57,36),k=c(47,36);Cleanup=function(a){this.init(a)};Cleanup.prototype=Object.create(g.prototype);Cleanup.prototype.constructor=Cleanup;Cleanup.prototype.init=function(a){g.call(this);this.type="cleanup";this.supportRoom=a};Cleanup.prototype.run=function(c){var g=c.name,l=[],q=[],t=[],y=[],F=[],B=[],v,E;if(v=Game.rooms[Memory.rooms[c.name].roomType.supportRoom])E={collectEnergy:{cleanupTasks:[]},collectMinerals:{cleanupTasks:[]},fillEnergy:{storageTasks:p.getStorageTasks(v),
containerTasks:p.getContainerTasks(v)},fillMinerals:{labTasks:h.getLabTasks(v),storageTasks:h.getStorageTasks(v),terminalTasks:h.getTerminalTasks(v)},remoteDismantle:{cleanupTasks:[]},dismantle:{tasks:[]},pickupResource:{tasks:[]}},c.unobservable||(Memory.dismantle&&Memory.dismantle[c.name]&&0<Memory.dismantle[c.name].length&&(_.forEach(Memory.dismantle[c.name],function(a){var b=c.lookForAt(LOOK_STRUCTURES,a.x,a.y);0===b.length?F.push(a):E.dismantle.tasks=E.dismantle.tasks.concat(_.map(b,function(a){return new r(a.id)}))}),
_.forEach(F,function(a){_.remove(Memory.dismantle[g],function(b){return b.x===a.x&&b.y===a.y})})),l=_.filter(c.find(FIND_STRUCTURES),function(a){return a.structureType===STRUCTURE_RAMPART}),q=_.filter(c.find(FIND_STRUCTURES),function(b){return b.structureType!==STRUCTURE_RAMPART&&b.structureType!==STRUCTURE_CONTROLLER&&b.structureType!==STRUCTURE_ROAD&&b.structureType!==STRUCTURE_WALL&&(0===l.length||0<b.pos.getRangeTo(a.objectsClosestToObj(l,b)[0]))}),t=_.filter(q,function(a){return a.structureType===
STRUCTURE_NUKER||(!a.energy||0===a.energy)&&(!a.store||0===_.sum(a.store))&&(!a.mineralAmount||0===a.mineralAmount)}),y=_.filter(q,function(a){return a.structureType!==STRUCTURE_NUKER&&(a.energy&&0<a.energy||a.store&&0<_.sum(a.store)||a.mineralAmount&&0<a.mineralAmount)}),B=_.filter(c.find(FIND_STRUCTURES),function(a){return-1!==[STRUCTURE_WALL,STRUCTURE_ROAD].indexOf(a.structureType)}),E.collectEnergy.cleanupTasks=u.getCleanupTasks(y),E.collectMinerals.cleanupTasks=d.getCleanupTasks(y),E.pickupResource.tasks=
k.getTasks(c),E.remoteDismantle.cleanupTasks=[].concat.apply([],[r.getCleanupTasks(t),r.getCleanupTasks(l),r.getCleanupTasks(B)]),0===y.length&&0===E.remoteDismantle.cleanupTasks.length&&0===E.pickupResource.tasks.length&&(Game.notify("Cleanup Room "+c.name+" is squeaky clean!"),_.forEach(m.creeps[g]&&m.creeps[g].remoteCollector||[],function(a){a.memory.role="storer";a.memory.home=v.name}),_.forEach(m.creeps[g]&&m.creeps[g].remoteDismantler||[],function(a){a.memory.role="upgrader";a.memory.home=v.name}),
e.setRoomType(c.name))),(c.unobservable||0<q.length||0<l.length||0<B.length)&&b.checkSpawn(c,v,Math.min(q.length+l.length+B.length,8)),f.checkSpawn(c,v,0<E.collectEnergy.cleanupTasks||E.collectMinerals.cleanupTasks?v.controller?v.controller.level:3:1),b.assignTasks(c,E),f.assignTasks(c,E)};Cleanup.prototype.toObj=function(a){Memory.rooms[a.name].roomType={type:this.type,supportRoom:this.supportRoom}};Cleanup.fromObj=function(a){return new Cleanup(a.roomType.supportRoom)};Memory.profiling&&c(2,36).registerObject(Cleanup,
"RoomCleanup");q.exports=Cleanup;return q.exports};v[37]=function(q,t){var g=c(55,37),m=c(4,37),e=c(5,37),a=c(11,37),b=c(20,37),f=c(23,37),u=c(26,37),d=c(27,37),r=c(28,37),p=c(29,37),h=c(49,37),k=c(44,37),l=c(56,37),n=c(57,37),w=function(a,b){this.init(a,b)};w.prototype=Object.create(g.prototype);w.prototype.constructor=w;w.prototype.init=function(a,b){g.call(this);this.type="mine";this.supportRoom=a;this.stage=b||1};w.prototype.convert=function(b,c){var d=this,f=b.name;c=Memory.rooms[f];var g=c.roomType.type;
e.setRoomType(f,{type:"base",region:c.region});e.claimRoom(this.supportRoom,f,!1);switch(g){case "mine":_.forEach(m.creeps[f]&&m.creeps[f].all||[],function(c){var e=c.memory;switch(e.role){case "remoteBuilder":case "remoteWorker":e.role="worker";e.home=f;e.homeSource=a.objectsClosestToObj(b.find(FIND_SOURCES),c)[0].id;break;case "remoteReserver":c.suicide();break;case "remoteStorer":e.role="storer";e.home=d.supportRoom;break;case "dismantler":e.home=f,e.supportRoom=f}})}};w.prototype.stage1Tasks=
function(a,b){b={fillEnergy:{storageTasks:l.getStorageTasks(b),containerTasks:l.getContainerTasks(b)},fillMinerals:{storageTasks:n.getStorageTasks(b),terminalTasks:n.getTerminalTasks(b)},dismantle:{tasks:[]}};a.unobservable||(b.build={tasks:h.getTasks(a)});return b};w.prototype.stage1Spawn=function(a){d.checkSpawn(a);f.checkSpawn(a)};w.prototype.stage1AssignTasks=function(a,c){d.assignTasks(a,c);f.assignTasks(a);u.assignTasks(a,c);p.assignTasks(a,c);r.assignTasks(a,c);b.assignTasks(a,c)};w.prototype.stage1Manage=
function(b,c){var d=c.name,f,g,h,k;b.unobservable||(f=[].concat.apply([],[b.find(FIND_SOURCES),/^[EW][1-9][0-9]*5[NS][1-9][0-9]*5$/.test(b.name)?b.find(FIND_MINERALS):[]]),g=m.containersInRoom(b),h=b.name,g.length>=f.length?(this.stage=2,_.forEach(g,function(c){var d=a.objectsClosestToObj([].concat.apply([],[f,b.find(FIND_MINERALS)]),c)[0];if(!(d instanceof Mineral))return _.forEach(m.creeps[h]&&m.creeps[h].remoteBuilder||[],function(b){b.memory.role="remoteWorker";b.memory.container=a.objectsClosestToObj(g,
d)[0].id}),!1})):(k=b.find(FIND_MY_CONSTRUCTION_SITES),0===k.length&&_.forEach(f,function(a){var d=PathFinder.search(a.pos,{pos:m.spawnsInRoom(c)[0].pos,range:1},{swampCost:1}).path[0];0===_.filter(d.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&0===_.filter(k,function(a){return a.pos.x===d.x&&a.pos.y===d.y&&a.structureType===STRUCTURE_CONTAINER}).length&&b.createConstructionSite(d.x,d.y,STRUCTURE_CONTAINER)}),0<_.filter(m.hostilesInRoom(b),function(a){return a.owner&&
"Invader"===a.owner.username}).length?Memory.army[h+"-defense"]||e.createArmy(h+"-defense",{reinforce:!1,region:b.memory.region,boostRoom:void 0,buildRoom:d,stageRoom:d,attackRoom:h,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:1,units:Math.min(Math.floor((c.energyCapacityAvailable-300)/300),20)},melee:{maxCreeps:1,units:Math.min(Math.floor((c.energyCapacityAvailable-300)/130),20)},ranged:{maxCreeps:0,units:20}}):Memory.army[h+"-defense"]&&(Memory.army[h+"-defense"].directive="attack",
Memory.army[h+"-defense"].success=!0)))};w.prototype.stage1=function(a,b){var c=this.stage1Tasks(a,b);this.stage1Spawn(a);this.stage1AssignTasks(a,c);this.stage1Manage(a,b)};w.prototype.stage2Manage=function(a,b){var c=a.name,d=b.name,f;a.unobservable?0===(m.creeps[c]&&m.creeps[c].remoteMiner||[]).length&&0===(m.creeps[c]&&m.creeps[c].remoteWorker||[]).length&&0===(m.creeps[c]&&m.creeps[c].remoteStorer||[]).length&&0===(m.creeps[c]&&m.creeps[c].remoteReserver||[]).length&&(this.stage=1):(f=[].concat.apply([],
[a.find(FIND_SOURCES),/^[EW][1-9][0-9]*5[NS][1-9][0-9]*5$/.test(a.name)?a.find(FIND_MINERALS):[]]),m.containersInRoom(a).length<f.length?this.stage=1:0<_.filter(m.hostilesInRoom(a),function(a){return a.owner&&"Invader"===a.owner.username}).length?Memory.army[c+"-defense"]||e.createArmy(c+"-defense",{reinforce:!1,region:a.memory.region,boostRoom:void 0,buildRoom:d,stageRoom:d,attackRoom:c,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:1,units:Math.min(Math.floor((b.energyCapacityAvailable-
300)/300),20)},melee:{maxCreeps:1,units:Math.min(Math.floor((b.energyCapacityAvailable-300)/130),20)},ranged:{maxCreeps:0,units:20}}):Memory.army[c+"-defense"]&&(Memory.army[c+"-defense"].directive="attack",Memory.army[c+"-defense"].success=!0))};w.prototype.stage2Spawn=function(a,c){var f=Memory.dismantle;0<m.hostilesInRoom(a).length||(d.checkSpawn(a),u.checkSpawn(a),p.checkSpawn(a),r.checkSpawn(a),f&&f[a.name]&&0<f[a.name].length&&b.checkSpawn(a,c))};w.prototype.stage2Tasks=function(b,c){var d=
b.name,f=0<a.creepsWithNoTask(m.creeps[d]&&m.creeps[d].remoteWorker||[]).length||0<a.creepsWithNoTask(m.creeps[d]&&m.creeps[d].remoteStorer||[]).length||0<a.creepsWithNoTask(m.creeps[d]&&m.creeps[d].remoteDismantler||[]).length;tasks={fillEnergy:{storageTasks:f?l.getStorageTasks(c):[],containerTasks:f?l.getContainerTasks(c):[]},fillMinerals:{storageTasks:f?n.getStorageTasks(c):[],terminalTasks:f?n.getTerminalTasks(c):[]}};if(!b.unobservable){var e=Memory.dismantle;tasks.dismantle={tasks:[]};if(e&&
e[d]&&0<e[d].length){var g=[];_.forEach(e[d],function(a){var c=b.lookForAt(LOOK_STRUCTURES,a.x,a.y);0===c.length?g.push(a):tasks.dismantle.tasks=tasks.dismantle.tasks.concat(_.map(c,function(a){return new k(a.id)}))});_.forEach(g,function(a){_.remove(e[d],function(b){return b.x===a.x&&b.y===a.y})})}else _.forEach(m.creeps[d]&&m.creeps[d].dismantler||[],function(a){a.memory.role="remoteWorker";a.memory.container=m.containersInRoom(b)[0].id})}return tasks};w.prototype.stage2AssignTasks=function(a,c){d.assignTasks(a,
c);u.assignTasks(a,c);p.assignTasks(a,c);r.assignTasks(a,c);b.assignTasks(a,c)};w.prototype.stage2=function(a,b){this.stage2Manage(a,b);1!==this.stage&&(a.unobservable||this.stage2Spawn(a,b),b=this.stage2Tasks(a,b),this.stage2AssignTasks(a,b))};w.prototype.run=function(a){var b;if(a.unobservable||0!==a.find(FIND_SOURCES).length)if(b=Game.rooms[Memory.rooms[a.name].roomType.supportRoom])a.controller&&a.controller.my?this.convert(a,b):(1===this.stage&&this.stage1(a,b),2===this.stage&&this.stage2(a,
b))};w.prototype.toObj=function(a){Memory.rooms[a.name].roomType={type:this.type,supportRoom:this.supportRoom,stage:this.stage}};w.fromObj=function(a){return new w(a.roomType.supportRoom,a.roomType.stage)};Memory.profiling&&c(2,37).registerObject(w,"RoomMine");q.exports=w;return q.exports};v[38]=function(q,t){var g=c(4,38),m=c(48,38),e=c(49,38),a=c(45,38),b=c(53,38),f=c(54,38),u=c(44,38),d=c(56,38),r=c(57,38),p=c(46,38),h=c(40,38),k=c(41,38),l=c(51,38),n=c(47,38),w=c(42,38),v=c(43,38),A=c(50,38),
y=c(52,38),F=c(58,38);t=function(c){switch(c.memory.currentTask.type){case "attack":g.creepTasks[c.name]=m.fromObj(c);break;case "build":g.creepTasks[c.name]=e.fromObj(c);break;case "claim":g.creepTasks[c.name]=a.fromObj(c);break;case "collectEnergy":g.creepTasks[c.name]=b.fromObj(c);break;case "collectMinerals":g.creepTasks[c.name]=f.fromObj(c);break;case "dismantle":g.creepTasks[c.name]=u.fromObj(c);break;case "fillEnergy":g.creepTasks[c.name]=d.fromObj(c);break;case "fillMinerals":g.creepTasks[c.name]=
r.fromObj(c);break;case "harvest":g.creepTasks[c.name]=p.fromObj(c);break;case "heal":g.creepTasks[c.name]=h.fromObj(c);break;case "meleeAttack":g.creepTasks[c.name]=k.fromObj(c);break;case "mine":g.creepTasks[c.name]=l.fromObj(c);break;case "pickupResource":g.creepTasks[c.name]=n.fromObj(c);break;case "rally":g.creepTasks[c.name]=w.fromObj(c);break;case "rangedAttack":g.creepTasks[c.name]=v.fromObj(c);break;case "repair":g.creepTasks[c.name]=A.fromObj(c);break;case "reserve":g.creepTasks[c.name]=
y.fromObj(c);break;case "upgradeController":g.creepTasks[c.name]=F.fromObj(c)}};Memory.profiling&&c(2,38).registerObject(t,"TaskDeserialization");q.exports=t;return q.exports};v[39]=function(q,t){var g=c(4,39),m=c(35,39),e=c(36,39),a=c(37,39),b=c(59,39);t=function(c,u){switch(c.roomType.type){case "base":g.roomTypes[u]=m.fromObj(c);break;case "cleanup":g.roomTypes[u]=e.fromObj(c);break;case "mine":g.roomTypes[u]=a.fromObj(c);break;case "source":g.roomTypes[u]=b.fromObj(c)}};Memory.profiling&&c(2,
39).registerObject(t,"RoomDeserialization");q.exports=t;return q.exports};v[40]=function(q,t){var g=c(4,40),m=c(60,40),e=function(a){this.init(a)};e.prototype.init=function(a){this.type="heal";this.id=a;this.ally=Game.getObjectById(a);this.unimportant=!0};e.prototype.canAssign=function(a,b){if(a.spawning||0===a.getActiveBodyparts(HEAL))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){a.hits<a.hitsMax&&a.heal(a);if(!this.ally)return delete a.memory.currentTask,
!0;m.moveTo(a,this.ally);this.ally.hits!==this.ally.hitsMax&&a.id!==this.ally.id&&(1>=a.pos.getRangeTo(this.ally)?a.heal(this.ally):3>=a.pos.getRangeTo(this.ally)&&a.rangedHeal(this.ally))};e.prototype.toObj=function(a){this.ally?a.memory.currentTask={type:this.type,id:this.ally.id,unimportant:this.unimportant}:delete a.memory.currentTask};e.fromObj=function(a){return new e(a.memory.currentTask.id)};e.getTasks=function(a){return _.map(_.filter(a.find(FIND_MY_CREEPS),function(a){return a.hits<a.hitsMax}).sort(function(a,
c){return a.hits-c.hits}),function(a){return new e(a.id)})};e.getDefenderTask=function(a){return _.map(_.filter(a.room.find(FIND_MY_CREEPS),function(b){return b.hits<b.hitsMax&&b.id!==a.id}).sort(function(a,c){return a.hits-c.hits}),function(a){return new e(a.id)})[0]};Memory.profiling&&c(2,40).registerObject(e,"TaskHeal");q.exports=e;return q.exports};v[41]=function(q,t){var g=c(4,41),m=c(60,41),e=function(a){this.init(a)};e.prototype.init=function(a){this.type="meleeAttack";this.id=a;this.enemy=
Game.getObjectById(a)};e.prototype.canAssign=function(a){if(a.spawning||0===a.getActiveBodyparts(ATTACK))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){this.enemy?0===a.getActiveBodyparts(ATTACK)?(a.say("Help!"),delete a.memory.currentTask):(m.moveTo(a,this.enemy),a.attack(this.enemy)===ERR_NOT_IN_RANGE&&a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a),0<a.getActiveBodyparts(RANGED_ATTACK)&&a.rangedAttack(this.enemy)):(a.say("Get Rekt!",!0),delete a.memory.currentTask)};
e.prototype.toObj=function(a){this.enemy?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};e.fromObj=function(a){return new e(a.memory.currentTask.id)};e.getTasks=function(a){return _.map(g.hostilesInRoom(a).sort(function(a,c){return a.hits-c.hits}),function(a){return new e(a.id)})};Memory.profiling&&c(2,41).registerObject(e,"TaskMeleeAttack");q.exports=e;return q.exports};v[42]=function(q,t){var g=c(4,42),m=c(60,42),e=function(a,b){this.init(a,b)};e.prototype.init=function(a,
b){this.type="rally";this.id=a;this.creep=b;a instanceof RoomPosition?this.rallyPoint=new RoomPosition(a.x,a.y,a.roomName):(this.rallyPoint=Game.getObjectById(a),this.rallyPoint||(this.rallyPoint=new RoomPosition(25,25,a),this.range=5));this.unimportant=!0};e.prototype.canAssign=function(a){if(a.spawning)return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){var b;this.rallyPoint?(b=a.room.name===this.rallyPoint.roomName||!(this.rallyPoint instanceof RoomPosition)||
this.rallyPoint.pos&&a.room.name===this.rallyPoint.pos.roomName?this.range||0:20,a.pos.getRangeTo(this.rallyPoint)<=b?0===a.pos.x?a.move(RIGHT):49===a.pos.x?a.move(LEFT):0===a.pos.y?a.move(BOTTOM):49===a.pos.y?a.move(TOP):0<_.filter(a.pos.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_ROAD||a.structureType===STRUCTURE_CONTAINER}).length&&a.move(Math.floor(8*Math.random())):m.moveTo(a,this.rallyPoint,b),a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a),0<a.getActiveBodyparts(RANGED_ATTACK)&&
a.rangedMassAttack()):delete a.memory.currentTask};e.prototype.toObj=function(a){this.rallyPoint?a.memory.currentTask={type:this.type,id:this.id,unimportant:this.unimportant,range:this.range}:delete a.memory.currentTask};e.fromObj=function(a){var b;b=a.memory.currentTask.id.roomName?new e(new RoomPosition(a.memory.currentTask.id.x,a.memory.currentTask.id.y,a.memory.currentTask.id.roomName)):new e(a.memory.currentTask.id);a.memory.currentTask.range&&(b.range=a.memory.currentTask.range);return b};e.getHarvesterTasks=
function(a){return _.map(_.filter(a,function(a){return!a.spawning&&150<=a.ticksToLive&&a.memory.homeSource}),function(a){return new e(a.memory.homeSource,a)})};e.getDefenderTask=function(a){var b=g.sourceKeepersInRoom(a.room).sort(function(a,b){return a.ticksToSpawn-b.ticksToSpawn})[0];return b&&a.room.name===a.memory.home?new e(b.id,a):new e(a.memory.home,a)};e.getClaimerTask=function(a){return new e(a.memory.claim,a)};Memory.profiling&&c(2,42).registerObject(e,"TaskRally");q.exports=e;return q.exports};
v[43]=function(q,t){var g=c(4,43),m=c(60,43),e=function(a){this.init(a)};e.prototype.init=function(a){this.type="rangedAttack";this.id=a;this.enemy=Game.getObjectById(a)};e.prototype.canAssign=function(a){if(a.spawning||0===a.getActiveBodyparts(RANGED_ATTACK))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){this.enemy?0===a.getActiveBodyparts(RANGED_ATTACK)?(a.say("Help!"),delete a.memory.currentTask):0<a.getActiveBodyparts(ATTACK)?(m.moveTo(a,this.enemy),a.attack(this.enemy)===
ERR_NOT_IN_RANGE&&a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a),0<a.getActiveBodyparts(RANGED_ATTACK)&&a.rangedAttack(this.enemy)):(m.moveTo(a,this.enemy,3),a.rangedAttack(this.enemy),a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a)):(a.say("Get Rekt!",!0),delete a.memory.currentTask)};e.prototype.toObj=function(a){this.enemy?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};e.fromObj=function(a){return new e(a.memory.currentTask.id)};e.getTasks=function(a){return _.map(g.hostilesInRoom(a).sort(function(a,
c){return a.hits-c.hits}),function(a){return new e(a.id)})};Memory.profiling&&c(2,43).registerObject(e,"TaskRangedAttack");q.exports=e;return q.exports};v[44]=function(q,t){var g=c(4,44),m=c(60,44),e=function(a){this.init(a)};e.prototype.init=function(a){this.type="dismantle";this.id=a;this.structure=Game.getObjectById(a);this.force=this.unimportant=!0};e.prototype.canAssign=function(a){if(a.spawning||0<a.carryCapacity&&_.sum(a.carry)===a.carryCapacity||a.spawning||0===a.getActiveBodyparts(WORK))return!1;
g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){var b=this.structure;0<a.carryCapacity&&_.sum(a.carry)===a.carryCapacity||!this.structure||0===a.getActiveBodyparts(WORK)?delete a.memory.currentTask:(m.moveTo(a,b,1),a.dismantle(b),50*Math.min(a.getActiveBodyparts(WORK),a.carry[RESOURCE_ENERGY])>=b.hits&&delete a.memory.currentTask)};e.prototype.toObj=function(a){this.structure?a.memory.currentTask={type:this.type,id:this.structure.id}:delete a.memory.currentTask};e.fromObj=
function(a){return new e(a.memory.currentTask.id)};e.getCleanupTasks=function(a){return _.map(a,function(a){return new e(a.id)})};Memory.profiling&&c(2,44).registerObject(e,"TaskDismantle");q.exports=e;return q.exports};v[45]=function(q,t){var g=c(4,45),m=c(60,45),e=function(a){this.init(a)};e.prototype.init=function(){this.type="claim"};e.prototype.canAssign=function(a){var b=a.room.controller;if(a.spawning||"claimer"!==a.memory.role||!b||b.my||0===a.getActiveBodyparts(CLAIM))return!1;g.creepTasks[a.name]=
this;this.toObj(a);return!0};e.prototype.run=function(a){!a.room.controller||a.room.controller.my||0===!a.getActiveBodyparts(CLAIM)?delete a.memory.currentTask:(m.moveTo(a,a.room.controller,1),a.claimController(a.room.controller))};e.prototype.toObj=function(a){a.room.controller?a.memory.currentTask={type:this.type}:delete a.memory.currentTask};e.fromObj=function(a){return new e};e.getTask=function(a){if(a.room.controller)return new e};Memory.profiling&&c(2,45).registerObject(e,"TaskClaim");q.exports=
e;return q.exports};v[46]=function(q,t){var g=c(4,46),m=c(60,46),e=function(a,b){this.init(a,b)};e.prototype.init=function(a,b){this.type="harvest";this.failIn=a||10;this.source=b};e.prototype.canAssign=function(a){var b=Game.getObjectById(a.memory.homeSource);if(a.spawning||150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||!b||0===a.getActiveBodyparts(WORK)||0===b.energy&&(b=a.room.find(FIND_SOURCES_ACTIVE)[0],!b))return!1;this.source=b.id;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=
function(a){var b=Game.getObjectById(this.source||a.memory.homeSource);150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||!b||0===b.energy||0===a.getActiveBodyparts(WORK)?delete a.memory.currentTask:(m.moveTo(a,b,1),a.harvest(b)===OK?(void 0===Memory.rooms[a.room.name].harvested&&(Memory.rooms[a.room.name].harvested=3E4),Memory.rooms[a.room.name].harvested+=2*a.getActiveBodyparts(WORK)):(this.failIn--,0===this.failIn&&delete a.memory.currentTask))};e.prototype.toObj=function(a){a.memory.currentTask=
{type:this.type,failIn:this.failIn,source:this.source}};e.fromObj=function(a){return new e(a.memory.currentTask.failIn,a.memory.currentTask.source)};Memory.profiling&&c(2,46).registerObject(e,"TaskHarvest");q.exports=e;return q.exports};v[47]=function(q,t){var g=c(4,47),m=c(53,47),e=c(60,47),a=function(a){this.init(a)};a.prototype.init=function(a){this.type="pickupResource";this.id=a;this.resource=Game.getObjectById(a);this.force=!0};a.prototype.canAssign=function(a){if(a.spawning||150>a.ticksToLive||
!this.resource||_.sum(a.carry)===a.carryCapacity||this.resource.amount<a.pos.getRangeTo(this.resource)||this.resource.resourceType===RESOURCE_ENERGY&&50>this.resource.amount)return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){if(this.resource&&_.sum(a.carry)!==a.carryCapacity){if(e.moveTo(a,this.resource,1),a.pickup(this.resource)===OK){delete a.memory.currentTask;var b=_.filter(a.room.lookForAt(LOOK_STRUCTURES,this.resource),function(a){return a.structureType===
STRUCTURE_CONTAINER&&a.store[RESOURCE_ENERGY]});0<b.length&&(new m(b[0].id)).canAssign(a)}}else delete a.memory.currentTask};a.fromObj=function(b){return new a(b.memory.currentTask.id)};a.prototype.toObj=function(a){this.resource?a.memory.currentTask={type:this.type,id:this.resource.id}:delete a.memory.currentTask};a.getTasks=function(b){return _.map(b.find(FIND_DROPPED_RESOURCES).sort(function(a,b){return b.amount-a.amount}),function(b){return new a(b.id)})};Memory.profiling&&c(2,47).registerObject(a,
"TaskPickupResource");q.exports=a;return q.exports};v[48]=function(q,t){var g=c(4,48),m=c(60,48),e=function(a){this.init(a)};e.prototype.init=function(){this.type="attack"};e.prototype.canAssign=function(a){var b=a.room.controller;if(a.spawning||"converter"!==a.memory.role||!b||0===b.level||0===a.getActiveBodyparts(CLAIM))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){a.room.controller&&0!==a.room.controller.level&&0!==!a.getActiveBodyparts(CLAIM)?(m.moveTo(a,
a.room.controller,1),a.attackController(a.room.controller)):delete a.memory.currentTask};e.prototype.toObj=function(a){a.room.controller?a.memory.currentTask={type:this.type}:delete a.memory.currentTask};e.fromObj=function(a){return new e};e.getTask=function(a){if(a.room.controller)return new e};Memory.profiling&&c(2,48).registerObject(e,"TaskAttack");q.exports=e;return q.exports};v[49]=function(q,t){var g=c(4,49),m=c(60,49),e=function(a){this.init(a)};e.prototype.init=function(a){this.type="build";
this.id=a;this.constructionSite=Game.getObjectById(a);this.force=!0};e.prototype.canAssign=function(a){if(a.spawning||!a.carry[RESOURCE_ENERGY]||0===a.getActiveBodyparts(WORK))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){var b=this.constructionSite;a.carry[RESOURCE_ENERGY]&&b&&0!==a.getActiveBodyparts(WORK)?(m.moveTo(a,b,Math.max(Math.min(a.pos.getRangeTo(b)-1,3),1)),a.build(b,RESOURCE_ENERGY)===OK&&(Math.min(5*a.getActiveBodyparts(WORK),a.carry[RESOURCE_ENERGY])>=
b.progressTotal-b.progress||a.carry[RESOURCE_ENERGY]<=Math.min(5*a.getActiveBodyparts(WORK)))&&delete a.memory.currentTask):delete a.memory.currentTask};e.prototype.toObj=function(a){this.constructionSite?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};e.fromObj=function(a){return new e(a.memory.currentTask.id)};e.getTasks=function(a){return _.map(a.find(FIND_MY_CONSTRUCTION_SITES),function(a){return new e(a.id)})};Memory.profiling&&c(2,49).registerObject(e,"TaskBuild");
q.exports=e;return q.exports};v[50]=function(q,t){var g=c(4,50),m=c(60,50),e=function(a){this.init(a)};e.prototype.init=function(a){this.type="repair";this.id=a;this.structure=Game.getObjectById(a);this.force=!0};e.prototype.canAssign=function(a){if(a.spawning||!a.carry[RESOURCE_ENERGY]||0===a.carry[RESOURCE_ENERGY]||0===a.getActiveBodyparts(WORK)||1E6<=this.structure.hits&&"worker"===a.memory.role&&a.room.name===a.memory.home&&8>a.room.controller.level&&!_.find(a.body,function(a){return a.type===
WORK&&-1!==[RESOURCE_CATALYZED_LEMERGIUM_ACID,RESOURCE_LEMERGIUM_ACID,RESOURCE_LEMERGIUM_HYDRIDE].indexOf(a.boost)}))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){var b=this.structure;a.carry[RESOURCE_ENERGY]&&b&&b.hits!==b.hitsMax&&0!==a.getActiveBodyparts(WORK)?(m.moveTo(a,b,Math.max(Math.min(a.pos.getRangeTo(b)-1,3),1)),a.repair(b)===OK&&100*Math.min(a.getActiveBodyparts(WORK),a.carry[RESOURCE_ENERGY])>=b.hitsMax-b.hits&&delete a.memory.currentTask):delete a.memory.currentTask};
e.prototype.toObj=function(a){this.structure?a.memory.currentTask={type:this.type,id:this.structure.id}:delete a.memory.currentTask};e.fromObj=function(a){return new e(a.memory.currentTask.id)};e.getTowerTasks=function(a){return _.map(_.take(_.filter(g.sortedRepairableStructuresInRoom(a),function(a){return 1E4>a.hits&&.25>a.hits/a.hitsMax}),5),function(a){return new e(a.id)})};e.getCriticalTasks=function(a){return _.map(_.take(_.filter(g.sortedRepairableStructuresInRoom(a),function(a){return 125E3>
a.hits&&.5>a.hits/a.hitsMax}),5),function(a){return new e(a.id)})};e.getTasks=function(a){return _.map(_.take(_.filter(g.sortedRepairableStructuresInRoom(a),function(a){return.9>a.hits/a.hitsMax||1E5<a.hitsMax-a.hits}),5),function(a){return new e(a.id)})};Memory.profiling&&c(2,50).registerObject(e,"TaskRepair");q.exports=e;return q.exports};v[51]=function(q,t){var g=c(4,51),m=c(60,51),e=c(11,51),a=function(a){this.init(a)};a.prototype.init=function(a){this.type="mine";this.id=a;this.source=Game.getObjectById(a)};
a.prototype.canAssign=function(a){var b=Game.getObjectById(a.memory.container);if(a.spawning||!b||0===a.getActiveBodyparts(WORK))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){var b=Game.getObjectById(a.memory.container),c;b?(b.pos.x===a.pos.x&&b.pos.y===a.pos.y&&b.pos.roomName===a.pos.roomName||m.moveTo(a,b,0),b.pos.x===a.pos.x&&b.pos.y===a.pos.y&&b.pos.roomName===a.pos.roomName&&(this.source?c=this.source:(c=Memory.containerSource[a.memory.container]?Game.getObjectById(Memory.containerSource[a.memory.container]):
e.objectsClosestToObj([].concat.apply([],[b.room.find(FIND_SOURCES),b.room.find(FIND_MINERALS)]),a)[0],this.id=c.id),c instanceof Mineral&&0===c.mineralAmount&&(a.say(":(",!0),a.suicide()),c instanceof Mineral&&1500<=_.sum(b.store)||(a.harvest(c)===OK&&(void 0===Memory.rooms[a.room.name].harvested&&(Memory.rooms[a.room.name].harvested=3E4),Memory.rooms[a.room.name].harvested+=2*a.getActiveBodyparts(WORK)),0<_.filter([].concat.apply([],[g.creeps[a.room.name]&&g.creeps[a.room.name].miner||[],g.creeps[a.room.name]&&
g.creeps[a.room.name].remoteMiner||[]]),function(b){return b.room.name===a.room.name&&b.memory.container===a.memory.container&&1===b.pos.getRangeTo(a)&&b.ticksToLive>a.ticksToLive&&0===b.fatigue}).length&&(a.say(":(",!0),a.suicide())))):delete a.memory.currentTask};a.prototype.toObj=function(a){a.memory.currentTask={type:this.type,id:this.id}};a.fromObj=function(b){return new a(b.memory.currentTask.id)};Memory.profiling&&c(2,51).registerObject(a,"TaskMine");q.exports=a;return q.exports};v[52]=function(q,
t){var g=c(4,52),m=c(60,52),e=function(a){this.init(a)};e.prototype.init=function(a){this.type="reserve";this.force=!0};e.prototype.canAssign=function(a){if(a.spawning||0===a.getActiveBodyparts(CLAIM)||!Game.rooms[a.memory.home]||!Game.rooms[a.memory.home].controller||Game.rooms[a.memory.home].controller.my)return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){a.say("You;spin;me;right;round;baby;right;round;like a;record;baby;right;round;round;round;".split(";")[Game.time%
16],!0);Game.rooms[a.memory.home]&&Game.rooms[a.memory.home].controller&&!Game.rooms[a.memory.home].controller.my&&0!==a.getActiveBodyparts(CLAIM)?(m.moveTo(a,Game.rooms[a.memory.home].controller,1),a.reserveController(Game.rooms[a.memory.home].controller),!Memory.signs||!Memory.signs[a.room.name]||a.room.controller.sign&&"roncli"===a.room.controller.sign.username||a.signController(a.room.controller,Memory.signs[a.room.name])):delete a.memory.currentTask};e.prototype.toObj=function(a){a.memory.currentTask=
{type:this.type}};e.fromObj=function(a){return new e};e.getTask=function(a){if(a.room.controller)return new e};e.getRemoteTask=function(a){if(Game.rooms[a.memory.home]&&Game.rooms[a.memory.home].controller)return new e};Memory.profiling&&c(2,52).registerObject(e,"TaskReserve");q.exports=e;return q.exports};v[53]=function(q,t){var g=c(4,53),m=c(60,53),e=function(a){this.init(a)};e.prototype.init=function(a){this.type="collectEnergy";this.id=a;this.object=Game.getObjectById(a)};e.prototype.canAssign=
function(a){var b=this.object;if(a.spawning||150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||!b||0===(b.energy||b.store&&b.store[RESOURCE_ENERGY]||0))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){var b=this.object,c,e;150>a.ticksToLive||!b?delete a.memory.currentTask:(c=b.energy||b.store&&b.store[RESOURCE_ENERGY]||0,_.sum(a.carry)===a.carryCapacity||0===c?delete a.memory.currentTask:(m.moveTo(a,b,1),1===a.pos.getRangeTo(b)&&0<(e=_.filter(b.pos.lookFor(LOOK_RESOURCES),
function(a){return 50<a.amount})).length?a.pickup(e[0]):a.withdraw(b,RESOURCE_ENERGY)===OK&&delete a.memory.currentTask))};e.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};e.fromObj=function(a){return new e(a.memory.currentTask.id)};e.getTasks=function(a){var b=_.filter(a.find(FIND_HOSTILE_STRUCTURES),function(a){return(0<a.energy||a.store&&0<a.store[RESOURCE_ENERGY])&&a.structureType!==STRUCTURE_NUKER});return 0<b.length?_.map(b,
function(a){return new e(a.id)}):a.storage&&0<a.storage.store[RESOURCE_ENERGY]?[new e(a.storage.id)]:_.map(_.filter(g.containersInRoom(a),function(a){return 500<=a.store[RESOURCE_ENERGY]}).sort(function(a,b){return b.store[RESOURCE_ENERGY]-a.store[RESOURCE_ENERGY]}),function(a){return new e(a.id)})};e.getStorerTasks=function(a){return _.map(_.filter(g.containersInRoom(a),function(a){return a.store[RESOURCE_ENERGY]&&500<=a.store[RESOURCE_ENERGY]}),function(a){return new e(a.id)})};e.getCleanupTasks=
function(a){return _.map(_.filter(a,function(a){return a.energy||a.store&&a.store[RESOURCE_ENERGY]}).sort(function(a,c){return(a.energy||a.store[RESOURCE_ENERGY])-(c.energy||c.store[RESOURCE_ENERGY])}),function(a){return new e(a.id)})};Memory.profiling&&c(2,53).registerObject(e,"TaskCollectEnergy");q.exports=e;return q.exports};v[54]=function(q,t){var g=c(4,54),m=c(60,54),e=c(11,54),a=function(a,c,e){this.init(a,c,e)};a.prototype.init=function(a,c,e){this.type="collectMinerals";this.id=a;this.resource=
c;this.amount=e;this.object=Game.getObjectById(a)};a.prototype.canAssign=function(a){var b=this.object;if(0>this.amount||a.spawning||150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||this.resource&&this.amount&&(b.structureType===STRUCTURE_LAB&&b.mineralType!==this.resource&&b.mineralAmount<this.amount||b.structureType!==STRUCTURE_LAB&&(b.store[this.resource]||0)<this.amount))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){var b=this.object,c=this.resource,
d=a.carry,e=a.carryCapacity,g=this.amount,h;if(0>g||150>a.ticksToLive||!b)delete a.memory.currentTask;else if(h=b.store,_.sum(a.carry)===a.carryCapacity)delete a.memory.currentTask;else{if(b.structureType===STRUCTURE_LAB){if(null===b.mineralType){delete a.memory.currentTask;return}c=[b.mineralType]}else c=c?[c]:_.filter(_.keys(h),function(a){return a!==RESOURCE_ENERGY&&0<h[a]});0===c.length?delete a.memory.currentTask:(m.moveTo(a,b,1),g?a.withdraw(b,c[0],Math.min(g,e-_.sum(d)))===OK&&delete a.memory.currentTask:
a.withdraw(b,c[0])===OK&&delete a.memory.currentTask)}};a.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id,resource:this.resource,amount:this.amount}:delete a.memory.currentTask};a.fromObj=function(b){return new a(b.memory.currentTask.id,b.memory.currentTask.resource,b.memory.currentTask.amount)};a.getStorerTasks=function(b){return _.map(_.filter(g.containersInRoom(b),function(a){return 0<_.filter(_.keys(a.store),function(b){return b!==RESOURCE_ENERGY&&500<=
a.store[b]}).length}).sort(function(a,b){return _.sum(b.store)-_.sum(a.store)}),function(b){return new a(b.id)})};a.getCleanupTasks=function(b){return _.map(_.filter(b,function(a){return(a.store||-1!==[STRUCTURE_LAB,STRUCTURE_NUKER,STRUCTURE_POWER_SPAWN].indexOf(a.structureType))&&(0<_.sum(a.store)&&a.store[RESOURCE_ENERGY]<_.sum(a.store)||0<a.mineralAmount||0<a.ghodium||0<a.power)}).sort(function(a,b){return(a.mineralAmount||a.ghodium||a.power||_.sum(a.store)-a.store[RESOURCE_ENERGY])-(b.mineralAmount||
b.ghodium||b.power||_.sum(b.store)-b.store[RESOURCE_ENERGY])}),function(b){return new a(b.id)})};a.getLabTasks=function(b){var c=b.memory,m=c.labsInUse,d=c.labQueue,c=b.storage,r=g.labsInRoom(b),p=[],h,k;d&&(h=d.status,k=d.sourceLabs);m&&(_.forEach(m,function(b){Game.creeps[b.creepToBoost]||p.push(new a(b.id))}),_.forEach(p,function(a){_.remove(m,function(b){return b.id===a.id})}));c&&d&&"clearing"===h&&_.forEach(_.filter(r,function(a){return-1===_.map(m,function(a){return a.id}).indexOf(a.id)&&0<
a.mineralAmount}),function(b){p.push(new a(b.id))});c&&m&&_.forEach(_.filter(m,function(a){return(!a.status||"emptying"===a.status)&&Game.getObjectById(a.id).mineralType&&Game.getObjectById(a.id).mineralType!==a.resource}),function(b){p.push(new a(b.id))});c&&d&&"creating"===h&&!e.roomLabsArePaused(b)&&(0===Game.getObjectById(k[0]).mineralAmount&&0!==Game.getObjectById(k[1]).mineralAmount&&p.push(new a(k[1])),0!==Game.getObjectById(k[0]).mineralAmount&&0===Game.getObjectById(k[1]).mineralAmount&&
p.push(new a(k[0])));c&&d&&"returning"===h&&_.forEach(_.filter(r,function(a){return a.mineralType===d.resource}),function(b){p.push(new a(b.id))});return p};a.getStorageTasks=function(b){var c=[],m;b.controller&&6<=b.controller.level&&(b.storage&&b.memory.labsInUse&&_.forEach(_.filter(b.memory.labsInUse,function(a){return(!a.status||-1!==["filling","refilling"].indexOf(a.status))&&(!Game.getObjectById(a.id).mineralType||Game.getObjectById(a.id).mineralType===("refilling"===a.status?a.oldResource:
a.resource))}),function(d){0<("refilling"===d.status?d.oldAmount-Game.getObjectById(d.id).mineralAmount:d.amount-Game.getObjectById(d.id).mineralAmount)&&c.push(new a(b.storage.id,"refilling"===d.status?d.oldResource:d.resource,"refilling"===d.status?d.oldAmount-Game.getObjectById(d.id).mineralAmount:d.amount-Game.getObjectById(d.id).mineralAmount))}),b.storage&&b.memory.labQueue&&"moving"===b.memory.labQueue.status&&3<=g.labsInRoom(b).length&&!e.roomLabsArePaused(b)&&_.forEach(b.memory.labQueue.children,
function(d){(m=_.sum(_.filter(g.labsInRoom(b),function(a){return a.mineralType===d}),function(a){return a.mineralAmount}))<b.memory.labQueue.amount&&c.push(new a(b.storage.id,d,b.memory.labQueue.amount-m))}),b.storage&&b.terminal&&Memory.reserveMinerals&&_.forEach(b.storage.store,function(d,f){f!==RESOURCE_ENERGY&&(Memory.reserveMinerals[f]?(f.startsWith("X")&&5===f.length?Memory.reserveMinerals[f]-5E3:Memory.reserveMinerals[f])<d&&c.push(new a(b.storage.id,f,d-(f.startsWith("X")&&5===f.length?Memory.reserveMinerals[f]-
5E3:Memory.reserveMinerals[f]))):c.push(new a(b.storage.id,f,d)))}),8<=b.controller.level&&(_.forEach(g.nukersInRoom(b),function(d){d.ghodium<d.ghodiumCapacity&&c.push(new a(b.storage.id,RESOURCE_GHODIUM,d.ghodiumCapacity-d.ghodium))}),_.forEach(g.powerSpawnsInRoom(b),function(d){d.power<d.powerCapacity&&c.push(new a(b.storage.id,RESOURCE_POWER,d.powerCapacity-d.power))})));return c};a.getTerminalTasks=function(b){var c=[];b.storage&&b.terminal&&Memory.reserveMinerals&&_.forEach(b.terminal.store,
function(f,d){d!==RESOURCE_ENERGY&&Memory.reserveMinerals[d]&&(b.storage.store[d]?b.storage.store[d]<(d.startsWith("X")&&5===d.length?Memory.reserveMinerals[d]-5E3:Memory.reserveMinerals[d])&&c.push(new a(b.terminal.id,d,Math.min(f,(d.startsWith("X")&&5===d.length?Memory.reserveMinerals[d]-5E3:Memory.reserveMinerals[d])-b.storage.store[d]))):c.push(new a(b.terminal.id,d,Math.min(f,d.startsWith("X")&&5===d.length?Memory.reserveMinerals[d]-5E3:Memory.reserveMinerals[d]))))});return c};Memory.profiling&&
c(2,54).registerObject(a,"TaskCollectMinerals");q.exports=a;return q.exports};v[55]=function(c,t){c.exports=function(){};return c.exports};v[56]=function(q,t){var g=c(4,56),m=c(60,56),e=c(11,56),a=function(a){this.init(a)};a.prototype.init=function(a){this.type="fillEnergy";this.id=a;this.object=Game.getObjectById(a)};a.prototype.canAssign=function(a){var b;if(a.spawning||!a.carry[RESOURCE_ENERGY]||this.object.energyCapacity&&this.object.energy===this.object.energyCapacity)return!1;if(this.object.structureType===
STRUCTURE_EXTENSION){switch(this.object.room.controller.level){case 7:b=100;break;case 8:b=200;break;default:b=50}if(a.carry[RESOURCE_ENERGY]<b)return!1}g.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){var b=this.object;b&&(b.energy||_.sum(b.store))!==(b.energyCapacity||b.storeCapacity)?b&&a.carry[RESOURCE_ENERGY]?(m.moveTo(a,b,1),a.transfer(b,RESOURCE_ENERGY)===OK&&delete a.memory.currentTask):delete a.memory.currentTask:delete a.memory.currentTask};a.prototype.toObj=
function(a){this.object?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};a.fromObj=function(b){return new a(b.memory.currentTask.id)};a.getExtensionTasks=function(b){return _.map(_.filter(g.extensionsInRoom(b),function(a){return a.energy<a.energyCapacity}),function(b){return new a(b.id)})};a.getSpawnTasks=function(b){return _.map(_.filter(g.spawnsInRoom(b),function(a){return a.energy<a.energyCapacity}),function(b){return new a(b.id)})};a.getTowerTasks=function(b){return _.map(_.filter(g.towersInRoom(b),
function(a){return.8>a.energy/a.energyCapacity}).sort(function(a,b){return a.energy-b.energy}),function(b){return new a(b.id)})};a.getLabTasks=function(b){return _.map(_.filter(g.labsInRoom(b),function(a){return a.energy<a.energyCapacity}),function(b){return new a(b.id)})};a.getContainerTasks=function(b){var c=_.filter(g.containersInRoom(b),function(a){return _.sum(a.store)<a.storeCapacity});b.storage&&b.storage.my&&_.sum(b.storage.store)<b.storage.storeCapacity&&c.unshift(b.storage);return _.map(c,
function(b){return new a(b.id)})};a.getStorageTasks=function(b){return b.storage&&b.storage.my&&_.sum(b.storage.store)<b.storage.storeCapacity?[new a(b.storage.id)]:[]};a.getLinkTasks=function(b){var c=g.linksInRoom(b);b=g.spawnsInRoom(b);if(0===c.length||0===b.length)return[];c=e.objectsClosestToObj(c,b[0]);return[new a(c[0].id)]};a.getNukerTasks=function(b){b=g.nukersInRoom(b);return 0===b.length?[]:[new a(b[0].id)]};a.getPowerSpawnTasks=function(b){b=g.powerSpawnsInRoom(b);return 0===b.length?
[]:[new a(b[0].id)]};Memory.profiling&&c(2,56).registerObject(a,"TaskFillEnergy");q.exports=a;return q.exports};v[57]=function(q,t){var g=c(4,57),m=c(60,57),e=c(11,57),a=function(a,c){this.init(a,c)};a.prototype.init=function(a,c){this.type="fillMinerals";this.id=a;this.resources=c;this.object=Game.getObjectById(a)};a.prototype.canAssign=function(a){if(a.spawning||_.sum(a.carry)===a.carry[RESOURCE_ENERGY]||this.resources&&0===_.intersection(_.keys(this.resources),_.filter(_.keys(a.carry),function(b){return b!==
RESOURCE_ENERGY&&a.carry[b]})).length||this.object.structureType===STRUCTURE_NUKER&&this.object.ghodium===this.object.ghodiumCapacity||this.object.structureType===STRUCTURE_POWER_SPAWN&&this.object.power===this.object.powerCapacity)return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){var b=this,c=this.object,d;if(c){if(c.storeCapacity&&0===_.filter(_.keys(a.carry),function(b){return b!==RESOURCE_ENERGY&&0<a.carry[b]}).length||(_.sum(c.store)||0)===c.storeCapacity)return delete a.memory.currentTask,
!0;this.resources?(d=_.intersection(_.keys(this.resources),_.filter(_.keys(a.carry),function(b){return a.carry[b]})).sort(function(a,c){a=b.resources[a];c=b.resources[c];return a===c?0:null===a?1:null===c?-1:a-c}),0===d.length?delete a.memory.currentTask:(m.moveTo(a,c,1),a.transfer(c,d[0],null!==this.resources[d[0]]?Math.min(this.resources[d[0]],a.carry[d[0]]):void 0)===OK&&1===d.length&&delete a.memory.currentTask)):(d=_.filter(_.keys(a.carry),function(b){return b!==RESOURCE_ENERGY&&0<a.carry[b]}),
0===d.length?delete a.memory.currentTask:(m.moveTo(a,c,1),a.transfer(c,d[0])===OK&&0===_.filter(_.keys(a.carry),function(b){return b!==RESOURCE_ENERGY&&0<a.carry[b]}).length&&delete a.memory.currentTask))}else delete a.memory.currentTask};a.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id,resources:this.resources}:delete a.memory.currentTask};a.fromObj=function(b){return new a(b.memory.currentTask.id,b.memory.currentTask.resources)};a.getLabTasks=function(b){var c,
m=[];_.forEach(_.filter(b.memory.labsInUse,function(a){return(!a.status||-1!==["filling","refilling"].indexOf(a.status))&&(!Game.getObjectById(a.id).mineralType||Game.getObjectById(a.id).mineralType===("refilling"===a.status?a.oldResource:a.resource))&&Game.getObjectById(a.id).mineralAmount<("refilling"===a.status?a.oldAmount:a.amount)}),function(b){c={};c["refilling"===b.status?b.oldResource:b.resource]=("refilling"===b.status?b.oldAmount:b.amount)-Game.getObjectById(b.id).mineralAmount;m.push(new a(b.id,
c))});b.storage&&3<=g.labsInRoom(b).length&&b.memory.labQueue&&"moving"===b.memory.labQueue.status&&!e.roomLabsArePaused(b)&&(Game.getObjectById(b.memory.labQueue.sourceLabs[0]).mineralAmount<b.memory.labQueue.amount&&(c={},c[b.memory.labQueue.children[0]]=b.memory.labQueue.amount-Game.getObjectById(b.memory.labQueue.sourceLabs[0]).mineralAmount,m.push(new a(b.memory.labQueue.sourceLabs[0],c))),Game.getObjectById(b.memory.labQueue.sourceLabs[1]).mineralAmount<b.memory.labQueue.amount&&(c={},c[b.memory.labQueue.children[1]]=
b.memory.labQueue.amount-Game.getObjectById(b.memory.labQueue.sourceLabs[1]).mineralAmount,m.push(new a(b.memory.labQueue.sourceLabs[1],c))));return m};a.getStorageTasks=function(b){var c=b.storage,e,d;if(c&&c.my&&(!b.terminal||!b.terminal.my))return[new a(c.id)];if(c&&c.my&&_.sum(e=c.store)<c.storeCapacity&&Memory.reserveMinerals)return d={},_.forEach(_.keys(Memory.reserveMinerals),function(a){var b=(a.startsWith("X")&&5===a.length?Memory.reserveMinerals[a]-5E3:Memory.reserveMinerals[a])-(e[a]||
0);0<b&&(d[a]=b)}),[new a(c.id,d)]};a.getTerminalTasks=function(b){return b.terminal&&b.terminal.my&&_.sum(b.terminal.store)<b.terminal.storeCapacity?[new a(b.terminal.id)]:[]};a.getNukerTasks=function(b){b=g.nukersInRoom(b);var c;if(0===b.length)return[];c={};c[RESOURCE_GHODIUM]=b[0].ghodiumCapacity-b[0].ghodium;return 0>=c[RESOURCE_GHODIUM]?[]:[new a(b[0].id,c)]};a.getPowerSpawnTasks=function(b){b=g.powerSpawnsInRoom(b);var c;if(0===b.length)return[];c={};c[RESOURCE_POWER]=b[0].powerCapacity-b[0].power;
return 0>=c[RESOURCE_POWER]?[]:[new a(b[0].id,c)]};Memory.profiling&&c(2,57).registerObject(a,"TaskFillMinerals");q.exports=a;return q.exports};v[58]=function(q,t){var g=c(4,58),m=c(60,58),e=c(11,58),a=function(a){this.init(a)};a.prototype.init=function(a){this.type="upgradeController";this.room=a;this.controller=Game.rooms[a].controller;this.force=!0};a.prototype.canAssign=function(a){if(a.spawning||!a.carry[RESOURCE_ENERGY]||"upgrader"!==a.memory.role&&_.sum(a.carry)!==a.carryCapacity&&150<=a.ticksToLive&&
1E3<=this.controller.ticksToDowngrade||0===a.getActiveBodyparts(WORK))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){a.say("I've;got to;celebrate;you baby;I've got;to praise;GCL like;I should!;".split(";")[Game.time%9],!0);if(this.controller&&a.carry[RESOURCE_ENERGY]&&0!==a.getActiveBodyparts(WORK)){if("upgrader"===a.memory.role){var b=e.objectsClosestToObj(g.linksInRoom(a.room),a);0<b.length&&0<b[0].energy&&1>=a.pos.getRangeTo(b[0])&&a.withdraw(b[0],RESOURCE_ENERGY)}m.moveTo(a,
this.controller,Math.max(Math.min(a.pos.getRangeTo(this.controller)-1,3),1));a.transfer(this.controller,RESOURCE_ENERGY);!Memory.signs||!Memory.signs[a.room.name]||this.controller.sign&&"roncli"===this.controller.sign.username||a.signController(this.controller,Memory.signs[a.room.name]);a.carry[RESOURCE_ENERGY]<=a.getActiveBodyparts(WORK)&&delete a.memory.currentTask}else delete a.memory.currentTask};a.prototype.toObj=function(a){a.memory.currentTask={type:this.type,room:this.room}};a.fromObj=function(b){return new a(b.memory.currentTask.room)};
a.getCriticalTasks=function(b){var c;if(b.controller&&b.controller.my){switch(b.controller.level){case 1:c=1E4;break;case 2:c=3500;break;case 3:c=5E3;break;case 4:c=1E4;break;case 5:c=2E4;break;case 6:c=3E4;break;case 7:c=5E4;break;case 8:c=1E5}if(b.controller.ticksToDowngrade<c)return[new a(b.name)]}return[]};a.getTasks=function(b){if(b.controller&&b.controller.my)return[new a(b.name)]};Memory.profiling&&c(2,58).registerObject(a,"TaskUpgradeController");q.exports=a;return q.exports};v[59]=function(q,
t){var g=c(55,59),m=c(4,59),e=c(5,59),a=c(11,59),b=c(19,59),f=c(20,59),u=c(21,59),d=c(23,59),r=c(24,59),p=c(26,59),h=c(28,59),k=c(29,59),l=c(49,59),n=c(44,59),w=c(56,59),v=c(57,59),A=function(a,b){this.init(a,b)};A.prototype=Object.create(g.prototype);A.prototype.constructor=A;A.prototype.init=function(a,b){g.call(this);this.type="source";this.supportRoom=a;this.stage=b||1};A.prototype.stage1Tasks=function(a,b){b={fillEnergy:{storageTasks:w.getStorageTasks(b),containerTasks:w.getContainerTasks(b)},
fillMinerals:{storageTasks:v.getStorageTasks(b),terminalTasks:v.getTerminalTasks(b)},dismantle:{tasks:[]}};a.unobservable||(b.build={tasks:l.getTasks(a)});return b};A.prototype.stage1Spawn=function(a){var c=a.name;b.checkSpawn(a);u.checkSpawn(a);m.creeps[c]&&m.creeps[c].defender&&0!==_.filter(m.creeps[c].defender,function(a){return!a.spawning}).length&&d.checkSpawn(a)};A.prototype.stage1AssignTasks=function(a,c){b.assignTasks(a,c);u.assignTasks(a,c);d.assignTasks(a);p.assignTasks(a,c);k.assignTasks(a,
c);h.assignTasks(a,c);r.assignTasks(a,c);f.assignTasks(a,c)};A.prototype.stage1Manage=function(b,c){var d=c.name,f,g,h,k;b.unobservable||(f=[].concat.apply([],[b.find(FIND_SOURCES),b.find(FIND_MINERALS)]),g=m.containersInRoom(b),h=b.name,g.length===f.length?(this.stage=2,_.forEach(g,function(c){var d=a.objectsClosestToObj([].concat.apply([],[f,b.find(FIND_MINERALS)]),c)[0];if(!(d instanceof Mineral))return _.forEach(m.creeps[h]&&m.creeps[h].remoteBuilder||[],function(b){b.memory.role="remoteWorker";
b.memory.container=a.objectsClosestToObj(g,d)[0].id}),!1})):(k=b.find(FIND_MY_CONSTRUCTION_SITES),0===k.length&&_.forEach(f,function(a){var d=PathFinder.search(a.pos,{pos:m.spawnsInRoom(c)[0].pos,range:1},{swampCost:1}).path[0];0===_.filter(d.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&0===_.filter(k,function(a){return a.pos.x===d.x&&a.pos.y===d.y&&a.structureType===STRUCTURE_CONTAINER}).length&&b.createConstructionSite(d.x,d.y,STRUCTURE_CONTAINER)}),
0<_.filter(m.hostilesInRoom(b),function(a){return a.owner&&"Invader"===a.owner.username}).length?Memory.army[h+"-defense"]||e.createArmy(h+"-defense",{reinforce:!1,region:b.memory.region,boostRoom:void 0,buildRoom:d,stageRoom:d,attackRoom:h,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:2,units:17},melee:{maxCreeps:2,units:20},ranged:{maxCreeps:0,units:20}}):Memory.army[h+"-defense"]&&(Memory.army[h+"-defense"].directive="attack",Memory.army[h+"-defense"].success=!0)))};A.prototype.stage1=
function(a,b){var c=this.stage1Tasks(a,b);this.stage1Spawn(a);this.stage1AssignTasks(a,c);this.stage1Manage(a,b)};A.prototype.stage2Manage=function(a,b){var c=a.name;b=b.name;var d=m.creeps[c];a.unobservable?0===(d&&d.remoteMiner||[]).length&&0===(d&&d.remoteWorker||[]).length&&0===(d&&d.remoteStorer||[]).length&&(this.stage=1):(d=[].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),m.containersInRoom(a).length!==d.length&&(this.stage=1),0<_.filter(m.hostilesInRoom(a),function(a){return a.owner&&
"Invader"===a.owner.username}).length?Memory.army[c+"-defense"]||e.createArmy(c+"-defense",{reinforce:!1,region:a.memory.region,boostRoom:void 0,buildRoom:b,stageRoom:b,attackRoom:c,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:2,units:17},melee:{maxCreeps:2,units:20},ranged:{maxCreeps:0,units:20}}):Memory.army[c+"-defense"]&&(Memory.army[c+"-defense"].directive="attack",Memory.army[c+"-defense"].success=!0))};A.prototype.stage2Spawn=function(a,c){var d=a.name,e=Memory.dismantle;
b.checkSpawn(a);u.checkSpawn(a);m.creeps[d]&&m.creeps[d].defender&&0!==_.filter(m.creeps[d].defender,function(a){return!a.spawning}).length&&(p.checkSpawn(a),k.checkSpawn(a),h.checkSpawn(a),r.checkSpawn(a,c),e&&e[d]&&0<e[d].length&&f.checkSpawn(a,c))};A.prototype.stage2Tasks=function(b,c){var d=b.name,e=0<a.creepsWithNoTask(m.creeps[d]&&m.creeps[d].remoteWorker||[]).length||0<a.creepsWithNoTask(m.creeps[d]&&m.creeps[d].remoteStorer||[]).length||0<a.creepsWithNoTask(m.creeps[d]&&m.creeps[d].remoteDismantler||
[]).length;tasks={fillEnergy:{storageTasks:e?w.getStorageTasks(c):[],containerTasks:e?w.getContainerTasks(c):[]},fillMinerals:{storageTasks:e?v.getStorageTasks(c):[],terminalTasks:e?v.getTerminalTasks(c):[]}};if(!b.unobservable){var f=Memory.dismantle;tasks.dismantle={tasks:[]};if(f&&f[d]&&0<f[d].length){var g=[];_.forEach(f[d],function(a){var c=b.lookForAt(LOOK_STRUCTURES,a.x,a.y);0===c.length?g.push(a):tasks.dismantle.tasks=tasks.dismantle.tasks.concat(_.map(c,function(a){return new n(a.id)}))});
_.forEach(g,function(a){_.remove(f[d],function(b){return b.x===a.x&&b.y===a.y})})}else _.forEach(m.creeps[d]&&m.creeps[d].dismantler||[],function(a){a.memory.role="remoteWorker";a.memory.container=m.containersInRoom(b)[0].id})}return tasks};A.prototype.stage2AssignTasks=function(a,c){b.assignTasks(a,c);u.assignTasks(a,c);p.assignTasks(a,c);k.assignTasks(a,c);h.assignTasks(a,c);r.assignTasks(a,c);f.assignTasks(a,c)};A.prototype.stage2=function(a,b){this.stage2Manage(a,b);1!==this.stage&&(a.unobservable||
this.stage2Spawn(a,b),b=this.stage2Tasks(a,b),this.stage2AssignTasks(a,b))};A.prototype.run=function(a){var b;if(a.unobservable||0!==a.find(FIND_SOURCES).length)if(b=Game.rooms[Memory.rooms[a.name].roomType.supportRoom])a.controller&&a.controller.my?this.convert(a,b):(1===this.stage&&this.stage1(a,b),2===this.stage&&this.stage2(a,b))};A.prototype.toObj=function(a){Memory.rooms[a.name].roomType={type:this.type,supportRoom:this.supportRoom,stage:this.stage}};A.fromObj=function(a){return new A(a.roomType.supportRoom,
a.roomType.stage)};Memory.profiling&&c(2,59).registerObject(A,"RoomSource");q.exports=A;return q.exports};v[60]=function(q,t){var g={1:{dx:0,dy:-1},2:{dx:1,dy:-1},3:{dx:1,dy:0},4:{dx:1,dy:1},5:{dx:0,dy:1},6:{dx:-1,dy:1},7:{dx:-1,dy:0},8:{dx:-1,dy:-1}},m=c(4,60),e=c(10,60),a={moveTo:function(b,c,e){b.memory._pathing=a.move(b,c,e)},move:function(b,c,q){var d=b.memory._pathing,f=[],p=b.pos,h=p.x,k=p.y,l=p.roomName,n=Game.time,t,u,v,y,z;c instanceof RoomObject&&(c=c.pos);t=c.x;u=c.y;v=c.roomName;q||(q=
0);if(!(p.getRangeTo(c)<=q)){!d||d.dest.x===t&&d.dest.y===u&&d.dest.room===v||(d=void 0);d&&d.restartOn&&-1!==d.restartOn.indexOf(l)&&(delete d.path,delete d.restartOn);d&&((y=h===d.start.x&&k===d.start.y&&l===d.start.room||(49===Math.abs(h-d.start.x)||49===Math.abs(k-d.start.y))&&l!==d.start.room,d.stationary=y?d.stationary+1:0,2<=d.stationary)?(d.path&&0<d.path.length&&(y=g[+d.path[0]],y={x:h+y.dx,y:k+y.dy,room:l,blockedUntil:n+12},y.x!==h||y.y!==k)&&(d.blocked||(d.blocked=[]),d.blocked.push(y)),
delete d.path,delete d.restartOn):d.path&&!y&&(1===d.path.length?d=void 0:(d.start={x:h,y:k,room:l},d.path=d.path.substring(1))));if(!d||!d.path)if(y=b.getActiveBodyparts(MOVE),new e(4),z=1+(_.filter(b.body,function(a){return 0<a.hits&&-1===[MOVE,CARRY].indexOf(a.type)}).length+Math.ceil(_.sum(b.carry)/50)-y)/y,d&&d.blocked&&_.remove(d.blocked,function(a){return a.blockedUntil<=n}),y=l+"."+h+"."+k+"."+v+"."+t+"."+u+"."+q+"."+(1>=z?"0":"1"),d&&0!==d.blocked.length||!Memory.paths[y]){c=PathFinder.search(p,
{pos:c,range:q},{plainCost:Math.ceil(1*z),swampCost:Math.ceil(5*z),maxOps:l===v?2E3:1E5,roomCallback:function(a){var c=Game.rooms[a],e;if(l!==a&&(-1!==Memory.avoidRooms.indexOf(a)||l===v&&a!==v&&!b.memory.role.startsWith("remote")&&!b.memory.role.startsWith("army")))return!1;if(c)return e=m.getCostMatrix(c),d&&a===l&&_.forEach(d.blocked,function(b){a===b.room&&n<b.blockedUntil&&e.set(b.x,b.y,255)}),e;f.push(a)}});if(!c.path||0===c.path.length)return;d?(d.path=a.serializePath(p,c.path),d.restartOn=
f):d={start:{x:h,y:k,room:l},dest:{x:t,y:u,room:v},path:a.serializePath(p,c.path),stationary:0,blocked:[],restartOn:f};0===d.blocked.length&&10<d.path.length&&(Memory.paths[y]=[d.path,[],n,n],f&&0<f.length&&(Memory.paths[y][1]=f))}else d?(d.path=Memory.paths[y][0],d.restartOn=Memory.paths[y][1]):d={start:{x:h,y:k,room:l},dest:{x:t,y:u,room:v},path:Memory.paths[y][0],stationary:0,blocked:[],restartOn:Memory.paths[y][1]},Memory.paths[y][3]=n;b.move(+d.path[0])!==OK&&--d.stationary;return d}},serializePath:function(a,
c){return _.map(c,function(b,d){d=0===d?a:c[d-1];switch(b.x-d.x){case 0:case -49:case 49:switch(b.y-d.y){case 0:case -49:case 49:return"";case 1:case -48:return BOTTOM.toString();case -1:case 48:return TOP.toString()}break;case 1:case -48:switch(b.y-d.y){case 0:case -49:case 49:return RIGHT.toString();case 1:case -48:return BOTTOM_RIGHT.toString();case -1:case 48:return TOP_RIGHT.toString()}break;case -1:case 48:switch(b.y-d.y){case 0:case -49:case 49:return LEFT.toString();case 1:case -48:return BOTTOM_LEFT.toString();
case -1:case 48:return TOP_LEFT.toString()}}}).join("")}};Memory.profiling&&c(2,60).registerObject(a,"Pathing");q.exports=a;return q.exports};if("object"===typeof module)module.exports=c(0);else return c(0)})();