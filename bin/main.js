var $jscomp={scope:{},getGlobal:function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,v,y){if(y.get||y.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[v]=y.value)};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var v=0;return $jscomp.iteratorPrototype(function(){return v<c.length?{done:!1,value:c[v++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.makeIterator=function(c){$jscomp.initSymbolIterator();var v=c[Symbol.iterator];return v?v.call(c):$jscomp.arrayIterator(c)};$jscomp.arrayFromIterator=function(c){for(var v,y=[];!(v=c.next()).done;)y.push(v.value);return y};$jscomp.arrayFromIterable=function(c){return c instanceof Array?c:$jscomp.arrayFromIterator($jscomp.makeIterator(c))};
$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(c,v){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var y=0,B={next:function(){if(y<c.length){var r=y++;return{value:v(r,c[r]),done:!1}}B.next=function(){return{done:!0,value:void 0}};return B.next()}};B[Symbol.iterator]=function(){return B};return B};
$jscomp.polyfill=function(c,v,y,B){if(v){y=$jscomp.global;c=c.split(".");for(B=0;B<c.length-1;B++){var r=c[B];r in y||(y[r]={});y=y[r]}c=c[c.length-1];B=y[c];v=v(B);v!=B&&null!=v&&$jscomp.defineProperty(y,c,{configurable:!0,writable:!0,value:v})}};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.values",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c,y){return y})}},"es6","es3");$jscomp.findInternal=function(c,v,y){c instanceof String&&(c=String(c));for(var B=c.length,r=0;r<B;r++){var p=c[r];if(v.call(y,p,r,c))return{i:r,v:p}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,y){return $jscomp.findInternal(this,c,y).v}},"es6-impl","es3");
$jscomp.checkStringArgs=function(c,v,y){if(null==c)throw new TypeError("The 'this' value for String.prototype."+y+" must not be null or undefined");if(v instanceof RegExp)throw new TypeError("First argument to String.prototype."+y+" must not be a regular expression");return c+""};
$jscomp.polyfill("String.prototype.startsWith",function(c){return c?c:function(c,y){var v=$jscomp.checkStringArgs(this,c,"startsWith");c+="";var r=v.length,p=c.length;y=Math.max(0,Math.min(y|0,v.length));for(var f=0;f<p&&y<r;)if(v[y++]!=c[f++])return!1;return f>=p}},"es6-impl","es3");$jscomp.polyfill("Number.isFinite",function(c){return c?c:function(c){return"number"!==typeof c?!1:!isNaN(c)&&Infinity!==c&&-Infinity!==c}},"es6-impl","es3");
$jscomp.polyfill("Number.isInteger",function(c){return c?c:function(c){return Number.isFinite(c)?c===Math.floor(c):!1}},"es6-impl","es3");
(function(){function c(c,p){B[c]||(y[c]={exports:{},loaded:!1},B[c]=!0,0===c&&"function"===typeof require?require.main=y[0]:y[c].parent=y[p],v[c].call(this,y[c],y[c].exports),y[c].loaded=!0);return y[c].exports}var v={},y={},B={};v[0]=function(r,p){var f=c(1,0),q=c(2,0),e=c(3,0),a=c(4,0),b=c(5,0),d=c(6,0),x=c(7,0);c(8,0);var m=c(9,0),n=c(10,0),t=c(11,0),g=c(12,0),h=c(13,0),l=c(14,0),k=c(15,0),u=c(16,0),w=c(17,0),z=c(18,0),F=c(19,0),K=c(20,0),D=c(21,0),C=c(22,0),E=c(23,0),v=c(24,0),y=c(25,0),L=c(26,
0),A=c(27,0),G=c(28,0),U=c(29,0),V=c(30,0),W=c(31,0),X=c(32,0),Y=c(33,0),P=c(34,0),Q=c(35,0),R=c(36,0),B=c(37,0),Z=c(38,0),aa=c(39,0),ba=c(40,0),ca=c(41,0),da=c(42,0),ea=c(43,0),fa=c(44,0),ga=c(45,0),ha=c(46,0),ia=c(47,0),ja=c(48,0),O=c(49,0),J=c(50,0),I=c(51,0),M=c(52,0),ka=c(53,0),la=c(54,0),ma=c(55,0),S,N;p=function(){};p.loop=function(){var a=this,b=Game.cpu.getUsed(),d=Game.cpu.bucket;10<=b&&9800>Game.cpu.bucket?Game.notify("CPU started at "+b.toFixed(2)+" with bucket at "+d.toFixed(0)+", aborting! "+
Game.time.toFixed(0)):d<Game.cpu.tickLimit?Game.notify("Bucket at "+d.toFixed(0)+", aborting! "+Game.time.toFixed(0)):(b=function(){var b="",d,l;Memory.logCpu&&(d=l,b="Started at "+d.toFixed(2));a.init();Memory.logCpu&&(l=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"init took "+(l-d).toFixed(2),d=l);a.minerals();Memory.logCpu&&(l=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"minerals took "+(l-d).toFixed(2),d=l);a.baseMatrixes();Memory.logCpu&&(l=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"baseMatrixes took "+
(l-d).toFixed(2),d=l);a.deserializeCreeps();Memory.logCpu&&(l=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"deserializeCreeps took "+(l-d).toFixed(2),d=l);a.deserializeRooms();Memory.logCpu&&(l=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"deserializeRooms took "+(l-d).toFixed(2),d=l);a.balanceEnergy();Memory.logCpu&&(l=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"balanceEnergy took "+(l-d).toFixed(2),d=l);a.rooms();Memory.logCpu&&(l=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"rooms took "+(l-d).toFixed(2),
d=l);a.army();Memory.logCpu&&(l=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"army took "+(l-d).toFixed(2),d=l);a.creeps();Memory.logCpu&&(l=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"creeps took "+(l-d).toFixed(2),d=l);Memory.debug&&(a.debug(),Memory.logCpu&&(l=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"debug took "+(l-d).toFixed(2),d=l));Memory.log&&(a.log(),Memory.logCpu&&(l=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"log took "+(l-d).toFixed(2),d=l));Memory.visualizations&&(a.drawGlobal(),
Memory.logCpu&&(l=Game.cpu.getUsed(),b+=(0<b.length?" - ":"")+"drawGlobal took "+(l-d).toFixed(2),e.log.events.push(b)));a.finalize();Memory.logCpu&&(l=Game.cpu.getUsed(),(l-d).toFixed(2))},Memory.profiling?f.wrap(b):b())};p.init=function(){var b=Game.time%1500;m.init();e.reset();S||(S=!0,e.log.events.push("System reset."));e.credits<Memory.minimumCredits&&delete Memory.buy;e.credits>=1.5*Memory.minimumCredits&&(Memory.buy=!0);Game.cmd={Army:q,Cache:e,Commands:a,Market:d,Minerals:x,Role:{ArmyDismantler:t,
ArmyHealer:g,ArmyMelee:h,ArmyRanged:l,Claimer:k,Collector:u,Converter:w,Defender:z,Dismantler:F,Healer:K,Miner:D,RemoteBuilder:C,RemoteCollector:E,RemoteDismantler:v,RemoteMiner:y,RemoteReserver:L,RemoteStorer:A,RemoteWorker:G,Scientist:U,Storer:V,Tower:W,Upgrader:X,Worker:Y},Room:{Base:P,Cleanup:Q,Mine:R,Source:B},Utilities:n};Memory.maxCreeps||(Memory.maxCreeps={});Memory.containerSource||(Memory.containerSource={});Memory.army||(Memory.army={});Memory.avoidRooms||(Memory.avoidRooms=[]);Memory.avoidSquares||
(Memory.avoidSquares={});Memory.paths||(Memory.paths={});Memory.lengthToStorage||(Memory.lengthToStorage={});Memory.towerTasks||(Memory.towerTasks={});Memory.stats||(Memory.stats={});Memory.stats.cpu||(Memory.stats.cpu=[]);Memory.stats.bucket||(Memory.stats.bucket=[]);Memory.stats.gclProgress||(Memory.stats.gclProgress=[]);Memory.minimumSell||(Memory.minimumSell={});Memory.flipPrice||(Memory.flipPrice={});Memory.allies||(Memory.allies=[]);0===Game.time%10&&(_.forEach(Memory.creeps,function(a,b){Game.creeps[b]||
delete Memory.creeps[b]}),_.forEach(Memory.lengthToContainer,function(a,b){Game.getObjectById(b)||delete Memory.lengthToContainer[b]}),_.forEach(Memory.lengthToController,function(a,b){Game.getObjectById(b)||delete Memory.lengthToController[b]}),_.forEach(Memory.lengthToStorage,function(a,b){Game.getObjectById(b)||delete Memory.lengthToStorage[b]}),_.forEach(Memory.containerSource,function(a,b){Game.getObjectById(b)||delete Memory.containerSource[b]}),_.forEach(Memory.dismantle,function(a,b){0===
a.length&&delete Memory.dismantle[b]}),_.forEach(Memory.rooms,function(a,b){a&&a.roomType||delete Memory.rooms[b]}),_.forEach(Memory.maxCreeps,function(a,b){_.forEach(Memory.maxCreeps[b],function(b,d){0===Object.keys(b).length&&delete a[d]})}),_.forEach(Memory.paths,function(a,b){(a[3]<=Game.time-500||a[2]<=Game.time-1500)&&delete Memory.paths[b]}));delete Memory.flags;switch(b){case 0:Memory.lengthToStorage={};break;case 100:Memory.lengthToContainer={};break;case 200:Memory.lengthToController={};
break;case 300:Memory.ranges={}}e.creeps=n.nest(_.filter(Game.creeps,function(a){return a.memory.home||a.memory.army}),[function(a){return a.memory.home||a.memory.army},function(a){return a.memory.role}]);_.forEach(e.creeps,function(a,b){e.creeps[b].all=_.flatten(_.values(a))})};p.minerals=function(){var a={},b,l;Game.cpu.bucket>=Memory.marketBucket&&(b=[{resource:RESOURCE_HYDROGEN,amount:3E3},{resource:RESOURCE_OXYGEN,amount:3E3},{resource:RESOURCE_ZYNTHIUM,amount:3E3},{resource:RESOURCE_KEANIUM,
amount:3E3},{resource:RESOURCE_UTRIUM,amount:3E3},{resource:RESOURCE_LEMERGIUM,amount:3E3},{resource:RESOURCE_CATALYST,amount:3E3},{resource:RESOURCE_HYDROXIDE,amount:3E3},{resource:RESOURCE_ZYNTHIUM_KEANITE,amount:3E3},{resource:RESOURCE_UTRIUM_LEMERGITE,amount:3E3},{resource:RESOURCE_GHODIUM,amount:3E3},{resource:RESOURCE_UTRIUM_HYDRIDE,amount:3E3},{resource:RESOURCE_KEANIUM_OXIDE,amount:3E3},{resource:RESOURCE_LEMERGIUM_HYDRIDE,amount:3E3},{resource:RESOURCE_LEMERGIUM_OXIDE,amount:3E3},{resource:RESOURCE_ZYNTHIUM_HYDRIDE,
amount:3E3},{resource:RESOURCE_GHODIUM_HYDRIDE,amount:3E3},{resource:RESOURCE_GHODIUM_OXIDE,amount:3E3},{resource:RESOURCE_UTRIUM_ACID,amount:3E3},{resource:RESOURCE_KEANIUM_ALKALIDE,amount:3E3},{resource:RESOURCE_LEMERGIUM_ACID,amount:3E3},{resource:RESOURCE_LEMERGIUM_ALKALIDE,amount:3E3},{resource:RESOURCE_ZYNTHIUM_ACID,amount:3E3},{resource:RESOURCE_GHODIUM_ACID,amount:3E3},{resource:RESOURCE_GHODIUM_ALKALIDE,amount:3E3},{resource:RESOURCE_CATALYZED_UTRIUM_ACID,amount:15E3},{resource:RESOURCE_CATALYZED_KEANIUM_ALKALIDE,
amount:15E3},{resource:RESOURCE_CATALYZED_LEMERGIUM_ACID,amount:15E3},{resource:RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE,amount:15E3},{resource:RESOURCE_CATALYZED_ZYNTHIUM_ACID,amount:15E3},{resource:RESOURCE_CATALYZED_GHODIUM_ACID,amount:15E3},{resource:RESOURCE_CATALYZED_GHODIUM_ALKALIDE,amount:15E3},{resource:RESOURCE_POWER,amount:3E3}],_.forEach(b,function(a){var b=function(a,b){a.children=_.map(x[a.resource],function(a){return{resource:a}});_.forEach(a.children,function(d){d.amount=a.amount;b(d,
b)})};b(a,b)}),Memory.reserveMinerals={},_.forEach(b,function(a){var b=function(a,b){Memory.reserveMinerals[a.resource]||(Memory.reserveMinerals[a.resource]=0);Memory.reserveMinerals[a.resource]=Math.min(Memory.reserveMinerals[a.resource]+a.amount,2E4);_.forEach(a.children,function(a){b(a,b)});a.amount=Memory.reserveMinerals[a.resource]};b(a,b)}),_.forEach(_.uniq(_.map(d.getAllOrders(),function(a){return a.resourceType})),function(b){(l=(d.getFilteredOrders().sell[b]||[])[0])&&(a[b]=l)}),_.forEach(Game.rooms,
function(d,l){var k=Infinity,u=d.memory,h=e.creeps[l]&&e.creeps[l].all,n;!d.unobservable&&d.storage&&d.terminal&&d.terminal.my&&d.memory.roomType&&"base"===d.memory.roomType.type&&!(3>e.labsInRoom(d))&&(e.minerals[l]=_.cloneDeep(b),_.forEach(e.minerals[l],function(b){var l=function(b,l){var m,w=b.resource,g=(d.storage.store[w]||0)+(d.terminal.store[w]||0)+_.sum(h,function(a){return a.carry[w]||0});b.buyPrice=a[w]?a[w].price:Infinity;b.amount=Math.max(b.amount-g,0);_.forEach(b.children,function(a){l(a,
l)});if(b.children&&0!==b.children.length)if(m=1.2*_.sum(_.map(b.children,function(a){return a.buyPrice})),Memory.minimumSell[w]=Math.min(Infinity,m),0!==Memory.minimumSell[w]&&Infinity!==Memory.minimumSell[w]||delete Memory.minimumSell[w],b.buyPrice>m){var f=5*Math.floor(((d.storage.store[b.children[0].resource]||0)+(d.terminal.store[b.children[0].resource]||0)+_.sum(h,function(a){return a.carry[b.children[0].resource]||0}))/5),t=5*Math.floor(((d.storage.store[b.children[1].resource]||0)+(d.terminal.store[b.children[1].resource]||
0)+_.sum(h,function(a){return a.carry[b.children[1].resource]||0}))/5);b.amount=Math.min(Math.min(b.amount,f),t);b.action="create";b.buyPrice=m;g<=k&&0<b.amount&&(n=b,k=g)}else b.action="buy";else b.action="buy";0<b.amount&&"buy"===b.action&&!u.buyQueue&&e.credits>=Memory.minimumCredits&&Memory.buy&&(u.buyQueue={resource:w,amount:b.amount,price:b.buyPrice,start:Game.time})};l(b,l)}),n&&!u.labQueue&&(l=function(a,b){var l=a.resource;if(!(0>=a.amount)&&"create"===a.action){var k=5*Math.floor(((d.storage.store[a.children[0].resource]||
0)+(d.terminal.store[a.children[0].resource]||0)+_.sum(h,function(b){return b.carry[a.children[0].resource]||0}))/5),n=5*Math.floor(((d.storage.store[a.children[1].resource]||0)+(d.terminal.store[a.children[1].resource]||0)+_.sum(h,function(b){return b.carry[a.children[1].resource]||0}))/5);u.labQueue={resource:l,amount:Math.min(5*Math.ceil(Math.min(Math.min(Math.min(a.amount,k),n),LAB_MINERAL_CAPACITY)/5),3E3),children:_.map(a.children,function(a){return a.resource}),start:Game.time};_.forEach(a.children,
function(a){b(a,b)})}},l(n,l)))}))};p.baseMatrixes=function(){Memory.baseMatrixes||(Memory.baseMatrixes={});_.forEach(Memory.baseMatrixes,function(a,b){var d=Game.rooms[b],l,k,u;if(d&&!d.unobservable&&"complete"!==a.status&&0!==e.spawnsInRoom(d).length&&(u=e.repairableStructuresInRoom(d),a.status||(k=new PathFinder.CostMatrix,_.forEach(_.filter(u,function(a){return a.structureType!==STRUCTURE_ROAD}),function(a){k.set(a.pos.x,a.pos.y,255)}),a.tempMatrix=k.serialize(),a.costMatrix=k.serialize(),a.status=
"building",a.x=0,a.y=0),"building"===a.status)){l=PathFinder.CostMatrix.deserialize(a.tempMatrix);for(k=PathFinder.CostMatrix.deserialize(a.costMatrix);50>a.x;a.x++){for(;50>a.y;a.y++){if(250<=Game.cpu.getUsed())return a.costMatrix=k.serialize(),!1;PathFinder.search(new RoomPosition(a.x,a.y,b),{pos:e.spawnsInRoom(d)[0].pos,range:1},{roomCallback:function(){return l},maxOps:1E4,maxRooms:1}).incomplete&&k.set(a.x,a.y,255)}a.y=0}_.forEach(_.filter(u,function(a){return a.structureType===STRUCTURE_RAMPART}),
function(a){k.set(a.pos.x,a.pos.y,0)});delete a.tempMatrix;delete a.x;delete a.y;a.costMatrix=k.serialize();a.status="complete"}})};p.deserializeCreeps=function(){_.forEach(Game.creeps,function(a){if(a.memory.currentTask)switch(a.memory.currentTask.type){case "attack":e.creepTasks[a.name]=Z.fromObj(a);break;case "build":e.creepTasks[a.name]=aa.fromObj(a);break;case "claim":e.creepTasks[a.name]=ba.fromObj(a);break;case "collectEnergy":e.creepTasks[a.name]=ca.fromObj(a);break;case "collectMinerals":e.creepTasks[a.name]=
da.fromObj(a);break;case "dismantle":e.creepTasks[a.name]=ea.fromObj(a);break;case "fillEnergy":e.creepTasks[a.name]=fa.fromObj(a);break;case "fillMinerals":e.creepTasks[a.name]=ga.fromObj(a);break;case "harvest":e.creepTasks[a.name]=ha.fromObj(a);break;case "heal":e.creepTasks[a.name]=ia.fromObj(a);break;case "meleeAttack":e.creepTasks[a.name]=ja.fromObj(a);break;case "mine":e.creepTasks[a.name]=O.fromObj(a);break;case "pickupResource":e.creepTasks[a.name]=J.fromObj(a);break;case "rally":e.creepTasks[a.name]=
I.fromObj(a);break;case "rangedAttack":e.creepTasks[a.name]=M.fromObj(a);break;case "repair":e.creepTasks[a.name]=ka.fromObj(a);break;case "reserve":e.creepTasks[a.name]=la.fromObj(a);break;case "upgradeController":e.creepTasks[a.name]=ma.fromObj(a)}})};p.deserializeRooms=function(){N=[];_.forEach(Memory.rooms,function(a,b){if(a.roomType){switch(a.roomType.type){case "base":e.roomTypes[b]=P.fromObj(a);break;case "cleanup":e.roomTypes[b]=Q.fromObj(a);break;case "mine":e.roomTypes[b]=R.fromObj(a);break;
case "source":e.roomTypes[b]=B.fromObj(a)}Game.rooms[b]||N.push({name:b,unobservable:!0})}})};p.balanceEnergy=function(){var a,b;a=_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&"base"===a.memory.roomType.type&&a.storage&&a.storage.my&&a.terminal&&a.terminal.my}).sort(function(a,b){return a.storage.store[RESOURCE_ENERGY]+a.terminal.store[RESOURCE_ENERGY]-(b.storage.store[RESOURCE_ENERGY]+b.terminal.store[RESOURCE_ENERGY])});1<a.length&&(b=Math.min(_.sum(_.map(a,function(a){return a.storage.store[RESOURCE_ENERGY]+
a.terminal.store[RESOURCE_ENERGY]}))/a.length,5E5),_.forEach(a,function(d,l){l=a[a.length-l-1];var k=d.storage.store[RESOURCE_ENERGY],u=l.storage.store[RESOURCE_ENERGY],h=l.terminal,n=h.store[RESOURCE_ENERGY];if(k>=u||k+d.terminal.store[RESOURCE_ENERGY]>b||u+n<b+1E4)return!1;1E3<=n&&(k=Game.market.calcTransactionCost(n,l.name,d.name),h.send(RESOURCE_ENERGY,Math.floor(n/(n+k)*n),d.name),e.log.events.push("Sending "+Math.floor(n/(n+k)*n)+" energy from "+l.name+" to "+d.name))}))};p.log=function(){e.log.creeps=
_.map(Game.creeps,function(a){return{creepId:a.id,name:a.name,creepType:a.memory.role,home:a.memory.home,army:a.memory.army,room:a.pos.roomName,x:a.pos.x,y:a.pos.y,spawning:a.spawning,ttl:a.ticksToLive,carryCapacity:a.carryCapacity,carry:a.carry,hits:a.hits,hitsMax:a.hitsMax}});e.log.spawns=_.map(Game.spawns,function(a){return{spawnId:a.id,name:a.name,room:a.room.name,spawningName:a.spawning?a.spawning.name:void 0,spawningNeedTime:a.spawning?a.spawning.needTime:void 0,spawningRemainingTime:a.spawning?
a.spawning.remainingTime:void 0}});_.forEach([].concat.apply([],[_.filter(Game.rooms),N]),function(a){var b=a.name,d=Memory.rooms[b],l=d&&d.roomType&&d.roomType.type?d.roomType.type:"unknown",k,u,h,n,m,w;a.unobservable?e.log.rooms[b]={type:l,supportRoom:d&&d.roomType?d.roomType.supportRoom:void 0,region:d?d.region:void 0,unobservable:!0,store:{},labs:[],source:[],creeps:[]}:(0===Game.time%10&&(k=e.repairableStructuresInRoom(a)),u=a.find(FIND_MY_CONSTRUCTION_SITES),h=e.towersInRoom(a),n=e.labsInRoom(a),
m=e.nukersInRoom(a),w=e.powerSpawnsInRoom(a),e.log.rooms[b]={type:l,supportRoom:d&&d.roomType?d.roomType.supportRoom:void 0,region:d?d.region:void 0,unobservable:!1,controller:!!a.controller,store:{},labs:[],source:[],creeps:[]},e.log.rooms[b].controller&&(e.log.rooms[b].rcl=a.controller.level,a.controller.owner&&(e.log.rooms[b].ownerUsername=a.controller.owner.username),e.log.rooms[b].progress=a.controller.progress,e.log.rooms[b].progressTotal=a.controller.progressTotal,e.log.rooms[b].ttd=a.controller.ticksToDowngrade),
a.controller&&a.controller.reservation&&(e.log.rooms[b].reservedUsername=a.controller.reservation.username,e.log.rooms[b].tte=a.controller.reservation.ticksToEnd),e.log.rooms[b].lowestWall=0===Game.time%10?Math.min.apply(Math,_.map(_.filter(k,function(a){return a.structureType===STRUCTURE_WALL||a.structureType===STRUCTURE_RAMPART}),function(a){return a.hits})):Memory.console&&Memory.console.rooms&&Memory.console.rooms[b]&&Memory.console.rooms[b].lowestWall||null,a.energyCapacityAvailable&&0<a.energyCapacityAvailable&&
(e.log.rooms[b].energyAvailable=a.energyAvailable,e.log.rooms[b].energyCapacityAvailable=a.energyCapacityAvailable),e.log.rooms[b].constructionProgress=_.sum(_.map(u,function(a){return a.progress})),e.log.rooms[b].constructionProgressTotal=_.sum(_.map(u,function(a){return a.progressTotal})),e.log.rooms[b].towerEnergy=_.sum(_.map(h,function(a){return a.energy})),e.log.rooms[b].towerEnergyCapacity=_.sum(_.map(h,function(a){return a.energyCapacity})),e.log.rooms[b].labEnergy=_.sum(_.map(n,function(a){return a.energy})),
e.log.rooms[b].labEnergyCapacity=_.sum(_.map(n,function(a){return a.energyCapacity})),e.log.rooms[b].nukerEnergy=_.sum(_.map(m,function(a){return a.energy})),e.log.rooms[b].nukerEnergyCapacity=_.sum(_.map(m,function(a){return a.energyCapacity})),e.log.rooms[b].nukerGhodium=_.sum(_.map(m,function(a){return a.ghodium})),e.log.rooms[b].nukerGhodiumCapacity=_.sum(_.map(m,function(a){return a.ghodiumCapacity})),e.log.rooms[b].powerSpawnEnergy=_.sum(_.map(w,function(a){return a.energy})),e.log.rooms[b].powerSpawnEnergyCapacity=
_.sum(_.map(w,function(a){return a.energyCapacity})),e.log.rooms[b].powerSpawnPower=_.sum(_.map(w,function(a){return a.power})),e.log.rooms[b].powerSpawnPowerCapacity=_.sum(_.map(w,function(a){return a.powerCapacity})),a.storage&&(e.log.rooms[b].store.storage=_.map(a.storage.store,function(a,b){return{resource:b,amount:a}})),a.terminal&&(e.log.rooms[b].store.terminal=_.map(a.terminal.store,function(a,b){return{resource:b,amount:a}})),e.log.rooms[b].labs=_.map(n,function(a){return{resource:a.mineralType,
amount:a.mineralAmount}}),e.log.rooms[b].labQueue=d.labQueue,e.log.rooms[b].buyQueue=d.buyQueue,_.forEach(a.find(FIND_SOURCES),function(a){e.log.rooms[b].source.push({sourceId:a.id,resource:RESOURCE_ENERGY,amount:a.energy,capacity:a.energyCapacity,ttr:a.ticksToRegeneration})}),_.forEach(a.find(FIND_MINERALS),function(a){e.log.rooms[b].source.push({sourceId:a.id,resource:a.mineralType,amount:a.mineralAmount,ttr:a.ticksToRegeneration})}),e.log.hostiles=[].concat.apply([],[e.log.hostiles,_.map(e.hostilesInRoom(a),
function(a){return{creepId:a.id,ownerUsername:a.owner.username,room:b,x:a.pos.x,y:a.pos.y,ttl:a.ticksToLive,hits:a.hits,hitsMax:a.hitsMax}})]))})};p.rooms=function(){var a=this,b=["base","source","mine","cleanup",""],d=Memory.rooms,l=["source","cleanup"],k=9800<=Game.cpu.bucket||0===Game.time%2;Memory.rushRoom=(_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&"base"===a.memory.roomType.type&&a.controller&&8>a.controller.level}).sort(function(a,b){return b.controller.level-a.controller.level||
b.controller.progress-a.controller.progress})[0]||{name:""}).name;_.forEach([].concat.apply([],[_.filter(Game.rooms),N]).sort(function(a,l){return b.indexOf(d[a.name]&&d[a.name].roomType&&d[a.name].roomType.type||"")-b.indexOf(d[l.name]&&d[l.name].roomType&&d[l.name].roomType.type||"")}),function(b){var u=b.name,h=d[u].roomType;e.roomTypes[u]&&((-1!==l.indexOf(h.type)||k)&&e.roomTypes[u].run(b),h.type===e.roomTypes[u].type&&e.roomTypes[u].toObj(b));Memory.visualizations&&!b.unobservable&&a.drawRoom(b)})};
p.drawRoom=function(a){var d=a.visual,l,k,u,h;d||(d=new RoomVisual(a.name));d&&(a.memory&&a.memory.roomType&&d.text(_.capitalize(a.memory.roomType.type),-.5,49.325,{align:"left",font:"0.5 Arial"}),a.controller&&a.controller.level&&(d.text("RCL "+a.controller.level,2.5,49.325,{align:"left",font:"0.5 Arial"}),a.controller.progress&&a.controller.progressTotal&&b.progressBar(d,5.5,48.9,20,.5,a.controller.progress,a.controller.progressTotal,{background:"#808080",bar:"#00ff00",showDetails:!0,color:"#ffffff",
font:"0.5 Arial"})),k=2.125,a.energyCapacityAvailable&&(k+=.7,d.text("Energy",-.5,k,{align:"left",font:"0.5 Arial"}),b.progressBar(d,2.5,k-.425,5,.5,a.energyAvailable,a.energyCapacityAvailable,{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),u=e.towersInRoom(a),0<u.length&&(k+=.7,d.text("Towers",-.5,k,{align:"left",font:"0.5 Arial"}),b.progressBar(d,2.5,k-.425,5,.5,_.sum(_.map(u,function(a){return a.energy})),_.sum(_.map(u,function(a){return a.energyCapacity})),
{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),u=e.labsInRoom(a),0<u.length&&(k+=.7,d.text("Labs",-.5,k,{align:"left",font:"0.5 Arial"}),b.progressBar(d,2.5,k-.425,5,.5,_.sum(_.map(u,function(a){return a.energy})),_.sum(_.map(u,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),h=e.nukersInRoom(a),0<h.length&&(k+=.7,d.text("Nuker",-.5,k,{align:"left",font:"0.5 Arial"}),b.progressBar(d,
2.5,k-.425,5,.5,_.sum(_.map(h,function(a){return a.energy})),_.sum(_.map(h,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"}),b.progressBar(d,8.5,k-.425,5,.5,_.sum(_.map(h,function(a){return a.ghodium})),_.sum(_.map(h,function(a){return a.ghodiumCapacity})),{background:"#808080",bar:"#ffff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),h=e.powerSpawnsInRoom(a),0<h.length&&(k+=.7,d.text("Power Spawn",-.5,k,{align:"left",
font:"0.5 Arial"}),b.progressBar(d,2.5,k-.425,5,.5,_.sum(_.map(h,function(a){return a.energy})),_.sum(_.map(h,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"}),b.progressBar(d,8.5,k-.425,5,.5,_.sum(_.map(h,function(a){return a.power})),_.sum(_.map(h,function(a){return a.powerCapacity})),{background:"#808080",bar:"#ff0000",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),a.memory&&a.memory.buyQueue&&(k+=.7,d.text("Buy",-.5,
k,{align:"left",font:"bold 0.5 Arial"}),d.text(a.memory.buyQueue.amount,2.5,k,{align:"right",font:"0.5 Arial"}),b.resource(d,2.8,k-.175,.5,a.memory.buyQueue.resource,{opacity:1})),a.memory&&a.memory.labQueue&&(k+=.7,d.text("Create",-.5,k,{align:"left",font:"bold 0.5 Arial"}),d.text(a.memory.labQueue.amount,2.5,k,{align:"right",font:"0.5 Arial"}),b.resource(d,2.8,k-.175,.5,a.memory.labQueue.resource,{opacity:1})),0<u.length&&(k+=.7,d.text("Labs",-.5,k,{align:"left",font:"bold 0.5 Arial"}),l=0,_.forEach(u,
function(a){l+=2.5;0===a.mineralAmount?d.text("Empty",l,k,{align:"right",font:"0.5 Arial"}):(d.text(a.mineralAmount,l,k,{align:"right",font:"0.5 Arial"}),b.resource(d,l+.3,k-.175,.5,a.mineralType,{opacity:1}))})),a.storage&&(k+=1.4,d.text("Storage",-.5,k,{align:"left",font:"bold 0.5 Arial"}),_.forEach(a.storage.store,function(a,l){l!==RESOURCE_ENERGY&&(k+=.7,d.text(a,1,k,{align:"right",font:"0.5 Arial"}),b.resource(d,1.3,k-.175,.5,l,{opacity:1}))})),a.terminal&&(k+=1.4,d.text("Terminal",-.5,k,{align:"left",
font:"bold 0.5 Arial"}),_.forEach(a.terminal.store,function(a,l){l!==RESOURCE_ENERGY&&(k+=.7,d.text(a,1,k,{align:"right",font:"0.5 Arial"}),b.resource(d,1.3,k-.175,.5,l,{opacity:1}))})))};p.army=function(){_.forEach(Memory.army,function(a,b){e.log.army[b]={directive:a.directive,scheduled:a.scheduled,portals:a.portals,boostRoom:a.boostRoom,buildRoom:a.buildRoom,stageRoom:a.stageRoom,attackRoom:a.attackRoom,dismantle:a.dismantle.length,creeps:[]};Game.rooms[a.attackRoom]&&(e.log.army[b].structures=
_.filter(Game.rooms[Memory.army[b].attackRoom].find(FIND_HOSTILE_STRUCTURES),function(a){return a.structureType!==STRUCTURE_CONTROLLER&&a.structureType!==STRUCTURE_RAMPART&&a.structureType!==STRUCTURE_KEEPER_LAIR}).length,e.log.army[b].constructionSites=Game.rooms[Memory.army[b].attackRoom].find(FIND_HOSTILE_CONSTRUCTION_SITES).length);q.run(b)})};p.creeps=function(){_.forEach(Game.creeps,function(a){if(!a.spawning&&!a.memory.stop){if(150>=a.ticksToLive||500>a.ticksToLive&&1===a.ticksToLive%10||1===
a.ticksToLive%100)switch(a.ticksToLive-1){case 3:a.say("R.I.P. and",!0);break;case 2:a.say("Pepperonis",!0);break;case 1:a.say(":(",!0);break;default:a.say("TTL "+(a.ticksToLive-1))}a.memory.army&&Memory.army[a.memory.army]&&a.room.name===Memory.army[a.memory.army].attackRoom&&a.say("All my friends are heathens, take it slow.  Wait for them to ask you who you know.  Please don't make any sudden moves.  You don't know the half of the abuse. ".split(" ")[Game.time%35],!0);switch(Game.time%1E6){case 999990:a.say("TEN!",
!0);break;case 999991:a.say("NINE!",!0);break;case 999992:a.say("EIGHT!",!0);break;case 999993:a.say("SEVEN!",!0);break;case 999994:a.say("SIX!",!0);break;case 999995:a.say("FIVE!",!0);break;case 999996:a.say("FOUR!",!0);break;case 999997:a.say("THREE!",!0);break;case 999998:a.say("TWO!",!0);break;case 999999:a.say("ONE!",!0);break;case 0:a.say("HAPPY NEW",!0);break;case 1:a.say("MILLION!",!0)}if(a.memory.currentTask&&e.creepTasks[a.name]){if(0===a.pos.x)switch(Math.floor(3*Math.random())){case 0:a.move(RIGHT);
break;case 1:a.move(TOP_RIGHT);break;case 2:a.move(BOTTOM_RIGHT)}if(49===a.pos.x)switch(Math.floor(3*Math.random())){case 0:a.move(LEFT);break;case 1:a.move(TOP_LEFT);break;case 2:a.move(BOTTOM_LEFT)}if(0===a.pos.y)switch(Math.floor(3*Math.random())){case 0:a.move(BOTTOM);break;case 1:a.move(BOTTOM_RIGHT);break;case 2:a.move(BOTTOM_LEFT)}if(49===a.pos.y)switch(Math.floor(3*Math.random())){case 0:a.move(TOP);break;case 1:a.move(TOP_RIGHT);break;case 2:a.move(TOP_LEFT)}e.creepTasks[a.name].run(a);!a.memory.lastRoom||
a.memory.lastRoom===a.room.name||e.creepTasks[a.name]&&e.creepTasks[a.name].force||delete a.memory.currentTask;a.memory.lastRoom=a.room.name;a.memory.currentTask&&e.creepTasks[a.name]&&e.creepTasks[a.name].toObj(a);0<a.carry[RESOURCE_ENERGY]&&0<a.getActiveBodyparts(WORK)&&_.forEach(_.filter(a.pos.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_ROAD&&a.hits<a.hitsMax}),function(b){a.repair(b)});a.spawning||!(150>a.ticksToLive)||0!==_.sum(a.carry)||a.memory.currentTask&&"rally"!==
a.memory.currentTask.type||-1!=="armyDismantler armyHealer armyMelee armyRanged claimer converter defender healer remoteReserver".split(" ").indexOf(a.memory.role)||a.suicide()}else delete a.memory.currentTask,!a.spawning&&150>a.ticksToLive&&0===_.sum(a.carry)&&-1==="armyDismantler armyHealer armyMelee armyRanged claimer converter defender healer remoteReserver".split(" ").indexOf(a.memory.role)?a.suicide():a.say("Idle")}})};p.debug=function(){_.forEach(Game.creeps,function(a){a.room.visual.text(a.name,
a.pos.x,a.pos.y+1,{align:"center",font:"0.5 Arial"});a.room.visual.text(a.memory.role,a.pos.x,a.pos.y+1.5,{align:"center",font:"0.5 Arial"});a.room.visual.text(a.memory.currentTask?a.memory.currentTask.type:"",a.pos.x,a.pos.y+2,{align:"center",font:"0.5 Arial"})})};p.finalize=function(){e.log.tick=Game.time;e.log.date=new Date;e.log.gcl=Game.gcl.level;e.log.progress=Game.gcl.progress;e.log.progressTotal=Game.gcl.progressTotal;e.log.limit=Game.cpu.limit;e.log.tickLimit=Game.cpu.tickLimit;e.log.bucket=
Game.cpu.bucket;e.log.credits=Game.market.credits;e.log.cpuUsed=Game.cpu.getUsed();Memory.console=e.log};p.drawGlobal=function(){var a;e.globalVisual.text("GCL "+Game.gcl.level,-.5,.025,{align:"left",font:"0.5 Arial"});b.progressBar(e.globalVisual,2.5,-.4,20,.5,Game.gcl.progress,Game.gcl.progressTotal,{background:"#808080",bar:"#00ff00",showDetails:!0,color:"#ffffff",font:"0.5 Arial"});b.progressBar(e.globalVisual,34.5,-.4,10,.5,Game.cpu.bucket,1E4,{label:"Bucket",background:"#808080",showMax:!1,
bar:9990<=Game.cpu.bucket?"#00ffff":9E3<=Game.cpu.bucket?"#00ff00":5E3<=Game.cpu.bucket?"#cccc00":"#ff0000",color:"#ffffff",font:"0.5 Arial"});e.globalVisual.text("Tick "+Game.time,49.5,.025,{align:"right",font:"0.5 Arial"});e.globalVisual.text(e.time,49.5,.725,{align:"right",font:"0.5 Arial"});e.globalVisual.text("Credits "+Game.market.credits.toFixed(2),-.5,.725,{align:"left",font:"0.5 Arial"});e.globalVisual.text("Creeps "+_.keys(Game.creeps).length,-.5,1.425,{align:"left",font:"0.5 Arial"});a=
.725;_.forEach(_.filter(Game.rooms,function(a){return!a.unobservable&&a.memory.roomType&&"base"===a.memory.roomType.type}),function(d){a+=.7;e.globalVisual.text(d.name,43.5,a,{align:"right",font:"bold 0.5 Arial"});d.storage&&(e.globalVisual.text(d.storage.store[RESOURCE_ENERGY],45.8,a,{align:"right",font:"0.5 Arial"}),b.resource(e.globalVisual,46.15,a-.175,.5,RESOURCE_ENERGY,{opacity:1}));d.terminal&&(e.globalVisual.text(d.terminal.store[RESOURCE_ENERGY],48.8,a,{align:"right",font:"0.5 Arial"}),b.resource(e.globalVisual,
49.15,a-.175,.5,RESOURCE_ENERGY,{opacity:1}))});for(Memory.stats.cpu.push(Game.cpu.getUsed());100<Memory.stats.cpu.length;)Memory.stats.cpu.shift();for(Memory.stats.bucket.push(Game.cpu.bucket);100<Memory.stats.bucket.length;)Memory.stats.bucket.shift();for(Memory.stats.gclProgress.push(Game.gcl.progress);100<Memory.stats.gclProgress.length;)Memory.stats.gclProgress.shift();b.sparkline(e.globalVisual,23.5,1,18,2,_.map(Memory.stats.cpu,function(a,b){return{cpu:Memory.stats.cpu[b],bucket:Memory.stats.bucket[b],
limit:Game.cpu.limit}}),[{key:"limit",min:.5*Game.cpu.limit,max:1.5*Game.cpu.limit,stroke:"#c0c0c0",opacity:.25},{key:"cpu",min:.5*Game.cpu.limit,max:1.5*Game.cpu.limit,stroke:"#ffff00",opacity:.5},{key:"bucket",min:0,max:1E4,stroke:"#00ffff",opacity:.5,font:"0.5 Arial"}]);e.log.cpuUsed=Game.cpu.getUsed();Memory.stats.cpu[Memory.stats.cpu.length-1]=Game.cpu.getUsed();b.progressBar(e.globalVisual,23.5,-.4,10,.5,Game.cpu.getUsed(),Game.cpu.limit,{label:"CPU",background:"#808080",valueDecimals:2,bar:e.log.cpuUsed>
Game.cpu.limit?"#ff0000":"#00ff00",color:"#ffffff",font:"0.5 Arial"})};Memory.profiling&&(f.registerObject(p,"Main"),f.enable());r.exports=p;return r.exports};v[1]=function(c,p){function f(){h=0;Game.profiler={stream:function(a,b,d){q("stream",a||10,b,d)},email:function(a,b,d){q("email",a||100,b,d)},profile:function(a,b,d){q("profile",a||100,b,d)},background:function(a,b){q("background",!1,a,b)},restart:function(){if(k.isProfiling()){var a=Memory.profiler.filter,b=!1;Memory.profiler.disableTick&&
(b=Memory.profiler.disableTick-Memory.profiler.enabledTick+1);q(Memory.profiler.type,b,a)}},reset:e,output:k.output};a()}function q(a,b,d,l){e();b=Number.isInteger(b)?Game.time+b:!1;Memory.profiler||(Memory.profiler={map:{},totalTime:0,enabledTick:Game.time+1,disableTick:b,type:a,filter:d,startsWith:l})}function e(){Memory.profiler=null}function a(){Game.rooms.sim&&(t=0,Game.cpu.getUsed=function(){return performance.now()-t})}function b(a,b){return function(){if(k.isProfiling()){var d=Memory.profiler.startsWith?
a.startsWith(Memory.profiler.filter):a===Memory.profiler.filter,l=Game.cpu.getUsed();d&&h++;var u=b.apply(this,arguments);if(0<h||!Memory.profiler.filter){var n=Game.cpu.getUsed();k.record(a,n-l)}d&&h--;return u}return b.apply(this,arguments)}}function d(){k.prototypes.forEach(function(a){m(a.val,a.name)})}function x(a,b){Object.getOwnPropertyNames(a).forEach(function(d){var k=b+"."+d;try{var h="function"===typeof a[d],u=-1===l.indexOf(d);h&&u&&(a[d]=n(a[d],k))}catch(C){}});return a}function m(a,
b){a.prototype&&x(a.prototype,b);x(a,b)}function n(a,d){d=d||a.name;return d?b(d,a):(console.log("Couldn't find a function name for - ",a),console.log("Will not profile this function."),a)}Array.prototype.forEach=function(a,b){for(var d=0;d<this.length;d++)a.call(b,this[d],d,this)};Array.prototype.map=function(a,b){for(var d=[],l=0;l<this.length;l++)d.push(a.call(b,this[l],l,this));return d};var t=0,g=!1,h=0,l=["getUsed","constructor"],k={printProfile:function(){console.log(k.output())},emailProfile:function(){Game.notify(k.output())},
output:function(a){a=a?a:20;if(!Memory.profiler||!Memory.profiler.enabledTick)return"Profiler not active.";var b=Game.time-Memory.profiler.enabledTick+1,b=["Avg: "+(Memory.profiler.totalTime/b).toFixed(2),"Total: "+Memory.profiler.totalTime.toFixed(2),"Ticks: "+b].join("\t");return[].concat("calls\t\ttime\t\tavg\t\tfunction",k.lines().slice(0,a),b).join("\n")},lines:function(){return Object.keys(Memory.profiler.map).map(function(a){var b=Memory.profiler.map[a];return{name:a,calls:b.calls,totalTime:b.time,
averageTime:b.time/b.calls}}).sort(function(a,b){return b.totalTime-a.totalTime}).map(function(a){return[a.calls,a.totalTime.toFixed(1),a.averageTime.toFixed(3),a.name].join("\t\t")})},prototypes:[{name:"Game",val:Game},{name:"Room",val:Room},{name:"Structure",val:Structure},{name:"Spawn",val:Spawn},{name:"Creep",val:Creep},{name:"RoomPosition",val:RoomPosition},{name:"Source",val:Source},{name:"Flag",val:Flag}],record:function(a,b){Memory.profiler.map[a]||(Memory.profiler.map[a]={time:0,calls:0});
Memory.profiler.map[a].calls++;Memory.profiler.map[a].time+=b},endTick:function(){if(Game.time>=Memory.profiler.enabledTick){var a=Game.cpu.getUsed();Memory.profiler.totalTime+=a;k.report()}},report:function(){k.shouldPrint()?k.printProfile():k.shouldEmail()&&k.emailProfile()},isProfiling:function(){return g&&Memory.profiler?!Memory.profiler.disableTick||Game.time<=Memory.profiler.disableTick:!1},type:function(){return Memory.profiler.type},shouldPrint:function(){var a="stream"===k.type(),b="profile"===
k.type(),d=Memory.profiler.disableTick===Game.time;return a||b&&d},shouldEmail:function(){return"email"===k.type()&&Memory.profiler.disableTick===Game.time}};c.exports={wrap:function(a){g&&f();return k.isProfiling()?(t=Game.cpu.getUsed(),a=a(),k.endTick(),a):a()},enable:function(){g=!0;d()},output:k.output,registerObject:m,registerFN:n,registerClass:m};return c.exports};v[2]=function(r,p){var f=c(3,2),q=c(10,2),e=c(11,2),a=c(12,2),b=c(13,2),d=c(14,2),x=c(47,2),m=c(48,2),n=c(51,2),t=c(52,2);p=function(){};
p.run=function(g){var h=Memory.army[g],l=f.creeps[g]&&f.creeps[g].all||[],k=Game.rooms[h.attackRoom],u=h.dismantler,w=h.healer,c=h.melee,F=h.ranged,p,r;if(!(h.scheduled&&h.scheduled>Game.time))if(k&&(r=k.find(FIND_HOSTILE_CONSTRUCTION_SITES)),h.boostRoom&&(p=Game.rooms[h.boostRoom].storage.store),0===l.length&&h.success)delete Memory.army[g];else{"preparing"===h.directive||"building"===h.directive||0!==l.length||h.success||(Game.notify("Army "+g+" operation failed, restarting."),h.directive="preparing");
h.safeMode&&k&&k.controller&&k.controller.safeMode&&(h.directive="staging",h.stageRoom=h.safeMode.stageRoom,h.attackRoom=h.safeMode.attackRoom,h.dismantle=h.safeMode.dismantle,h.safeMode=h.safeMode.safeMode);switch(h.directive){case "preparing":h.boostRoom?(p[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]||0)>=150*(u.maxCreeps+c.maxCreeps+F.maxCreeps+w.maxCreeps)&&(p[RESOURCE_CATALYZED_ZYNTHIUM_ACID]||0)>=30*u.units*u.maxCreeps&&(p[RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE]||0)>=30*w.units*w.maxCreeps&&(h.directive=
"building"):h.directive="building";break;case "building":0===_.filter(l,function(a){return a.room.name!==h.buildRoom}).length&&_.filter(l,function(a){return a.room.name===h.buildRoom}).length>=u.maxCreeps+w.maxCreeps+c.maxCreeps+F.maxCreeps&&(h.directive="staging");break;case "staging":0===_.filter(l,function(a){return a.room.name!==h.stageRoom}).length&&(h.directive="dismantle");break;case "dismantle":k&&(h.dismantle=_.filter(h.dismantle,function(a){return Game.getObjectById(a)}),0===h.dismantle.length&&
(h.directive="attack"));break;case "attack":k&&!h.reinforce&&0===_.filter(k.find(FIND_HOSTILE_STRUCTURES),function(a){return a.structureType!==STRUCTURE_CONTROLLER&&a.structureType!==STRUCTURE_RAMPART&&a.structureType!==STRUCTURE_KEEPER_LAIR}).length&&0===r.length&&(h.success=!0)}if("building"===h.directive||h.reinforce)e.checkSpawn(g,h.portals),a.checkSpawn(g,h.portals),b.checkSpawn(g,h.portals),d.checkSpawn(g,h.portals);(u.escort||c.escort||F.escort)&&_.forEach(_.filter(f.creeps[g]&&f.creeps[g].armyHealer||
[],function(a){return!a.memory.escorting&&!a.spawning}),function(a){var b=[].concat.apply([],[u.escort&&f.creeps[g].armyDismantler?_.filter(f.creeps[g].armyDismantler,function(a){return!a.memory.escortedBy&&!a.spawning}):[],c.escort&&f.creeps[g].armyMelee?_.filter(f.creeps[g].armyMelee,function(a){return!a.memory.escortedBy&&!a.spawning}):[],F.escort&&f.creeps[g].armyRanged?_.filter(f.creeps[g].armyRanged,function(a){return!a.memory.escortedBy&&!a.spawning}):[]])[0];if(b)a.memory.escorting=b.id,b.memory.escortedBy=
a.id;else return!1});w={melee:{tasks:[]},ranged:{tasks:[]},heal:{tasks:_.map(_.filter(l,function(a){return a.hits<a.hitsMax}).sort(function(a,b){return b.hitsMax-b.hits-(a.hitsMax-a.hits)}),function(a){return new x(a.id)})},rally:{tasks:[]}};if(k)switch(h.directive){case "dismantle":k=_.filter(f.hostilesInRoom(k),function(a){return 3>=q.objectsClosestToObj(l,a)[0].pos.getRangeTo(a)});w.ranged.tasks=_.map(k,function(a){return new t(a.id)});w.melee.tasks=_.map(k,function(a){return new m(a.id)});break;
case "attack":k=f.hostilesInRoom(k),w.melee.tasks=_.map(k,function(a){return new m(a.id)}),w.ranged.tasks=_.map(k,function(a){return new t(a.id)}),w.rally.tasks=_.map(r,function(a){return new n(a.id)})}e.assignTasks(g,h.directive,w);a.assignTasks(g,h.directive,w);b.assignTasks(g,h.directive,w);d.assignTasks(g,h.directive,w)}};Memory.profiling&&c(1,2).registerObject(p,"Army");r.exports=p;return r.exports};v[3]=function(r,p){var f={},q={},e={},a={},b={},d={},x={},m={},n={},t={},g={},h={},l={},k={},
u={},w={},z={};p=function(){};p.reset=function(){f={};q={};e={};a={};b={};d={};x={};m={};n={};t={};g={};h={};l={};k={};u={};w={};z={};this.creepTasks={};this.roomTypes={};this.spawning={};this.minerals={};this.log={events:[],hostiles:[],creeps:[],spawns:[],structures:[],rooms:{},army:{}};this.credits=Game.market.credits;Memory.visualizations&&(this.globalVisual=new RoomVisual,this.time=(new Date).toLocaleString("en-US",{timeZone:"America/Los_Angeles"}).replace(",",""))};p.spawnsInRoom=function(a){return f[a.name]?
f[a.name]:f[a.name]=_.filter(a.find(FIND_MY_STRUCTURES),function(a){return a.structureType===STRUCTURE_SPAWN})};p.powerSpawnsInRoom=function(a){return q[a.name]?q[a.name]:q[a.name]=_.filter(a.find(FIND_MY_STRUCTURES),function(a){return a.structureType===STRUCTURE_POWER_SPAWN})};p.extensionsInRoom=function(a){return e[a.name]?e[a.name]:e[a.name]=_.filter(a.find(FIND_MY_STRUCTURES),function(a){return a.structureType===STRUCTURE_EXTENSION})};p.towersInRoom=function(b){return a[b.name]?a[b.name]:a[b.name]=
_.filter(b.find(FIND_MY_STRUCTURES),function(a){return a.structureType===STRUCTURE_TOWER})};p.labsInRoom=function(a){return b[a.name]?b[a.name]:b[a.name]=_.filter(a.find(FIND_MY_STRUCTURES),function(a){return a.structureType===STRUCTURE_LAB})};p.nukersInRoom=function(a){return d[a.name]?d[a.name]:d[a.name]=_.filter(a.find(FIND_MY_STRUCTURES),function(a){return a.structureType===STRUCTURE_NUKER})};p.containersInRoom=function(a){return x[a.name]?x[a.name]:x[a.name]=_.filter(a.find(FIND_STRUCTURES),
function(a){return a.structureType===STRUCTURE_CONTAINER})};p.linksInRoom=function(a){return m[a.name]?m[a.name]:m[a.name]=a.find(FIND_STRUCTURES,{filter:function(a){return a.structureType===STRUCTURE_LINK}})};p.repairableStructuresInRoom=function(a){return n[a.name]?n[a.name]:n[a.name]=a.find(FIND_STRUCTURES,{filter:function(a){return(a.my||a.structureType===STRUCTURE_WALL||a.structureType===STRUCTURE_ROAD||a.structureType===STRUCTURE_CONTAINER)&&a.hits}})};p.sortedRepairableStructuresInRoom=function(a){return t[a.name]?
t[a.name]:t[a.name]=this.repairableStructuresInRoom(a).sort(function(a,b){return a.hits-b.hits})};p.extractorsInRoom=function(a){return g[a.name]?g[a.name]:g[a.name]=a.find(FIND_STRUCTURES,{filter:function(a){return a.structureType===STRUCTURE_EXTRACTOR}})};p.portalsInRoom=function(a){return h[a.name]?h[a.name]:h[a.name]=a.find(FIND_STRUCTURES,{filter:function(a){return a.structureType===STRUCTURE_PORTAL}})};p.hostilesInRoom=function(a){var b=a.name,d;if(!a||a.unobservable)return[];d=l[a.name]?l[a.name]:
l[a.name]=_.filter(a.find(FIND_HOSTILE_CREEPS),function(a){return!a.owner||-1===Memory.allies.indexOf(a.owner.username)});Memory.rooms[b].hostiles||(Memory.rooms[b].hostiles=[]);_.forEach(d,function(a){-1!==Memory.rooms[b].hostiles.indexOf(a.id)&&(Memory.rooms[b].harvested=0)});a.memory.hostiles=_.map(d,function(a){return a.id});return d};p.sourceKeepersInRoom=function(a){return k[a.name]?k[a.name]:k[a.name]=a.find(FIND_HOSTILE_STRUCTURES,{filter:function(a){return a.structureType===STRUCTURE_KEEPER_LAIR}})};
p.powerBanksInRoom=function(a){return u[a.name]?u[a.name]:u[a.name]=a.find(FIND_STRUCTURES,{filter:function(a){return a.structureType===STRUCTURE_POWER_BANK}})};p.resourcesInRoom=function(a){return w[a.name]?w[a.name]:w[a.name]=a.find(FIND_DROPPED_RESOURCES).sort(function(a,b){return b.amount-a.amount})};p.getCostMatrix=function(a){var b=a.name;if(!a||a.unobservable)return new PathFinder.CostMatrix;if(!z[b]){var d=new PathFinder.CostMatrix;_.forEach(a.find(FIND_STRUCTURES),function(a){var b=a.pos;
a.structureType===STRUCTURE_ROAD?d.set(b.x,b.y,Math.max(1,d.get(b.x,b.y))):a.structureType===STRUCTURE_WALL?d.set(b.x,b.y,Math.max(255,d.get(b.x,b.y))):a.structureType===STRUCTURE_CONTAINER?d.set(b.x,b.y,Math.max(10,d.get(b.x,b.y))):a.structureType===STRUCTURE_RAMPART&&a.my||d.set(b.x,b.y,255)});_.forEach(a.find(FIND_MY_CONSTRUCTION_SITES),function(a){a=a.pos;d.set(a.x,a.y,Math.max(5,d.get(a.x,a.y)))});_.forEach(this.portalsInRoom(a),function(a){a=a.pos;d.set(a.x,a.y,5)});Memory.avoidSquares[b]&&
_.forEach(Memory.avoidSquares[b],function(a){d.set(a.x,a.y,255)});z[b]=d}return z[b]};Memory.profiling&&c(1,3).registerObject(p,"Cache");r.exports=p;return r.exports};v[4]=function(r,p){var f=c(3,4);p=function(){};p.setRoomType=function(f,e){void 0===e?delete Memory.rooms[f].roomType:(Memory.rooms[f]||(Memory.rooms[f]={}),Memory.rooms[f].roomType=e)};p.claimRoom=function(f,e,a){Memory.maxCreeps.claimer||(Memory.maxCreeps.claimer={});Memory.maxCreeps.claimer[f]||(Memory.maxCreeps.claimer[f]={});a?
Memory.maxCreeps.claimer[f][e]=!0:delete Memory.maxCreeps.claimer[f][e]};p.attackRoom=function(f,e,a){Memory.maxCreeps.converter||(Memory.maxCreeps.converter={});Memory.maxCreeps.converter[f]||(Memory.maxCreeps.converter[f]={});a?Memory.maxCreeps.converter[f][e]=!0:delete Memory.maxCreeps.converter[f][e]};p.claimMine=function(c){Game.rooms[c]&&f.creeps[c]&&_.forEach(f.creeps[c].remoteReserver,function(e){e.claimController(Game.rooms[c].controller)})};p.dismantle=function(f,e,a){Memory.dismantle||
(Memory.dismantle={});Memory.dismantle[a]||(Memory.dismantle[a]=[]);Memory.dismantle[a].push({x:f,y:e})};p.stopCreep=function(f){Game.creeps[f]&&(Game.creeps[f].memory.stop=!0)};p.startCreep=function(f){Game.creeps[f]&&delete Game.creeps[f].memory.stop};p.startAllCreeps=function(){_.forEach(Game.creeps,function(f){delete f.memory.stop})};p.setContainerSource=function(f,e){Memory.containerSource[f]=e};p.addAlly=function(f){Memory.allies.push(f)};p.removeAlly=function(f){_.pull(Memory.allies,f)};p.createArmy=
function(f,e){void 0===e?delete Memory.army[f]:(Memory.army[f]=e,Memory.army[f].directive="preparing")};p.avoidRoom=function(f,e){e&&-1===Memory.avoidRooms.indexOf(f)&&Memory.avoidRooms.push(f);e||_.remove(Memory.avoidRooms,function(a){return a===f})};p.avoidSquare=function(f,e,a,b){b&&(Memory.avoidSquares[a]||(Memory.avoidSquares[a]=[]),Memory.avoidSquares[a].push({x:f,y:e}));b||Memory.avoidSquares[a]&&_.remove(Memory.avoidSquares[a],function(a){return a.x===f&&a.y===e})};p.addSign=function(f,e){Memory.signs||
(Memory.signs={});e?Memory.signs[f]=e:delete Memory.signs[f]};p.resetMatrix=function(f){Memory.baseMatrixes[f]={}};p.recover=function(){_.forEach(Game.spawns,function(f){f.createCreep([MOVE,MOVE,CARRY,CARRY,CARRY,CARRY],"storer-emerg-"+f.room.name+"-"+f.name,{role:"storer",home:f.room.name})})};Memory.profiling&&c(1,4).registerObject(p,"Commands");r.exports=p;return r.exports};v[5]=function(r,p){p=function(){};p.progressBar=function(f,c,e,a,b,d,x,m){void 0===m.showMax&&(m.showMax=!0);void 0===m.valueDecimals&&
(m.valueDecimals=0);f.rect(c,e,a,b,{fill:m.background}).rect(c,e,a*Math.min(d/x,1),b,{fill:m.bar}).text(""+(m.label?m.label+" ":"")+d.toFixed(m.valueDecimals)+(m.showMax?"/"+x.toFixed(0):"")+(m.showDetails?" ("+(100*d/x).toFixed(3)+"%) "+(x-d).toFixed(0)+" to go":""),c+a/2,e+b/2+.175,{align:"center",color:m.color,font:m.font})};p.sparkline=function(f,c,e,a,b,d,x,m){f.rect(c,e,a,b,{fill:"#404040",opacity:.5});_.forEach(m,function(d){f.poly(_.map(values,function(n,m){return[c+m/(values.length-1)*a,
e+b*(1-(n[d.key]-d.min)/(d.max-d.min))]}),d)})};p.resource=function(f,c,e,a,b,d){switch(b){case RESOURCE_ENERGY:f.circle(c,e,{radius:.625*a/2,fill:"#FFE664",opacity:d.opacity});break;case RESOURCE_POWER:f.circle(c,e,{radius:.625*a/2,fill:"#FF1930",opacity:d.opacity});break;case RESOURCE_HYDROGEN:f.circle(c,e,{radius:.4375*a,fill:"#B4B4B4",opacity:d.opacity}).circle(c,e,{radius:.375*a,fill:"#4C4C4C",opacity:d.opacity}).text(b,c,e+.2*a,{color:"#B4B4B4",size:.625*a,opacity:d.opacity});break;case RESOURCE_OXYGEN:f.circle(c,
e,{radius:.4375*a,fill:"#B4B4B4",opacity:d.opacity}).circle(c,e,{radius:.375*a,fill:"#4C4C4C",opacity:d.opacity}).text(b,c,e+.2*a,{color:"#B4B4B4",size:.625*a,opacity:d.opacity});break;case RESOURCE_UTRIUM:f.circle(c,e,{radius:.4375*a,fill:"#50D7F9",opacity:d.opacity}).circle(c,e,{radius:.375*a,fill:"#006181",opacity:d.opacity}).text(b,c,e+.2*a,{color:"#50D7F9",size:.625*a,opacity:d.opacity});break;case RESOURCE_KEANIUM:f.circle(c,e,{radius:.4375*a,fill:"#A071FF",opacity:d.opacity}).circle(c,e,{radius:.375*
a,fill:"#371383",opacity:d.opacity}).text(b,c,e+.2*a,{color:"#A071FF",size:.625*a,opacity:d.opacity});break;case RESOURCE_LEMERGIUM:f.circle(c,e,{radius:.4375*a,fill:"#00F4A2",opacity:d.opacity}).circle(c,e,{radius:.375*a,fill:"#236144",opacity:d.opacity}).text(b,c,e+.2*a,{color:"#00F4A2",size:.625*a,opacity:d.opacity});break;case RESOURCE_ZYNTHIUM:f.circle(c,e,{radius:.4375*a,fill:"#FDD388",opacity:d.opacity}).circle(c,e,{radius:.375*a,fill:"#5D4C2E",opacity:d.opacity}).text(b,c,e+.2*a,{color:"#FDD388",
size:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYST:f.circle(c,e,{radius:.4375*a,fill:"#FF7B7B",opacity:d.opacity}).circle(c,e,{radius:.375*a,fill:"#592121",opacity:d.opacity}).text(b,c,e+.2*a,{color:"#FF7B7B",size:.625*a,opacity:d.opacity});break;case RESOURCE_HYDROXIDE:f.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#B4B4B4",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#666666",size:.625*a,opacity:d.opacity});break;case RESOURCE_ZYNTHIUM_KEANITE:f.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#B4B4B4",
opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#666666",size:.625*a,opacity:d.opacity});break;case RESOURCE_UTRIUM_LEMERGITE:f.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#B4B4B4",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#666666",size:.625*a,opacity:d.opacity});break;case RESOURCE_GHODIUM:f.rect(c-a/2,e-a/2,a,a,{fill:"#FFFFFF",opacity:d.opacity}).text(b,c,e+.2*a,{color:"#666666",size:.625*a,opacity:d.opacity});break;case RESOURCE_UTRIUM_HYDRIDE:f.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#50D7F9",opacity:d.opacity}).text(b,
c+.1875*a,e+.2*a,{color:"#006181",font:.625*a,opacity:d.opacity});break;case RESOURCE_UTRIUM_OXIDE:f.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#50D7F9",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#006181",font:.625*a,opacity:d.opacity});break;case RESOURCE_KEANIUM_HYDRIDE:f.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#A071FF",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#371383",font:.625*a,opacity:d.opacity});break;case RESOURCE_KEANIUM_OXIDE:f.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#A071FF",opacity:d.opacity}).text(b,
c+.1875*a,e+.2*a,{color:"#371383",font:.625*a,opacity:d.opacity});break;case RESOURCE_LEMERGIUM_HYDRIDE:f.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#00F4A2",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#236144",font:.625*a,opacity:d.opacity});break;case RESOURCE_LEMERGIUM_OXIDE:f.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#00F4A2",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#236144",font:.625*a,opacity:d.opacity});break;case RESOURCE_ZYNTHIUM_HYDRIDE:f.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#FDD388",opacity:d.opacity}).text(b,
c+.1875*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:d.opacity});break;case RESOURCE_ZYNTHIUM_OXIDE:f.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#FDD388",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:d.opacity});break;case RESOURCE_GHODIUM_HYDRIDE:f.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#FFFFFF",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#666666",font:.625*a,opacity:d.opacity});break;case RESOURCE_GHODIUM_OXIDE:f.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#FFFFFF",opacity:d.opacity}).text(b,
c+.1875*a,e+.2*a,{color:"#666666",font:.625*a,opacity:d.opacity});break;case RESOURCE_UTRIUM_ACID:f.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#50D7F9",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#006181",font:.625*a,opacity:d.opacity});break;case RESOURCE_UTRIUM_ALKALIDE:f.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#50D7F9",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#006181",font:.625*a,opacity:d.opacity});break;case RESOURCE_KEANIUM_ACID:f.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#A071FF",opacity:d.opacity}).text(b,
c+.5*a,e+.2*a,{color:"#371383",font:.625*a,opacity:d.opacity});break;case RESOURCE_KEANIUM_ALKALIDE:f.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#A071FF",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#371383",font:.625*a,opacity:d.opacity});break;case RESOURCE_LEMERGIUM_ACID:f.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#00F4A2",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#236144",font:.625*a,opacity:d.opacity});break;case RESOURCE_LEMERGIUM_ALKALIDE:f.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#00F4A2",opacity:d.opacity}).text(b,
c+.5*a,e+.2*a,{color:"#236144",font:.625*a,opacity:d.opacity});break;case RESOURCE_ZYNTHIUM_ACID:f.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#FDD388",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:d.opacity});break;case RESOURCE_ZYNTHIUM_ALKALIDE:f.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#FDD388",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:d.opacity});break;case RESOURCE_GHODIUM_ACID:f.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#FFFFFF",opacity:d.opacity}).text(b,
c+.5*a,e+.2*a,{color:"#666666",font:.625*a,opacity:d.opacity});break;case RESOURCE_GHODIUM_ALKALIDE:f.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#FFFFFF",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#666666",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_UTRIUM_ACID:f.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#50D7F9",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#006181",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_UTRIUM_ALKALIDE:f.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#50D7F9",
opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#006181",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_KEANIUM_ACID:f.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#A071FF",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#371383",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_KEANIUM_ALKALIDE:f.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#A071FF",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#371383",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_LEMERGIUM_ACID:f.rect(c-
a/2,e-a/2,2.5*a,a,{fill:"#00F4A2",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#236144",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE:f.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#00F4A2",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#236144",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_ZYNTHIUM_ACID:f.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#FDD388",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE:f.rect(c-
a/2,e-a/2,2.5*a,a,{fill:"#FDD388",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_GHODIUM_ACID:f.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#FFFFFF",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#666666",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_GHODIUM_ALKALIDE:f.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#FFFFFF",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#666666",font:.625*a,opacity:d.opacity})}};Memory.profiling&&
c(1,5).registerObject(p,"Drawing");r.exports=p;return r.exports};v[6]=function(r,p){var f=c(3,6),q=c(10,6),e=function(){};e.getAllOrders=function(){if(!e.orders||Game.cpu.bucket>=Memory.marketBucket)e.orders=Game.market.getAllOrders(),delete e.filteredOrders;return e.orders};e.getFilteredOrders=function(){e.filteredOrders||(e.filteredOrders=q.nest(_.filter(e.getAllOrders(),function(a){return 0<a.amount}),[function(a){return a.type},function(a){return a.resourceType}]),_.forEach(e.filteredOrders.sell,
function(a,b){e.filteredOrders.sell[b].sort(function(a,b){return a.price-b.price})}),_.forEach(e.filteredOrders.buy,function(a,b){e.filteredOrders.buy[b].sort(function(a,b){return b.price-a.price})}));return e.filteredOrders};e.deal=function(a,b,d){var c=Game.market.deal(a,b,d),m=_.find(e.orders,function(b){return b.id===a});c===OK?m&&("sell"===m.type&&(f.credits-=m.amount*m.price),m.amount<=b?(f.log.events.push(d+" "+m.resourceType+" x"+b+" @ "+m.price+" completed, "+m.type+" sold out "+m.id),_.remove(e.filteredOrders[m.type][m.resourceType],
function(b){return b.id===a}),_.remove(e.orders,function(b){return b.id===a})):(m.amount-=b,f.log.events.push(d+" "+m.resourceType+" x"+b+" @ "+m.price+" completed, "+m.type+" "+m.amount+" remaining on "+m.id))):m&&(f.log.events.push(d+" failed to process order ID "+a+": "+c),_.remove(e.filteredOrders[m.type][m.resourceType],function(b){return b.id===a}),_.remove(e.orders,function(b){return b.id===a}));return c};Memory.profiling&&c(1,6).registerObject(e,"Market");r.exports=e;return r.exports};v[7]=
function(c,p){p={};p[RESOURCE_HYDROGEN]=[];p[RESOURCE_OXYGEN]=[];p[RESOURCE_ZYNTHIUM]=[];p[RESOURCE_KEANIUM]=[];p[RESOURCE_UTRIUM]=[];p[RESOURCE_LEMERGIUM]=[];p[RESOURCE_CATALYST]=[];p[RESOURCE_HYDROXIDE]=[RESOURCE_HYDROGEN,RESOURCE_OXYGEN];p[RESOURCE_ZYNTHIUM_KEANITE]=[RESOURCE_ZYNTHIUM,RESOURCE_KEANIUM];p[RESOURCE_UTRIUM_LEMERGITE]=[RESOURCE_UTRIUM,RESOURCE_LEMERGIUM];p[RESOURCE_GHODIUM]=[RESOURCE_ZYNTHIUM_KEANITE,RESOURCE_UTRIUM_LEMERGITE];p[RESOURCE_UTRIUM_HYDRIDE]=[RESOURCE_UTRIUM,RESOURCE_HYDROGEN];
p[RESOURCE_UTRIUM_OXIDE]=[RESOURCE_UTRIUM,RESOURCE_OXYGEN];p[RESOURCE_KEANIUM_HYDRIDE]=[RESOURCE_KEANIUM,RESOURCE_HYDROGEN];p[RESOURCE_KEANIUM_OXIDE]=[RESOURCE_KEANIUM,RESOURCE_OXYGEN];p[RESOURCE_LEMERGIUM_HYDRIDE]=[RESOURCE_LEMERGIUM,RESOURCE_HYDROGEN];p[RESOURCE_LEMERGIUM_OXIDE]=[RESOURCE_LEMERGIUM,RESOURCE_OXYGEN];p[RESOURCE_ZYNTHIUM_HYDRIDE]=[RESOURCE_ZYNTHIUM,RESOURCE_HYDROGEN];p[RESOURCE_ZYNTHIUM_OXIDE]=[RESOURCE_ZYNTHIUM,RESOURCE_OXYGEN];p[RESOURCE_GHODIUM_HYDRIDE]=[RESOURCE_GHODIUM,RESOURCE_HYDROGEN];
p[RESOURCE_GHODIUM_OXIDE]=[RESOURCE_GHODIUM,RESOURCE_OXYGEN];p[RESOURCE_UTRIUM_ACID]=[RESOURCE_UTRIUM_HYDRIDE,RESOURCE_HYDROXIDE];p[RESOURCE_UTRIUM_ALKALIDE]=[RESOURCE_UTRIUM_OXIDE,RESOURCE_HYDROXIDE];p[RESOURCE_KEANIUM_ACID]=[RESOURCE_KEANIUM_HYDRIDE,RESOURCE_HYDROXIDE];p[RESOURCE_KEANIUM_ALKALIDE]=[RESOURCE_KEANIUM_OXIDE,RESOURCE_HYDROXIDE];p[RESOURCE_LEMERGIUM_ACID]=[RESOURCE_LEMERGIUM_HYDRIDE,RESOURCE_HYDROXIDE];p[RESOURCE_LEMERGIUM_ALKALIDE]=[RESOURCE_LEMERGIUM_OXIDE,RESOURCE_HYDROXIDE];p[RESOURCE_ZYNTHIUM_ACID]=
[RESOURCE_ZYNTHIUM_HYDRIDE,RESOURCE_HYDROXIDE];p[RESOURCE_ZYNTHIUM_ALKALIDE]=[RESOURCE_ZYNTHIUM_OXIDE,RESOURCE_HYDROXIDE];p[RESOURCE_GHODIUM_ACID]=[RESOURCE_GHODIUM_HYDRIDE,RESOURCE_HYDROXIDE];p[RESOURCE_GHODIUM_ALKALIDE]=[RESOURCE_GHODIUM_OXIDE,RESOURCE_HYDROXIDE];p[RESOURCE_CATALYZED_UTRIUM_ACID]=[RESOURCE_UTRIUM_ACID,RESOURCE_CATALYST];p[RESOURCE_CATALYZED_UTRIUM_ALKALIDE]=[RESOURCE_UTRIUM_ALKALIDE,RESOURCE_CATALYST];p[RESOURCE_CATALYZED_KEANIUM_ACID]=[RESOURCE_KEANIUM_ACID,RESOURCE_CATALYST];
p[RESOURCE_CATALYZED_KEANIUM_ALKALIDE]=[RESOURCE_KEANIUM_ALKALIDE,RESOURCE_CATALYST];p[RESOURCE_CATALYZED_LEMERGIUM_ACID]=[RESOURCE_LEMERGIUM_ACID,RESOURCE_CATALYST];p[RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE]=[RESOURCE_LEMERGIUM_ALKALIDE,RESOURCE_CATALYST];p[RESOURCE_CATALYZED_ZYNTHIUM_ACID]=[RESOURCE_ZYNTHIUM_ACID,RESOURCE_CATALYST];p[RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE]=[RESOURCE_ZYNTHIUM_ALKALIDE,RESOURCE_CATALYST];p[RESOURCE_CATALYZED_GHODIUM_ACID]=[RESOURCE_GHODIUM_ACID,RESOURCE_CATALYST];p[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]=
[RESOURCE_GHODIUM_ALKALIDE,RESOURCE_CATALYST];c.exports=p;return c.exports};v[8]=function(r,p){var f=c(1,8);p=function(){};p.run=function(c,e){f.registerFN(e,"Proxy."+c)()};Memory.profiling&&f.registerObject(p,"Proxy");r.exports=p;return r.exports};v[9]=function(r,p){var f=[];p=function(c){this.id=c;if(!f[c])try{f[c]=JSON.parse(RawMemory.segments[c])}catch(e){f[c]=void 0}};p.init=function(){RawMemory.setActiveSegments([1,2,3,4,5,6,7,8,9,10])};p.prototype.set=function(){RawMemory.segments[this.id]=
JSON.stringify(f[this.id])};$jscomp.global.Object.defineProperties(p.prototype,{memory:{configurable:!0,enumerable:!0,get:function(){return f[this.id]},set:function(c){f[this.id]=c}}});Memory.profiling&&c(1,9).registerObject(p,"Segment");r.exports=p;return r.exports};v[10]=function(r,p){var f=c(3,10),q=function(){};q.nest=function(f,a){return a.length?_.mapValues(_.groupBy(f,a[0]),function(b){return q.nest(b,a.slice(1))}):f};q.creepsWithNoTask=function(f){return _.filter(f,function(a){return!a.memory.currentTask||
a.memory.currentTask.unimportant})};q.objectsClosestToObj=function(f,a){var b=a.id;if(0===f.length)return[];if(!a)return f;f=_.map(f,function(d){var f=d.id,m;Memory.ranges&&Memory.ranges[b]&&Memory.ranges[b][f]?m=Memory.ranges[b][f]:(m=a.pos.getRangeTo(d),d instanceof Creep||a instanceof Creep||(Memory.ranges||(Memory.ranges={}),Memory.ranges[b]||(Memory.ranges[b]={}),Memory.ranges[b][f]=m));return{object:d,distance:m}});f.sort(function(a,b){return a.distance-b.distance});return _.map(f,function(a){return a.object})};
q.getEmptyPosAroundPos=function(f){var a=0,b,d,e;for(b=f.x-1;b<f.x+2;b++)for(d=f.y-1;d<f.y+2;d++)if(b!==f.x||d!==f.y)e=new RoomPosition(b,d,f.roomName),a+=_.filter(e.look(),function(a){return"terrain"===a.type&&"wall"!==a.terrain}).length;return a};q.checkSiteIsClear=function(f){var a=!0,b=f.x,d=f.y,e=f.roomName,m=Game.rooms[e];if("wall"===(new RoomPosition(b,d,e)).lookFor(LOOK_TERRAIN)[0]||"wall"===(new RoomPosition(b-1,d,e)).lookFor(LOOK_TERRAIN)[0]&&"wall"===(new RoomPosition(b+1,d,e)).lookFor(LOOK_TERRAIN)[0]||
"wall"===(new RoomPosition(b,d-1,e)).lookFor(LOOK_TERRAIN)[0]&&"wall"===(new RoomPosition(b,d+1,e)).lookFor(LOOK_TERRAIN)[0])return!1;_.forEach(m.find(FIND_SOURCES),function(b){return a=1<f.getRangeTo(b)});if(!a)return!1;_.forEach(m.find(FIND_MINERALS),function(b){return a=1<f.getRangeTo(b)});if(!a||4>=f.getRangeTo(m.controller))return!1;b=_.filter(f.lookFor(LOOK_STRUCTURES),function(a){return"rampart"!==a.structureType});return 0===b.length?!0:_.filter(b,function(a){return-1!==[STRUCTURE_ROAD,STRUCTURE_WALL].indexOf(a.structureType)}).length!==
b.length?!1:b};q.buildStructures=function(f,a,b,d){var e=1,m=d.pos;d=m.x;for(var m=m.y,n,c,g;0<b&&50>e;){for(n=d-e;n<=d+e;n+=2){for(c=m-e;c<=m+e&&(1>n||48<n||1>c||48<c||0<_.filter(f.find(FIND_MY_CONSTRUCTION_SITES),function(a){return a.pos.x===n&&a.pos.y===c}).length||(g=q.checkSiteIsClear(new RoomPosition(n,c,f.name)),!1===g||(!0!==g&&_.forEach(g,function(a){a.destroy()}),f.createConstructionSite(n,c,a),b--,0!==b)));c+=Math.abs(d-n)===e?2:2*e);if(0===b)break}e++}};q.getBodypartCost=function(f){return _.sum(_.map(f,
function(a){return BODYPART_COST[a]}))};q.getSourceLabs=function(e){var a=f.labsInRoom(e),b=[];_.forEach(a,function(d){if(2>=q.objectsClosestToObj(a,d)[a.length-1].pos.getRangeTo(d)&&(b.push(d.id),2<=b.length))return!1});return b};q.getLabToBoostWith=function(e,a){var b=e.memory.labQueue,d=b&&b.sourceLabs?b.sourceLabs:[],c=[],b=null,m;a||(a=1);0===d.length&&(d=q.getSourceLabs(e));e.memory.labsInUse||(e.memory.labsInUse=[]);for(var n=0;n<a;n++){b={};m=_.filter(f.labsInRoom(e),function(a){return-1===
d.indexOf(a.id)&&-1===_.map(e.memory.labsInUse,function(a){return a.id}).indexOf(a.id)&&-1===_.map(c,function(a){return a.id}).indexOf(a.id)});0<m.length&&(b={id:m[0].id,pause:!1});if(!b||!b.id){b={id:_.filter(d,function(a){return-1===_.map(e.memory.labsInUse,function(a){return a.id}).indexOf(a)&&-1===_.map(c,function(a){return a.id}).indexOf(a)})[0],pause:!0};if(!b.id)return!1;m=Game.getObjectById(b.id);0<m.mineralAmount&&(b.status="emptying",b.oldResource=m.mineralType,b.oldAmount=m.mineralAmount)}if(!b.id)return!1;
c.push(b)}return c};q.roomLabsArePaused=function(f){return f.memory.labsInUse&&0<_.filter(f.memory.labsInUse,function(a){return a.pause}).length};Memory.profiling&&c(1,10).registerObject(q,"Utilities");r.exports=q;return r.exports};v[11]=function(r,p){var f=c(3,11),q=c(10,11),e=c(43,11),a=c(51,11),b=function(){};b.checkSpawn=function(a,c){var d=_.filter(f.creeps[a]&&f.creeps[a].armyDismantler||[],function(a){return a.spawning||300<a.ticksToLive}).length,n=Memory.army[a].dismantler.maxCreeps;d<n&&
b.spawn(a,c);Memory.log&&0<n&&f.log.army[a].creeps.push({role:"armyDismantler",count:d,max:n})};b.spawn=function(a,b){var d=Memory.army[a],n=d.dismantler.units,c=[],g,h,l,k;d.boostRoom&&(g=Game.rooms[d.boostRoom],h=g.memory.labsInUse);if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;for(l=0;5>l;l++)c.push(TOUGH);for(l=0;l<n;l++)c.push(WORK);for(l=0;l<n+5;l++)c.push(MOVE);if(g&&!(k=q.getLabToBoostWith(g,2)))return!1;l=_.filter(Game.spawns,function(a){return!a.spawning&&
!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(c)&&a.room.memory.region===d.region})[0];if(!l)return!1;a=l.createCreep(c,"armyDismantler-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"armyDismantler",army:a,labs:g?_.map(k,function(a){return a.id}):[],portals:b});f.spawning[l.id]="number"!==typeof a;"number"!==typeof a&&g&&(k[0].creepToBoost=a,k[0].resource=RESOURCE_CATALYZED_GHODIUM_ALKALIDE,k[0].amount=150,h.push(k[0]),k[1].creepToBoost=a,k[1].resource=RESOURCE_CATALYZED_ZYNTHIUM_ACID,
k[1].amount=30*n,h.push(k[1]),f.creeps[g.name]&&_.forEach(_.filter(f.creeps[g.name].all,function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&-1!==_.map(k,function(a){return a.id}).indexOf(a.memory.currentTask.id)}),function(a){delete a.memory.currentTask}));return"number"!==typeof a};b.assignTasks=function(b,c,m){var d=_.filter(q.creepsWithNoTask(f.creeps[b]&&f.creeps[b].armyDismantler||[]),function(a){return!a.spawning}),t=[],g=Memory.army[b],h=g.stageRoom,l=g.attackRoom,
k=Game.rooms[l],u=g.dismantle,w,x;switch(c){case "building":_.forEach(_.filter(d,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(b){(new a(b.memory.labs[0])).canAssign(b);t.push(b.name)});_.remove(d,function(a){return-1!==t.indexOf(a.name)});t=[];if(0===d.length)break;w=new a(g.buildRoom);_.forEach(d,function(b){b.say("Building");b.memory.portaling&&b.memory.portals[0]!==b.room.name&&b.memory.portals.shift();b.memory.portals&&0<b.memory.portals.length?b.memory.portals[0]===b.room.name?
(b.memory.portaling=!0,w=new a(f.portalsInRoom(b.room)[0].id)):w=new a(b.memory.portals[0]):w=new a(g.buildRoom);w.canAssign(b)});break;case "staging":w=new a(h);_.forEach(d,function(a){a.say("Staging");w.canAssign(a)});break;case "dismantle":x=f.creeps[b].armyHealer||[];if(0<x.length&&h!==l&&(w=new a(h),w.range=22,_.forEach(_.filter(f.creeps[b].armyDismantler,function(a){return(a.room.name===l||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&1E3<=a.hitsMax-a.hits}),function(a){a.say("Ouch!");
w.canAssign(a);t.push(a.name)}),_.remove(d,function(a){return-1!==t.indexOf(a.name)}),t=[],0===d.length))break;if(0<x.length&&(_.forEach(d,function(b){var d=q.objectsClosestToObj(x,b);2<d[0].pos.getRangeTo(b)&&(d=new a(d[0].id),d.canAssign(b),t.push(b.name))}),_.remove(d,function(a){return-1!==t.indexOf(a.name)}),t=[],0===d.length))break;0<x.length&&_.remove(d,function(a){return 1E3<=a.hitsMax-a.hits});if(k&&0<u.length&&(w=new e(u[0]),_.forEach(d,function(a){w.canAssign(a)&&(a.say("Dismantle"),t.push(a.name))}),
_.remove(d,function(a){return-1!==t.indexOf(a.name)}),t=[],0===d.length))break;w=new a(l);_.forEach(d,function(a){w.canAssign(a)});break;case "attack":x=f.creeps[b].armyHealer||[];if(0<x.length&&h!==l&&(w=new a(h),w.range=22,_.forEach(_.filter(f.creeps[b].armyDismantler,function(a){return(a.room.name===l||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&1E3<=a.hitsMax-a.hits}),function(a){a.say("Ouch!");w.canAssign(a);t.push(a.name)}),_.remove(d,function(a){return-1!==t.indexOf(a.name)}),t=[],0===
d.length))break;0<x.length&&_.remove(d,function(a){return 1E3<=a.hitsMax-a.hits});if(k&&(b=_.filter(k.find(FIND_HOSTILE_STRUCTURES),function(a){return a.structureType!==STRUCTURE_CONTROLLER&&a.structureType!==STRUCTURE_RAMPART&&a.structureType!==STRUCTURE_KEEPER_LAIR}),0<b.length&&(w=new e(b[0].id),_.forEach(d,function(a){w.canAssign(a)&&(a.say("Dismantle"),t.push(a.name))}),_.remove(d,function(a){return-1!==t.indexOf(a.name)}),t=[],0===d.length)))break;_.forEach(m.rally.tasks,function(a){_.forEach(d,
function(b){a.canAssign(b);t.push(b.name);return!1});_.remove(d,function(a){return-1!==t.indexOf(a.name)});t=[]});w=g.restPosition?new a(new RoomPosition(g.restPosition.x,g.restPosition.y,g.restPosition.room)):new a(l);_.forEach(d,function(a){w.canAssign(a)})}};Memory.profiling&&c(1,11).registerObject(b,"ArmyDismantler");r.exports=b;return r.exports};v[12]=function(r,p){var f=c(3,12),q=c(10,12),e=c(47,12),a=c(51,12),b=function(){};b.checkSpawn=function(a,c){var d=_.filter(f.creeps[a]&&f.creeps[a].armyHealer||
[],function(a){return a.spawning||300<a.ticksToLive}).length,n=Memory.army[a].healer.maxCreeps;d<n&&b.spawn(a,c);Memory.log&&0<n&&f.log.army[a].creeps.push({role:"armyHealer",count:d,max:n})};b.spawn=function(a,b){var d=Memory.army[a],n=d.healer.units,c=[],g,h,l,k;d.boostRoom&&(g=Game.rooms[d.boostRoom],h=g.memory.labsInUse);if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;for(l=0;5>l;l++)c.push(TOUGH);for(l=0;l<n-1;l++)c.push(HEAL);for(l=0;l<n+5;l++)c.push(MOVE);
c.push(HEAL);if(g&&!(k=q.getLabToBoostWith(g,2)))return!1;l=_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(c)&&a.room.memory.region===d.region})[0];if(!l)return!1;a=l.createCreep(c,"armyHealer-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"armyHealer",army:a,labs:g?_.map(k,function(a){return a.id}):[],portals:b});f.spawning[l.id]="number"!==typeof a;"number"!==typeof a&&g&&(k[0].creepToBoost=a,k[0].resource=RESOURCE_CATALYZED_GHODIUM_ALKALIDE,
k[0].amount=150,h.push(k[0]),k[1].creepToBoost=a,k[1].resource=RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE,k[1].amount=30*n,h.push(k[1]),f.creeps[g.name]&&_.forEach(_.filter(f.creeps[g.name].all,function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&-1!==_.map(k,function(a){return a.id}).indexOf(a.memory.currentTask.id)}),function(a){delete a.memory.currentTask}));return"number"!==typeof a};b.assignTasks=function(b,c,m){var d=[],t=Memory.army[b],g=t.stageRoom,h=t.attackRoom,
l=t.dismantle,k,u;_.forEach(_.filter(f.creeps[b]&&f.creeps[b].armyHealer||[],function(a){return!a.spawning&&a.memory.escorting}),function(b){Game.getObjectById(b.memory.escorting)?1E3>b.hitsMax-b.hits&&!(new e(b.memory.escorting)).canAssign(b)&&(new a(b.memory.escorting)).canAssign(b):delete b.memory.escorting});k=_.filter(q.creepsWithNoTask(f.creeps[b]&&f.creeps[b].armyHealer||[]),function(a){return!a.spawning&&!a.memory.escorting});switch(c){case "building":_.forEach(_.filter(k,function(a){return a.memory.labs&&
0<a.memory.labs.length}),function(b){(new a(b.memory.labs[0])).canAssign(b);d.push(b.name)});_.remove(k,function(a){return-1!==d.indexOf(a.name)});d=[];if(0===k.length)break;u=new a(t.buildRoom);_.forEach(k,function(b){b.say("Building");b.memory.portaling&&b.memory.portals[0]!==b.room.name&&b.memory.portals.shift();b.memory.portals&&0<b.memory.portals.length?b.memory.portals[0]===b.room.name?(b.memory.portaling=!0,u=new a(f.portalsInRoom(b.room)[0].id)):u=new a(b.memory.portals[0]):u=new a(t.buildRoom);
u.canAssign(b)});break;case "staging":u=new a(g);_.forEach(k,function(a){a.say("Staging");u.canAssign(a)});break;case "dismantle":if(g!==h&&(u=new a(g),u.range=22,_.forEach(_.filter(f.creeps[b].armyHealer,function(a){return(a.room.name===h||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&1E3<=a.hitsMax-a.hits}),function(a){a.say("Ouch!");u.canAssign(a);d.push(a.name)}),_.remove(k,function(a){return-1!==d.indexOf(a.name)}),d=[],0===k.length))break;_.forEach(m.heal.tasks,function(a){_.forEach(k,
function(b){a.canAssign(b)&&(b.say("Heal"),d.push(b.name))});_.remove(k,function(a){return-1!==d.indexOf(a.name)});d=[]});if(Game.rooms[h]&&0<l.length&&(u=new a(l[0]),u.range=3,_.forEach(k,function(a){u.canAssign(a);d.push(a.name)}),_.remove(k,function(a){return-1!==d.indexOf(a.name)}),d=[],0===k.length))break;u=new a(h);_.forEach(k,function(a){u.canAssign(a)});break;case "attack":if(g!==h&&(u=new a(g),u.range=22,_.forEach(_.filter(f.creeps[b].armyHealer,function(a){return(a.room.name===h||1>=a.pos.x||
48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&1E3<=a.hitsMax-a.hits}),function(a){a.say("Ouch!");u.canAssign(a);d.push(a.name)}),_.remove(k,function(a){return-1!==d.indexOf(a.name)}),d=[],0===k.length))break;_.forEach(m.heal.tasks,function(a){_.forEach(k,function(b){a.canAssign(b)&&(b.say("Heal"),d.push(b.name))});_.remove(k,function(a){return-1!==d.indexOf(a.name)});d=[]});Game.rooms[h]&&!Game.rooms[h].unobservable&&_.forEach(e.getTasks(Game.rooms[h]),function(a){_.forEach(k,function(b){a.canAssign(b)&&
(b.say("Heal"),d.push(b.name))});_.remove(k,function(a){return-1!==d.indexOf(a.name)});d=[]});_.forEach(m.rally.tasks,function(a){_.forEach(k,function(b){a.canAssign(b);d.push(b.name);return!1});_.remove(k,function(a){return-1!==d.indexOf(a.name)});d=[]});u=t.restPosition?new a(new RoomPosition(t.restPosition.x,t.restPosition.y,t.restPosition.room)):new a(h);_.forEach(k,function(a){u.canAssign(a)})}};Memory.profiling&&c(1,12).registerObject(b,"ArmyHealer");r.exports=b;return r.exports};v[13]=function(r,
p){var f=c(3,13),q=c(10,13),e=c(51,13),a=function(){};a.checkSpawn=function(b,d){var c=_.filter(f.creeps[b]&&f.creeps[b].armyMelee||[],function(a){return a.spawning||300<a.ticksToLive}).length,m=Memory.army[b].melee.maxCreeps;c<m&&a.spawn(b,d);Memory.log&&0<m&&f.log.army[b].creeps.push({role:"armyMelee",count:c,max:m})};a.spawn=function(a,d){var b=Memory.army[a],m=b.melee.units,c=[],e,g,h,l;b.boostRoom&&(e=Game.rooms[b.boostRoom],g=e.memory.labsInUse);if(0===_.filter(Game.spawns,function(a){return!a.spawning&&
!f.spawning[a.id]}).length)return!1;for(h=0;5>h;h++)c.push(TOUGH);for(h=0;h<m;h++)c.push(ATTACK);for(h=0;h<m+5;h++)c.push(MOVE);if(e&&!(l=q.getLabToBoostWith(e,2)))return!1;h=_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(c)&&a.room.memory.region===b.region})[0];if(!h)return!1;a=h.createCreep(c,"armyMelee-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"armyMelee",army:a,labs:e?_.map(l,function(a){return a.id}):[],portals:d});f.spawning[h.id]=
"number"!==typeof a;"number"!==typeof a&&e&&(l[0].creepToBoost=a,l[0].resource=RESOURCE_CATALYZED_GHODIUM_ALKALIDE,l[0].amount=150,g.push(l[0]),l[1].creepToBoost=a,l[1].resource=RESOURCE_CATALYZED_UTRIUM_ACID,l[1].amount=30*m,g.push(l[1]),f.creeps[e.name]&&_.forEach(_.filter(f.creeps[e.name].all,function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&-1!==_.map(l,function(a){return a.id}).indexOf(a.memory.currentTask.id)}),function(a){delete a.memory.currentTask}));return"number"!==
typeof a};a.assignTasks=function(a,d,c){var b=_.filter(q.creepsWithNoTask(f.creeps[a]&&f.creeps[a].armyMelee||[]),function(a){return!a.spawning}),n=[],t=Memory.army[a],g=t.stageRoom,h=t.attackRoom,l=t.dismantle,k,u;switch(d){case "building":_.forEach(_.filter(b,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(a){(new e(a.memory.labs[0])).canAssign(a);n.push(a.name)});_.remove(b,function(a){return-1!==n.indexOf(a.name)});n=[];if(0===b.length)break;k=new e(t.buildRoom);_.forEach(b,
function(a){a.say("Building");a.memory.portaling&&a.memory.portals[0]!==a.room.name&&a.memory.portals.shift();a.memory.portals&&0<a.memory.portals.length?a.memory.portals[0]===a.room.name?(a.memory.portaling=!0,k=new e(f.portalsInRoom(a.room)[0].id)):k=new e(a.memory.portals[0]):k=new e(t.buildRoom);k.canAssign(a)});break;case "staging":k=new e(g);_.forEach(b,function(a){a.say("Staging");k.canAssign(a)});break;case "dismantle":u=f.creeps[a].armyHealer||[];if(0<u.length&&g!==h&&(k=new e(g),k.range=
22,_.forEach(_.filter(f.creeps[a].armyMelee,function(a){return(a.room.name===h||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&1E3<=a.hitsMax-a.hits}),function(a){a.say("Ouch!");k.canAssign(a);n.push(a.name)}),_.remove(b,function(a){return-1!==n.indexOf(a.name)}),n=[],0===b.length))break;if(0<u.length&&(_.forEach(b,function(a){var b=q.objectsClosestToObj(u,a);2<b[0].pos.getRangeTo(a)&&(b=new e(b[0].id),b.canAssign(a),n.push(a.name))}),_.remove(b,function(a){return-1!==n.indexOf(a.name)}),n=[],
0===b.length))break;0<u.length&&_.remove(b,function(a){return 1E3<=a.hitsMax-a.hits});_.forEach(c.melee.tasks,function(a){_.forEach(b,function(b){a.canAssign(b)&&(b.say("Die!",!0),n.push(b.name))});_.remove(b,function(a){return-1!==n.indexOf(a.name)});n=[];if(0===b.length)return!1});if(0===b.length)break;if(Game.rooms[h]&&0<l.length&&(k=new e(l[0]),k.range=3,_.forEach(b,function(a){k.canAssign(a);n.push(a.name)}),_.remove(b,function(a){return-1!==n.indexOf(a.name)}),n=[],0===b.length))break;k=new e(h);
_.forEach(b,function(a){k.canAssign(a)});break;case "attack":u=f.creeps[a].armyHealer||[];if(0<u.length&&g!==h&&(k=new e(g),k.range=22,_.forEach(_.filter(f.creeps[a].armyMelee,function(a){return(a.room.name===h||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&1E3<=a.hitsMax-a.hits}),function(a){a.say("Ouch!");k.canAssign(a);n.push(a.name)}),_.remove(b,function(a){return-1!==n.indexOf(a.name)}),n=[],0===b.length))break;0<u.length&&_.remove(b,function(a){return 1E3<=a.hitsMax-a.hits});_.forEach(c.melee.tasks,
function(a){_.forEach(b,function(b){a.canAssign(b)&&(b.say("Die!",!0),n.push(b.name))});_.remove(b,function(a){return-1!==n.indexOf(a.name)});n=[];if(0===b.length)return!1});0!==b.length&&(_.forEach(c.rally.tasks,function(a){_.forEach(b,function(b){a.canAssign(b);n.push(b.name);return!1});_.remove(b,function(a){return-1!==n.indexOf(a.name)});n=[]}),k=t.restPosition?new e(new RoomPosition(t.restPosition.x,t.restPosition.y,t.restPosition.room)):new e(h),_.forEach(b,function(a){k.canAssign(a)}))}};Memory.profiling&&
c(1,13).registerObject(a,"ArmyMelee");r.exports=a;return r.exports};v[14]=function(r,p){var f=c(3,14),q=c(10,14),e=c(51,14),a=function(){};a.checkSpawn=function(b,d){var c=_.filter(f.creeps[b]&&f.creeps[b].armyRanged||[],function(a){return a.spawning||300<a.ticksToLive}).length,m=Memory.army[b].ranged.maxCreeps;c<m&&a.spawn(b,d);Memory.log&&0<m&&f.log.army[b].creeps.push({role:"armyRanged",count:c,max:m})};a.spawn=function(a,d){var b=Memory.army[a],c=b.ranged.units,n=[],e,g,h,l;b.boostRoom&&(e=Game.rooms[b.boostRoom],
g=e.memory.labsInUse);if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;for(h=0;5>h;h++)n.push(TOUGH);for(h=0;h<c;h++)n.push(RANGED_ATTACK);for(h=0;h<c+5;h++)n.push(MOVE);if(e&&!(l=q.getLabToBoostWith(e,2)))return!1;h=_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(n)&&a.room.memory.region===b.region})[0];if(!h)return!1;a=h.createCreep(n,"armyRanged-"+a+"-"+Game.time.toFixed(0).substring(4),
{role:"armyRanged",army:a,labs:e?_.map(l,function(a){return a.id}):[],portals:d});f.spawning[h.id]="number"!==typeof a;"number"!==typeof a&&e&&(l[0].creepToBoost=a,l[0].resource=RESOURCE_CATALYZED_GHODIUM_ALKALIDE,l[0].amount=150,g.push(l[0]),l[1].creepToBoost=a,l[1].resource=RESOURCE_CATALYZED_KEANIUM_ALKALIDE,l[1].amount=30*c,g.push(l[1]),f.creeps[e.name]&&_.forEach(_.filter(f.creeps[e.name].all,function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&-1!==_.map(l,function(a){return a.id}).indexOf(a.memory.currentTask.id)}),
function(a){delete a.memory.currentTask}));return"number"!==typeof a};a.assignTasks=function(a,d,c){var b=_.filter(q.creepsWithNoTask(f.creeps[a]&&f.creeps[a].armyRanged||[]),function(a){return!a.spawning}),n=[],t=Memory.army[a],g=t.stageRoom,h=t.attackRoom,l=t.dismantle,k,u;switch(d){case "building":_.forEach(_.filter(b,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(a){(new e(a.memory.labs[0])).canAssign(a);n.push(a.name)});_.remove(b,function(a){return-1!==n.indexOf(a.name)});
n=[];if(0===b.length)break;_.forEach(b,function(a){a.say("Building");a.memory.portaling&&a.memory.portals[0]!==a.room.name&&a.memory.portals.shift();a.memory.portals&&0<a.memory.portals.length?a.memory.portals[0]===a.room.name?(a.memory.portaling=!0,k=new e(f.portalsInRoom(a.room)[0].id)):k=new e(a.memory.portals[0]):k=new e(t.buildRoom);k.canAssign(a)});break;case "staging":k=new e(g);_.forEach(b,function(a){a.say("Staging");k.canAssign(a)});break;case "dismantle":u=f.creeps[a].armyHealer||[];if(0<
u.length&&g!==h&&(k=new e(g),k.range=22,_.forEach(_.filter(f.creeps[a].armyRanged,function(a){return(a.room.name===h||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&1E3<=a.hitsMax-a.hits}),function(a){a.say("Ouch!");k.canAssign(a);n.push(a.name)}),_.remove(b,function(a){return-1!==n.indexOf(a.name)}),n=[],0===b.length))break;if(0<u.length&&(_.forEach(b,function(a){var b=q.objectsClosestToObj(u,a);2<b[0].pos.getRangeTo(a)&&(b=new e(b[0].id),b.canAssign(a),n.push(a.name))}),_.remove(b,function(a){return-1!==
n.indexOf(a.name)}),n=[],0===b.length))break;0<u.length&&_.remove(b,function(a){return 1E3<=a.hitsMax-a.hits});_.forEach(c.ranged.tasks,function(a){_.forEach(b,function(b){a.canAssign(b)&&(b.say("Die!",!0),n.push(b.name))});_.remove(b,function(a){return-1!==n.indexOf(a.name)});n=[];if(0===b.length)return!1});if(0===b.length)break;if(Game.rooms[h]&&0<l.length&&(k=new e(l[0]),k.range=3,_.forEach(b,function(a){k.canAssign(a);n.push(a.name)}),_.remove(b,function(a){return-1!==n.indexOf(a.name)}),n=[],
0===b.length))break;k=new e(h);_.forEach(b,function(a){k.canAssign(a)});break;case "attack":u=f.creeps[a].armyHealer||[];if(0<u.length&&g!==h&&(k=new e(g),k.range=22,_.forEach(_.filter(f.creeps[a].armyRanged,function(a){return(a.room.name===h||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&1E3<=a.hitsMax-a.hits}),function(a){a.say("Ouch!");k.canAssign(a);n.push(a.name)}),_.remove(b,function(a){return-1!==n.indexOf(a.name)}),n=[],0===b.length))break;0<u.length&&_.remove(b,function(a){return 1E3<=
a.hitsMax-a.hits});_.forEach(c.ranged.tasks,function(a){_.forEach(b,function(b){a.canAssign(b)&&(b.say("Die!",!0),n.push(b.name))});_.remove(b,function(a){return-1!==n.indexOf(a.name)});n=[];if(0===b.length)return!1});0!==b.length&&(_.forEach(c.rally.tasks,function(a){_.forEach(b,function(b){a.canAssign(b);n.push(b.name);return!1});_.remove(b,function(a){return-1!==n.indexOf(a.name)});n=[]}),k=t.restPosition?new e(new RoomPosition(t.restPosition.x,t.restPosition.y,t.restPosition.room)):new e(h),_.forEach(b,
function(a){k.canAssign(a)}))}};Memory.profiling&&c(1,14).registerObject(a,"ArmyRanged");r.exports=a;return r.exports};v[15]=function(r,p){var f=c(3,15);c(4,15);var q=c(10,15),e=c(51,15),a=c(40,15),b=function(){};b.checkSpawn=function(a){var d=Memory.maxCreeps.claimer,c=a.name,e=f.creeps[c]&&f.creeps[c].claimer||[],t=0;d&&_.forEach(d[c],function(d,h){d=_.filter(e,function(a){return a.memory.claim===h}).length;t+=1;0===d&&b.spawn(a,h)});Memory.log&&(0<e.length||0<t)&&f.log.rooms[c].creeps.push({role:"claimer",
count:e.length,max:t})};b.spawn=function(a,b){var d=f.spawnsInRoom(a),c=[CLAIM,MOVE];if(0===_.filter(d,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;d=_.filter(d,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(c)})[0];if(!d)return!1;a=d.createCreep(c,"claimer-"+b+"-"+Game.time.toFixed(0).substring(4),{role:"claimer",home:a.name,claim:b});f.spawning[d.id]="number"!==typeof a;return"number"!==typeof a};b.assignTasks=function(b,c){b=b.name;
b=q.creepsWithNoTask(f.creeps[b]&&f.creeps[b].claimer||[]);var d=[];0!==b.length&&(_.forEach(_.filter(b,function(a){return a.room.name!==a.memory.claim}),function(a){e.getClaimerTask(a).canAssign(a)&&d.push(a.name)}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&(_.forEach(b,function(b){a.getTask(b).canAssign(b)&&(b.say("Claiming"),d.push(b.name))}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&_.forEach(b,function(a){a.room.name===a.memory.claim&&
a.room.controller.my&&a.suicide()})))};Memory.profiling&&c(1,15).registerObject(b,"RoleClaimer");r.exports=b;return r.exports};v[16]=function(r,p){var f=c(3,16),q=c(10,16),e=c(46,16),a=c(50,16),b=c(51,16),d=function(){};d.checkSpawn=function(a){var b=f.spawnsInRoom(a),c=0,e=a.name,g=f.creeps[e]&&f.creeps[e].collector||[],h,l;0!==f.containersInRoom(a).length&&a.storage&&a.storage.my||0===b.length||(b=q.objectsClosestToObj(a.find(FIND_SOURCES),b[0]),1>=b.length||(l=Math.max((2500-a.energyCapacityAvailable)/
2500,.1),_.forEach(b,function(b,f){var k=b.id;0!==f&&(c+=Math.ceil(3*l),h=_.filter(g,function(a){return a.memory.homeSource===k}).length,h<3*l&&d.spawn(a,k))}),Memory.log&&(0<g.length||0<c)&&f.log.rooms[e].creeps.push({role:"collector",count:g.length,max:c})))};d.spawn=function(a,b){var d=[],c=a.name,g,h,l;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;g=Math.min(a.energyCapacityAvailable,3300);h=Math.floor(g/200);g%=200;for(l=0;l<h;l++)d.push(WORK);
150<=g&&d.push(WORK);for(l=0;l<h;l++)d.push(CARRY);100<=g&&150>g&&d.push(CARRY);for(l=0;l<h;l++)d.push(MOVE);50<=g&&d.push(MOVE);h=_.filter(Game.spawns,function(b){return!b.spawning&&!f.spawning[b.id]&&b.room.energyAvailable>=q.getBodypartCost(d)&&b.room.memory.region===a.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!h)return!1;b=h.createCreep(d,"collector-"+c+"-"+Game.time.toFixed(0).substring(4),{role:"collector",home:c,homeSource:b});h.room.name===
c&&(f.spawning[h.id]="number"!==typeof b);return"number"!==typeof b};d.assignTasks=function(d,c){var n=d.name,m=_.filter(q.creepsWithNoTask(f.creeps[n]&&f.creeps[n].collector||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),g=f.creeps[n]&&f.creeps[n].all||[],h=[];0!==m.length&&(_.forEach(c.upgradeController.criticalTasks,function(a){0===_.filter(g,function(b){return b.memory.currentTask&&"upgradeController"===b.memory.currentTask.type&&b.memory.currentTask.room===a.room}).length&&
(_.forEach(q.objectsClosestToObj(m,d.controller),function(b){if(a.canAssign(b))return b.say("CritCntrlr"),h.push(b.name),!1}),_.remove(m,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==m.length&&(_.forEach(m,function(a){a.carry[RESOURCE_ENERGY]<(8===d.controller.level?200:7===d.controller.level?100:50)||_.forEach(c.fillEnergy.extensionTasks.sort(function(b,d){return b.object.pos.getRangeTo(a)-d.object.pos.getRangeTo(a)}),function(b){if(0<b.object.energyCapacity-b.object.energy-_.reduce(_.filter(g,
function(a){return a.memory.currentTask&&"fillEnergy"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0)&&b.canAssign(a))return a.say("Extension"),h.push(a.name),!1})}),_.remove(m,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==m.length&&(_.forEach(c.fillEnergy.spawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(g,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&
b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(q.objectsClosestToObj(m,a.object),function(d){if(a.canAssign(d)&&(d.say("Spawn"),h.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(m,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==m.length&&(_.forEach(c.fillEnergy.towerTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(g,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&
b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(q.objectsClosestToObj(m,a.object),function(d){if(a.canAssign(d)&&(d.say("Tower"),h.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(m,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==m.length&&(_.forEach(c.repair.criticalTasks,function(a){_.forEach(q.objectsClosestToObj(m,a.structure),function(b){if(0===_.filter(f.creeps[a.structure.room.name]&&f.creeps[a.structure.room.name].all||
[],function(b){return b.memory.currentTask&&"repair"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length&&a.canAssign(b))return b.say("CritRepair"),h.push(b.name),!1});_.remove(m,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==m.length&&(_.forEach(c.build.tasks,function(a){var b=a.constructionSite.progressTotal-a.constructionSite.progress-_.reduce(_.filter(f.creeps[a.constructionSite.room.name]&&f.creeps[a.constructionSite.room.name].all||[],function(b){return b.memory.currentTask&&
"build"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(q.objectsClosestToObj(m,a.constructionSite),function(d){if(a.canAssign(d)&&(d.say("Build"),h.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(m,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==m.length&&(_.forEach(c.repair.tasks,function(a){var b=a.structure.hitsMax-a.structure.hits-100*_.reduce(_.filter(f.creeps[a.structure.room.name]&&
f.creeps[a.structure.room.name].all||[],function(b){return b.memory.currentTask&&"repair"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0),d=!1;0<b&&(_.forEach(q.objectsClosestToObj(m,a.structure),function(l){if(a.canAssign(l)&&(l.say("Repair"),h.push(l.name),b-=100*(l.carry[RESOURCE_ENERGY]||0),d=!0,0>=b))return!1}),_.remove(m,function(a){return-1!==h.indexOf(a.name)}),h=[]);return d}),0!==m.length&&(_.forEach(c.upgradeController.tasks,
function(a){_.forEach(q.objectsClosestToObj(m,d.controller),function(b){a.canAssign(b)&&(b.say("Controller"),h.push(b.name))});_.remove(m,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==m.length&&(0===f.hostilesInRoom(d).length&&_.forEach(m,function(b){_.forEach(a.getCollectorTasks(b.room),function(a){if(!(0<_.filter(f.creeps[a.resource.room.name]&&f.creeps[a.resource.room.name].all||[],function(b){return b.memory.currentTask&&"pickupResource"===b.memory.currentTask.type&&b.memory.currentTask.id===
a.id}).length)&&a.canAssign(b))return b.say("Pickup"),h.push(b.name),!1})}),_.remove(m,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==m.length&&(_.forEach(c.collectEnergy.tasks,function(a){_.forEach(m,function(b){a.canAssign(b)&&(b.say("Collecting"),h.push(b.name))});_.remove(m,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==m.length&&(_.forEach(m,function(a){(new e).canAssign(a)&&(a.say("Harvesting"),h.push(a.name))}),_.remove(m,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==m.length&&
_.forEach(b.getHarvesterTasks(m),function(a){a.canAssign(a.creep)}))))))))))))};Memory.profiling&&c(1,16).registerObject(d,"RoleCollector");r.exports=d;return r.exports};v[17]=function(r,p){var f=c(3,17);c(4,17);var q=c(10,17),e=c(51,17),a=c(38,17),b=function(){};b.checkSpawn=function(a){var d=Memory.maxCreeps.converter,c=a.name,e=f.creeps[c]&&f.creeps[c].converter||[],t=0;d&&_.forEach(d[c],function(d,h){d=_.filter(e,function(a){return a.memory.attack===h}).length;t+=1;0===d&&b.spawn(a,h)});Memory.log&&
(0<e.length||0<t)&&f.log.rooms[c].creeps.push({role:"converter",count:e.length,max:t})};b.spawn=function(a,b){var d=[],c=f.spawnsInRoom(a),e,g;if(0===_.filter(c,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;e=Math.floor(Math.min(supportRoom.energyCapacityAvailable,24400)/3050);for(g=0;g<e;g++)d.push(CLAIM),d.push(CLAIM),d.push(CLAIM),d.push(CLAIM),d.push(CLAIM);for(g=0;g<e;g++)d.push(MOVE);c=_.filter(c,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=
q.getBodypartCost(d)})[0];if(!c)return!1;a=c.createCreep(d,"converter-"+b+"-"+Game.time.toFixed(0).substring(4),{role:"converter",home:a.name,attack:b});f.spawning[c.id]="number"!==typeof a;return"number"!==typeof a};b.assignTasks=function(b,c){b=b.name;b=q.creepsWithNoTask(f.creeps[b]&&f.creeps[b].converter||[]);var d=[];0!==b.length&&(_.forEach(_.filter(b,function(a){return a.room.name!==a.memory.attack}),function(a){e.getClaimerTask(a).canAssign(a)&&d.push(a.name)}),_.remove(b,function(a){return-1!==
d.indexOf(a.name)}),d=[],0!==b.length&&(_.forEach(b,function(b){a.getTask(b).canAssign(b)&&(b.say("Attacking"),d.push(b.name))}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&_.forEach(b,function(a){a.suicide()})))};Memory.profiling&&c(1,17).registerObject(b,"RoleConverter");r.exports=b;return r.exports};v[18]=function(r,p){var f=c(3,18),q=c(10,18),e=c(51,18),a=c(48,18),b=function(){};b.checkQuadrant=function(a,b){switch(b){case 0:return 25>a.x&&25>a.y;case 1:return 25>
a.x&&25<a.y;case 2:return 25<a.x&&25<a.y;case 3:return 25<a.x&&25>a.y}};b.checkSpawn=function(a){var d=a.name,c=f.creeps[d]&&f.creeps[d].defender||[],e=Game.rooms[Memory.rooms[d].roomType.supportRoom];1>_.filter(c,function(a){return a.spawning||300<=a.ticksToLive}).length&&b.spawn(a,e);Memory.log&&f.log.rooms[d].creeps.push({role:"defender",count:c.length,max:1})};b.spawn=function(a,b){var d=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,
MOVE,MOVE,MOVE,MOVE,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,HEAL,HEAL,HEAL,HEAL,HEAL],c=a.name,e=b.name;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;a=_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(d)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===e?
0:1)-(b.room.name===e?0:1)})[0];if(!a)return!1;c=a.createCreep(d,"defender-"+c+"-"+Game.time.toFixed(0).substring(4),{role:"defender",home:c,supportRoom:e});a.room.name===e&&(f.spawning[a.id]="number"!==typeof c);return"number"!==typeof c};b.assignTasks=function(b,c){var d=this;c=b.name;c=_.filter(q.creepsWithNoTask(f.creeps[c]&&f.creeps[c].defender||[]),function(a){return!a.spawning});var n,t;b&&!b.unobservable&&(n=f.hostilesInRoom(b),t=f.sourceKeepersInRoom(b));_.forEach(c,function(b){b.room.name!==
b.memory.home?e.getDefenderTask(b).canAssign(b):(b.memory.quadrant||(b.memory.quadrant=0),_.forEach(_.filter(n,function(a){return d.checkQuadrant(a.pos,b.memory.quadrant)}),function(d){return!(new a(d.id)).canAssign(b)}),b.memory.currentTask||(_.forEach(_.filter(t,function(a){return 200>a.ticksToSpawn&&d.checkQuadrant(a.pos,b.memory.quadrant)}),function(a){a=new e(a.id,b);a.range=1;return!a.canAssign(b)}),b.memory.currentTask||(b.memory.quadrant=(b.memory.quadrant+1)%4)))})};Memory.profiling&&c(1,
18).registerObject(b,"RoleDefender");r.exports=b;return r.exports};v[19]=function(r,p){var f=c(3,19),q=c(10,19),e=c(39,19),a=c(50,19),b=c(51,19),d=c(53,19),x=function(){};x.checkSpawn=function(a,b){var d=a.name,c=f.creeps[d]&&f.creeps[d].dismantler||[];b||(b=a);0===f.spawnsInRoom(b).length||a.unobservable||(0===_.filter(c,function(a){return a.spawning||150<=a.ticksToLive}).length&&x.spawn(a,b),Memory.log&&f.log.rooms[d].creeps.push({role:"dismantler",count:c.length,max:1}))};x.spawn=function(a,b){var d=
[];a=a.name;var c=b.name,h,l,k;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;h=Math.min(b.energyCapacityAvailable,3300);l=Math.floor(h/200);h%=200;for(k=0;k<l;k++)d.push(WORK);150<=h&&d.push(WORK);for(k=0;k<l;k++)d.push(CARRY);100<=h&&150>h&&d.push(CARRY);for(k=0;k<l;k++)d.push(MOVE);50<=h&&d.push(MOVE);l=_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(d)&&a.room.memory.region===b.memory.region}).sort(function(a,
b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!l)return!1;a=l.createCreep(d,"dismantler-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"dismantler",home:a,supportRoom:c});l.room.name===c&&(f.spawning[l.id]="number"!==typeof a);return"number"!==typeof a};x.assignTasks=function(c,n){var m=c.name,g=_.filter(q.creepsWithNoTask(f.creeps[m]&&f.creeps[m].dismantler||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),h=[];0!==g.length&&(_.forEach(_.filter(g,function(a){return a.room.name!==
m}),function(a){_.forEach(d.getCriticalTasks(a.room),function(b){if(0===_.filter(f.creeps[b.structure.room.name]&&f.creeps[b.structure.room.name].all||[],function(a){return a.memory.currentTask&&"repair"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length&&b.canAssign(a))return a.say("CritRepair"),h.push(a.name),!1})}),_.remove(g,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==g.length&&(_.forEach(g,function(a){var b=a.room.find(FIND_MY_CONSTRUCTION_SITES);0<b.length&&(new e(b[0].id)).canAssign(a)&&
(a.say("Build"),h.push(a.name))}),_.remove(g,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==g.length&&(_.forEach([].concat.apply([],[n.fillEnergy.storageTasks,n.fillEnergy.containerTasks]),function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&-1!==["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||
0)},0);0<b&&(_.forEach(q.objectsClosestToObj(g,a.object),function(d){if(a.canAssign(d)&&(d.say("Container"),h.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(g,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==g.length&&(_.forEach(n.fillMinerals.storageTasks,function(a){_.forEach(g,function(b){a.canAssign(b)&&(b.say("Storage"),h.push(b.name))});_.remove(g,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==g.length&&(_.forEach(n.fillMinerals.terminalTasks,function(a){_.forEach(g,
function(b){a.canAssign(b)&&(b.say("Terminal"),h.push(b.name))});_.remove(g,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==g.length&&(_.forEach(_.filter(g,function(a){return a.room.name===m}),function(a){_.forEach(n.dismantle.tasks,function(b){if(!(0<_.filter(b.structure.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"dismantle"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Dismantle"),h.push(a.name),!1})}),_.remove(g,
function(a){return-1!==h.indexOf(a.name)}),h=[],0!==g.length&&(_.forEach(g,function(b){_.forEach(a.getTasks(b.room),function(a){if(!(0<_.filter(a.resource.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"pickupResource"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length)&&a.canAssign(b))return b.say("Pickup"),h.push(b.name),!1})}),_.remove(g,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==g.length&&_.forEach(g,function(a){(new b(a.memory.home)).canAssign(a)}))))))))};
Memory.profiling&&c(1,19).registerObject(x,"RoleDismantler");r.exports=x;return r.exports};v[20]=function(r,p){var f=c(3,20),q=c(10,20),e=c(47,20),a=c(51,20),b=function(){};b.checkSpawn=function(a){var d=a.name,c=f.creeps[d]&&f.creeps[d].healer||[],e=Game.rooms[Memory.rooms[d].roomType.supportRoom];1>_.filter(c,function(a){return a.spawning||300<=a.ticksToLive}).length&&b.spawn(a,e);Memory.log&&f.log.rooms[d].creeps.push({role:"healer",count:c.length,max:1})};b.spawn=function(a,b){var d=[];a=a.name;
var c=b.name,e,g;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;e=Math.floor(Math.min(b.energyCapacityAvailable,7500)/300);for(g=0;g<e;g++)d.push(MOVE);for(g=0;g<e;g++)d.push(HEAL);e=_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(d)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!e)return!1;a=e.createCreep(d,"healer-"+
a+"-"+Game.time.toFixed(0).substring(4),{role:"healer",home:a,supportRoom:c});e.room.name===c&&(f.spawning[e.id]="number"!==typeof a);return"number"!==typeof a};b.assignTasks=function(b,c){b=b.name;b=_.filter(q.creepsWithNoTask(f.creeps[b]&&f.creeps[b].healer||[]),function(a){return!a.spawning});var d=[];0!==b.length&&(_.forEach(_.filter(b,function(a){return a.room.name!==a.memory.home}),function(b){a.getDefenderTask(b).canAssign(b)&&d.push(b.name)}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),
d=[],0!==b.length&&(_.forEach(b,function(a){var b=e.getDefenderTask(a);b&&b.canAssign(a)&&(a.say("Heal"),d.push(a.name))}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&_.forEach(_.filter(b,function(a){return a.room.name===a.memory.home}),function(b){var c=a.getDefenderTask(b);c.range=1;c.canAssign(b)&&d.push(b.name)})))};Memory.profiling&&c(1,20).registerObject(b,"RoleHealer");r.exports=b;return r.exports};v[21]=function(r,p){var f=c(3,21),q=c(10,21),e=c(49,21),a=c(51,
21),b=function(){};b.checkSpawn=function(a){var d=a.name,c=f.containersInRoom(a),e=0,t;0!==f.spawnsInRoom(a).length&&0!==c.length&&(t=f.creeps[d]&&f.creeps[d].miner||[],_.forEach(c,function(d){var c=d.id;Memory.containerSource[c]||(Memory.containerSource[c]=q.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),d)[0].id);d=Game.getObjectById(Memory.containerSource[c]);d instanceof Mineral&&0===d.mineralAmount||(e+=1,0===_.filter(t,function(a){return(a.spawning||150<=
a.ticksToLive)&&a.memory.container===c}).length&&b.spawn(a,c))}),Memory.log&&(0<t.length||0<e)&&f.log.rooms[d].creeps.push({role:"miner",count:t.length,max:e}))};b.spawn=function(a,b){var d=f.spawnsInRoom(a),c=[MOVE,WORK,WORK,WORK,WORK,WORK],e=a.name,g,h;if(0===_.filter(d,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;g=Math.min(a.energyCapacityAvailable,4500);h=Math.floor(g/450);g%=450;if(q.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),Game.getObjectById(b))[0]instanceof
Mineral){c=[];for(a=0;a<h;a++)c.push(MOVE);50<=g&&c.push(MOVE);for(a=0;a<h;a++)c.push(WORK),c.push(WORK),c.push(WORK),c.push(WORK);150<=g&&c.push(WORK);250<=g&&c.push(WORK);350<=g&&c.push(WORK)}d=_.filter(d,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(c)})[0];if(!d)return!1;b=d.createCreep(c,"miner-"+e+"-"+Game.time.toFixed(0).substring(4),{role:"miner",home:e,container:b});f.spawning[d.id]="number"!==typeof b;return"number"!==typeof b};b.assignTasks=
function(b,c){b=b.name;b=q.creepsWithNoTask(f.creeps[b]&&f.creeps[b].miner||[]);var d=[];0!==b.length&&(_.forEach(_.filter(b,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(b){(new a(b.memory.labs[0])).canAssign(b);d.push(b.name)}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&_.forEach(b,function(a){(new e).canAssign(a)&&a.say("Mining")}))};Memory.profiling&&c(1,21).registerObject(b,"RoleMiner");r.exports=b;return r.exports};v[22]=function(r,p){var f=
c(3,22),q=c(10,22),e=c(39,22),a=c(46,22),b=c(50,22),d=c(51,22),x=c(53,22),m=function(){};m.checkSpawn=function(a){var b=a.name,d=Game.rooms[Memory.rooms[b].roomType.supportRoom],c;0!==f.spawnsInRoom(d).length&&(2>(c=(f.creeps[b]&&f.creeps[b].remoteBuilder||[]).length)&&m.spawn(a,d),Memory.log&&f.log.rooms[b].creeps.push({role:"remoteBuilder",count:c,max:2}))};m.spawn=function(a,b){var d=[];a=a.name;var c=b.name,l,e,u;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;
l=Math.min(b.energyCapacityAvailable,3300);e=Math.floor(l/200);l%=200;for(u=0;u<e;u++)d.push(WORK);150<=l&&d.push(WORK);for(u=0;u<e;u++)d.push(CARRY);100<=l&&150>l&&d.push(CARRY);for(u=0;u<e;u++)d.push(MOVE);50<=l&&d.push(MOVE);e=_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(d)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!e)return!1;a=e.createCreep(d,"remoteBuilder-"+
a+"-"+Game.time.toFixed(0).substring(4),{role:"remoteBuilder",home:a,supportRoom:c});e.room.name===c&&(f.spawning[e.id]="number"!==typeof a);return"number"!==typeof a};m.assignTasks=function(c){var m=c.name,m=_.filter(q.creepsWithNoTask(f.creeps[m]&&f.creeps[m].remoteBuilder||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),g=[];if(0!==m.length&&(_.forEach(_.filter(m,function(a){return a.room.name===c.name}),function(a){0<c.find(FIND_HOSTILE_CONSTRUCTION_SITES).length&&((new d(c.find(FIND_HOSTILE_CONSTRUCTION_SITES)[0].id)).canAssign(a),
a.say("Stomping"),g.push(a.name))}),_.remove(m,function(a){return-1!==g.indexOf(a.name)}),g=[],0!==m.length&&(_.forEach(m,function(a){_.forEach(x.getCriticalTasks(a.room),function(b){if(0===_.filter(b.structure.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"repair"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length&&b.canAssign(a))return a.say("CritRepair"),g.push(a.name),!1})}),_.remove(m,function(a){return-1!==g.indexOf(a.name)}),g=[],0!==m.length))){if(!c.unobservable&&
(_.forEach(m,function(a){var b=c.find(FIND_MY_CONSTRUCTION_SITES);0<b.length&&(new e(q.objectsClosestToObj(b,a)[0].id)).canAssign(a)&&(a.say("Build"),g.push(a.name))}),_.remove(m,function(a){return-1!==g.indexOf(a.name)}),g=[],0===m.length))return;_.forEach(m,function(a){a.room.name===a.memory.home&&_.forEach(b.getTasks(a.room),function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===
b.id}).length)&&b.canAssign(a))return a.say("Pickup"),g.push(a.name),!1})});_.remove(m,function(a){return-1!==g.indexOf(a.name)});g=[];0!==m.length&&(c.unobservable||_.forEach(m,function(b){var d=new a,f=q.objectsClosestToObj(_.filter(c.find(FIND_SOURCES),function(a){return 0<a.energy}),b);if(0===f.length)return!1;b.memory.homeSource=f[0].id;d.canAssign(b)&&(b.say("Harvesting"),g.push(b.name))}),_.remove(m,function(a){return-1!==g.indexOf(a.name)}),g=[],0!==m.length&&_.forEach(m,function(a){(new d(a.memory.home)).canAssign(a)}))}};
Memory.profiling&&c(1,22).registerObject(m,"RoleRemoteBuilder");r.exports=m;return r.exports};v[23]=function(r,p){var f=c(3,23),q=c(10,23),e=c(50,23),a=c(51,23),b=function(){};b.checkSpawn=function(a,c,e){var d=a.name,m=f.creeps[d],m=m&&m.remoteCollector||[];c||(c=a);e||(e=a.memory.roomType&&"cleanup"===a.memory.roomType.type?c.controller?c.controller.level:3:1);0!==f.spawnsInRoom(c).length&&(_.filter(m,function(a){return a.spawning||300<=a.ticksToLive}).length<e&&b.spawn(a,c),Memory.log&&(0<m.length||
0<e)&&f.log.rooms[d].creeps.push({role:"remoteCollector",count:m.length,max:e}))};b.spawn=function(a,b){var d=[];a=a.name;var c=b.name,e,g;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;e=Math.floor(Math.min(b.energyCapacityAvailable,2400)/150);for(g=0;g<e;g++)d.push(CARRY),d.push(CARRY);for(g=0;g<e;g++)d.push(MOVE);e=_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(d)&&a.room.memory.region===
b.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!e)return!1;a=e.createCreep(d,"remoteCollector-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"remoteCollector",home:a,supportRoom:c});e.room.name===c&&(f.spawning[e.id]="number"!==typeof a);return"number"!==typeof a};b.assignTasks=function(b,c){var d=b.name,n=f.creeps[d],t=q.creepsWithNoTask(n&&n.remoteCollector||[]),g=[];0!==t.length&&(_.forEach(t,function(a){_.forEach(e.getTasks(a.room),function(b){if(!(_.sum(n&&
n.all||[],function(a){return a.memory.currentTask&&a.memory.currentTask.id===b.idG?a.carryCapacity-_.sum(a.carry):0})>=b.resource.amount)&&b.canAssign(a))return a.say("Pickup"),g.push(a.name),!1})}),_.remove(t,function(a){return-1!==g.indexOf(a.name)}),g=[],0!==t.length&&(c.collectMinerals&&c.collectMinerals.cleanupTasks&&_.forEach(c.collectMinerals.cleanupTasks,function(a){_.forEach(t,function(b){a.canAssign(b)&&(b.say("Collecting"),g.push(b.name))});_.remove(t,function(a){return-1!==g.indexOf(a.name)});
g=[]}),c.collectEnergy&&c.collectEnergy.cleanupTasks&&_.forEach(c.collectEnergy.cleanupTasks,function(a){_.forEach(_.filter(t,function(a){return a.room.name===d}),function(b){a.canAssign(b)&&(b.say("Collecting"),g.push(b.name))});_.remove(t,function(a){return-1!==g.indexOf(a.name)});g=[]}),_.forEach(c.fillEnergy.storageTasks,function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&
b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(q.objectsClosestToObj(t,a.object),function(d){if(a.canAssign(d)&&(d.say("Storage"),g.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(t,function(a){return-1!==g.indexOf(a.name)}),g=[])}),0!==t.length&&(_.forEach(c.fillMinerals.storageTasks,function(a){_.forEach(t,function(b){a.canAssign(b)&&(b.say("Storage"),g.push(b.name))});_.remove(t,function(a){return-1!==g.indexOf(a.name)});g=[]}),0!==t.length&&
(_.forEach(c.fillMinerals.terminalTasks,function(a){_.forEach(t,function(b){a.canAssign(b)&&(b.say("Terminal"),g.push(b.name))});_.remove(t,function(a){return-1!==g.indexOf(a.name)});g=[]}),0!==t.length&&(_.forEach(c.fillEnergy.containerTasks,function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,
b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(q.objectsClosestToObj(t,a.object),function(d){if(a.canAssign(d)&&(d.say("Container"),g.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(t,function(a){return-1!==g.indexOf(a.name)}),g=[])}),0!==t.length&&_.forEach(t,function(b){(0<_.sum(b.carry)?new a(b.memory.supportRoom):new a(b.memory.home)).canAssign(b)}))))))};Memory.profiling&&c(1,23).registerObject(b,"RoleRemoteCollector");r.exports=b;return r.exports};v[24]=function(r,p){var f=c(3,24),
q=c(10,24);c(39,24);c(50,24);var e=c(51,24),a=function(){};a.checkSpawn=function(b,d,c){var e=b.name,n=f.creeps[e]&&f.creeps[e].remoteDismantler||[];d||(d=b);0!==f.spawnsInRoom(d).length&&(_.filter(n,function(a){return a.spawning||300<=a.ticksToLive}).length<c&&a.spawn(b,d),Memory.log&&(0<n.length||0<c)&&f.log.rooms[e].creeps.push({role:"remoteDismantler",count:n.length,max:c}))};a.spawn=function(a,d){var b=[];a=a.name;var c=d.name,e,t;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;
e=Math.floor(Math.min(d.energyCapacityAvailable,3750)/150);for(t=0;t<e;t++)b.push(WORK);for(t=0;t<e;t++)b.push(MOVE);e=_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(b)&&a.room.memory.region===d.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!e)return!1;a=e.createCreep(b,"remoteDismantler-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"remoteDismantler",home:a,supportRoom:c});e.room.name===
c&&(f.spawning[e.id]="number"!==typeof a);return"number"!==typeof a};a.assignTasks=function(a,d){var b=a.name,c=_.filter(q.creepsWithNoTask(f.creeps[b]&&f.creeps[b].remoteDismantler||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),n=[];0!==c.length&&(_.forEach(_.filter(c,function(a){return a.room.name===b}),function(b){0<a.find(FIND_HOSTILE_CONSTRUCTION_SITES).length&&((new e(a.find(FIND_HOSTILE_CONSTRUCTION_SITES)[0].id)).canAssign(b),b.say("Stomping"),n.push(b.name))}),
_.remove(c,function(a){return-1!==n.indexOf(a.name)}),n=[],0!==c.length&&(_.forEach(_.filter(c,function(a){return a.room.name===b}),function(a){_.forEach(d.remoteDismantle.cleanupTasks,function(b){if(!(0<_.filter(b.structure.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"dismantle"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Dismantle"),n.push(a.name),!1})}),_.remove(c,function(a){return-1!==n.indexOf(a.name)}),n=[],0!==
c.length&&_.forEach(c,function(a){(new e(a.memory.home)).canAssign(a)})))};Memory.profiling&&c(1,24).registerObject(a,"RoleRemoteDismantler");r.exports=a;return r.exports};v[25]=function(r,p){var f=c(3,25),q=c(10,25),e=c(49,25),a=c(51,25),b=function(){};b.checkSpawn=function(a){var d=a.name,c=Game.rooms[Memory.rooms[d].roomType.supportRoom],e=c.name,t=f.creeps[d]&&f.creeps[d].remoteMiner||[],g=f.containersInRoom(a),h=0;0===f.spawnsInRoom(c).length||a.unobservable||0===g.length||(Memory.lengthToContainer||
(Memory.lengthToContainer={}),_.forEach(g,function(d){var l=d.id;Memory.lengthToContainer[l]||(Memory.lengthToContainer[l]={});Memory.lengthToContainer[l][e]||(Memory.lengthToContainer[l][e]=PathFinder.search(d.pos,{pos:f.spawnsInRoom(c)[0].pos,range:1},{swampCost:1,maxOps:1E5}).path.length);Memory.containerSource[l]||(Memory.containerSource[l]=q.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),d)[0].id);d=Game.getObjectById(Memory.containerSource[l]);d instanceof
Mineral&&(0===d.mineralAmount||a.controller&&(!a.controller.my||6>a.controller.level))||(h+=1,0===_.filter(t,function(a){return(a.spawning||a.ticksToLive>=150+3*Memory.lengthToContainer[l][e])&&a.memory.container===l}).length&&b.spawn(a,c,l))}),Memory.log&&(0<t.length||0<h)&&f.log.rooms[d].creeps.push({role:"remoteMiner",count:t.length,max:h}))};b.spawn=function(a,b,c){var d=a.memory&&a.memory.roomType&&"source"===a.memory.roomType.type||/^[EW][1-9][0-9]*5[NS][1-9][0-9]*5$/.test(a.name)?[MOVE,MOVE,
MOVE,MOVE,WORK,WORK,WORK,WORK,WORK,WORK,WORK]:[MOVE,MOVE,MOVE,WORK,WORK,WORK,WORK,WORK],e=a.name,g=b.name,h,l;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;if(q.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),Game.getObjectById(c))[0]instanceof Mineral){d=[];h=Math.min(b.energyCapacityAvailable,4500);a=Math.floor(h/450);h%=450;for(l=0;l<a;l++)d.push(MOVE);50<=h&&d.push(MOVE);for(l=0;l<a;l++)d.push(WORK),d.push(WORK),
d.push(WORK),d.push(WORK);150<=h&&d.push(WORK);250<=h&&d.push(WORK);350<=h&&d.push(WORK)}a=_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(d)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===g?0:1)-(b.room.name===g?0:1)})[0];if(!a)return!1;c=a.createCreep(d,"remoteMiner-"+e+"-"+Game.time.toFixed(0).substring(4),{role:"remoteMiner",home:e,supportRoom:g,container:c});a.room.name===g&&(f.spawning[a.id]=
"number"!==typeof c);return"number"!==typeof c};b.assignTasks=function(b,c){c=b.name;c=q.creepsWithNoTask(f.creeps[c]&&f.creeps[c].remoteMiner||[]);var d=[];0!==c.length&&(b.unobservable||_.forEach(c,function(a){(new e).canAssign(a)&&(a.say("Mining"),d.push(a.name))}),_.remove(c,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==c.length&&_.forEach(c,function(b){(new a(b.memory.home)).canAssign(b)}))};Memory.profiling&&c(1,25).registerObject(b,"RoleRemoteMiner");r.exports=b;return r.exports};v[26]=
function(r,p){var f=c(3,26),q=c(4,26),e=c(10,26),a=c(51,26),b=c(54,26),d=function(){};d.checkSpawn=function(a){var b=Game.rooms[Memory.rooms[a.name].roomType.supportRoom],c=b.name,e=f.spawnsInRoom(b),g=a.controller,h=a.name,l=f.creeps[h]&&f.creeps[h].remoteReserver||[],k=0,u=0,w,x;if(0!==e.length&&!a.unobservable&&g){w=g.id;x=g.reservation;Memory.lengthToController||(Memory.lengthToController={});Memory.lengthToController[w]||(Memory.lengthToController[w]={});Memory.lengthToController[w][c]||(Memory.lengthToController[w][c]=
PathFinder.search(g.pos,{pos:e[0].pos,range:1},{swampCost:1,maxOps:1E5}).path.length);k=_.filter(l,function(a){return a.spawning||a.ticksToLive>Memory.lengthToController[w][c]}).length;if(!x||4E3>x.ticksToEnd)u+=1;k<u&&d.spawn(a,b);Memory.log&&(0<l.length||0<u)&&f.log.rooms[h].creeps.push({role:"remoteReserver",count:l.length,max:u})}};d.spawn=function(a,b){var d=[];a=a.name;var c=b.name,g,h;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;g=Math.floor(Math.min(b.energyCapacityAvailable,
3250)/650);for(h=0;h<g;h++)d.push(CLAIM);for(h=0;h<g;h++)d.push(MOVE);g=_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=e.getBodypartCost(d)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!g)return!1;a=g.createCreep(d,"remoteReserver-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"remoteReserver",home:a,supportRoom:c});g.room.name===c&&(f.spawning[g.id]="number"!==typeof a);return"number"!==
typeof a};d.assignTasks=function(d,c){c=d.name;c=e.creepsWithNoTask(f.creeps[c]&&f.creeps[c].remoteReserver||[]);var m=[];0!==c.length&&(d.unobservable||_.forEach(c,function(a){a.room.name===a.memory.home&&a.room.controller.my&&(m.push(a.name),q.setRoomType(a.room,{type:"base"}),a.suicide())}),_.remove(c,function(a){return-1!==m.indexOf(a.name)}),m=[],0!==c.length&&(d&&!d.unobservable&&d.controller&&_.forEach(c,function(a){b.getRemoteTask(a).canAssign(a)&&(a.say("Reserving"),m.push(a.name))}),_.remove(c,
function(a){return-1!==m.indexOf(a.name)}),m=[],0!==c.length&&_.forEach(c,function(b){(new a(b.memory.home)).canAssign(b)})))};Memory.profiling&&c(1,26).registerObject(d,"RoleRemoteReserver");r.exports=d;return r.exports};v[27]=function(r,p){var f=c(3,27),q=c(10,27),e=c(41,27),a=c(42,27),b=c(50,27),d=c(51,27),x=function(){};x.checkSpawn=function(a){var b=Game.rooms[Memory.rooms[a.name].roomType.supportRoom],d=f.containersInRoom(a),c=a.name,e=f.creeps[c]&&f.creeps[c].remoteStorer||[],l=0,k=!1;0===
f.spawnsInRoom(b).length||a.unobservable||0===d.length||(_.forEach(d,function(d){var c=0,f=d.id,h;Memory.containerSource[f]||(Memory.containerSource[f]=q.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),d)[0].id);d=Game.getObjectById(Memory.containerSource[f]);if(d instanceof Mineral){if(0===d.mineralAmount)return}else c=k?0:-1,k=!0;h=Memory.lengthToContainer[f][b.name];c+=Math.max(Math.ceil(h/[18,18,18,18,30,44,54,62,62][b.controller.level]),0);l+=c;_.filter(e,
function(a){return(a.spawning||a.ticksToLive>=150+2*h)&&a.memory.container===f}).length<c&&x.spawn(a,b,f)}),Memory.log&&(0<e.length||0<l)&&f.log.rooms[c].creeps.push({role:"remoteStorer",count:e.length,max:l}))};x.spawn=function(a,b,d){var c=a.name,e=b.name,l=[];if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;switch(b.controller.level){case 3:l=[MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 4:l=[MOVE,
MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 5:l=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 6:l=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,
CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 7:case 8:l=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY]}a=_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=
q.getBodypartCost(l)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===e?0:1)-(b.room.name===e?0:1)})[0];if(!a)return!1;d=a.createCreep(l,"remoteStorer-"+c+"-"+Game.time.toFixed(0).substring(4),{role:"remoteStorer",home:c,supportRoom:e,container:d});a.room.name===e&&(f.spawning[a.id]="number"!==typeof d);return"number"!==typeof d};x.assignTasks=function(c,n){var m=c.name,g=q.creepsWithNoTask(f.creeps[m]&&f.creeps[m].remoteStorer||[]),h=[];0!==g.length&&(_.forEach(g,
function(a){_.forEach(b.getTasks(a.room),function(b){if(!(_.sum(f.creeps[c.name]&&f.creeps[c.name].all||[],function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id?a.carryCapacity-_.sum(a.carry):0})>=b.resource.amount)&&b.canAssign(a))return a.say("Pickup"),h.push(a.name),!1})}),_.remove(g,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==g.length&&(_.forEach(n.fillEnergy.storageTasks,function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-
_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(g,function(d){if(a.canAssign(d)&&(d.say("Storage"),h.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(g,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==g.length&&(_.forEach(n.fillMinerals.storageTasks,function(a){_.forEach(g,function(b){a.canAssign(b)&&
(b.say("Storage"),h.push(b.name))});_.remove(g,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==g.length&&(_.forEach(n.fillMinerals.terminalTasks,function(a){_.forEach(g,function(b){a.canAssign(b)&&(b.say("Terminal"),h.push(b.name))});_.remove(g,function(a){return-1!==h.indexOf(a.name)});h=[]}),0!==g.length&&(_.forEach(n.fillEnergy.containerTasks,function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&
["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(g,function(d){if(a.canAssign(d)&&(d.say("Container"),h.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(g,function(a){return-1!==h.indexOf(a.name)}),h=[])}),0!==g.length&&(c.unobservable||_.forEach(g,function(b){var d=Game.getObjectById(b.memory.container),c;d&&(d.store[RESOURCE_ENERGY]?c=new e(b.memory.container):0<_.sum(d.store)&&(c=
new a(b.memory.container)),c&&c.canAssign(b)&&(b.say("Collecting"),h.push(b.name)))}),_.remove(g,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==g.length&&_.forEach(g,function(a){(0<_.sum(a.carry)?new d(a.memory.supportRoom):new d(a.memory.home)).canAssign(a)})))))))};Memory.profiling&&c(1,27).registerObject(x,"RoleRemoteStorer");r.exports=x;return r.exports};v[28]=function(r,p){var f=c(3,28),q=c(10,28),e=c(39,28),a=c(41,28),b=c(46,28),d=c(50,28),x=c(51,28),m=c(53,28),n=function(){};n.checkSpawn=
function(a){var b=a.name,d=Game.rooms[Memory.rooms[b].roomType.supportRoom],c=d.name,e=f.containersInRoom(a),u=f.creeps[b]&&f.creeps[b].remoteWorker||[],m=0;0===f.spawnsInRoom(d).length||a.unobservable||0===e.length||(_.forEach(e,function(b){var e=q.objectsClosestToObj([].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),b)[0],f=b.id;if(!(e instanceof Mineral))return m+=1,0===_.filter(u,function(a){return(a.spawning||a.ticksToLive>=150+2*(Memory.lengthToContainer&&Memory.lengthToContainer[f]&&
Memory.lengthToContainer[f][c]?Memory.lengthToContainer[f][c]:0))&&a.memory.container===f}).length&&n.spawn(a,d,f),!1}),Memory.log&&(0<u.length||0<m)&&f.log.rooms[b].creeps.push({role:"remoteWorker",count:u.length,max:m}))};n.spawn=function(a,b,d){var c=[];a=a.name;var e=b.name,h,g,m,n,x,t;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;h=Math.min(b.energyCapacityAvailable,3E3);g=Math.floor(h/200);m=Math.floor((h-2E3)/150);n=h%200;x=(h-2E3)%150;for(t=
0;t<g&&10>t;t++)c.push(WORK);2E3>h&&150<=n&&c.push(WORK);for(t=0;t<g&&10>t;t++)c.push(CARRY);for(t=0;t<m;t++)c.push(CARRY),c.push(CARRY);2E3>h&&100<=n&&150>n&&c.push(CARRY);2E3<h&&100<=x&&c.push(CARRY);for(t=0;t<g&&10>t;t++)c.push(MOVE);for(t=0;t<m;t++)c.push(MOVE);2E3>h&&50<=n&&c.push(MOVE);2E3<h&&50<=x&&c.push(MOVE);h=_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(c)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===
e?0:1)-(b.room.name===e?0:1)})[0];if(!h)return!1;d=h.createCreep(c,"remoteWorker-"+a+"-"+Game.time.toFixed(0).substring(4),{role:"remoteWorker",home:a,supportRoom:e,container:d});h.room.name===e&&(f.spawning[h.id]="number"!==typeof d);return"number"!==typeof d};n.assignTasks=function(c,g){var h=c.name,l=_.filter(q.creepsWithNoTask(f.creeps[h]&&f.creeps[h].remoteWorker||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),k=[];0!==l.length&&(_.forEach(l,function(a){var b=_.filter(a.room.find(FIND_MY_CONSTRUCTION_SITES),
function(a){return 1===a.progressTotal});0<b.length&&(new e(b[0].id)).canAssign(a)&&(a.say("Build"),k.push(a.name))}),_.remove(l,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==l.length&&(_.forEach(l,function(a){_.forEach(m.getCriticalTasks(a.room),function(b){if(0===_.filter(b.structure.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"repair"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length&&b.canAssign(a))return a.say("CritRepair"),k.push(a.name),!1})}),
_.remove(l,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==l.length&&(_.forEach(l,function(a){var b=a.room.find(FIND_MY_CONSTRUCTION_SITES);0<b.length&&(new e(b[0].id)).canAssign(a)&&(a.say("Build"),k.push(a.name))}),_.remove(l,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==l.length&&(_.forEach([].concat.apply([],[g.fillEnergy.storageTasks,g.fillEnergy.containerTasks]),function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&
["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(q.objectsClosestToObj(l,a.object),function(d){if(a.canAssign(d)&&(d.say("Container"),k.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(l,function(a){return-1!==k.indexOf(a.name)}),k=[])}),0!==l.length&&(_.forEach(g.fillMinerals.storageTasks,function(a){_.forEach(l,function(b){a.canAssign(b)&&(b.say("Storage"),
k.push(b.name))});_.remove(l,function(a){return-1!==k.indexOf(a.name)});k=[]}),0!==l.length&&(_.forEach(g.fillMinerals.terminalTasks,function(a){_.forEach(l,function(b){a.canAssign(b)&&(b.say("Terminal"),k.push(b.name))});_.remove(l,function(a){return-1!==k.indexOf(a.name)});k=[]}),0!==l.length&&(_.forEach(l,function(a){a.room.name===c.name&&_.forEach(d.getTasks(a.room),function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&
a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Pickup"),k.push(a.name),!1})}),_.remove(l,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==l.length&&(c.unobservable||_.forEach(l,function(b){(new a(b.memory.container)).canAssign(b)&&(b.say("Collecting"),k.push(b.name))}),_.remove(l,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==l.length&&(c.unobservable||_.forEach(l,function(a){var d=new b,e=q.objectsClosestToObj(_.filter(c.find(FIND_SOURCES),function(a){return 0<a.energy}),
a);if(0===e.length)return!1;a.memory.homeSource=e[0].id;d.canAssign(a)&&(a.say("Harvesting"),k.push(a.name))}),_.remove(l,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==l.length&&_.forEach(l,function(a){(new x(a.memory.home)).canAssign(a)}))))))))))};Memory.profiling&&c(1,28).registerObject(n,"RoleRemoteWorker");r.exports=n;return r.exports};v[29]=function(r,p){var f=c(3,29),q=c(10,29),e=c(50,29),a=c(51,29),b=function(){};b.checkSpawn=function(a){var d=a.controller,c=a.name,c=f.creeps[c]&&f.creeps[c].scientist||
[];!d||6>d.level||(1>_.filter(c,function(a){return a.spawning||150<=a.ticksToLive}).length&&b.spawn(a),Memory.log&&f.log.rooms[a.name].creeps.push({role:"scientist",count:c.length,max:1}))};b.spawn=function(a){var b=f.spawnsInRoom(a),d=[],c=a.name,e,g,h;if(0===_.filter(b,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;e=Math.min(a.energyCapacityAvailable,2500);g=Math.floor(e/150);e%=150;for(h=0;h<g;h++)d.push(CARRY),d.push(CARRY);100<=e&&d.push(CARRY);for(h=0;h<g;h++)d.push(MOVE);
50<=e&&d.push(MOVE);g=_.filter(b,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(d)})[0];if(!g)return!1;a=g.createCreep(d,"scientist-"+c+"-"+Game.time.toFixed(0).substring(4),{role:"scientist",home:c,homeSource:q.objectsClosestToObj(a.find(FIND_SOURCES),b[0])[0].id});f.spawning[g.id]="number"!==typeof a;return"number"!==typeof a};b.assignTasks=function(b,c){var d=b.name,n=_.filter(q.creepsWithNoTask(f.creeps[d]&&f.creeps[d].scientist||[]),function(a){return 0<
_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),t=f.creeps[d]&&f.creeps[d].all||[],g=[];0!==n.length&&(_.forEach(c.fillEnergy.towerTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(t,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(q.objectsClosestToObj(n,a.object),function(d){if(a.canAssign(d)&&(d.say("Tower"),g.push(d.name),
b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(n,function(a){return-1!==g.indexOf(a.name)}),g=[])}),0!==n.length&&(_.forEach(c.collectMinerals.labTasks,function(a){_.forEach(n,function(b){a.canAssign(b)&&(b.say("Collecting"),g.push(b.name))});_.remove(n,function(a){return-1!==g.indexOf(a.name)});g=[]}),0!==n.length&&(_.forEach(c.fillMinerals.labTasks,function(a){_.forEach(n,function(b){a.canAssign(b)&&(b.say("Lab"),g.push(b.name))});_.remove(n,function(a){return-1!==g.indexOf(a.name)});
g=[]}),0!==n.length&&(_.forEach(c.fillMinerals.nukerTasks,function(a){_.forEach(n,function(b){a.canAssign(b)&&(b.say("NukeG"),g.push(b.name))});_.remove(n,function(a){return-1!==g.indexOf(a.name)});g=[]}),0!==n.length&&(_.forEach(c.fillMinerals.powerSpawnTasks,function(a){_.forEach(n,function(b){a.canAssign(b)&&(b.say("powerPower"),g.push(b.name))});_.remove(n,function(a){return-1!==g.indexOf(a.name)});g=[]}),0!==n.length&&(_.forEach(c.fillMinerals.storageTasks,function(a){_.forEach(n,function(b){a.canAssign(b)&&
(b.say("Storage"),g.push(b.name))});_.remove(n,function(a){return-1!==g.indexOf(a.name)});g=[]}),0!==n.length&&(_.forEach(c.fillMinerals.terminalTasks,function(a){_.forEach(n,function(b){a.canAssign(b)&&(b.say("Terminal"),g.push(b.name))});_.remove(n,function(a){return-1!==g.indexOf(a.name)});g=[]}),0!==n.length&&(_.forEach(c.fillEnergy.labTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(t,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&
b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(q.objectsClosestToObj(n,a.object),function(d){if(a.canAssign(d)&&(d.say("LabEnergy"),g.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(n,function(a){return-1!==g.indexOf(a.name)}),g=[])}),0!==n.length&&(c.fillEnergy.terminalTask&&(_.forEach(n,function(a){c.fillEnergy.terminalTask.canAssign(a)&&(a.say("Terminal"),g.push(a.name))}),_.remove(n,function(a){return-1!==g.indexOf(a.name)}),
g=[]),0!==n.length&&(_.forEach(c.fillEnergy.nukerTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(t,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(q.objectsClosestToObj(n,a.object),function(d){if(a.canAssign(d)&&(d.say("NukeEnergy"),g.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(n,function(a){return-1!==
g.indexOf(a.name)}),g=[])}),0!==n.length&&(_.forEach(c.fillEnergy.powerSpawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(t,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(q.objectsClosestToObj(n,a.object),function(d){if(a.canAssign(d)&&(d.say("PwrEnergy"),g.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(n,
function(a){return-1!==g.indexOf(a.name)}),g=[])}),0!==n.length&&(_.forEach(n,function(a){a.carry[RESOURCE_ENERGY]<(8===b.controller.level?200:7===b.controller.level?100:50)||_.forEach(c.fillEnergy.extensionTasks.sort(function(b,d){return b.object.pos.getRangeTo(a)-d.object.pos.getRangeTo(a)}),function(b){if(0<b.object.energyCapacity-b.object.energy-_.reduce(_.filter(t,function(a){return a.memory.currentTask&&"fillEnergy"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}),function(a,b){return a+
(b.carry[RESOURCE_ENERGY]||0)},0)&&b.canAssign(a))return a.say("Extension"),g.push(a.name),!1})}),_.remove(n,function(a){return-1!==g.indexOf(a.name)}),g=[],0!==n.length&&(_.forEach(c.fillEnergy.spawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(t,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(q.objectsClosestToObj(n,a.object),
function(d){if(a.canAssign(d)&&(d.say("Spawn"),g.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(n,function(a){return-1!==g.indexOf(a.name)}),g=[])}),0!==n.length&&(_.forEach(c.fillEnergy.storageTasks,function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+
_.sum(b.carry)},0);0<b&&(_.forEach(q.objectsClosestToObj(n,a.object),function(d){if(!d.memory.lastCollectEnergyWasStorage&&a.canAssign(d)&&(d.say("Storage"),g.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(n,function(a){return-1!==g.indexOf(a.name)}),g=[])}),0!==n.length&&(_.forEach(c.collectMinerals.terminalTasks,function(a){_.forEach(n,function(b){a.canAssign(b)&&(b.say("Collecting"),g.push(b.name))});_.remove(n,function(a){return-1!==g.indexOf(a.name)});g=[]}),0!==n.length&&(_.forEach(c.collectMinerals.storageTasks,
function(a){_.forEach(n,function(b){a.canAssign(b)&&(b.say("Collecting"),g.push(b.name))});_.remove(n,function(a){return-1!==g.indexOf(a.name)});g=[]}),0!==n.length&&(0===f.hostilesInRoom(b).length&&_.forEach(n,function(a){_.forEach(e.getTasks(a.room),function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Pickup"),g.push(a.name),!1})}),
_.remove(n,function(a){return-1!==g.indexOf(a.name)}),g=[],0!==n.length&&(c.collectEnergy.terminalTask&&(_.forEach(n,function(a){c.collectEnergy.terminalTask.canAssign(a)&&(a.say("Collecting"),g.push(a.name))}),_.remove(n,function(a){return-1!==g.indexOf(a.name)}),g=[]),_.forEach(c.collectEnergy.tasks,function(a){_.forEach(n,function(b){a.canAssign(b)&&(b.say("Collecting"),g.push(b.name))});_.remove(n,function(a){return-1!==g.indexOf(a.name)});g=[]}),0!==n.length&&b.terminal&&_.forEach(n,function(d){d=
new a(b.terminal.id,d);d.canAssign(d.creep)})))))))))))))))))))};Memory.profiling&&c(1,29).registerObject(b,"RoleScientist");r.exports=b;return r.exports};v[30]=function(r,p){var f=c(3,30),q=c(10,30),e=c(51,30),a=function(){};a.checkSpawn=function(b){var d=f.containersInRoom(b),c=b.name,e=0,n=0,t,g,h,l;0!==f.spawnsInRoom(b).length&&0!==d.length&&b.storage&&b.storage.my&&(t=b.controller,g=Memory.army,h=f.creeps[c]&&f.creeps[c].storer||[],Memory.lengthToStorage||(Memory.lengthToStorage={}),l=Memory.lengthToStorage,
_.forEach(d,function(a){var d=a.id;Memory.containerSource[d]||(Memory.containerSource[d]=q.objectsClosestToObj([].concat.apply([],[b.find(FIND_SOURCES),b.find(FIND_MINERALS)]),a)[0].id);d=Game.getObjectById(Memory.containerSource[d]);d instanceof Mineral?0<d.mineralAmount&&(n+=1):(l[a.id]||(l[a.id]=PathFinder.search(a.pos,{pos:b.storage.pos,range:1},{swampCost:1}).path.length),e+=l[a.id])}),n+=Math.ceil(2*e/(t&&8==t.level?35:30))+(7<=t.level&&g&&0<_.filter(g,function(a){return a.region===b.memory.region}).length?
1:0),_.filter(h,function(a){return a.spawning||300<=a.ticksToLive}).length<n&&a.spawn(b),Memory.log&&(0<h.length||0<n)&&f.log.rooms[c].creeps.push({role:"storer",count:h.length,max:n}))};a.spawn=function(a){var b=f.spawnsInRoom(a),c=a.name,e,n;switch(a.controller.level){case 7:e=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 8:e=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,
MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;default:e=[MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY]}if(0===_.filter(b,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;b=_.filter(Game.spawns,function(b){return!b.spawning&&!f.spawning[b.id]&&b.room.energyAvailable>=
q.getBodypartCost(e)&&b.room.memory.region===a.memory.region}).sort(function(a,b){return(a.room.name===c?0:1)-(b.room.name===c?0:1)})[0];if(!b)return!1;n=b.createCreep(e,"storer-"+c+"-"+Game.time.toFixed(0).substring(4),{role:"storer",home:c});f.spawning[b.id]="number"!==typeof n;return"number"!==typeof n};a.assignTasks=function(a,d){var b=a.name,c=_.filter(q.creepsWithNoTask(f.creeps[b]&&f.creeps[b].storer||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),n=f.creeps[b]&&
f.creeps[b].all||[],t=[];0!==c.length&&(_.forEach(d.fillEnergy.linkTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(n,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(q.objectsClosestToObj(c,a.object),function(d){if(a.canAssign(d)&&(d.say("Link"),t.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(c,function(a){return-1!==
t.indexOf(a.name)}),t=[])}),0!==c.length&&(_.forEach(c,function(b){b.carry[RESOURCE_ENERGY]<(8===a.controller.level?200:7===a.controller.level?100:50)||_.forEach(d.fillEnergy.extensionTasks.sort(function(a,d){return a.object.pos.getRangeTo(b)-d.object.pos.getRangeTo(b)}),function(a){if(0<a.object.energyCapacity-a.object.energy-_.reduce(_.filter(n,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||
0)},0)&&a.canAssign(b))return b.say("Extension"),t.push(b.name),!1})}),_.remove(c,function(a){return-1!==t.indexOf(a.name)}),t=[],0!==c.length&&(_.forEach(d.fillEnergy.spawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(n,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(q.objectsClosestToObj(c,a.object),function(d){if(a.canAssign(d)&&
(d.say("Spawn"),t.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(c,function(a){return-1!==t.indexOf(a.name)}),t=[])}),0!==c.length&&(d.fillEnergy.terminalTask&&(_.forEach(c,function(a){d.fillEnergy.terminalTask.canAssign(a)&&(a.say("Terminal"),t.push(a.name))}),_.remove(c,function(a){return-1!==t.indexOf(a.name)}),t=[]),0!==c.length&&(_.forEach(d.fillEnergy.storageTasks,function(b){var d=b.object.storeCapacity-_.sum(b.object.store)-_.reduce(_.filter(b.object.room.find(FIND_MY_CREEPS),
function(a){return a.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(a.memory.currentTask.type)&&a.memory.currentTask.id===b.id}),function(a,b){return a+_.sum(b.carry)},0);0<d&&(_.forEach(q.objectsClosestToObj(c,b.object),function(c){if((!a.terminal||!c.memory.lastCollectEnergyWasStorage)&&b.canAssign(c)&&(c.say("Storage"),t.push(c.name),d-=_.sum(c.carry),0>=d))return!1}),_.remove(c,function(a){return-1!==t.indexOf(a.name)}),t=[])}),0!==c.length&&(_.forEach(d.fillMinerals.storageTasks,function(a){_.forEach(c,
function(b){a.canAssign(b)&&(b.say("Storage"),t.push(b.name))});_.remove(c,function(a){return-1!==t.indexOf(a.name)});t=[]}),0!==c.length&&(_.forEach(d.fillMinerals.terminalTasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&(b.say("Terminal"),t.push(b.name))});_.remove(c,function(a){return-1!==t.indexOf(a.name)});t=[]}),0!==c.length&&(_.forEach([].concat.apply([],[d.collectEnergy.storerTasks,d.collectMinerals.storerTasks]).sort(function(a,b){return(b.object.energy||_.sum(b.object.store)||0)-
(a.object.energy||_.sum(a.object.store)||0)}),function(a){if(a.object.energy||_.sum(a.object.store)){var b=(a.object.energy||_.sum(a.object.store)||0)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&b.memory.currentTask.type===a.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carryCapacity-_.sum(b.carry))},0);500<=b&&(_.forEach(c,function(d){d.memory.lastCollectEnergyWasStorage=!1;if(a.canAssign(d)&&(d.say("Collecting"),t.push(d.name),
b-=d.carryCapacity-_.sum(d.carry),500>b))return!1}),_.remove(c,function(a){return-1!==t.indexOf(a.name)}),t=[])}}),0!==c.length&&(d.collectEnergy.terminalTask&&(_.forEach(c,function(a){d.collectEnergy.terminalTask.canAssign(a)&&(a.say("Collecting"),t.push(a.name),a.memory.lastCollectEnergyWasStorage=!1)}),_.remove(c,function(a){return-1!==t.indexOf(a.name)}),t=[]),0!==c.length&&(_.forEach(d.collectEnergy.tasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&(b.say("Collecting"),t.push(b.name),
a.object.structureType===STRUCTURE_STORAGE&&(b.memory.lastCollectEnergyWasStorage=!0))});_.remove(c,function(a){return-1!==t.indexOf(a.name)});t=[]}),0!==c.length&&_.forEach(c,function(a){var b=new e(a.room.terminal?a.room.terminal.id:a.room.name);b.range=0;b.canAssign(a)})))))))))))};Memory.profiling&&c(1,30).registerObject(a,"RoleStorer");r.exports=a;return r.exports};v[31]=function(r,p){var f=c(3,31);p=function(){};p.assignTasks=function(c,e){0<e.rangedAttack.tasks.length?_.forEach(f.towersInRoom(c),
function(a){a.attack(e.rangedAttack.tasks[0].enemy)}):0<e.repair.towerTasks.length?_.forEach(f.towersInRoom(c),function(a){a.repair(e.repair.towerTasks[0].structure)}):0<e.heal.tasks.length&&_.forEach(f.towersInRoom(c),function(a){a.heal(e.heal.tasks[0].ally)})};Memory.profiling&&c(1,31).registerObject(p,"RoleTower");r.exports=p;return r.exports};v[32]=function(r,p){var f=c(3,32),q=c(10,32),e=c(41,32),a=c(46,32),b=c(50,32),d=c(51,32),x=function(){};x.checkSpawn=function(a){var b=a.name,d=f.creeps[b]&&
f.creeps[b].upgrader||[],c=a.storage,e=a.controller,l,k,m;0!==f.spawnsInRoom(a).length&&(c&&(l=c.store[RESOURCE_ENERGY]),k=_.filter(d,function(a){return a.spawning||150<=a.ticksToLive}).length,m=b===Memory.rushRoom?1:!c||l<Memory.upgradeEnergy?0:1,(k<m||e&&8>e.level&&c&&9E5<l)&&x.spawn(a),Memory.log&&(0<d.length||0<m)&&f.log.rooms[b].creeps.push({role:"upgrader",count:d.length,max:m}),_.forEach(_.filter(Game.rooms,function(b){return b.memory&&b.memory.roomType&&"base"===b.memory.roomType.type&&b.memory.region===
a.memory.region&&b.name!==a.name&&b.controller&&b.controller.my&&7>b.controller.level}),function(b){0===_.filter(f.creeps[b.name]&&f.creeps[b.name].upgrader||[],function(a){return a.memory.supportRoom!==a.memory.home}).length&&x.spawn(b,a)}))};x.spawn=function(a,b){var d=[],c=a.controller,e=0,l=!1,k=a.name,m,n,z,x,p,r,v;b||(b=a);m=b.name;n=f.spawnsInRoom(b);z=b.storage;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;if(2<=f.linksInRoom(a).length&&2>=
q.objectsClosestToObj(f.linksInRoom(a),c)[0].pos.getRangeTo(c)){c=Math.min(b.energyCapacityAvailable,8===c.level?1950:4100);x=Math.floor((c-50*Math.ceil(c/3200))/250);p=(c-50*Math.ceil(c/3200))%250;for(r=0;r<x;r++)d.push(WORK),d.push(WORK),e+=2;150<=p&&(d.push(WORK),e++);for(r=0;r<Math.ceil(c/3200);r++)d.push(CARRY)}else{c=Math.min(b.energyCapacityAvailable,8===c.level?3E3:3300);x=Math.floor(c/200);p=c%200;for(r=0;r<x;r++)d.push(WORK),e++;150<=p&&(d.push(WORK),e++);for(r=0;r<x;r++)d.push(CARRY);100<=
p&&150>p&&d.push(CARRY)}for(r=0;r<x;r++)d.push(MOVE);50<=p&&d.push(MOVE);0<e&&z&&0<f.labsInRoom(b).length&&Math.max(z.store[RESOURCE_GHODIUM_HYDRIDE]||0,z.store[RESOURCE_GHODIUM_ACID]||0,z.store[RESOURCE_CATALYZED_GHODIUM_ACID]||0)>=30*e&&(l=!!(v=q.getLabToBoostWith(b)[0]));c=3>f.labsInRoom(b).length?_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(d)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===m?
0:1)-(b.room.name===m?0:1)})[0]:_.filter(n,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(d)})[0];if(!c)return!1;a=c.createCreep(d,"upgrader-"+k+"-"+Game.time.toFixed(0).substring(4),{role:"upgrader",home:k,supportRoom:m,homeSource:q.objectsClosestToObj(a.find(FIND_SOURCES),n[0])[0].id,labs:l?[v.id]:[]});f.spawning[c.id]="number"!==typeof a;"number"!==typeof a&&l&&(v.creepToBoost=a,v.resource=z.store[RESOURCE_CATALYZED_GHODIUM_ACID]>=30*e?RESOURCE_CATALYZED_GHODIUM_ACID:
z.store[RESOURCE_GHODIUM_ACID]>=30*e?RESOURCE_GHODIUM_ACID:RESOURCE_GHODIUM_HYDRIDE,v.amount=30*e,b.memory.labsInUse.push(v),_.forEach(_.filter(f.creeps[m]&&f.creeps[m].all||[],function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&a.memory.currentTask.id===v.id}),function(a){delete a.memory.currentTask}));return"number"!==typeof a};x.assignTasks=function(c,n){var m=c.name,g=_.filter(q.creepsWithNoTask(f.creeps[m]&&f.creeps[m].upgrader||[]),function(a){return 0<_.sum(a.carry)||
!a.spawning&&150<a.ticksToLive}),h=[],l=c.controller;if(0!==g.length&&(_.forEach(_.filter(g,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(a){(new d(a.memory.labs[0])).canAssign(a);h.push(a.name)}),_.remove(g,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==g.length&&(_.forEach(n.upgradeController.tasks,function(a){_.forEach(q.objectsClosestToObj(g,l),function(b){a.canAssign(b)&&(b.say("Controller"),h.push(b.name))});_.remove(g,function(a){return-1!==h.indexOf(a.name)});h=
[]}),0!==g.length&&(_.forEach(g,function(a){var b=q.objectsClosestToObj(f.linksInRoom(c),l);0<b.length&&0<b[0].energy&&(b=new e(b[0].id),b.canAssign(a)&&(a.say("Collecting"),h.push(a.name)))}),_.remove(g,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==g.length)))){if(!l||6>l.level)if(0===f.hostilesInRoom(c).length&&_.forEach(g,function(a){_.forEach(b.getTasks(a.room),function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&
a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Pickup"),h.push(a.name),!1})}),_.remove(g,function(a){return-1!==h.indexOf(a.name)}),h=[],0===g.length)return;_.forEach(n.collectEnergy.tasks,function(a){_.forEach(g,function(b){a.canAssign(b)&&(b.say("Collecting"),h.push(b.name))});_.remove(g,function(a){return-1!==h.indexOf(a.name)});h=[]});if(0!==g.length){if(0===_.filter(f.containersInRoom(c),function(a){return 0<a.energy}).length&&!c.storage&&(_.forEach(g,function(b){(new a).canAssign(b)&&
(b.say("Harvesting"),h.push(b.name))}),_.remove(g,function(a){return-1!==h.indexOf(a.name)}),h=[],0===g.length))return;_.forEach(g,function(a){(new d(a.memory.home)).canAssign(a)})}}};Memory.profiling&&c(1,32).registerObject(x,"RoleUpgrader");r.exports=x;return r.exports};v[33]=function(r,p){var f=c(3,33),q=c(10,33),e=c(46,33),a=c(50,33),b=c(51,33),d=function(){};d.checkSpawn=function(a,b){var c=a.name,e=f.creeps[c]&&f.creeps[c].worker||[],g=a.storage,h;0!==a.find(FIND_SOURCES).length&&(h=_.filter(e,
function(a){return a.spawning||a.ticksToLive>=(g&&g.my?150:300)}).length,b=b?g&&g.my?1:2:0,h<b&&d.spawn(a),Memory.log&&(0<e.length||0<b)&&f.log.rooms[c].creeps.push({role:"worker",count:e.length,max:b}),_.forEach(_.filter(Game.rooms,function(b){return b.memory&&b.memory.roomType&&"base"===b.memory.roomType.type&&b.memory.region===a.memory.region&&b.name!==c&&b.controller&&b.controller.my&&6>b.controller.level}),function(b){0===_.filter(f.creeps[b.name]&&f.creeps[b.name].worker||[],function(a){return a.memory.supportRoom!==
a.memory.home}).length&&d.spawn(b,a)}))};d.spawn=function(a,b){var d=[],c=0,e=!1,h=a.name,l,m,u,w,z,x,p;b||(b=a);l=b.name;m=f.spawnsInRoom(b);u=b.storage;if(0!==m.length){if(3<=f.labsInRoom(b).length&&0===_.filter(m,function(a){return!a.spawning&&!f.spawning[a.id]}).length)return!1;w=Math.min(b.energyCapacityAvailable,3300);z=Math.floor(w/200);w%=200;for(x=0;x<z;x++)d.push(WORK),c++;150<=w&&(d.push(WORK),c++);for(x=0;x<z;x++)d.push(CARRY);100<=w&&150>w&&d.push(CARRY);for(x=0;x<z;x++)d.push(MOVE);
50<=w&&d.push(MOVE);(h===l||0<a.find(FIND_MY_CONSTRUCTION_SITES).length)&&0<c&&u&&0<f.labsInRoom(b).length&&Math.max(u.store[RESOURCE_LEMERGIUM_HYDRIDE]||0,u.store[RESOURCE_LEMERGIUM_ACID]||0,u.store[RESOURCE_CATALYZED_LEMERGIUM_ACID]||0)>=30*c&&(e=!!(p=q.getLabToBoostWith(b)[0]));z=3>f.labsInRoom(b).length?_.filter(Game.spawns,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(d)&&a.room.memory.region===b.memory.region}).sort(function(a,b){return(a.room.name===
l?0:1)-(b.room.name===l?0:1)})[0]:_.filter(m,function(a){return!a.spawning&&!f.spawning[a.id]&&a.room.energyAvailable>=q.getBodypartCost(d)})[0];if(!z)return!1;a=z.createCreep(d,"worker-"+h+"-"+Game.time.toFixed(0).substring(4),{role:"worker",home:h,supportRoom:l,homeSource:q.objectsClosestToObj(a.find(FIND_SOURCES),m[0])[0].id,labs:e?[p.id]:[]});f.spawning[z.id]="number"!==typeof a;"number"!==typeof a&&e&&(p.creepToBoost=a,p.resource=u.store[RESOURCE_CATALYZED_LEMERGIUM_ACID]>=30*c?RESOURCE_CATALYZED_LEMERGIUM_ACID:
u.store[RESOURCE_LEMERGIUM_ACID]>=30*c?RESOURCE_LEMERGIUM_ACID:RESOURCE_LEMERGIUM_HYDRIDE,p.amount=30*c,b.memory.labsInUse.push(p),_.forEach(_.filter(f.creeps[b.name]&&f.creeps[b.name].all||[],function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&a.memory.currentTask.id===p.id}),function(a){delete a.memory.currentTask}));return"number"!==typeof a}};d.assignTasks=function(d,c){var m=d.name,x=f.creeps[m]&&f.creeps[m].worker||[],g=_.filter(q.creepsWithNoTask(x),function(a){return 0<
_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),h=f.creeps[m]&&f.creeps[m].all||[],m=f.creeps[m]&&f.creeps[m].storer||[],l=d.controller,k=[];if(0!==g.length&&(_.forEach(_.filter(g,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(a){var d=_.filter(Memory.rooms[a.memory.supportRoom].labsInUse,function(b){return b.id===a.memory.labs[0]})[0];d&&Game.getObjectById(a.memory.labs[0]).mineralType===d.resource&&Game.getObjectById(a.memory.labs[0]).mineralAmount>=d.amount&&((new b(a.memory.labs[0])).canAssign(a),
k.push(a.name))}),_.remove(g,function(a){return-1!==k.indexOf(a.name)}),k=[],0!==g.length&&(_.forEach(c.fillMinerals.storageTasks,function(a){_.forEach(g,function(b){a.canAssign(b)&&(b.say("Storage"),k.push(b.name))});_.remove(g,function(a){return-1!==k.indexOf(a.name)});k=[]}),0!==g.length&&(_.forEach(c.fillMinerals.terminalTasks,function(a){_.forEach(g,function(b){a.canAssign(b)&&(b.say("Terminal"),k.push(b.name))});_.remove(g,function(a){return-1!==k.indexOf(a.name)});k=[]}),0!==g.length&&(_.forEach(c.upgradeController.criticalTasks,
function(a){0===_.filter(x,function(b){return b.memory.currentTask&&"upgradeController"===b.memory.currentTask.type&&b.memory.currentTask.room===a.room}).length&&(_.forEach(q.objectsClosestToObj(g,l),function(b){if(a.canAssign(b))return b.say("CritCntrlr"),k.push(b.name),!1}),_.remove(g,function(a){return-1!==k.indexOf(a.name)}),k=[])}),0!==g.length))))){if(!d.storage||0===m.length)if(_.forEach(g,function(a){a.carry[RESOURCE_ENERGY]<(8===d.controller.level?200:7===d.controller.level?100:50)||_.forEach(c.fillEnergy.extensionTasks.sort(function(b,
d){return b.object.pos.getRangeTo(a)-d.object.pos.getRangeTo(a)}),function(b){if(0<b.object.energyCapacity-b.object.energy-_.reduce(_.filter(h,function(a){return a.memory.currentTask&&"fillEnergy"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0)&&b.canAssign(a))return a.say("Extension"),k.push(a.name),!1})}),_.remove(g,function(a){return-1!==k.indexOf(a.name)}),k=[],0===g.length)return;d.storage&&0!==m.length||_.forEach(c.fillEnergy.spawnTasks,
function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(h,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(q.objectsClosestToObj(g,a.object),function(d){if(a.canAssign(d)&&(d.say("Spawn"),k.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(g,function(a){return-1!==k.indexOf(a.name)}),k=[])});if(0!==g.length&&(_.forEach(c.fillEnergy.towerTasks,
function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(h,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(q.objectsClosestToObj(g,a.object),function(d){if(a.canAssign(d)&&(d.say("Tower"),k.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(g,function(a){return-1!==k.indexOf(a.name)}),k=[])}),0!==g.length&&(_.forEach(_.filter(c.build.tasks,
function(a){return 1===a.constructionSite.progressTotal}),function(a){var b=a.constructionSite.progressTotal-a.constructionSite.progress-_.reduce(_.filter(a.constructionSite.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"build"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(q.objectsClosestToObj(g,a.constructionSite),function(d){if(a.canAssign(d)&&(d.say("Build"),k.push(d.name),b-=d.carry[RESOURCE_ENERGY]||
0,0>=b))return!1}),_.remove(g,function(a){return-1!==k.indexOf(a.name)}),k=[])}),0!==g.length&&(_.forEach(c.repair.criticalTasks,function(a){_.forEach(q.objectsClosestToObj(g,a.structure),function(b){if(0===_.filter(a.structure.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"repair"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length&&a.canAssign(b))return b.say("CritRepair"),k.push(b.name),!1});_.remove(g,function(a){return-1!==k.indexOf(a.name)});k=[]}),0!==
g.length&&(_.forEach(c.build.tasks,function(a){var b=a.constructionSite.progressTotal-a.constructionSite.progress-_.reduce(_.filter(a.constructionSite.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"build"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(q.objectsClosestToObj(g,a.constructionSite),function(d){if(a.canAssign(d)&&(d.say("Build"),k.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=
b))return!1}),_.remove(g,function(a){return-1!==k.indexOf(a.name)}),k=[])}),0!==g.length&&(_.forEach(c.repair.tasks,function(a){var b=a.structure.hitsMax-a.structure.hits-100*_.reduce(_.filter(a.structure.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"repair"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0),d=!1;if(0<b)return _.forEach(q.objectsClosestToObj(g,a.structure),function(c){if(a.canAssign(c)&&(c.say("Repair"),
k.push(c.name),b-=100*(c.carry[RESOURCE_ENERGY]||0),d=!0,0>=b))return!1}),_.remove(g,function(a){return-1!==k.indexOf(a.name)}),k=[],d}),0!==g.length)))))){if(l&&8>l.level&&(_.forEach(c.upgradeController.tasks,function(a){_.forEach(q.objectsClosestToObj(g,d.controller),function(b){a.canAssign(b)&&(b.say("Controller"),k.push(b.name))});_.remove(g,function(a){return-1!==k.indexOf(a.name)});k=[]}),0===g.length))return;if(!l||6>l.level)if(0===f.hostilesInRoom(d).length&&_.forEach(_.filter(g,function(a){return a.room.name===
d.name}),function(b){_.forEach(a.getTasks(b.room),function(a){if(!(0<_.filter(a.resource.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"pickupResource"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length)&&a.canAssign(b))return b.say("Pickup"),k.push(b.name),!1})}),_.remove(g,function(a){return-1!==k.indexOf(a.name)}),k=[],0===g.length)return;c.collectEnergy.terminalTask&&(_.forEach(g,function(a){c.collectEnergy.terminalTask.canAssign(a)&&(a.say("Collecting"),
k.push(a.name))}),_.remove(g,function(a){return-1!==k.indexOf(a.name)}),k=[]);_.forEach(c.collectEnergy.tasks,function(a){_.forEach(g,function(b){a.canAssign(b)&&(b.say("Collecting"),k.push(b.name))});_.remove(g,function(a){return-1!==k.indexOf(a.name)});k=[]});if(0!==g.length){if(0===_.filter(f.containersInRoom(d),function(a){return 0<a.energy}).length&&!d.storage&&(_.forEach(g,function(a){(new e).canAssign(a)&&(a.say("Harvesting"),k.push(a.name))}),_.remove(g,function(a){return-1!==k.indexOf(a.name)}),
k=[],0===g.length))return;_.forEach(b.getHarvesterTasks(g),function(a){a.canAssign(a.creep)})}}}};Memory.profiling&&c(1,33).registerObject(d,"RoleWorker");r.exports=d;return r.exports};v[34]=function(r,p){var f=c(3,34),q=c(4,34),e=c(6,34),a=c(7,34),b=c(10,34),d=c(15,34),x=c(16,34),m=c(17,34),n=c(19,34),t=c(21,34),g=c(29,34),h=c(30,34),l=c(31,34),k=c(32,34),u=c(33,34),w=c(39,34),z=c(41,34),F=c(42,34),v=c(43,34),D=c(44,34),C=c(45,34),E=c(47,34),T=c(52,34),y=c(53,34),L=c(55,34),A=function(){this.type=
"base"};A.prototype.manage=function(a){var d=a.controller,c=d.level,e=a.find(FIND_MY_CONSTRUCTION_SITES),g=f.spawnsInRoom(a)[0],h=g.pos,l=a.storage,m=a.find(FIND_MINERALS),k=a.name,n;d&&0!==c&&(0<(n=[0,5,10,20,30,40,50,60][c-1]-(f.extensionsInRoom(a).length+_.filter(e,function(a){return a.structureType===STRUCTURE_EXTENSION}).length))&&b.buildStructures(a,STRUCTURE_EXTENSION,n,g),3<=c&&0===f.towersInRoom(a).length&&0===_.filter(e,function(a){return a.structureType===STRUCTURE_TOWER}).length&&b.buildStructures(a,
STRUCTURE_TOWER,1,g),3<=c&&_.forEach(a.find(FIND_SOURCES),function(b){b=PathFinder.search(b.pos,{pos:h,range:1},{swampCost:1}).path[0];var d=b.lookFor(LOOK_STRUCTURES),c=b.x,f=b.y;0===_.filter(d,function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&0===_.filter(e,function(a){return a.pos.x===c&&a.pos.y===f&&a.structureType===STRUCTURE_CONTAINER}).length&&(_.forEach(_.filter(d,function(a){return-1!==[STRUCTURE_ROAD,STRUCTURE_WALL].indexOf(a.structureType)}),function(a){a.destroy()}),a.createConstructionSite(c,
f,STRUCTURE_CONTAINER))}),4<=c&&!l&&0===_.filter(e,function(a){return a.structureType===STRUCTURE_STORAGE}).length&&b.buildStructures(a,STRUCTURE_STORAGE,1,g),6<=c&&l&&!a.terminal&&0===_.filter(e,function(a){return a.structureType===STRUCTURE_TERMINAL}).length&&b.buildStructures(a,STRUCTURE_TERMINAL,1,l),6<=c&&m.length!==f.extractorsInRoom(a).length&&_.forEach(m,function(b){b=b.pos;var d=b.x,c=b.y;0===_.filter(b.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_EXTRACTOR}).length&&
0===_.filter(e,function(a){return a.pos.x===d&&a.pos.y===c&&a.structureType===STRUCTURE_EXTRACTOR}).length&&a.createConstructionSite(d,c,STRUCTURE_EXTRACTOR)}),6<=c&&_.forEach(m,function(b){b=PathFinder.search(b.pos,{pos:h,range:1},{swampCost:1}).path[0];var d=b.lookFor(LOOK_STRUCTURES),c=b.x,f=b.y;0===_.filter(d,function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&0===_.filter(e,function(a){return a.pos.x===c&&a.pos.y===f&&a.structureType===STRUCTURE_CONTAINER}).length&&(_.forEach(_.filter(d,
function(a){return-1!==[STRUCTURE_ROAD,STRUCTURE_WALL].indexOf(a.structureType)}),function(a){a.destroy()}),a.createConstructionSite(c,f,STRUCTURE_CONTAINER))}),3<=c&&_.forEach(_.filter(a.find(FIND_MY_STRUCTURES),function(a){return a.structureType===STRUCTURE_SPAWN||a.structureType===STRUCTURE_EXTENSION||a.structureType===STRUCTURE_TOWER||a.structureType===STRUCTURE_STORAGE||a.structureType===STRUCTURE_TERMINAL}),function(b){var d=b.pos.x;b=b.pos.y;_.forEach([new RoomPosition(d-1,b,k),new RoomPosition(d+
1,b,k),new RoomPosition(d,b-1,k),new RoomPosition(d,b+1,k)],function(b){var d=b.x,c=b.y;0===_.filter(b.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_ROAD}).length&&0===_.filter(e,function(a){return a.pos.x===d&&a.pos.y===c&&a.structureType===STRUCTURE_ROAD}).length&&a.createConstructionSite(d,c,STRUCTURE_ROAD)})}))};A.prototype.defend=function(a){var b=a.name,d=a.memory,c=_.filter(f.hostilesInRoom(a),function(a){return a.owner&&"Invader"!==a.owner.username});a=b+"-defense";
var e,g;0<c.length?(d.lastHostile=Game.time,d.currentAttack||(d.currentAttack=Game.time),d.threats||(d.threats={}),d.edgeTicks||(d.edgeTicks={1:0,3:0,5:0,7:0}),_.forEach(_.filter(_.map(c,function(a){return{id:a.id,threat:_.filter(a.body,function(a){return-1!==[ATTACK,RANGED_ATTACK,HEAL].indexOf(a)}).length}})),function(a){d.threats[a.id]=a.threat}),e=Math.min(Math.ceil(_.sum(d.threats)/20),3),0<_.filter(c,function(a){return 0===a.pos.x}).length&&d.edgeTicks[TOP]++,0<_.filter(c,function(a){return 49===
a.pos.x}).length&&d.edgeTicks[BOTTOM]++,0<_.filter(c,function(a){return 0===a.pos.y}).length&&d.edgeTicks[LEFT]++,0<_.filter(c,function(a){return 49===a.pos.y}).length&&d.edgeTicks[RIGHT]++,0<e&&(Memory.army[a]?(c=Game.time-d.currentAttack,500<=c&&2E3>c?Memory.army[a].boostRoom=b:2E3<=c&&2500>c?_.forEach(_.filter(Game.rooms,function(a){return a.memory&&a.memory.region===d.region}),function(a){var c=a.name+"-defense-for-"+b;Memory.army[a.name+"-defense"]||Memory.army[c]||q.createArmy(c,{reinforce:!1,
region:d.region,boostRoom:b,buildRoom:b,stageRoom:b,attackRoom:b,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:e,units:17},melee:{maxCreeps:e,units:20},ranged:{maxCreeps:0,units:20}})}):2500<=c&&_.forEach(_.filter(Game.rooms,function(a){return a.memory&&a.memory.region===d.region}),function(a){var d=a.name+"-defense-for-"+b;Memory.army[d]&&(Memory.army[d].boostRoom=a.name)}),g=Game.map.describeExits(b),_.forEach(_.keys(g),function(a){var c=b+"-"+a.toString()+"-border-defense";!Memory.army[c]&&
50<=d.edgeTicks[a]&&q.createArmy(c,{reinforce:!1,region:d.region,boostRoom:b,buildRoom:b,stageRoom:b,attackRoom:g[a],dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:e,units:17},melee:{maxCreeps:e,units:20},ranged:{maxCreeps:0,units:20}})})):(Game.notify("Warning! "+b+" is under attack!"),q.createArmy(a,{reinforce:!1,region:d.region,boostRoom:b,buildRoom:b,stageRoom:b,attackRoom:b,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:e,units:17},melee:{maxCreeps:e,units:20},
ranged:{maxCreeps:0,units:20}}),Memory.army[a].creepCount=0))):Memory.army[a]&&d.lastHostile+50<Game.time&&(Memory.army[a]&&(Memory.army[a].directive="attack",Memory.army[a].success=!0),delete d.lastHostile,delete d.currentAttack,delete d.threats,delete d.edgeTicks)};A.prototype.transferEnergy=function(a){a=b.objectsClosestToObj(f.linksInRoom(a),f.spawnsInRoom(a)[0]);var d=a[0];_.forEach(a,function(a,b){0!==b&&!d.cooldown&&0<d.energy&&300>=a.energy&&d.transferEnergy(a)})};A.prototype.terminal=function(b,
d){var c=d.store,g=c[RESOURCE_ENERGY]||0,h=b.storage,l=b.name,m=b.memory,k=m.buyQueue,n=!1,x=[],u={},t=Game.market,p=Math.max.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&"base"===a.memory.roomType.type&&a.storage&&a.storage.my&&a.terminal&&a.terminal.my}),function(a){return a.storage&&a.storage.my?a.storage.store[RESOURCE_ENERGY]:0})))),q,r,z;h&&(u=h.store);d&&1E3<=g&&p>=Memory.dealEnergy&&(m.buyQueue&&(f.credits<Memory.minimumCredits||
(u[k.resource]||0)+(c[k.resource]||0)>(Memory.reserveMinerals[k.resource]||0))&&(delete m.buyQueue,k=void 0),k&&p>Memory.marketEnergy&&Memory.buy?((q=(e.getFilteredOrders().sell[k.resource]||[])[0])?q.price>k.price?(delete m.buyQueue,k=void 0):(r=t.calcTransactionCost(Math.min(k.amount,q.amount),l,q.roomName),g>r&&f.credits>=k.amount*q.price?(e.deal(q.id,Math.min(k.amount,q.amount),l),n=!0,k.amount-=Math.min(k.amount,q.amount)):0<g&&(z=Math.min(Math.floor(Math.min(k.amount,q.amount)*g/r),Math.floor(f.credits/
q.price)),0<z&&(e.deal(q.id,z,l),n=!0,k.amount-=z))):(delete m.buyQueue,k=void 0),k&&0>=k.amount&&(delete m.buyQueue,k=void 0)):(f.credits>=Memory.minimumCredits&&Memory.buy&&(d=_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&"base"===a.memory.roomType.type&&a.terminal&&a.terminal.my}),_.forEach(d,function(a){var d=a.name;n=!1;if(l!==a.name)return _.forEach(_.filter(_.map(c,function(b,d){return{resource:d,amount:Math.min(Memory.reserveMinerals?b+u[d]-(d.startsWith("X")&&5===d.length?
Memory.reserveMinerals[d]-5E3:Memory.reserveMinerals[d]):0,b),otherRoomAmount:(a.terminal.store[d]||0)+(a.storage&&a.storage.store[d]||0),needed:Memory.reserveMinerals?(d.startsWith("X")&&5===d.length?Memory.reserveMinerals[d]-5E3:Memory.reserveMinerals[d])||0:0}}),function(a){return Memory.reserveMinerals[a.resource]&&a.otherRoomAmount<a.needed&&0<a.amount&&0<a.needed-a.otherRoomAmount&&100<=Math.min(a.amount,a.needed-a.otherRoomAmount)}),function(a){var c=Math.min(a.amount,a.needed-a.otherRoomAmount);
r=t.calcTransactionCost(c,l,d);if(g>r){if(b.terminal.send(a.resource,c,d)===OK)return f.log.events.push("Sending "+c+" "+a.resource+" from "+l+" to "+d),n=!0,!1}else if(0<g&&(c=Math.floor(c*g/r),0<c&&b.terminal.send(a.resource,c,d)===OK))return f.log.events.push("Sending "+c+" "+a.resource+" from "+l+" to "+d),n=!0,!1}),!n})),n||(d=_.filter(_.map(c,function(a,b){return{resource:b,amount:Math.min(a,a-(Memory.reserveMinerals?(b.startsWith("X")&&5===b.length?Memory.reserveMinerals[b]-5E3:Memory.reserveMinerals[b])||
0:0)+(u[b]||0))}}),function(a){return a.resource!==RESOURCE_ENERGY&&0<a.amount}),0<d.length&&_.forEach(d.sort(function(a,b){return b.amount-a.amount}),function(a){var b=a.resource;if(q=_.filter(e.getFilteredOrders().buy[b]||[],function(d){return 5005<=a.amount&&f.credits<Memory.minimumCredits||!Memory.minimumSell[b]&&!Memory.flipPrice[b]||Memory.minimumSell[b]&&d.price>=Memory.minimumSell[b]||Memory.flipPrice[b]&&d.price>=Memory.flipPrice[b].price||Memory.flipPrice[b]&&Game.time>Memory.flipPrice[b].expiration})[0]){r=
t.calcTransactionCost(Math.min(a.amount,q.amount),l,q.roomName);if(g>r)return e.deal(q.id,Math.min(a.amount,q.amount),l),n=!0,5005>a.amount&&delete Memory.minimumSell[q.resourceType],!1;if(0<g&&(z=Math.floor(Math.min(a.amount,q.amount)*g/r),0<z))return e.deal(q.id,z,l),n=!0,!1}})),!n&&h&&p>Memory.marketEnergy&&(_.forEach(a,function(a,b){var d;!u||u[b]<Memory.reserveMinerals[b]||-1!==[RESOURCE_ENERGY,SUBSCRIPTION_TOKEN].indexOf(b)||(a=(e.getFilteredOrders().sell[b]||[])[0],d=(e.getFilteredOrders().buy[b]||
[])[0],a&&d&&a.price<d.price&&a.price<f.credits&&x.push({resource:b,buy:d,sell:a}))}),_.forEach(x.sort(function(a,b){return a.sell.price-a.buy.price-(b.sell.price-b.buy.price)}),function(a,b){var d=a.buy,c=a.sell;z=Math.min(d.amount,c.amount);z*c.price>f.credits&&(z=Math.floor(f.credits/c.price));0===b&&f.log.events.push("Biggest flip: "+a.resource+" x"+z+" "+c.price.toFixed(2)+" to "+d.price.toFixed(2));r=t.calcTransactionCost(z,l,c.roomName);if(g>r||0<g&&(z=Math.floor(z*g/r),0<z))return e.deal(c.id,
z,l),Memory.flipPrice[a.resource]={price:c.price,expiration:Game.time+100},n=!0,!1}))))};A.prototype.tasks=function(a){var d=a.terminal,c=Memory.dismantle,e=a.name,g=0,h=0,l,m=f.creeps[e]&&f.creeps[e].worker||[],k=0<_.filter(m,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,n=0<_.filter(m,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&a.carry[RESOURCE_ENERGY]!==_.sum(a.carry)}).length,x=0<_.filter(m,function(a){return(!a.memory.currentTask||
a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,u=f.creeps[e]&&f.creeps[e].collector||[],q=0<_.filter(u,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,t=0<_.filter(u,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,p=f.creeps[e]&&f.creeps[e].storer||[],r=0<_.filter(p,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,
K=0<_.filter(p,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&a.carry[RESOURCE_ENERGY]!==_.sum(a.carry)}).length,p=0<_.filter(p,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,G=f.creeps[e]&&f.creeps[e].scientist||[],H=0<_.filter(G,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,A=0<_.filter(G,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&
a.carry[RESOURCE_ENERGY]!==_.sum(a.carry)}).length,G=0<_.filter(G,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,B=f.creeps[e]&&f.creeps[e].upgrader||[],O=0<_.filter(B,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,B=0<_.filter(B,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,J=0<b.creepsWithNoTask(f.creeps[e]&&f.creeps[e].dismantler||
[]).length,m=0===Game.time%10&&0===m.length+u.length,I={build:{tasks:k||q?w.getTasks(a):[]},collectEnergy:{tasks:x||p||G||t||B?z.getTasks(a):[],storerTasks:p?z.getStorerTasks(a):[]},collectMinerals:{storerTasks:p||K?F.getStorerTasks(a):[],labTasks:G||A?F.getLabTasks(a):[],storageTasks:G||A?F.getStorageTasks(a):[],terminalTasks:G||A?F.getTerminalTasks(a):[]},fillEnergy:{extensionTasks:k||r||H||q?D.getExtensionTasks(a):[],spawnTasks:k||r||H||q?D.getSpawnTasks(a):[],powerSpawnTasks:H?D.getPowerSpawnTasks(a):
[],towerTasks:k||H||q?D.getTowerTasks(a):[],storageTasks:r||H||J?D.getStorageTasks(a):[],containerTasks:J?D.getContainerTasks(a):[],labTasks:H?D.getLabTasks(a):[],linkTasks:r?D.getLinkTasks(a):[],nukerTasks:H?D.getNukerTasks(a):[]},fillMinerals:{labTasks:A?C.getLabTasks(a):[],storageTasks:n||K||A||J?C.getStorageTasks(a):[],terminalTasks:n||K||A||J?C.getTerminalTasks(a):[],nukerTasks:A?C.getNukerTasks(a):[],powerSpawnTasks:A?C.getPowerSpawnTasks(a):[]},heal:{tasks:E.getTasks(a)},rangedAttack:{tasks:T.getTasks(a)},
repair:{tasks:m||k||q?y.getTasks(a):[],criticalTasks:m||k||q?y.getCriticalTasks(a):[],towerTasks:Memory.towerTasks[e]||0===Game.time%10?y.getTowerTasks(a):[]},upgradeController:{tasks:k||q||O?L.getTasks(a):[],criticalTasks:m||k||q?L.getCriticalTasks(a):[]},dismantle:{tasks:[]}};Memory.towerTasks[e]=I.repair.towerTasks.length;d&&d.my&&(g=d.store[RESOURCE_ENERGY]||0,l=d.id);a.storage&&(h=a.storage.store[RESOURCE_ENERGY]||0);(p||G)&&d&&(!d.my||5E3<=g&&(!a.memory.buyQueue||h<Memory.marketEnergy||f.credits<
Memory.minimumCredits))&&(I.collectEnergy.terminalTask=new z(l));(k||r||H)&&d&&d.my&&1E3>g&&(I.fillEnergy.terminalTask=new D(l));if(c&&c[e]&&0<c[e].length){var M=[];_.forEach(c[e],function(b){var d=a.lookForAt(LOOK_STRUCTURES,b.x,b.y);0===d.length?M.push(b):J&&(I.dismantle.tasks=I.dismantle.tasks.concat(_.map(d,function(a){return new v(a.id)})))});_.forEach(M,function(a){_.remove(c[e],function(b){return b.x===a.x&&b.y===a.y})})}else _.forEach(f.creeps[e]&&f.creeps[e].dismantler||[],function(b){b.memory.role=
"remoteWorker";b.memory.container=f.containersInRoom(a)[0].id});return I};A.prototype.spawn=function(a,b){var c=Memory.dismantle,e=a.name,f=a.controller;u.checkSpawn(a,b);t.checkSpawn(a);h.checkSpawn(a);g.checkSpawn(a);c&&c[e]&&0<c[e].length&&n.checkSpawn(a);x.checkSpawn(a);d.checkSpawn(a);m.checkSpawn(a);f&&(8>f.level||0<_.filter(Game.rooms,function(a){return a.controller&&a.controller.my&&8>a.controller.level}).length)&&k.checkSpawn(a)};A.prototype.assignTasks=function(a,b){u.assignTasks(a,b);t.assignTasks(a,
b);h.assignTasks(a,b);g.assignTasks(a,b);n.assignTasks(a,b);x.assignTasks(a,b);d.assignTasks(a,b);m.assignTasks(a,b);k.assignTasks(a,b);l.assignTasks(a,b)};A.prototype.labQueue=function(a,d){var c=a.memory,e=f.labsInRoom(a),g=c.labsInUse,h=d.sourceLabs||[],l=d.children||[],m=Game.getObjectById(h[0]),k=Game.getObjectById(h[1]),n=d.resource;switch(d.status){case "clearing":if(!g||2<e.length-g.length&&0===_.filter(e,function(a){return-1===g.indexOf(a.id)&&0<a.mineralAmount}).length)d.status="moving";
break;case "moving":if(!d.start||d.start+500<Game.time)delete c.labQueue,d=void 0;else{var x=!0;_.forEach(l,function(a){if(_.sum(_.filter(e,function(b){return b.mineralType===a}),function(a){return a.mineralAmount})<d.amount)return x=!1});m.mineralType===l[0]&&k.mineralType===l[1]&&_.forEach(_.filter(e,function(a){return-1===h.indexOf(a.id)&&(!g||-1===_.map(_.filter(g,function(a){return a.resource!==n}),function(a){return a.id}).indexOf(a.id))}),function(a){a.runReaction(m,k)===OK&&(d.amount-=5)});
x&&(d.status="creating")}break;case "creating":_.forEach(_.filter(e,function(a){return-1===h.indexOf(a.id)&&(!g||-1===_.map(_.filter(g,function(a){return a.resource!==n}),function(a){return a.id}).indexOf(a.id))}),function(a){a.mineralAmount===LAB_MINERAL_CAPACITY&&(d.status="returning");a.runReaction(m,k)===OK&&(d.amount-=5)});0===_.sum(_.filter(e,function(a){return-1!==h.indexOf(a.id)}),function(a){return a.mineralAmount})&&(d.status="returning");break;case "returning":0===_.sum(_.filter(e,function(a){return a.mineralType===
n}),function(a){return a.mineralAmount})&&(delete c.labQueue,d=void 0);break;default:d.status="clearing",d.sourceLabs=b.getSourceLabs(a)}};A.prototype.labsInUse=function(a,b){var d=[];_.forEach(b,function(a){var b=Game.getObjectById(a.id);switch(a.status){case "emptying":0===b.mineralAmount&&(a.status="filling");break;case "filling":b.mineralAmount===a.amount&&b.mineralType===a.resource&&(a.status="waiting");break;default:var c=Game.creeps[a.creepToBoost];1>=b.pos.getRangeTo(c)&&b.mineralType===a.resource&&
b.mineralAmount>=a.amount&&b.boostCreep(c)===OK&&(_.remove(c.memory.labs,function(b){return b===a.id}),a.status&&0!==a.oldAmount?a.status="refilling":d.push(a));break;case "refilling":b.mineralAmount===a.oldAmount&&b.mineralType===a.oldResource&&d.push(a)}});_.forEach(d,function(a){_.remove(b,function(b){return b.id===a.id})})};A.prototype.processPower=function(a){_.forEach(f.powerSpawnsInRoom(a),function(a){1<=a.power&&50<=a.energy&&a.processPower()})};A.prototype.run=function(a){var d,c,e,g,h;a.unobservable?
Game.notify("Base Room "+d+" is unobservable, something is wrong!"):(d=a.name,c=f.spawnsInRoom(a),e=a.terminal,d=a.storage,g=a.memory,h=g.labQueue,g=g.labsInUse,0===Game.time%100&&0<c.length&&this.manage(a),this.defend(a),0<c.length&&this.transferEnergy(a),e&&this.terminal(a,e),c=this.tasks(a),this.spawn(a,!d||d.store[RESOURCE_ENERGY]>=Memory.workerEnergy||3500>a.controller.ticksToDowngrade||0<a.find(FIND_MY_CONSTRUCTION_SITES).length||c.repair.criticalTasks&&0<c.repair.criticalTasks.length||c.repair.tasks&&
0<_.filter(c.repair.tasks,function(a){return(a.structure.structureType===STRUCTURE_WALL||a.structure.structureType===STRUCTURE_RAMPART)&&1E6>a.structure.hits}).length),this.assignTasks(a,c),d&&3<=f.labsInRoom(a).length&&h&&!b.roomLabsArePaused(a)&&this.labQueue(a,h),g&&this.labsInUse(a,g),this.processPower(a))};A.prototype.toObj=function(a){Memory.rooms[a.name].roomType={type:this.type}};A.fromObj=function(a){return new A};Memory.profiling&&c(1,34).registerObject(A,"RoomBase");r.exports=A;return r.exports};
v[35]=function(r,p){var f=c(3,35),q=c(4,35),e=c(10,35),a=c(24,35),b=c(23,35),d=c(41,35),x=c(42,35),m=c(43,35),n=c(44,35),t=c(45,35),g=c(50,35),h=function(a){this.type="cleanup";this.supportRoom=a};h.prototype.run=function(c){var h=c.name,l=[],p=[],r=[],F=[],v=[],D=[],C,E;if(C=Game.rooms[Memory.rooms[c.name].roomType.supportRoom])E={collectEnergy:{cleanupTasks:[]},collectMinerals:{cleanupTasks:[]},fillEnergy:{storageTasks:n.getStorageTasks(C),containerTasks:n.getContainerTasks(C)},fillMinerals:{labTasks:t.getLabTasks(C),
storageTasks:t.getStorageTasks(C),terminalTasks:t.getTerminalTasks(C)},remoteDismantle:{cleanupTasks:[]},dismantle:{tasks:[]},pickupResource:{tasks:[]}},c.unobservable||(Memory.dismantle&&Memory.dismantle[c.name]&&0<Memory.dismantle[c.name].length&&(_.forEach(Memory.dismantle[c.name],function(a){var b=c.lookForAt(LOOK_STRUCTURES,a.x,a.y);0===b.length?v.push(a):E.dismantle.tasks=E.dismantle.tasks.concat(_.map(b,function(a){return new m(a.id)}))}),_.forEach(v,function(a){_.remove(Memory.dismantle[h],
function(b){return b.x===a.x&&b.y===a.y})})),l=_.filter(c.find(FIND_STRUCTURES),function(a){return a.structureType===STRUCTURE_RAMPART}),p=_.filter(c.find(FIND_STRUCTURES),function(a){return a.structureType!==STRUCTURE_RAMPART&&a.structureType!==STRUCTURE_CONTROLLER&&a.structureType!==STRUCTURE_ROAD&&a.structureType!==STRUCTURE_WALL&&(0===l.length||0<a.pos.getRangeTo(e.objectsClosestToObj(l,a)[0]))}),r=_.filter(p,function(a){return a.structureType===STRUCTURE_NUKER||(!a.energy||0===a.energy)&&(!a.store||
0===_.sum(a.store))&&(!a.mineralAmount||0===a.mineralAmount)}),F=_.filter(p,function(a){return a.structureType!==STRUCTURE_NUKER&&(a.energy&&0<a.energy||a.store&&0<_.sum(a.store)||a.mineralAmount&&0<a.mineralAmount)}),D=_.filter(c.find(FIND_STRUCTURES),function(a){return-1!==[STRUCTURE_WALL,STRUCTURE_ROAD].indexOf(a.structureType)}),E.collectEnergy.cleanupTasks=d.getCleanupTasks(F),E.collectMinerals.cleanupTasks=x.getCleanupTasks(F),E.pickupResource.tasks=g.getTasks(c),E.remoteDismantle.cleanupTasks=
[].concat.apply([],[m.getCleanupTasks(r),m.getCleanupTasks(l),m.getCleanupTasks(D)]),0===F.length&&0===E.remoteDismantle.cleanupTasks.length&&0===E.pickupResource.tasks.length&&(Game.notify("Cleanup Room "+c.name+" is squeaky clean!"),_.forEach(f.creeps[h]&&f.creeps[h].remoteCollector||[],function(a){a.memory.role="storer";a.memory.home=C.name}),_.forEach(f.creeps[h]&&f.creeps[h].remoteDismantler||[],function(a){a.memory.role="upgrader";a.memory.home=C.name}),q.setRoomType(c.name))),(c.unobservable||
0<p.length||0<l.length||0<D.length)&&a.checkSpawn(c,C,Math.min(p.length+l.length+D.length,8)),b.checkSpawn(c,C,0<E.collectEnergy.cleanupTasks||E.collectMinerals.cleanupTasks?C.controller?C.controller.level:3:1),a.assignTasks(c,E),b.assignTasks(c,E)};h.prototype.toObj=function(a){Memory.rooms[a.name].roomType={type:this.type,supportRoom:this.supportRoom}};h.fromObj=function(a){return new h(a.roomType.supportRoom)};Memory.profiling&&c(1,35).registerObject(h,"RoomCleanup");r.exports=h;return r.exports};
v[36]=function(r,p){var f=c(3,36),q=c(4,36),e=c(10,36),a=c(19,36),b=c(22,36),d=c(25,36),x=c(26,36),m=c(27,36),n=c(28,36),t=c(39,36),g=c(43,36),h=c(44,36),l=c(45,36),k=function(a,b){this.type="mine";this.supportRoom=a;this.stage=b||1};k.prototype.convert=function(a,b){var d=this,c=a.name;b=Memory.rooms[c];var g=b.roomType.type;q.setRoomType(c,{type:"base",region:b.region});q.claimRoom(this.supportRoom,c,!1);switch(g){case "mine":_.forEach(f.creeps[c]&&f.creeps[c].all||[],function(b){var f=b.memory;
switch(f.role){case "remoteBuilder":case "remoteWorker":f.role="worker";f.home=c;f.homeSource=e.objectsClosestToObj(a.find(FIND_SOURCES),b)[0].id;break;case "remoteReserver":b.suicide();break;case "remoteStorer":f.role="storer";f.home=d.supportRoom;break;case "dismantler":f.home=c,f.supportRoom=c}})}};k.prototype.stage1Tasks=function(a,b){b={fillEnergy:{storageTasks:h.getStorageTasks(b),containerTasks:h.getContainerTasks(b)},fillMinerals:{storageTasks:l.getStorageTasks(b),terminalTasks:l.getTerminalTasks(b)},
dismantle:{tasks:[]}};a.unobservable||(b.build={tasks:t.getTasks(a)});return b};k.prototype.stage1Spawn=function(a){x.checkSpawn(a);b.checkSpawn(a)};k.prototype.stage1AssignTasks=function(c,e){x.assignTasks(c,e);b.assignTasks(c);d.assignTasks(c,e);n.assignTasks(c,e);m.assignTasks(c,e);a.assignTasks(c,e)};k.prototype.stage1Manage=function(a,b){var d=b.name,c,g,h,m,k;a.unobservable||(c=[].concat.apply([],[a.find(FIND_SOURCES),/^[EW][1-9][0-9]*5[NS][1-9][0-9]*5$/.test(a.name)?a.find(FIND_MINERALS):[]]),
g=f.containersInRoom(a),h=a.name,g.length>=c.length?(this.stage=2,_.forEach(g,function(b){var d=e.objectsClosestToObj([].concat.apply([],[c,a.find(FIND_MINERALS)]),b)[0];if(!(d instanceof Mineral))return _.forEach(f.creeps[h]&&f.creeps[h].remoteBuilder||[],function(a){a.memory.role="remoteWorker";a.memory.container=e.objectsClosestToObj(g,d)[0].id}),!1})):(k=a.find(FIND_MY_CONSTRUCTION_SITES),0===k.length&&_.forEach(c,function(d){var c=PathFinder.search(d.pos,{pos:f.spawnsInRoom(b)[0].pos,range:1},
{swampCost:1}).path[0];0===_.filter(c.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&0===_.filter(k,function(a){return a.pos.x===c.x&&a.pos.y===c.y&&a.structureType===STRUCTURE_CONTAINER}).length&&a.createConstructionSite(c.x,c.y,STRUCTURE_CONTAINER)}),m=h+"-defense",0<_.filter(f.hostilesInRoom(a),function(a){return a.owner&&"Invader"===a.owner.username}).length?Memory.army[m]||q.createArmy(m,{reinforce:!1,region:a.memory.region,boostRoom:void 0,buildRoom:d,
stageRoom:d,attackRoom:h,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:1,units:Math.min(Math.floor((b.energyCapacityAvailable-300)/300),20)},melee:{maxCreeps:1,units:Math.min(Math.floor((b.energyCapacityAvailable-300)/130),20)},ranged:{maxCreeps:0,units:20}}):Memory.army[m]&&(Memory.army[m].directive="attack",Memory.army[m].success=!0)))};k.prototype.stage1=function(a,b){var d=this.stage1Tasks(a,b);this.stage1Spawn(a);this.stage1AssignTasks(a,d);this.stage1Manage(a,b)};k.prototype.stage2Manage=
function(a,b){var d=a.name,c=b.name,e;a.unobservable?0===(f.creeps[d]&&f.creeps[d].remoteMiner||[]).length&&0===(f.creeps[d]&&f.creeps[d].remoteWorker||[]).length&&0===(f.creeps[d]&&f.creeps[d].remoteStorer||[]).length&&0===(f.creeps[d]&&f.creeps[d].remoteReserver||[]).length&&(this.stage=1):(e=[].concat.apply([],[a.find(FIND_SOURCES),/^[EW][1-9][0-9]*5[NS][1-9][0-9]*5$/.test(a.name)?a.find(FIND_MINERALS):[]]),f.containersInRoom(a).length<e.length?this.stage=1:(e=d+"-defense",0<_.filter(f.hostilesInRoom(a),
function(a){return a.owner&&"Invader"===a.owner.username}).length?Memory.army[e]||q.createArmy(e,{reinforce:!1,region:a.memory.region,boostRoom:void 0,buildRoom:c,stageRoom:c,attackRoom:d,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:1,units:Math.min(Math.floor((b.energyCapacityAvailable-300)/300),20)},melee:{maxCreeps:1,units:Math.min(Math.floor((b.energyCapacityAvailable-300)/130),20)},ranged:{maxCreeps:0,units:20}}):Memory.army[e]&&(Memory.army[e].directive="attack",Memory.army[e].success=
!0)))};k.prototype.stage2Spawn=function(b,c){var e=Memory.dismantle;0<f.hostilesInRoom(b).length||(x.checkSpawn(b),d.checkSpawn(b),n.checkSpawn(b),m.checkSpawn(b),e&&e[b.name]&&0<e[b.name].length&&a.checkSpawn(b,c))};k.prototype.stage2Tasks=function(a,b){var d=a.name,c=0<e.creepsWithNoTask(f.creeps[d]&&f.creeps[d].remoteWorker||[]).length||0<e.creepsWithNoTask(f.creeps[d]&&f.creeps[d].remoteStorer||[]).length||0<e.creepsWithNoTask(f.creeps[d]&&f.creeps[d].remoteDismantler||[]).length,m={fillEnergy:{storageTasks:c?
h.getStorageTasks(b):[],containerTasks:c?h.getContainerTasks(b):[]},fillMinerals:{storageTasks:c?l.getStorageTasks(b):[],terminalTasks:c?l.getTerminalTasks(b):[]}};if(!a.unobservable){var k=Memory.dismantle;m.dismantle={tasks:[]};if(k&&k[d]&&0<k[d].length){var n=[];_.forEach(k[d],function(b){var d=a.lookForAt(LOOK_STRUCTURES,b.x,b.y);0===d.length?n.push(b):m.dismantle.tasks=m.dismantle.tasks.concat(_.map(d,function(a){return new g(a.id)}))});_.forEach(n,function(a){_.remove(k[d],function(b){return b.x===
a.x&&b.y===a.y})})}else _.forEach(f.creeps[d]&&f.creeps[d].dismantler||[],function(b){b.memory.role="remoteWorker";b.memory.container=f.containersInRoom(a)[0].id})}return m};k.prototype.stage2AssignTasks=function(b,c){x.assignTasks(b,c);d.assignTasks(b,c);n.assignTasks(b,c);m.assignTasks(b,c);a.assignTasks(b,c)};k.prototype.stage2=function(a,b){this.stage2Manage(a,b);1!==this.stage&&(a.unobservable||this.stage2Spawn(a,b),b=this.stage2Tasks(a,b),this.stage2AssignTasks(a,b))};k.prototype.run=function(a){var b;
if(a.unobservable||0!==a.find(FIND_SOURCES).length)if(b=Game.rooms[Memory.rooms[a.name].roomType.supportRoom])a.controller&&a.controller.my?this.convert(a,b):(1===this.stage&&this.stage1(a,b),2===this.stage&&this.stage2(a,b))};k.prototype.toObj=function(a){Memory.rooms[a.name].roomType={type:this.type,supportRoom:this.supportRoom,stage:this.stage}};k.fromObj=function(a){return new k(a.roomType.supportRoom,a.roomType.stage)};Memory.profiling&&c(1,36).registerObject(k,"RoomMine");r.exports=k;return r.exports};
v[37]=function(r,p){var f=c(3,37),q=c(4,37),e=c(10,37),a=c(18,37),b=c(19,37),d=c(20,37),x=c(22,37),m=c(23,37),n=c(25,37),t=c(27,37),g=c(28,37),h=c(39,37),l=c(43,37),k=c(44,37),u=c(45,37),w=function(a,b){this.type="source";this.supportRoom=a;this.stage=b||1};w.prototype.stage1Tasks=function(a,b){b={fillEnergy:{storageTasks:k.getStorageTasks(b),containerTasks:k.getContainerTasks(b)},fillMinerals:{storageTasks:u.getStorageTasks(b),terminalTasks:u.getTerminalTasks(b)},dismantle:{tasks:[]}};a.unobservable||
(b.build={tasks:h.getTasks(a)});return b};w.prototype.stage1Spawn=function(b){var c=b.name;a.checkSpawn(b);d.checkSpawn(b);f.creeps[c]&&f.creeps[c].defender&&0!==_.filter(f.creeps[c].defender,function(a){return!a.spawning}).length&&x.checkSpawn(b)};w.prototype.stage1AssignTasks=function(c,e){a.assignTasks(c,e);d.assignTasks(c,e);x.assignTasks(c);n.assignTasks(c,e);g.assignTasks(c,e);t.assignTasks(c,e);m.assignTasks(c,e);b.assignTasks(c,e)};w.prototype.stage1Manage=function(a,b){var d=b.name,c,g,h,
m,k;a.unobservable||(c=[].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),g=f.containersInRoom(a),h=a.name,g.length===c.length?(this.stage=2,_.forEach(g,function(b){var d=e.objectsClosestToObj([].concat.apply([],[c,a.find(FIND_MINERALS)]),b)[0];if(!(d instanceof Mineral))return _.forEach(f.creeps[h]&&f.creeps[h].remoteBuilder||[],function(a){a.memory.role="remoteWorker";a.memory.container=e.objectsClosestToObj(g,d)[0].id}),!1})):(k=a.find(FIND_MY_CONSTRUCTION_SITES),0===k.length&&_.forEach(c,
function(d){var c=PathFinder.search(d.pos,{pos:f.spawnsInRoom(b)[0].pos,range:1},{swampCost:1}).path[0];0===_.filter(c.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&0===_.filter(k,function(a){return a.pos.x===c.x&&a.pos.y===c.y&&a.structureType===STRUCTURE_CONTAINER}).length&&a.createConstructionSite(c.x,c.y,STRUCTURE_CONTAINER)}),m=h+"-defense",0<_.filter(f.hostilesInRoom(a),function(a){return a.owner&&"Invader"===a.owner.username}).length?Memory.army[m]||
q.createArmy(m,{reinforce:!1,region:a.memory.region,boostRoom:void 0,buildRoom:d,stageRoom:d,attackRoom:h,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:2,units:17},melee:{maxCreeps:2,units:20},ranged:{maxCreeps:0,units:20}}):Memory.army[m]&&(Memory.army[m].directive="attack",Memory.army[m].success=!0)))};w.prototype.stage1=function(a,b){var d=this.stage1Tasks(a,b);this.stage1Spawn(a);this.stage1AssignTasks(a,d);this.stage1Manage(a,b)};w.prototype.stage2Manage=function(a,b){var d=
a.name;b=b.name;var c=f.creeps[d];a.unobservable?0===(c&&c.remoteMiner||[]).length&&0===(c&&c.remoteWorker||[]).length&&0===(c&&c.remoteStorer||[]).length&&(this.stage=1):(c=[].concat.apply([],[a.find(FIND_SOURCES),a.find(FIND_MINERALS)]),f.containersInRoom(a).length!==c.length&&(this.stage=1),c=d+"-defense",0<_.filter(f.hostilesInRoom(a),function(a){return a.owner&&"Invader"===a.owner.username}).length?Memory.army[c]||q.createArmy(c,{reinforce:!1,region:a.memory.region,boostRoom:void 0,buildRoom:b,
stageRoom:b,attackRoom:d,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:2,units:17},melee:{maxCreeps:2,units:20},ranged:{maxCreeps:0,units:20}}):Memory.army[c]&&(Memory.army[c].directive="attack",Memory.army[c].success=!0))};w.prototype.stage2Spawn=function(c,e){var h=c.name,k=Memory.dismantle;a.checkSpawn(c);d.checkSpawn(c);f.creeps[h]&&f.creeps[h].defender&&0!==_.filter(f.creeps[h].defender,function(a){return!a.spawning}).length&&(n.checkSpawn(c),g.checkSpawn(c),t.checkSpawn(c),
m.checkSpawn(c,e),k&&k[h]&&0<k[h].length&&b.checkSpawn(c,e))};w.prototype.stage2Tasks=function(a,b){var d=a.name,c=0<e.creepsWithNoTask(f.creeps[d]&&f.creeps[d].remoteWorker||[]).length||0<e.creepsWithNoTask(f.creeps[d]&&f.creeps[d].remoteStorer||[]).length||0<e.creepsWithNoTask(f.creeps[d]&&f.creeps[d].remoteDismantler||[]).length,g={fillEnergy:{storageTasks:c?k.getStorageTasks(b):[],containerTasks:c?k.getContainerTasks(b):[]},fillMinerals:{storageTasks:c?u.getStorageTasks(b):[],terminalTasks:c?
u.getTerminalTasks(b):[]}};if(!a.unobservable){var h=Memory.dismantle;g.dismantle={tasks:[]};if(h&&h[d]&&0<h[d].length){var m=[];_.forEach(h[d],function(b){var d=a.lookForAt(LOOK_STRUCTURES,b.x,b.y);0===d.length?m.push(b):g.dismantle.tasks=g.dismantle.tasks.concat(_.map(d,function(a){return new l(a.id)}))});_.forEach(m,function(a){_.remove(h[d],function(b){return b.x===a.x&&b.y===a.y})})}else _.forEach(f.creeps[d]&&f.creeps[d].dismantler||[],function(b){b.memory.role="remoteWorker";b.memory.container=
f.containersInRoom(a)[0].id})}return g};w.prototype.stage2AssignTasks=function(c,e){a.assignTasks(c,e);d.assignTasks(c,e);n.assignTasks(c,e);g.assignTasks(c,e);t.assignTasks(c,e);m.assignTasks(c,e);b.assignTasks(c,e)};w.prototype.stage2=function(a,b){this.stage2Manage(a,b);1!==this.stage&&(a.unobservable||this.stage2Spawn(a,b),b=this.stage2Tasks(a,b),this.stage2AssignTasks(a,b))};w.prototype.run=function(a){var b;if(a.unobservable||0!==a.find(FIND_SOURCES).length)if(b=Game.rooms[Memory.rooms[a.name].roomType.supportRoom])a.controller&&
a.controller.my?this.convert(a,b):(1===this.stage&&this.stage1(a,b),2===this.stage&&this.stage2(a,b))};w.prototype.toObj=function(a){Memory.rooms[a.name].roomType={type:this.type,supportRoom:this.supportRoom,stage:this.stage}};w.fromObj=function(a){return new w(a.roomType.supportRoom,a.roomType.stage)};Memory.profiling&&c(1,37).registerObject(w,"RoomSource");r.exports=w;return r.exports};v[38]=function(r,p){var f=c(3,38),q=c(56,38),e=function(){this.type="attack"};e.prototype.canAssign=function(a){var b=
a.room.controller;if(a.spawning||"converter"!==a.memory.role||!b||0===b.level||0===a.getActiveBodyparts(CLAIM))return!1;f.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){a.room.controller&&0!==a.room.controller.level&&0!==!a.getActiveBodyparts(CLAIM)?(q.moveTo(a,a.room.controller,1),a.attackController(a.room.controller)):delete a.memory.currentTask};e.prototype.toObj=function(a){a.room.controller?a.memory.currentTask={type:this.type}:delete a.memory.currentTask};e.fromObj=
function(a){return new e};e.getTask=function(a){if(a.room.controller)return new e};Memory.profiling&&c(1,38).registerObject(e,"TaskAttack");r.exports=e;return r.exports};v[39]=function(r,p){var f=c(3,39),q=c(56,39),e=function(a){this.type="build";this.id=a;this.constructionSite=Game.getObjectById(a);this.force=!0};e.prototype.canAssign=function(a){if(a.spawning||!a.carry[RESOURCE_ENERGY]||0===a.getActiveBodyparts(WORK))return!1;f.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){var b=
this.constructionSite;a.carry[RESOURCE_ENERGY]&&b&&0!==a.getActiveBodyparts(WORK)?(q.moveTo(a,b,Math.max(Math.min(a.pos.getRangeTo(b)-1,3),1)),a.build(b,RESOURCE_ENERGY)===OK&&(Math.min(5*a.getActiveBodyparts(WORK),a.carry[RESOURCE_ENERGY])>=b.progressTotal-b.progress||a.carry[RESOURCE_ENERGY]<=Math.min(5*a.getActiveBodyparts(WORK)))&&delete a.memory.currentTask):delete a.memory.currentTask};e.prototype.toObj=function(a){this.constructionSite?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};
e.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new e(a.memory.currentTask.id)};e.getTasks=function(a){return _.map(a.find(FIND_MY_CONSTRUCTION_SITES),function(a){return new e(a.id)})};Memory.profiling&&c(1,39).registerObject(e,"TaskBuild");r.exports=e;return r.exports};v[40]=function(r,p){var f=c(3,40),q=c(56,40),e=function(){this.type="claim"};e.prototype.canAssign=function(a){var b=a.room.controller;if(a.spawning||"claimer"!==a.memory.role||!b||b.my||0===a.getActiveBodyparts(CLAIM))return!1;
f.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){!a.room.controller||a.room.controller.my||0===!a.getActiveBodyparts(CLAIM)?delete a.memory.currentTask:(q.moveTo(a,a.room.controller,1),a.claimController(a.room.controller))};e.prototype.toObj=function(a){a.room.controller?a.memory.currentTask={type:this.type}:delete a.memory.currentTask};e.fromObj=function(a){return new e};e.getTask=function(a){if(a.room.controller)return new e};Memory.profiling&&c(1,40).registerObject(e,
"TaskClaim");r.exports=e;return r.exports};v[41]=function(r,p){var f=c(3,41),q=c(56,41),e=function(a){this.type="collectEnergy";this.id=a;this.object=Game.getObjectById(a)};e.prototype.canAssign=function(a){var b=this.object;if(a.spawning||150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||!b||0===(b.energy||b.store&&b.store[RESOURCE_ENERGY]||0))return!1;f.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){var b=this.object,d,c;150>a.ticksToLive||!b?delete a.memory.currentTask:
(d=b.energy||b.store&&b.store[RESOURCE_ENERGY]||0,_.sum(a.carry)===a.carryCapacity||0===d?delete a.memory.currentTask:(q.moveTo(a,b,1),1===a.pos.getRangeTo(b)&&0<(c=_.filter(b.pos.lookFor(LOOK_RESOURCES),function(a){return 50<a.amount})).length?a.pickup(c[0]):a.withdraw(b,RESOURCE_ENERGY)===OK&&delete a.memory.currentTask))};e.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};e.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new e(a.memory.currentTask.id)};
e.getTasks=function(a){var b=_.filter(a.find(FIND_HOSTILE_STRUCTURES),function(a){return(0<a.energy||a.store&&0<a.store[RESOURCE_ENERGY])&&a.structureType!==STRUCTURE_NUKER});return 0<b.length?_.map(b,function(a){return new e(a.id)}):a.storage&&0<a.storage.store[RESOURCE_ENERGY]?[new e(a.storage.id)]:_.map(_.filter(f.containersInRoom(a),function(a){return 500<=a.store[RESOURCE_ENERGY]}).sort(function(a,b){return b.store[RESOURCE_ENERGY]-a.store[RESOURCE_ENERGY]}),function(a){return new e(a.id)})};
e.getStorerTasks=function(a){return _.map(_.filter(f.containersInRoom(a),function(a){return a.store[RESOURCE_ENERGY]&&500<=a.store[RESOURCE_ENERGY]}),function(a){return new e(a.id)})};e.getCleanupTasks=function(a){return _.map(_.filter(a,function(a){return a.energy||a.store&&a.store[RESOURCE_ENERGY]}).sort(function(a,d){return(a.energy||a.store[RESOURCE_ENERGY])-(d.energy||d.store[RESOURCE_ENERGY])}),function(a){return new e(a.id)})};Memory.profiling&&c(1,41).registerObject(e,"TaskCollectEnergy");
r.exports=e;return r.exports};v[42]=function(r,p){var f=c(3,42),q=c(56,42),e=c(10,42),a=function(a,d,c){this.type="collectMinerals";this.id=a;this.resource=d;this.amount=c;this.object=Game.getObjectById(a)};a.prototype.canAssign=function(a){var b=this.object;if(0>this.amount||a.spawning||150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||this.resource&&this.amount&&(b.structureType===STRUCTURE_LAB&&b.mineralType!==this.resource&&b.mineralAmount<this.amount||b.structureType!==STRUCTURE_LAB&&(b.store[this.resource]||
0)<this.amount))return!1;f.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){var b=this.object,c=this.resource,e=a.carry,f=a.carryCapacity,p=this.amount,g;if(0>p||150>a.ticksToLive||!b)delete a.memory.currentTask;else if(g=b.store,_.sum(a.carry)===a.carryCapacity)delete a.memory.currentTask;else{if(b.structureType===STRUCTURE_LAB){if(null===b.mineralType){delete a.memory.currentTask;return}c=[b.mineralType]}else c=c?[c]:_.filter(_.keys(g),function(a){return a!==RESOURCE_ENERGY&&
0<g[a]});0===c.length?delete a.memory.currentTask:(q.moveTo(a,b,1),p?a.withdraw(b,c[0],Math.min(p,f-_.sum(e)))===OK&&delete a.memory.currentTask:a.withdraw(b,c[0])===OK&&delete a.memory.currentTask)}};a.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id,resource:this.resource,amount:this.amount}:delete a.memory.currentTask};a.fromObj=function(b){if(Game.getObjectById(b.memory.currentTask.id))return new a(b.memory.currentTask.id,b.memory.currentTask.resource,b.memory.currentTask.amount)};
a.getStorerTasks=function(b){return _.map(_.filter(f.containersInRoom(b),function(a){return 0<_.filter(_.keys(a.store),function(b){return b!==RESOURCE_ENERGY&&500<=a.store[b]}).length}).sort(function(a,b){return _.sum(b.store)-_.sum(a.store)}),function(b){return new a(b.id)})};a.getCleanupTasks=function(b){return _.map(_.filter(b,function(a){return(a.store||-1!==[STRUCTURE_LAB,STRUCTURE_NUKER,STRUCTURE_POWER_SPAWN].indexOf(a.structureType))&&(0<_.sum(a.store)&&a.store[RESOURCE_ENERGY]<_.sum(a.store)||
0<a.mineralAmount||0<a.ghodium||0<a.power)}).sort(function(a,b){return(a.mineralAmount||a.ghodium||a.power||_.sum(a.store)-a.store[RESOURCE_ENERGY])-(b.mineralAmount||b.ghodium||b.power||_.sum(b.store)-b.store[RESOURCE_ENERGY])}),function(b){return new a(b.id)})};a.getLabTasks=function(b){var d=b.memory,c=d.labsInUse,m=d.labQueue,d=b.storage,n=f.labsInRoom(b),p=[],g,h;m&&(g=m.status,h=m.sourceLabs);c&&(_.forEach(c,function(b){Game.creeps[b.creepToBoost]||p.push(new a(b.id))}),_.forEach(p,function(a){_.remove(c,
function(b){return b.id===a.id})}));d&&m&&"clearing"===g&&_.forEach(_.filter(n,function(a){return-1===_.map(c,function(a){return a.id}).indexOf(a.id)&&0<a.mineralAmount}),function(b){p.push(new a(b.id))});d&&c&&_.forEach(_.filter(c,function(a){return(!a.status||"emptying"===a.status)&&Game.getObjectById(a.id).mineralType&&Game.getObjectById(a.id).mineralType!==a.resource}),function(b){p.push(new a(b.id))});d&&m&&"creating"===g&&!e.roomLabsArePaused(b)&&(0===Game.getObjectById(h[0]).mineralAmount&&
0!==Game.getObjectById(h[1]).mineralAmount&&p.push(new a(h[1])),0!==Game.getObjectById(h[0]).mineralAmount&&0===Game.getObjectById(h[1]).mineralAmount&&p.push(new a(h[0])));d&&m&&"returning"===g&&_.forEach(_.filter(n,function(a){return a.mineralType===m.resource}),function(b){p.push(new a(b.id))});return p};a.getStorageTasks=function(b){var d=[],c;b.controller&&6<=b.controller.level&&(b.storage&&b.memory.labsInUse&&_.forEach(_.filter(b.memory.labsInUse,function(a){return(!a.status||-1!==["filling",
"refilling"].indexOf(a.status))&&(!Game.getObjectById(a.id).mineralType||Game.getObjectById(a.id).mineralType===("refilling"===a.status?a.oldResource:a.resource))}),function(c){0<("refilling"===c.status?c.oldAmount-Game.getObjectById(c.id).mineralAmount:c.amount-Game.getObjectById(c.id).mineralAmount)&&d.push(new a(b.storage.id,"refilling"===c.status?c.oldResource:c.resource,"refilling"===c.status?c.oldAmount-Game.getObjectById(c.id).mineralAmount:c.amount-Game.getObjectById(c.id).mineralAmount))}),
b.storage&&b.memory.labQueue&&"moving"===b.memory.labQueue.status&&3<=f.labsInRoom(b).length&&!e.roomLabsArePaused(b)&&_.forEach(b.memory.labQueue.children,function(e){(c=_.sum(_.filter(f.labsInRoom(b),function(a){return a.mineralType===e}),function(a){return a.mineralAmount}))<b.memory.labQueue.amount&&d.push(new a(b.storage.id,e,b.memory.labQueue.amount-c))}),b.storage&&b.terminal&&Memory.reserveMinerals&&_.forEach(b.storage.store,function(c,e){e!==RESOURCE_ENERGY&&(Memory.reserveMinerals[e]?(e.startsWith("X")&&
5===e.length?Memory.reserveMinerals[e]-5E3:Memory.reserveMinerals[e])<c&&d.push(new a(b.storage.id,e,c-(e.startsWith("X")&&5===e.length?Memory.reserveMinerals[e]-5E3:Memory.reserveMinerals[e]))):d.push(new a(b.storage.id,e,c)))}),0<f.nukersInRoom(b).length&&8<=b.controller.level&&(_.forEach(f.nukersInRoom(b),function(c){c.ghodium<c.ghodiumCapacity&&d.push(new a(b.storage.id,RESOURCE_GHODIUM,c.ghodiumCapacity-c.ghodium))}),_.forEach(f.powerSpawnsInRoom(b),function(c){c.power<c.powerCapacity&&b.storage.store[RESOURCE_POWER]&&
d.push(new a(b.storage.id,RESOURCE_POWER,Math.min(c.powerCapacity-c.power,b.storage.store[RESOURCE_POWER])))})));return d};a.getTerminalTasks=function(b){var c=[];b.storage&&b.terminal&&Memory.reserveMinerals&&_.forEach(b.terminal.store,function(d,e){e!==RESOURCE_ENERGY&&Memory.reserveMinerals[e]&&(b.storage.store[e]?b.storage.store[e]<(e.startsWith("X")&&5===e.length?Memory.reserveMinerals[e]-5E3:Memory.reserveMinerals[e])&&c.push(new a(b.terminal.id,e,Math.min(d,(e.startsWith("X")&&5===e.length?
Memory.reserveMinerals[e]-5E3:Memory.reserveMinerals[e])-b.storage.store[e]))):c.push(new a(b.terminal.id,e,Math.min(d,e.startsWith("X")&&5===e.length?Memory.reserveMinerals[e]-5E3:Memory.reserveMinerals[e]))))});return c};Memory.profiling&&c(1,42).registerObject(a,"TaskCollectMinerals");r.exports=a;return r.exports};v[43]=function(r,p){var f=c(3,43),q=c(56,43),e=function(a){this.type="dismantle";this.id=a;this.structure=Game.getObjectById(a);this.force=this.unimportant=!0};e.prototype.canAssign=
function(a){if(a.spawning||0<a.carryCapacity&&_.sum(a.carry)===a.carryCapacity||a.spawning||0===a.getActiveBodyparts(WORK))return!1;f.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){var b=this.structure;0<a.carryCapacity&&_.sum(a.carry)===a.carryCapacity||!this.structure||0===a.getActiveBodyparts(WORK)?delete a.memory.currentTask:(q.moveTo(a,b,1),a.dismantle(b),50*Math.min(a.getActiveBodyparts(WORK),a.carry[RESOURCE_ENERGY])>=b.hits&&delete a.memory.currentTask)};e.prototype.toObj=
function(a){this.structure?a.memory.currentTask={type:this.type,id:this.structure.id}:delete a.memory.currentTask};e.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new e(a.memory.currentTask.id)};e.getCleanupTasks=function(a){return _.map(a,function(a){return new e(a.id)})};Memory.profiling&&c(1,43).registerObject(e,"TaskDismantle");r.exports=e;return r.exports};v[44]=function(r,p){var f=c(3,44),q=c(56,44),e=c(10,44),a=function(a){this.type="fillEnergy";this.id=a;this.object=
Game.getObjectById(a)};a.prototype.canAssign=function(a){var b;if(a.spawning||!a.carry[RESOURCE_ENERGY]||this.object.energyCapacity&&this.object.energy===this.object.energyCapacity)return!1;if(this.object.structureType===STRUCTURE_EXTENSION){switch(this.object.room.controller.level){case 7:b=100;break;case 8:b=200;break;default:b=50}if(a.carry[RESOURCE_ENERGY]<b)return!1}f.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){var b=this.object;b&&(b.energy||_.sum(b.store))!==
(b.energyCapacity||b.storeCapacity)?b&&a.carry[RESOURCE_ENERGY]?(q.moveTo(a,b,1),a.transfer(b,RESOURCE_ENERGY)===OK&&delete a.memory.currentTask):delete a.memory.currentTask:delete a.memory.currentTask};a.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};a.fromObj=function(b){if(Game.getObjectById(b.memory.currentTask.id))return new a(b.memory.currentTask.id)};a.getExtensionTasks=function(b){return _.map(_.filter(f.extensionsInRoom(b),
function(a){return a.energy<a.energyCapacity}),function(b){return new a(b.id)})};a.getSpawnTasks=function(b){return _.map(_.filter(f.spawnsInRoom(b),function(a){return a.energy<a.energyCapacity}),function(b){return new a(b.id)})};a.getTowerTasks=function(b){return _.map(_.filter(f.towersInRoom(b),function(a){return.8>a.energy/a.energyCapacity}).sort(function(a,b){return a.energy-b.energy}),function(b){return new a(b.id)})};a.getLabTasks=function(b){return _.map(_.filter(f.labsInRoom(b),function(a){return a.energy<
a.energyCapacity}),function(b){return new a(b.id)})};a.getContainerTasks=function(b){var c=_.filter(f.containersInRoom(b),function(a){return _.sum(a.store)<a.storeCapacity});b.storage&&b.storage.my&&_.sum(b.storage.store)<b.storage.storeCapacity&&c.unshift(b.storage);return _.map(c,function(b){return new a(b.id)})};a.getStorageTasks=function(b){return b.storage&&b.storage.my&&_.sum(b.storage.store)<b.storage.storeCapacity?[new a(b.storage.id)]:[]};a.getLinkTasks=function(b){var c=f.linksInRoom(b);
b=f.spawnsInRoom(b);if(0===c.length||0===b.length)return[];c=e.objectsClosestToObj(c,b[0]);return[new a(c[0].id)]};a.getNukerTasks=function(b){b=f.nukersInRoom(b);return 0===b.length?[]:[new a(b[0].id)]};a.getPowerSpawnTasks=function(b){b=f.powerSpawnsInRoom(b);return 0===b.length?[]:[new a(b[0].id)]};Memory.profiling&&c(1,44).registerObject(a,"TaskFillEnergy");r.exports=a;return r.exports};v[45]=function(r,p){var f=c(3,45),q=c(56,45),e=c(10,45),a=function(a,c){this.type="fillMinerals";this.id=a;
this.resources=c;this.object=Game.getObjectById(a)};a.prototype.canAssign=function(a){if(a.spawning||_.sum(a.carry)===a.carry[RESOURCE_ENERGY]||this.resources&&0===_.intersection(_.keys(this.resources),_.filter(_.keys(a.carry),function(b){return b!==RESOURCE_ENERGY&&a.carry[b]})).length||this.object.structureType===STRUCTURE_NUKER&&this.object.ghodium===this.object.ghodiumCapacity||this.object.structureType===STRUCTURE_POWER_SPAWN&&this.object.power===this.object.powerCapacity)return!1;f.creepTasks[a.name]=
this;this.toObj(a);return!0};a.prototype.run=function(a){var b=this,c=this.object,e;if(c){if(c.storeCapacity&&0===_.filter(_.keys(a.carry),function(b){return b!==RESOURCE_ENERGY&&0<a.carry[b]}).length||(_.sum(c.store)||0)===c.storeCapacity)return delete a.memory.currentTask,!0;this.resources?(e=_.intersection(_.keys(this.resources),_.filter(_.keys(a.carry),function(b){return a.carry[b]})).sort(function(a,c){a=b.resources[a];c=b.resources[c];return a===c?0:null===a?1:null===c?-1:a-c}),0===e.length?
delete a.memory.currentTask:(q.moveTo(a,c,1),a.transfer(c,e[0],null!==this.resources[e[0]]?Math.min(this.resources[e[0]],a.carry[e[0]]):void 0)===OK&&1===e.length&&delete a.memory.currentTask)):(e=_.filter(_.keys(a.carry),function(b){return b!==RESOURCE_ENERGY&&0<a.carry[b]}),0===e.length?delete a.memory.currentTask:(q.moveTo(a,c,1),a.transfer(c,e[0])===OK&&0===_.filter(_.keys(a.carry),function(b){return b!==RESOURCE_ENERGY&&0<a.carry[b]}).length&&delete a.memory.currentTask))}else delete a.memory.currentTask};
a.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id,resources:this.resources}:delete a.memory.currentTask};a.fromObj=function(b){if(Game.getObjectById(b.memory.currentTask.id))return new a(b.memory.currentTask.id,b.memory.currentTask.resources)};a.getLabTasks=function(b){var c,p=[];_.forEach(_.filter(b.memory.labsInUse,function(a){return(!a.status||-1!==["filling","refilling"].indexOf(a.status))&&(!Game.getObjectById(a.id).mineralType||Game.getObjectById(a.id).mineralType===
("refilling"===a.status?a.oldResource:a.resource))&&Game.getObjectById(a.id).mineralAmount<("refilling"===a.status?a.oldAmount:a.amount)}),function(b){c={};c["refilling"===b.status?b.oldResource:b.resource]=("refilling"===b.status?b.oldAmount:b.amount)-Game.getObjectById(b.id).mineralAmount;p.push(new a(b.id,c))});b.storage&&3<=f.labsInRoom(b).length&&b.memory.labQueue&&"moving"===b.memory.labQueue.status&&!e.roomLabsArePaused(b)&&(Game.getObjectById(b.memory.labQueue.sourceLabs[0]).mineralAmount<
b.memory.labQueue.amount&&(c={},c[b.memory.labQueue.children[0]]=b.memory.labQueue.amount-Game.getObjectById(b.memory.labQueue.sourceLabs[0]).mineralAmount,p.push(new a(b.memory.labQueue.sourceLabs[0],c))),Game.getObjectById(b.memory.labQueue.sourceLabs[1]).mineralAmount<b.memory.labQueue.amount&&(c={},c[b.memory.labQueue.children[1]]=b.memory.labQueue.amount-Game.getObjectById(b.memory.labQueue.sourceLabs[1]).mineralAmount,p.push(new a(b.memory.labQueue.sourceLabs[1],c))));return p};a.getStorageTasks=
function(b){var c=b.storage,e,f;if(c&&c.my&&(!b.terminal||!b.terminal.my))return[new a(c.id)];if(c&&c.my&&_.sum(e=c.store)<c.storeCapacity&&Memory.reserveMinerals)return f={},_.forEach(_.keys(Memory.reserveMinerals),function(a){var b=(a.startsWith("X")&&5===a.length?Memory.reserveMinerals[a]-5E3:Memory.reserveMinerals[a])-(e[a]||0);0<b&&(f[a]=b)}),[new a(c.id,f)]};a.getTerminalTasks=function(b){return b.terminal&&b.terminal.my&&_.sum(b.terminal.store)<b.terminal.storeCapacity?[new a(b.terminal.id)]:
[]};a.getNukerTasks=function(b){b=f.nukersInRoom(b);var c;if(0===b.length)return[];c={};c[RESOURCE_GHODIUM]=b[0].ghodiumCapacity-b[0].ghodium;return 0>=c[RESOURCE_GHODIUM]?[]:[new a(b[0].id,c)]};a.getPowerSpawnTasks=function(b){b=f.powerSpawnsInRoom(b);var c;if(0===b.length)return[];c={};c[RESOURCE_POWER]=b[0].powerCapacity-b[0].power;return 0>=c[RESOURCE_POWER]?[]:[new a(b[0].id,c)]};Memory.profiling&&c(1,45).registerObject(a,"TaskFillMinerals");r.exports=a;return r.exports};v[46]=function(r,p){var f=
c(3,46),q=c(56,46),e=function(a,b){this.type="harvest";this.failIn=a||10;this.source=b};e.prototype.canAssign=function(a){var b=Game.getObjectById(a.memory.homeSource);if(a.spawning||150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||!b||0===a.getActiveBodyparts(WORK)||0===b.energy&&(b=a.room.find(FIND_SOURCES_ACTIVE)[0],!b))return!1;this.source=b.id;f.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){var b=Game.getObjectById(this.source||a.memory.homeSource);150>a.ticksToLive||
_.sum(a.carry)===a.carryCapacity||!b||0===b.energy||0===a.getActiveBodyparts(WORK)?delete a.memory.currentTask:(q.moveTo(a,b,1),a.harvest(b)===OK?(void 0===Memory.rooms[a.room.name].harvested&&(Memory.rooms[a.room.name].harvested=3E4),Memory.rooms[a.room.name].harvested+=2*a.getActiveBodyparts(WORK)):(this.failIn--,0===this.failIn&&delete a.memory.currentTask))};e.prototype.toObj=function(a){a.memory.currentTask={type:this.type,failIn:this.failIn,source:this.source}};e.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.source))return new e(a.memory.currentTask.failIn,
a.memory.currentTask.source)};Memory.profiling&&c(1,46).registerObject(e,"TaskHarvest");r.exports=e;return r.exports};v[47]=function(r,p){var f=c(3,47),q=c(56,47),e=function(a){this.type="heal";this.id=a;this.ally=Game.getObjectById(a);this.unimportant=!0};e.prototype.canAssign=function(a,b){if(a.spawning||0===a.getActiveBodyparts(HEAL))return!1;f.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){a.hits<a.hitsMax&&a.heal(a);if(!this.ally)return delete a.memory.currentTask,
!0;q.moveTo(a,this.ally);this.ally.hits!==this.ally.hitsMax&&a.id!==this.ally.id&&(1>=a.pos.getRangeTo(this.ally)?a.heal(this.ally):3>=a.pos.getRangeTo(this.ally)&&a.rangedHeal(this.ally))};e.prototype.toObj=function(a){this.ally?a.memory.currentTask={type:this.type,id:this.ally.id,unimportant:this.unimportant}:delete a.memory.currentTask};e.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new e(a.memory.currentTask.id)};e.getTasks=function(a){return _.map(_.filter(a.find(FIND_MY_CREEPS),
function(a){return a.hits<a.hitsMax}).sort(function(a,c){return a.hits-c.hits}),function(a){return new e(a.id)})};e.getDefenderTask=function(a){return _.map(_.filter(a.room.find(FIND_MY_CREEPS),function(b){return b.hits<b.hitsMax&&b.id!==a.id}).sort(function(a,c){return a.hits-c.hits}),function(a){return new e(a.id)})[0]};Memory.profiling&&c(1,47).registerObject(e,"TaskHeal");r.exports=e;return r.exports};v[48]=function(r,p){var f=c(3,48),q=c(56,48),e=function(a){this.type="meleeAttack";this.id=a;
this.enemy=Game.getObjectById(a)};e.prototype.canAssign=function(a){if(a.spawning||0===a.getActiveBodyparts(ATTACK))return!1;f.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){this.enemy?0===a.getActiveBodyparts(ATTACK)?(a.say("Help!"),delete a.memory.currentTask):(q.moveTo(a,this.enemy),a.attack(this.enemy)===ERR_NOT_IN_RANGE&&a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a),0<a.getActiveBodyparts(RANGED_ATTACK)&&a.rangedAttack(this.enemy)):(a.say("Get Rekt!",
!0),delete a.memory.currentTask)};e.prototype.toObj=function(a){this.enemy?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};e.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new e(a.memory.currentTask.id)};e.getTasks=function(a){return _.map(f.hostilesInRoom(a).sort(function(a,c){return a.hits-c.hits}),function(a){return new e(a.id)})};Memory.profiling&&c(1,48).registerObject(e,"TaskMeleeAttack");r.exports=e;return r.exports};v[49]=function(r,
p){var f=c(3,49),q=c(56,49),e=c(10,49),a=function(a){this.type="mine";this.id=a;this.source=Game.getObjectById(a);this.force=!0};a.prototype.canAssign=function(a){var b=Game.getObjectById(a.memory.container);if(a.spawning||!b||0===a.getActiveBodyparts(WORK))return!1;f.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){var b=Game.getObjectById(a.memory.container),c;b?(b.pos.x===a.pos.x&&b.pos.y===a.pos.y&&b.pos.roomName===a.pos.roomName||q.moveTo(a,b,0),b.pos.x===a.pos.x&&
b.pos.y===a.pos.y&&b.pos.roomName===a.pos.roomName&&(this.source?c=this.source:(c=Memory.containerSource[a.memory.container]?Game.getObjectById(Memory.containerSource[a.memory.container]):e.objectsClosestToObj([].concat.apply([],[b.room.find(FIND_SOURCES),b.room.find(FIND_MINERALS)]),a)[0],this.id=c.id),c instanceof Mineral&&0===c.mineralAmount&&(a.say(":(",!0),a.suicide()),c instanceof Mineral&&1500<=_.sum(b.store)||(a.harvest(c)===OK&&(void 0===Memory.rooms[a.room.name].harvested&&(Memory.rooms[a.room.name].harvested=
3E4),Memory.rooms[a.room.name].harvested+=2*a.getActiveBodyparts(WORK)),0<_.filter([].concat.apply([],[f.creeps[a.room.name]&&f.creeps[a.room.name].miner||[],f.creeps[a.room.name]&&f.creeps[a.room.name].remoteMiner||[]]),function(b){return b.room.name===a.room.name&&b.memory.container===a.memory.container&&1===b.pos.getRangeTo(a)&&b.ticksToLive>a.ticksToLive&&0===b.fatigue}).length&&(a.say(":(",!0),a.suicide())))):delete a.memory.currentTask};a.prototype.toObj=function(a){a.memory.currentTask={type:this.type,
id:this.id}};a.fromObj=function(b){if(!b.memory.currentTask.id||Game.getObjectById(b.memory.currentTask.id))return new a(b.memory.currentTask.id)};Memory.profiling&&c(1,49).registerObject(a,"TaskMine");r.exports=a;return r.exports};v[50]=function(r,p){var f=c(3,50),q=c(41,50),e=c(56,50),a=function(a){this.type="pickupResource";this.id=a;this.resource=Game.getObjectById(a);this.force=!0};a.prototype.canAssign=function(a){if(a.spawning||150>a.ticksToLive||!this.resource||_.sum(a.carry)===a.carryCapacity||
this.resource.amount<a.pos.getRangeTo(this.resource)||this.resource.resourceType===RESOURCE_ENERGY&&50>this.resource.amount)return!1;f.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){if(this.resource&&_.sum(a.carry)!==a.carryCapacity){if(e.moveTo(a,this.resource,1),a.pickup(this.resource)===OK){delete a.memory.currentTask;var b=_.filter(a.room.lookForAt(LOOK_STRUCTURES,this.resource),function(a){return a.structureType===STRUCTURE_CONTAINER&&a.store[RESOURCE_ENERGY]});0<
b.length&&(new q(b[0].id)).canAssign(a)}}else delete a.memory.currentTask};a.prototype.toObj=function(a){this.resource?a.memory.currentTask={type:this.type,id:this.resource.id}:delete a.memory.currentTask};a.fromObj=function(b){if(Game.getObjectById(b.memory.currentTask.id))return new a(b.memory.currentTask.id)};a.getTasks=function(b){return _.map(f.resourcesInRoom(b),function(b){return new a(b.id)})};a.getCollectorTasks=function(b){return _.map(_.filter(f.resourcesInRoom(b),function(a){return a.resourceType===
RESOURCE_ENERGY}),function(b){return new a(b.id)})};Memory.profiling&&c(1,50).registerObject(a,"TaskPickupResource");r.exports=a;return r.exports};v[51]=function(r,p){var f=c(3,51),q=c(56,51),e=function(a,b){this.type="rally";this.id=a;this.creep=b;a instanceof RoomPosition?this.rallyPoint=new RoomPosition(a.x,a.y,a.roomName):(this.rallyPoint=Game.getObjectById(a),this.rallyPoint||(this.rallyPoint=new RoomPosition(25,25,a),this.range=5));this.unimportant=!0};e.prototype.canAssign=function(a){if(a.spawning)return!1;
f.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){var b;this.rallyPoint?(b=a.room.name===this.rallyPoint.roomName||!(this.rallyPoint instanceof RoomPosition)||this.rallyPoint.pos&&a.room.name===this.rallyPoint.pos.roomName?this.range||0:20,a.pos.getRangeTo(this.rallyPoint)<=b?0===a.pos.x?a.move(RIGHT):49===a.pos.x?a.move(LEFT):0===a.pos.y?a.move(BOTTOM):49===a.pos.y?a.move(TOP):0<_.filter(a.pos.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_ROAD||
a.structureType===STRUCTURE_CONTAINER}).length&&a.move(Math.floor(8*Math.random())):q.moveTo(a,this.rallyPoint,b),a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a),0<a.getActiveBodyparts(RANGED_ATTACK)&&a.rangedMassAttack()):delete a.memory.currentTask};e.prototype.toObj=function(a){this.rallyPoint?a.memory.currentTask={type:this.type,id:this.id,unimportant:this.unimportant,range:this.range}:delete a.memory.currentTask};e.fromObj=function(a){var b;if(b=a.memory.currentTask.id.roomName?new e(new RoomPosition(a.memory.currentTask.id.x,
a.memory.currentTask.id.y,a.memory.currentTask.id.roomName)):new e(a.memory.currentTask.id),a.memory.currentTask.range)b.range=a.memory.currentTask.range;return b};e.getHarvesterTasks=function(a){return _.map(_.filter(a,function(a){return!a.spawning&&150<=a.ticksToLive&&a.memory.homeSource}),function(a){return new e(a.memory.homeSource,a)})};e.getDefenderTask=function(a){var b=f.sourceKeepersInRoom(a.room).sort(function(a,b){return a.ticksToSpawn-b.ticksToSpawn})[0];return b&&a.room.name===a.memory.home?
new e(b.id,a):new e(a.memory.home,a)};e.getClaimerTask=function(a){return new e(a.memory.claim,a)};Memory.profiling&&c(1,51).registerObject(e,"TaskRally");r.exports=e;return r.exports};v[52]=function(r,p){var f=c(3,52),q=c(56,52),e=function(a){this.type="rangedAttack";this.id=a;this.enemy=Game.getObjectById(a)};e.prototype.canAssign=function(a){if(a.spawning||0===a.getActiveBodyparts(RANGED_ATTACK))return!1;f.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){this.enemy?0===
a.getActiveBodyparts(RANGED_ATTACK)?(a.say("Help!"),delete a.memory.currentTask):0<a.getActiveBodyparts(ATTACK)?(q.moveTo(a,this.enemy),a.attack(this.enemy)===ERR_NOT_IN_RANGE&&a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a),0<a.getActiveBodyparts(RANGED_ATTACK)&&a.rangedAttack(this.enemy)):(q.moveTo(a,this.enemy,3),a.rangedAttack(this.enemy),a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a)):(a.say("Get Rekt!",!0),delete a.memory.currentTask)};e.prototype.toObj=function(a){this.enemy?
a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};e.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new e(a.memory.currentTask.id)};e.getTasks=function(a){return _.map(f.hostilesInRoom(a).sort(function(a,c){return a.hits-c.hits}),function(a){return new e(a.id)})};Memory.profiling&&c(1,52).registerObject(e,"TaskRangedAttack");r.exports=e;return r.exports};v[53]=function(r,p){var f=c(3,53),q=c(56,53),e=function(a){this.type="repair";this.id=a;this.structure=
Game.getObjectById(a);this.force=!0};e.prototype.canAssign=function(a){if(a.spawning||!a.carry[RESOURCE_ENERGY]||0===a.carry[RESOURCE_ENERGY]||0===a.getActiveBodyparts(WORK)||1E6<=this.structure.hits&&"worker"===a.memory.role&&a.room.name===a.memory.home&&8>a.room.controller.level&&!_.find(a.body,function(a){return a.type===WORK&&-1!==[RESOURCE_CATALYZED_LEMERGIUM_ACID,RESOURCE_LEMERGIUM_ACID,RESOURCE_LEMERGIUM_HYDRIDE].indexOf(a.boost)}))return!1;f.creepTasks[a.name]=this;this.toObj(a);return!0};
e.prototype.run=function(a){var b=this.structure;a.carry[RESOURCE_ENERGY]&&b&&b.hits!==b.hitsMax&&0!==a.getActiveBodyparts(WORK)?(q.moveTo(a,b,Math.max(Math.min(a.pos.getRangeTo(b)-1,3),1)),a.repair(b)===OK&&100*Math.min(a.getActiveBodyparts(WORK),a.carry[RESOURCE_ENERGY])>=b.hitsMax-b.hits&&delete a.memory.currentTask):delete a.memory.currentTask};e.prototype.toObj=function(a){this.structure?a.memory.currentTask={type:this.type,id:this.structure.id}:delete a.memory.currentTask};e.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new e(a.memory.currentTask.id)};
e.getTowerTasks=function(a){return _.map(_.take(_.filter(f.sortedRepairableStructuresInRoom(a),function(a){return 1E4>a.hits&&.25>a.hits/a.hitsMax}),5),function(a){return new e(a.id)})};e.getCriticalTasks=function(a){return _.map(_.take(_.filter(f.sortedRepairableStructuresInRoom(a),function(a){return 125E3>a.hits&&.5>a.hits/a.hitsMax}),5),function(a){return new e(a.id)})};e.getTasks=function(a){return _.map(_.take(_.filter(f.sortedRepairableStructuresInRoom(a),function(a){return.9>a.hits/a.hitsMax||
1E5<a.hitsMax-a.hits}),5),function(a){return new e(a.id)})};Memory.profiling&&c(1,53).registerObject(e,"TaskRepair");r.exports=e;return r.exports};v[54]=function(r,p){var f=c(3,54),q=c(56,54),e=function(a){this.type="reserve";this.force=!0};e.prototype.canAssign=function(a){if(a.spawning||0===a.getActiveBodyparts(CLAIM)||!Game.rooms[a.memory.home]||!Game.rooms[a.memory.home].controller||Game.rooms[a.memory.home].controller.my)return!1;f.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=
function(a){a.say("You;spin;me;right;round;baby;right;round;like a;record;baby;right;round;round;round;".split(";")[Game.time%16],!0);Game.rooms[a.memory.home]&&Game.rooms[a.memory.home].controller&&!Game.rooms[a.memory.home].controller.my&&0!==a.getActiveBodyparts(CLAIM)?(q.moveTo(a,Game.rooms[a.memory.home].controller,1),a.reserveController(Game.rooms[a.memory.home].controller),!Memory.signs||!Memory.signs[a.room.name]||a.room.controller.sign&&"roncli"===a.room.controller.sign.username||a.signController(a.room.controller,
Memory.signs[a.room.name])):delete a.memory.currentTask};e.prototype.toObj=function(a){a.memory.currentTask={type:this.type}};e.fromObj=function(a){return new e};e.getTask=function(a){if(a.room.controller)return new e};e.getRemoteTask=function(a){if(Game.rooms[a.memory.home]&&Game.rooms[a.memory.home].controller)return new e};Memory.profiling&&c(1,54).registerObject(e,"TaskReserve");r.exports=e;return r.exports};v[55]=function(r,p){var f=c(3,55),q=c(56,55),e=c(10,55),a=function(a){this.type="upgradeController";
this.room=a;this.controller=Game.rooms[a].controller;this.force=!0};a.prototype.canAssign=function(a){if(a.spawning||!a.carry[RESOURCE_ENERGY]||"upgrader"!==a.memory.role&&_.sum(a.carry)!==a.carryCapacity&&150<=a.ticksToLive&&1E3<=this.controller.ticksToDowngrade||0===a.getActiveBodyparts(WORK))return!1;f.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){a.say("I've;got to;celebrate;you baby;I've got;to praise;GCL like;I should!;".split(";")[Game.time%9],!0);if(this.controller&&
a.carry[RESOURCE_ENERGY]&&0!==a.getActiveBodyparts(WORK)){if("upgrader"===a.memory.role){var b=e.objectsClosestToObj(f.linksInRoom(a.room),a);0<b.length&&0<b[0].energy&&1>=a.pos.getRangeTo(b[0])&&a.withdraw(b[0],RESOURCE_ENERGY)}q.moveTo(a,this.controller,Math.max(Math.min(a.pos.getRangeTo(this.controller)-1,3),1));a.transfer(this.controller,RESOURCE_ENERGY);!Memory.signs||!Memory.signs[a.room.name]||this.controller.sign&&"roncli"===this.controller.sign.username||a.signController(this.controller,
Memory.signs[a.room.name]);a.carry[RESOURCE_ENERGY]<=a.getActiveBodyparts(WORK)&&delete a.memory.currentTask}else delete a.memory.currentTask};a.prototype.toObj=function(a){a.memory.currentTask={type:this.type,room:this.room}};a.fromObj=function(b){return new a(b.memory.currentTask.room)};a.getCriticalTasks=function(b){var c;if(b.controller&&b.controller.my){switch(b.controller.level){case 1:c=1E4;break;case 2:c=3500;break;case 3:c=5E3;break;case 4:c=1E4;break;case 5:c=2E4;break;case 6:c=3E4;break;
case 7:c=5E4;break;case 8:c=1E5}if(b.controller.ticksToDowngrade<c)return[new a(b.name)]}return[]};a.getTasks=function(b){if(b.controller&&b.controller.my)return[new a(b.name)]};Memory.profiling&&c(1,55).registerObject(a,"TaskUpgradeController");r.exports=a;return r.exports};v[56]=function(r,p){var f={1:{dx:0,dy:-1},2:{dx:1,dy:-1},3:{dx:1,dy:0},4:{dx:1,dy:1},5:{dx:0,dy:1},6:{dx:-1,dy:1},7:{dx:-1,dy:0},8:{dx:-1,dy:-1}},q=c(3,56),e=c(9,56);p=function(){};p.moveTo=function(a,b,c){var d=a.memory._pathing,
m=[],n=a.pos,p=n.x,g=n.y,h=n.roomName,l=Game.time,k,r,w,v,y;b instanceof RoomObject&&(b=b.pos);k=b.x;r=b.y;w=b.roomName;c||(c=0);if(!(n.getRangeTo(b)<=c)){!d||d.dest.x===k&&d.dest.y===r&&d.dest.room===w||(d=void 0);d&&d.restartOn&&-1!==d.restartOn.indexOf(h)&&(delete d.path,delete d.restartOn);d&&((v=p===d.start.x&&g===d.start.y&&h===d.start.room||(49===Math.abs(p-d.start.x)||49===Math.abs(g-d.start.y))&&h!==d.start.room,d.stationary=v?d.stationary+1:0,2<=d.stationary)?(d.path&&0<d.path.length&&(v=
f[+d.path[0]],v={x:p+v.dx,y:g+v.dy,room:h,blockedUntil:l+12},v.x!==p||v.y!==g)&&(d.blocked||(d.blocked=[]),d.blocked.push(v)),delete d.path,delete d.restartOn):d.path&&!v&&(1===d.path.length?d=void 0:(d.start={x:p,y:g,room:h},d.path=d.path.substring(1))));if(!d||!d.path)if(v=a.getActiveBodyparts(MOVE),new e(4),y=1+(_.filter(a.body,function(a){return 0<a.hits&&-1===[MOVE,CARRY].indexOf(a.type)}).length+Math.ceil(_.sum(a.carry)/50)-v)/v,d&&d.blocked&&_.remove(d.blocked,function(a){return a.blockedUntil<=
l}),v=h+"."+p+"."+g+"."+w+"."+k+"."+r+"."+c+"."+(1>=y?0:1),d&&0!==d.blocked.length||!Memory.paths[v]){b=PathFinder.search(n,{pos:b,range:c},{plainCost:Math.ceil(1*y),swampCost:Math.ceil(5*y),maxOps:h===w?2E3:1E5,roomCallback:function(b){var c=Game.rooms[b],e;if(h!==b&&(-1!==Memory.avoidRooms.indexOf(b)||h===w&&b!==w&&!a.memory.role.startsWith("remote")&&!a.memory.role.startsWith("army")))return!1;if(c)return e=q.getCostMatrix(c),d&&b===h&&_.forEach(d.blocked,function(a){b===a.room&&l<a.blockedUntil&&
e.set(a.x,a.y,255)}),e;m.push(b)}});if(!b.path||0===b.path.length)return;d?(d.path=this.serializePath(n,b.path),d.restartOn=m):d={start:{x:p,y:g,room:h},dest:{x:k,y:r,room:w},path:this.serializePath(n,b.path),stationary:0,blocked:[],restartOn:m};0===d.blocked.length&&10<d.path.length&&(Memory.paths[v]=[d.path,[],l,l],m&&0<m.length&&(Memory.paths[v][1]=m))}else d?(d.path=Memory.paths[v][0],d.restartOn=Memory.paths[v][1]):d={start:{x:p,y:g,room:h},dest:{x:k,y:r,room:w},path:Memory.paths[v][0],stationary:0,
blocked:[],restartOn:Memory.paths[v][1]},Memory.paths[v][3]=l;a.move(+d.path[0])!==OK&&--d.stationary;a.memory._pathing=d}};p.serializePath=function(a,b){return _.map(b,function(c,e){e=0===e?a:b[e-1];switch(c.x-e.x){case 0:case -49:case 49:switch(c.y-e.y){case 0:case -49:case 49:return"";case 1:case -48:return BOTTOM.toString();case -1:case 48:return TOP.toString()}break;case 1:case -48:switch(c.y-e.y){case 0:case -49:case 49:return RIGHT.toString();case 1:case -48:return BOTTOM_RIGHT.toString();
case -1:case 48:return TOP_RIGHT.toString()}break;case -1:case 48:switch(c.y-e.y){case 0:case -49:case 49:return LEFT.toString();case 1:case -48:return BOTTOM_LEFT.toString();case -1:case 48:return TOP_LEFT.toString()}}}).join("")};Memory.profiling&&c(1,56).registerObject(p,"Pathing");r.exports=p;return r.exports};if("object"===typeof module)module.exports=c(0);else return c(0)})();