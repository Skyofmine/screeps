var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,r,t){if(t.get||t.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[r]=t.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var r=0;return $jscomp.iteratorPrototype(function(){return r<c.length?{done:!1,value:c[r++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.makeIterator=function(c){$jscomp.initSymbolIterator();var r=c[Symbol.iterator];return r?r.call(c):$jscomp.arrayIterator(c)};$jscomp.arrayFromIterator=function(c){for(var r,t=[];!(r=c.next()).done;)t.push(r.value);return t};$jscomp.arrayFromIterable=function(c){return c instanceof Array?c:$jscomp.arrayFromIterator($jscomp.makeIterator(c))};
$jscomp.inherits=function(c,r){function t(){}t.prototype=r.prototype;c.prototype=new t;c.prototype.constructor=c;for(var y in r)if(Object.defineProperties){var m=Object.getOwnPropertyDescriptor(r,y);m&&Object.defineProperty(c,y,m)}else c[y]=r[y]};$jscomp.array=$jscomp.array||{};
$jscomp.iteratorFromArray=function(c,r){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var t=0,y={next:function(){if(t<c.length){var m=t++;return{value:r(m,c[m]),done:!1}}y.next=function(){return{done:!0,value:void 0}};return y.next()}};y[Symbol.iterator]=function(){return y};return y};
$jscomp.polyfill=function(c,r,t,y){if(r){t=$jscomp.global;c=c.split(".");for(y=0;y<c.length-1;y++){var m=c[y];m in t||(t[m]={});t=t[m]}c=c[c.length-1];y=t[c];r=r(y);r!=y&&null!=r&&$jscomp.defineProperty(t,c,{configurable:!0,writable:!0,value:r})}};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.values",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c,t){return t})}},"es6","es3");$jscomp.findInternal=function(c,r,t){c instanceof String&&(c=String(c));for(var y=c.length,m=0;m<y;m++){var f=c[m];if(r.call(t,f,m,c))return{i:m,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,t){return $jscomp.findInternal(this,c,t).v}},"es6-impl","es3");
$jscomp.checkStringArgs=function(c,r,t){if(null==c)throw new TypeError("The 'this' value for String.prototype."+t+" must not be null or undefined");if(r instanceof RegExp)throw new TypeError("First argument to String.prototype."+t+" must not be a regular expression");return c+""};
$jscomp.polyfill("String.prototype.startsWith",function(c){return c?c:function(c,t){var r=$jscomp.checkStringArgs(this,c,"startsWith");c+="";var m=r.length,f=c.length;t=Math.max(0,Math.min(t|0,r.length));for(var g=0;g<f&&t<m;)if(r[t++]!=c[g++])return!1;return g>=f}},"es6-impl","es3");$jscomp.polyfill("Number.isFinite",function(c){return c?c:function(c){return"number"!==typeof c?!1:!isNaN(c)&&Infinity!==c&&-Infinity!==c}},"es6-impl","es3");
$jscomp.polyfill("Number.isInteger",function(c){return c?c:function(c){return Number.isFinite(c)?c===Math.floor(c):!1}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.fill",function(c){return c?c:function(c,t,y){var m=this.length||0;0>t&&(t=Math.max(0,m+t));if(null==y||y>m)y=m;y=Number(y);0>y&&(y=Math.max(0,m+y));for(t=Number(t||0);t<y;t++)this[t]=c;return this}},"es6-impl","es3");
(function(){function c(c,f){y[c]||(t[c]={exports:{},loaded:!1},y[c]=!0,0===c&&"function"===typeof require?require.main=t[0]:t[c].parent=t[f],r[c].call(this,t[c],t[c].exports),t[c].loaded=!0);return t[c].exports}var r={},t={},y={};r[0]=function(m,f){var g=c(1,0),p=c(2,0),e=c(3,0),a=c(4,0),b=c(5,0),d=c(6,0),k=c(7,0),h=c(8,0),x=c(9,0),l=c(10,0),n=c(11,0),u=c(12,0),q=c(13,0),w=c(14,0),v=c(15,0),A=c(16,0),C=c(17,0),r=c(18,0),E=c(19,0),F=c(20,0),B=c(21,0),t=c(22,0),y=c(23,0),O=c(24,0),K=c(25,0),M=c(26,
0),z=c(27,0),U=c(28,0),V=c(29,0),W=c(30,0),X=c(31,0),Q=c(32,0),R=c(33,0),S=c(34,0),T=c(35,0),Y=c(36,0),Z=c(37,0),aa=c(38,0),ba=c(39,0),ca=c(40,0),da=c(41,0),ea=c(42,0),fa=c(43,0),ga=c(44,0),ha=c(45,0),ia=c(46,0),ja=c(47,0),ka=c(48,0),J=c(49,0),P=c(50,0),I=c(51,0),H=c(52,0),N=c(53,0);f=function(){};f.loop=function(){var a=this,b=Game.cpu,d=b.getUsed(),k=b.bucket,l=Memory.logCpu;10<=d&&9700>b.bucket?Game.notify("CPU started at "+d.toFixed(2)+" with bucket at "+k.toFixed(0)+", aborting! "+Game.time.toFixed(0)):
k<b.tickLimit?Game.notify("Bucket at "+k.toFixed(0)+", aborting! "+Game.time.toFixed(0)):(d=function(){var d="",k,h;l&&(k=h,d="Started at "+k.toFixed(2));a.init();l&&(h=b.getUsed(),d+=(0<d.length?" - ":"")+"init took "+(h-k).toFixed(2),k=h);a.minerals();l&&(h=b.getUsed(),d+=(0<d.length?" - ":"")+"minerals took "+(h-k).toFixed(2),k=h);a.baseMatrixes();l&&(h=b.getUsed(),d+=(0<d.length?" - ":"")+"baseMatrixes took "+(h-k).toFixed(2),k=h);a.deserializeCreeps();l&&(h=b.getUsed(),d+=(0<d.length?" - ":"")+
"deserializeCreeps took "+(h-k).toFixed(2),k=h);a.deserializeRooms();l&&(h=b.getUsed(),d+=(0<d.length?" - ":"")+"deserializeRooms took "+(h-k).toFixed(2),k=h);a.deserializeArmies();l&&(h=b.getUsed(),d+=(0<d.length?" - ":"")+"deserializeArmies took "+(h-k).toFixed(2),k=h);a.balanceEnergy();l&&(h=b.getUsed(),d+=(0<d.length?" - ":"")+"balanceEnergy took "+(h-k).toFixed(2),k=h);Memory.log&&(a.log(),l&&(h=b.getUsed(),d+=(0<d.length?" - ":"")+"log took "+(h-k).toFixed(2),k=h));a.rooms();l&&(h=b.getUsed(),
d+=(0<d.length?" - ":"")+"rooms took "+(h-k).toFixed(2),k=h);a.army();l&&(h=b.getUsed(),d+=(0<d.length?" - ":"")+"army took "+(h-k).toFixed(2),k=h);a.creeps();l&&(h=b.getUsed(),d+=(0<d.length?" - ":"")+"creeps took "+(h-k).toFixed(2),k=h);Memory.debug&&(a.debug(),l&&(h=b.getUsed(),d+=(0<d.length?" - ":"")+"debug took "+(h-k).toFixed(2),k=h));Memory.visualizations&&(a.drawGlobal(),l&&(h=b.getUsed(),d+=(0<d.length?" - ":"")+"drawGlobal took "+(h-k).toFixed(2),e.log.events.push(d)));a.finalize();l&&
(h=b.getUsed(),(h-k).toFixed(2))},Memory.profiling?g.wrap(d):d())};f.init=function(){var b=Game.time%1500;e.reset();this.reset||(this.reset=!0,e.log.events.push("System reset."));e.credits<Memory.minimumCredits&&delete Memory.buy;e.credits>=1.5*Memory.minimumCredits&&(Memory.buy=!0);Game.cmd={Army:p,Cache:e,Commands:a,Market:d,Minerals:k,Role:{ArmyDismantler:l,ArmyHealer:n,ArmyMelee:u,ArmyRanged:q,Claimer:w,Collector:v,Defender:A,Dismantler:C,Downgrader:r,Healer:E,Miner:F,RemoteBuilder:B,RemoteCollector:t,
RemoteDismantler:y,RemoteMiner:O,RemoteReserver:K,RemoteStorer:M,RemoteWorker:z,Scientist:U,Storer:V,Upgrader:W,Worker:X},Room:{Base:Q,Cleanup:R,Mine:S,Source:T},Tower:h,Utilities:x};Memory.maxCreeps||(Memory.maxCreeps={});Memory.containerSource||(Memory.containerSource={});Memory.army||(Memory.army={});Memory.avoidRooms||(Memory.avoidRooms=[]);Memory.avoidSquares||(Memory.avoidSquares={});Memory.paths||(Memory.paths={});Memory.lengthToController||(Memory.lengthToController={});Memory.lengthToContainer||
(Memory.lengthToContainer={});Memory.lengthToStorage||(Memory.lengthToStorage={});Memory.towerTasks||(Memory.towerTasks={});Memory.stats||(Memory.stats={});Memory.stats.cpu||(Memory.stats.cpu=[]);Memory.stats.bucket||(Memory.stats.bucket=[]);Memory.stats.gclProgress||(Memory.stats.gclProgress=[]);Memory.minimumSell||(Memory.minimumSell={});Memory.flipPrice||(Memory.flipPrice={});Memory.allies||(Memory.allies=[]);0===Game.time%10&&(_.forEach(Memory.creeps,function(a,b){Game.creeps[b]||delete Memory.creeps[b]}),
_.forEach(Memory.lengthToContainer,function(a,b){Game.getObjectById(b)||delete Memory.lengthToContainer[b]}),_.forEach(Memory.lengthToController,function(a,b){Game.getObjectById(b)||delete Memory.lengthToController[b]}),_.forEach(Memory.lengthToStorage,function(a,b){Game.getObjectById(b)||delete Memory.lengthToStorage[b]}),_.forEach(Memory.containerSource,function(a,b){Game.getObjectById(b)||delete Memory.containerSource[b]}),_.forEach(Memory.dismantle,function(a,b){0===a.length&&delete Memory.dismantle[b]}),
_.forEach(Memory.rooms,function(a,b){a&&a.roomType||delete Memory.rooms[b]}),_.forEach(Memory.maxCreeps,function(a,b){_.forEach(Memory.maxCreeps[b],function(b,d){0===Object.keys(b).length&&delete a[d]})}),_.forEach(Memory.paths,function(a,b){(a[3]<=Game.time-500||a[2]<=Game.time-1500)&&delete Memory.paths[b]}));delete Memory.flags;switch(b){case 0:Memory.lengthToStorage={};break;case 100:Memory.lengthToContainer={};break;case 200:Memory.lengthToController={};break;case 300:Memory.ranges={}}e.creeps=
x.nest(_.filter(Game.creeps,function(a){return a.memory.home||a.memory.army}),[function(a){return a.memory.home||a.memory.army},function(a){return a.memory.role}]);_.forEach(e.creeps,function(a,b){e.creeps[b].all=_.flatten(_.values(a))})};f.minerals=function(){var a={},b,h;if(0===Game.time%10||Game.cpu.bucket>=Memory.marketBucket)b=[{resource:RESOURCE_HYDROGEN,amount:3E3},{resource:RESOURCE_OXYGEN,amount:3E3},{resource:RESOURCE_ZYNTHIUM,amount:3E3},{resource:RESOURCE_KEANIUM,amount:3E3},{resource:RESOURCE_UTRIUM,
amount:3E3},{resource:RESOURCE_LEMERGIUM,amount:3E3},{resource:RESOURCE_CATALYST,amount:3E3},{resource:RESOURCE_HYDROXIDE,amount:3E3},{resource:RESOURCE_ZYNTHIUM_KEANITE,amount:3E3},{resource:RESOURCE_UTRIUM_LEMERGITE,amount:3E3},{resource:RESOURCE_GHODIUM,amount:3E3},{resource:RESOURCE_UTRIUM_HYDRIDE,amount:3E3},{resource:RESOURCE_KEANIUM_OXIDE,amount:3E3},{resource:RESOURCE_LEMERGIUM_HYDRIDE,amount:3E3},{resource:RESOURCE_LEMERGIUM_OXIDE,amount:3E3},{resource:RESOURCE_ZYNTHIUM_HYDRIDE,amount:3E3},
{resource:RESOURCE_ZYNTHIUM_OXIDE,amount:3E3},{resource:RESOURCE_GHODIUM_HYDRIDE,amount:3E3},{resource:RESOURCE_GHODIUM_OXIDE,amount:3E3},{resource:RESOURCE_UTRIUM_ACID,amount:3E3},{resource:RESOURCE_KEANIUM_ALKALIDE,amount:3E3},{resource:RESOURCE_LEMERGIUM_ACID,amount:3E3},{resource:RESOURCE_LEMERGIUM_ALKALIDE,amount:3E3},{resource:RESOURCE_ZYNTHIUM_ACID,amount:3E3},{resource:RESOURCE_ZYNTHIUM_ALKALIDE,amount:3E3},{resource:RESOURCE_GHODIUM_ACID,amount:3E3},{resource:RESOURCE_GHODIUM_ALKALIDE,amount:3E3},
{resource:RESOURCE_CATALYZED_UTRIUM_ACID,amount:15E3},{resource:RESOURCE_CATALYZED_KEANIUM_ALKALIDE,amount:15E3},{resource:RESOURCE_CATALYZED_LEMERGIUM_ACID,amount:15E3},{resource:RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE,amount:15E3},{resource:RESOURCE_CATALYZED_ZYNTHIUM_ACID,amount:15E3},{resource:RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE,amount:15E3},{resource:RESOURCE_CATALYZED_GHODIUM_ACID,amount:15E3},{resource:RESOURCE_CATALYZED_GHODIUM_ALKALIDE,amount:15E3},{resource:RESOURCE_POWER,amount:3E3}],_.forEach(b,
function(a){var b=function(a,b){a.children=_.map(k[a.resource],function(a){return{resource:a}});_.forEach(a.children,function(d){d.amount=a.amount;b(d,b)})};b(a,b)}),Memory.reserveMinerals={},_.forEach(b,function(a){var b=function(a,b){Memory.reserveMinerals[a.resource]||(Memory.reserveMinerals[a.resource]=0);Memory.reserveMinerals[a.resource]=Math.min(Memory.reserveMinerals[a.resource]+a.amount,2E4);_.forEach(a.children,function(a){b(a,b)});a.amount=Memory.reserveMinerals[a.resource]};b(a,b)}),_.forEach(_.uniq(_.map(d.getAllOrders(),
function(a){return a.resourceType})),function(b){(h=(d.getFilteredOrders().sell[b]||[])[0])&&(a[b]=h)}),_.forEach(Game.rooms,function(d,k){var h=Infinity,l=d.memory,u=l.roomType,n=d.storage,q=d.terminal,x=e.creeps[k],g=x&&x.all,w,c,p;n&&q&&q.my&&u&&"base"===u.type&&!(3>e.labsInRoom(d))&&(c=n.store,p=q.store,e.minerals[k]=_.cloneDeep(b),_.forEach(e.minerals[k],function(b){var d=function(b,d){var k=b.resource,u=(c[k]||0)+(p[k]||0)+_.sum(g,function(a){return a.carry[k]||0}),n=b.children,q;b.buyPrice=
a[k]?a[k].price:Infinity;b.amount=Math.max(b.amount-u,0);_.forEach(n,function(a){d(a,d)});if(n&&0!==n.length)if(q=1.2*_.sum(_.map(n,function(a){return a.buyPrice})),Memory.minimumSell[k]=Math.min(Infinity,q),0!==Memory.minimumSell[k]&&Infinity!==Memory.minimumSell[k]||delete Memory.minimumSell[k],b.buyPrice>q||!Memory.buy){var x=5*Math.floor(((c[n[0].resource]||0)+(p[n[0].resource]||0)+_.sum(g,function(a){return a.carry[n[0].resource]||0}))/5),v=5*Math.floor(((c[n[1].resource]||0)+(p[n[1].resource]||
0)+_.sum(g,function(a){return a.carry[n[1].resource]||0}))/5);b.amount=Math.min(Math.min(b.amount,x),v);b.action="create";b.buyPrice=q;u<=h&&0<b.amount&&(w=b,h=u)}else b.action="buy";else b.action="buy";0<b.amount&&"buy"===b.action&&!l.buyQueue&&e.credits>=Memory.minimumCredits&&Memory.buy&&(l.buyQueue={resource:k,amount:b.amount,price:b.buyPrice,start:Game.time})};d(b,d)}),w&&!l.labQueue&&(d=function(a,b){var d=a.resource,k=a.children;if(!(0>=a.amount)&&"create"===a.action){var h=5*Math.floor(((c[k[0].resource]||
0)+(p[k[0].resource]||0)+_.sum(g,function(a){return a.carry[k[0].resource]||0}))/5),e=5*Math.floor(((c[k[1].resource]||0)+(p[k[1].resource]||0)+_.sum(g,function(a){return a.carry[k[1].resource]||0}))/5);l.labQueue={resource:d,amount:Math.min(5*Math.ceil(Math.min(Math.min(Math.min(a.amount,h),e),LAB_MINERAL_CAPACITY)/5),3E3),children:_.map(k,function(a){return a.resource}),start:Game.time};_.forEach(k,function(a){b(a,b)})}},d(w,d)))})};f.baseMatrixes=function(){Memory.baseMatrixes||(Memory.baseMatrixes=
{});_.forEach(Memory.baseMatrixes,function(a,b){var d=Game.rooms[b],k;if(d&&!d.unobservable&&"complete"!==a.status&&0!==e.spawnsInRoom(d).length){k=e.repairableStructuresInRoom(d);if(!a.status){var h=new PathFinder.CostMatrix;_.forEach(_.filter(k,function(a){return a.structureType!==STRUCTURE_ROAD}),function(a){h.set(a.pos.x,a.pos.y,255)});a.tempMatrix=h.serialize();a.costMatrix=h.serialize();a.status="building";a.x=0;a.y=0}if("building"===a.status){for(var d=e.spawnsInRoom(d)[0],l=PathFinder.CostMatrix.deserialize(a.tempMatrix),
h=PathFinder.CostMatrix.deserialize(a.costMatrix);50>a.x;a.x++){for(;50>a.y;a.y++){if(250<=Game.cpu.getUsed())return a.costMatrix=h.serialize(),!1;PathFinder.search(new RoomPosition(a.x,a.y,b),{pos:d.pos,range:1},{roomCallback:function(){return l},maxOps:1E4,maxRooms:1}).incomplete&&h.set(a.x,a.y,255)}a.y=0}_.forEach(_.filter(k,function(a){return a.structureType===STRUCTURE_RAMPART}),function(a){h.set(a.pos.x,a.pos.y,0)});delete a.tempMatrix;delete a.x;delete a.y;a.costMatrix=h.serialize();a.status=
"complete"}}})};f.deserializeCreeps=function(){var a=e.creepTasks;_.forEach(Game.creeps,function(b){if(b.memory.currentTask)switch(b.memory.currentTask.type){case "build":a[b.name]=Y.fromObj(b);break;case "claim":a[b.name]=Z.fromObj(b);break;case "collectEnergy":a[b.name]=aa.fromObj(b);break;case "collectMinerals":a[b.name]=ba.fromObj(b);break;case "dismantle":a[b.name]=ca.fromObj(b);break;case "downgrade":a[b.name]=da.fromObj(b);break;case "fillEnergy":a[b.name]=ea.fromObj(b);break;case "fillMinerals":a[b.name]=
fa.fromObj(b);break;case "harvest":a[b.name]=ga.fromObj(b);break;case "heal":a[b.name]=ha.fromObj(b);break;case "meleeAttack":a[b.name]=ia.fromObj(b);break;case "mine":a[b.name]=ja.fromObj(b);break;case "pickupResource":a[b.name]=ka.fromObj(b);break;case "rally":a[b.name]=J.fromObj(b);break;case "rangedAttack":a[b.name]=P.fromObj(b);break;case "repair":a[b.name]=I.fromObj(b);break;case "reserve":a[b.name]=H.fromObj(b);break;case "upgradeController":a[b.name]=N.fromObj(b)}})};f.deserializeRooms=function(){var a=
e.rooms,b={};_.forEach(Memory.rooms,function(d,k){Game.rooms[k]||(b[k]={name:k,unobservable:!0,memory:d});if(d.roomType)switch(d.roomType.type){case "base":a[k]=Q.fromObj(Game.rooms[k]||b[k]);break;case "cleanup":a[k]=R.fromObj(Game.rooms[k]||b[k]);break;case "mine":a[k]=S.fromObj(Game.rooms[k]||b[k]);break;case "source":a[k]=T.fromObj(Game.rooms[k]||b[k])}});this.unobservableRooms=_.values(b)};f.deserializeArmies=function(){var a=e.armies;_.forEach(Memory.army,function(b,d){a[d]=p.fromObj(d,b)})};
f.balanceEnergy=function(){var a,b;a=_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&"base"===a.memory.roomType.type&&a.storage&&a.storage.my&&a.terminal&&a.terminal.my}).sort(function(a,b){return a.storage.store[RESOURCE_ENERGY]+a.terminal.store[RESOURCE_ENERGY]-(b.storage.store[RESOURCE_ENERGY]+b.terminal.store[RESOURCE_ENERGY])});1<a.length&&(b=Math.min(_.sum(_.map(a,function(a){return a.storage.store[RESOURCE_ENERGY]+a.terminal.store[RESOURCE_ENERGY]}))/a.length,5E5),_.forEach(a,
function(d,k){k=a[a.length-k-1];var h=d.storage.store[RESOURCE_ENERGY],l=k.storage.store[RESOURCE_ENERGY],u=k.terminal,n=u.store[RESOURCE_ENERGY];if(!(0<u.cooldown)){if(h>=l||h+d.terminal.store[RESOURCE_ENERGY]>b||l+n<b+1E4)return!1;1E3<=n&&(h=Game.market.calcTransactionCost(n,k.name,d.name),u.send(RESOURCE_ENERGY,Math.floor(n/(n+h)*n),d.name),e.log.events.push("Sending "+Math.floor(n/(n+h)*n)+" energy from "+k.name+" to "+d.name))}}))};f.log=function(){e.log.creeps=_.map(Game.creeps,function(a){return{creepId:a.id,
name:a.name,creepType:a.memory.role,home:a.memory.home,army:a.memory.army,room:a.pos.roomName,x:a.pos.x,y:a.pos.y,spawning:a.spawning,ttl:a.ticksToLive,carryCapacity:a.carryCapacity,carry:a.carry,hits:a.hits,hitsMax:a.hitsMax}});_.forEach(e.armies,function(a){e.log.army[a.name]={directive:a.directive,scheduled:a.scheduled,portals:a.portals,boostRoom:a.boostRoom,buildRoom:a.buildRoom,stageRoom:a.stageRoom,attackRoom:a.attackRoom,dismantle:a.dismantle.length,creeps:[]};Game.rooms[a.attackRoom]&&(e.log.army[a.name].structures=
_.filter(Game.rooms[a.attackRoom].find(FIND_HOSTILE_STRUCTURES),function(a){return a.structureType!==STRUCTURE_CONTROLLER&&a.structureType!==STRUCTURE_RAMPART&&a.structureType!==STRUCTURE_KEEPER_LAIR}).length,e.log.army[a.name].constructionSites=Game.rooms[a.attackRoom].find(FIND_HOSTILE_CONSTRUCTION_SITES).length)});e.log.spawns=_.map(Game.spawns,function(a){return{spawnId:a.id,name:a.name,room:a.room.name,spawningName:a.spawning?a.spawning.name:void 0,spawningNeedTime:a.spawning?a.spawning.needTime:
void 0,spawningRemainingTime:a.spawning?a.spawning.remainingTime:void 0}});_.forEach([].concat.apply([],[_.filter(Game.rooms),this.unobservableRooms]),function(a){var b=a.name,d=Memory.rooms[b],k=d&&d.roomType&&d.roomType.type?d.roomType.type:"unknown",h,l,n,u,q,x;a.unobservable?e.log.rooms[b]={type:k,supportRoom:d&&d.roomType?d.roomType.supportRoom:void 0,region:d?d.region:void 0,unobservable:!0,store:{},labs:[],source:[],creeps:[]}:(0===Game.time%10&&(h=e.repairableStructuresInRoom(a)),l=a.find(FIND_MY_CONSTRUCTION_SITES),
n=e.towersInRoom(a),u=e.labsInRoom(a),q=e.nukersInRoom(a),x=e.powerSpawnsInRoom(a),e.log.rooms[b]={type:k,supportRoom:d&&d.roomType?d.roomType.supportRoom:void 0,region:d?d.region:void 0,unobservable:!1,controller:!!a.controller,store:{},labs:[],source:[],creeps:[]},e.log.rooms[b].controller&&(e.log.rooms[b].rcl=a.controller.level,a.controller.owner&&(e.log.rooms[b].ownerUsername=a.controller.owner.username),e.log.rooms[b].progress=a.controller.progress,e.log.rooms[b].progressTotal=a.controller.progressTotal,
e.log.rooms[b].ttd=a.controller.ticksToDowngrade),a.controller&&a.controller.reservation&&(e.log.rooms[b].reservedUsername=a.controller.reservation.username,e.log.rooms[b].tte=a.controller.reservation.ticksToEnd),e.log.rooms[b].lowestWall=0===Game.time%10?Math.min.apply(Math,_.map(_.filter(h,function(a){return a.structureType===STRUCTURE_WALL||a.structureType===STRUCTURE_RAMPART}),function(a){return a.hits})):Memory.console&&Memory.console.rooms&&Memory.console.rooms[b]&&Memory.console.rooms[b].lowestWall||
null,a.energyCapacityAvailable&&0<a.energyCapacityAvailable&&(e.log.rooms[b].energyAvailable=a.energyAvailable,e.log.rooms[b].energyCapacityAvailable=a.energyCapacityAvailable),e.log.rooms[b].constructionProgress=_.sum(_.map(l,function(a){return a.progress})),e.log.rooms[b].constructionProgressTotal=_.sum(_.map(l,function(a){return a.progressTotal})),e.log.rooms[b].towerEnergy=_.sum(_.map(n,function(a){return a.energy})),e.log.rooms[b].towerEnergyCapacity=_.sum(_.map(n,function(a){return a.energyCapacity})),
e.log.rooms[b].labEnergy=_.sum(_.map(u,function(a){return a.energy})),e.log.rooms[b].labEnergyCapacity=_.sum(_.map(u,function(a){return a.energyCapacity})),e.log.rooms[b].nukerEnergy=_.sum(_.map(q,function(a){return a.energy})),e.log.rooms[b].nukerEnergyCapacity=_.sum(_.map(q,function(a){return a.energyCapacity})),e.log.rooms[b].nukerGhodium=_.sum(_.map(q,function(a){return a.ghodium})),e.log.rooms[b].nukerGhodiumCapacity=_.sum(_.map(q,function(a){return a.ghodiumCapacity})),e.log.rooms[b].powerSpawnEnergy=
_.sum(_.map(x,function(a){return a.energy})),e.log.rooms[b].powerSpawnEnergyCapacity=_.sum(_.map(x,function(a){return a.energyCapacity})),e.log.rooms[b].powerSpawnPower=_.sum(_.map(x,function(a){return a.power})),e.log.rooms[b].powerSpawnPowerCapacity=_.sum(_.map(x,function(a){return a.powerCapacity})),a.storage&&(e.log.rooms[b].store.storage=_.map(a.storage.store,function(a,b){return{resource:b,amount:a}})),a.terminal&&(e.log.rooms[b].store.terminal=_.map(a.terminal.store,function(a,b){return{resource:b,
amount:a}})),e.log.rooms[b].labs=_.map(u,function(a){return{resource:a.mineralType,amount:a.mineralAmount}}),e.log.rooms[b].labQueue=d.labQueue,e.log.rooms[b].buyQueue=d.buyQueue,_.forEach(a.find(FIND_SOURCES),function(a){e.log.rooms[b].source.push({sourceId:a.id,resource:RESOURCE_ENERGY,amount:a.energy,capacity:a.energyCapacity,ttr:a.ticksToRegeneration})}),_.forEach(a.find(FIND_MINERALS),function(a){e.log.rooms[b].source.push({sourceId:a.id,resource:a.mineralType,amount:a.mineralAmount,ttr:a.ticksToRegeneration})}),
e.log.hostiles=[].concat.apply([],[e.log.hostiles,_.map(e.hostilesInRoom(a),function(a){return{creepId:a.id,ownerUsername:a.owner.username,room:b,x:a.pos.x,y:a.pos.y,ttl:a.ticksToLive,hits:a.hits,hitsMax:a.hitsMax}})]))})};f.rooms=function(){var a=this,b=["base","source","mine","cleanup",""],d=Memory.rooms,k=["source","cleanup"],h=9700<=Game.cpu.bucket||0===Game.time%2;Memory.rushRoom=(_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&"base"===a.memory.roomType.type&&a.controller&&
8>a.controller.level}).sort(function(a,b){return b.controller.level-a.controller.level||b.controller.progress-a.controller.progress})[0]||{name:""}).name;_.forEach([].concat.apply([],[_.filter(Game.rooms),this.unobservableRooms]).sort(function(a,k){return b.indexOf(d[a.name]&&d[a.name].roomType&&d[a.name].roomType.type||"")-b.indexOf(d[k.name]&&d[k.name].roomType&&d[k.name].roomType.type||"")}),function(b){var l=b.name,n=e.rooms[l],l=d[l],u;n&&l&&(u=l.roomType)&&((-1!==k.indexOf(u.type)||h)&&n.run(),
u.type===n.type&&n.toObj());Memory.visualizations&&!b.unobservable&&a.drawRoom(b)})};f.drawRoom=function(a){var d=a.visual,k,h,l,n;d||(d=new RoomVisual(a.name));d&&(a.memory&&a.memory.roomType&&d.text(_.capitalize(a.memory.roomType.type),-.5,49.325,{align:"left",font:"0.5 Arial"}),a.controller&&a.controller.level&&(d.text("RCL "+a.controller.level,2.5,49.325,{align:"left",font:"0.5 Arial"}),a.controller.progress&&a.controller.progressTotal&&b.progressBar(d,5.5,48.9,20,.5,a.controller.progress,a.controller.progressTotal,
{background:"#808080",bar:"#00ff00",showDetails:!0,color:"#ffffff",font:"0.5 Arial"})),h=2.125,a.energyCapacityAvailable&&(h+=.7,d.text("Energy",-.5,h,{align:"left",font:"0.5 Arial"}),b.progressBar(d,2.5,h-.425,5,.5,a.energyAvailable,a.energyCapacityAvailable,{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),l=e.towersInRoom(a),0<l.length&&(h+=.7,d.text("Towers",-.5,h,{align:"left",font:"0.5 Arial"}),b.progressBar(d,2.5,h-.425,5,.5,_.sum(_.map(l,function(a){return a.energy})),
_.sum(_.map(l,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),l=e.labsInRoom(a),0<l.length&&(h+=.7,d.text("Labs",-.5,h,{align:"left",font:"0.5 Arial"}),b.progressBar(d,2.5,h-.425,5,.5,_.sum(_.map(l,function(a){return a.energy})),_.sum(_.map(l,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),n=e.nukersInRoom(a),0<n.length&&(h+=.7,d.text("Nuker",
-.5,h,{align:"left",font:"0.5 Arial"}),b.progressBar(d,2.5,h-.425,5,.5,_.sum(_.map(n,function(a){return a.energy})),_.sum(_.map(n,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"}),b.progressBar(d,8.5,h-.425,5,.5,_.sum(_.map(n,function(a){return a.ghodium})),_.sum(_.map(n,function(a){return a.ghodiumCapacity})),{background:"#808080",bar:"#ffff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),n=e.powerSpawnsInRoom(a),0<
n.length&&(h+=.7,d.text("Power Spawn",-.5,h,{align:"left",font:"0.5 Arial"}),b.progressBar(d,2.5,h-.425,5,.5,_.sum(_.map(n,function(a){return a.energy})),_.sum(_.map(n,function(a){return a.energyCapacity})),{background:"#808080",bar:"#00ff00",showDetails:!1,color:"#ffffff",font:"0.5 Arial"}),b.progressBar(d,8.5,h-.425,5,.5,_.sum(_.map(n,function(a){return a.power})),_.sum(_.map(n,function(a){return a.powerCapacity})),{background:"#808080",bar:"#ff0000",showDetails:!1,color:"#ffffff",font:"0.5 Arial"})),
a.memory&&a.memory.buyQueue&&(h+=.7,d.text("Buy",-.5,h,{align:"left",font:"bold 0.5 Arial"}),d.text(a.memory.buyQueue.amount,2.5,h,{align:"right",font:"0.5 Arial"}),b.resource(d,2.8,h-.175,.5,a.memory.buyQueue.resource,{opacity:1})),a.memory&&a.memory.labQueue&&(h+=.7,d.text("Create",-.5,h,{align:"left",font:"bold 0.5 Arial"}),d.text(a.memory.labQueue.amount,2.5,h,{align:"right",font:"0.5 Arial"}),b.resource(d,2.8,h-.175,.5,a.memory.labQueue.resource,{opacity:1})),0<l.length&&(h+=.7,d.text("Labs",
-.5,h,{align:"left",font:"bold 0.5 Arial"}),k=0,_.forEach(l,function(a){k+=2.5;0===a.mineralAmount?d.text("Empty",k,h,{align:"right",font:"0.5 Arial"}):(d.text(a.mineralAmount,k,h,{align:"right",font:"0.5 Arial"}),b.resource(d,k+.3,h-.175,.5,a.mineralType,{opacity:1}))})),a.storage&&(h+=1.4,d.text("Storage",-.5,h,{align:"left",font:"bold 0.5 Arial"}),_.forEach(a.storage.store,function(a,k){k!==RESOURCE_ENERGY&&(h+=.7,d.text(a,1,h,{align:"right",font:"0.5 Arial"}),b.resource(d,1.3,h-.175,.5,k,{opacity:1}))})),
a.terminal&&(h+=1.4,d.text("Terminal",-.5,h,{align:"left",font:"bold 0.5 Arial"}),_.forEach(a.terminal.store,function(a,k){k!==RESOURCE_ENERGY&&(h+=.7,d.text(a,1,h,{align:"right",font:"0.5 Arial"}),b.resource(d,1.3,h-.175,.5,k,{opacity:1}))})))};f.army=function(){_.forEach(e.armies,function(a){a.run();a.toObj()})};f.creeps=function(){var a=Game.time;_.forEach(Game.creeps,function(b){var d,k,h,l,n;if(!b.spawning&&!b.memory.stop){d=b.ticksToLive;k=b.memory;h=k.army;l=b.room.name;n=e.creepTasks[b.name];
if(150>=d||500>d&&1===d%10||1===d%100)switch(d-1){case 3:b.say("R.I.P. and",!0);break;case 2:b.say("Pepperonis",!0);break;case 1:b.say(":(",!0);break;default:b.say("TTL "+(d-1))}h&&e.armies[h]&&l===e.armies[h].attackRoom&&b.say("All my friends are heathens, take it slow.  Wait for them to ask you who you know.  Please don't make any sudden moves.  You don't know the half of the abuse. ".split(" ")[a%35],!0);switch(a%1E6){case 999990:b.say("TEN!",!0);break;case 999991:b.say("NINE!",!0);break;case 999992:b.say("EIGHT!",
!0);break;case 999993:b.say("SEVEN!",!0);break;case 999994:b.say("SIX!",!0);break;case 999995:b.say("FIVE!",!0);break;case 999996:b.say("FOUR!",!0);break;case 999997:b.say("THREE!",!0);break;case 999998:b.say("TWO!",!0);break;case 999999:b.say("ONE!",!0);break;case 0:b.say("HAPPY NEW",!0);break;case 1:b.say("MILLION!",!0)}if(k.currentTask&&n){if(0===b.pos.x)switch(Math.floor(3*Math.random())){case 0:b.move(RIGHT);break;case 1:b.move(TOP_RIGHT);break;case 2:b.move(BOTTOM_RIGHT)}if(49===b.pos.x)switch(Math.floor(3*
Math.random())){case 0:b.move(LEFT);break;case 1:b.move(TOP_LEFT);break;case 2:b.move(BOTTOM_LEFT)}if(0===b.pos.y)switch(Math.floor(3*Math.random())){case 0:b.move(BOTTOM);break;case 1:b.move(BOTTOM_RIGHT);break;case 2:b.move(BOTTOM_LEFT)}if(49===b.pos.y)switch(Math.floor(3*Math.random())){case 0:b.move(TOP);break;case 1:b.move(TOP_RIGHT);break;case 2:b.move(TOP_LEFT)}n.run(b);!k.lastRoom||k.lastRoom===l||n&&n.force||delete k.currentTask;k.lastRoom=l;k.currentTask&&n&&k.currentTask.type===n.type&&
n.toObj(b);0<b.carry[RESOURCE_ENERGY]&&0<b.getActiveBodyparts(WORK)&&_.forEach(_.filter(b.pos.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_ROAD&&a.hits<a.hitsMax}),function(a){b.repair(a)});b.spawning||!(150>d)||0!==_.sum(b.carry)||k.currentTask&&"rally"!==k.currentTask.type||-1!=="armyDismantler armyHealer armyMelee armyRanged claimer downgrader defender healer remoteReserver".split(" ").indexOf(b.memory.role)||b.suicide()}else delete k.currentTask,!b.spawning&&150>d&&
0===_.sum(b.carry)&&-1==="armyDismantler armyHealer armyMelee armyRanged claimer downgrader defender healer remoteReserver".split(" ").indexOf(k.role)?b.suicide():b.say("Idle")}})};f.debug=function(){_.forEach(Game.creeps,function(a){var b=a.memory;a.room.visual.text(a.name,a.pos.x,a.pos.y+1,{align:"center",font:"0.5 Arial"}).text(b.role,a.pos.x,a.pos.y+1.5,{align:"center",font:"0.5 Arial"}).text(b.currentTask?b.currentTask.type:"",a.pos.x,a.pos.y+2,{align:"center",font:"0.5 Arial"})})};f.drawGlobal=
function(){var a;e.globalVisual.text("GCL "+Game.gcl.level,-.5,.025,{align:"left",font:"0.5 Arial"});b.progressBar(e.globalVisual,2.5,-.4,20,.5,Game.gcl.progress,Game.gcl.progressTotal,{background:"#808080",bar:"#00ff00",showDetails:!0,color:"#ffffff",font:"0.5 Arial"});b.progressBar(e.globalVisual,34.5,-.4,10,.5,Game.cpu.bucket,1E4,{label:"Bucket",background:"#808080",showMax:!1,bar:9990<=Game.cpu.bucket?"#00ffff":9E3<=Game.cpu.bucket?"#00ff00":5E3<=Game.cpu.bucket?"#cccc00":"#ff0000",color:"#ffffff",
font:"0.5 Arial"});e.globalVisual.text("Tick "+Game.time,49.5,.025,{align:"right",font:"0.5 Arial"}).text(e.time,49.5,.725,{align:"right",font:"0.5 Arial"});e.globalVisual.text("Credits "+Game.market.credits.toFixed(2),-.5,.725,{align:"left",font:"0.5 Arial"});e.globalVisual.text("Creeps "+_.keys(Game.creeps).length,-.5,1.425,{align:"left",font:"0.5 Arial"});a=.725;_.forEach(_.filter(Game.rooms,function(a){return!a.unobservable&&a.memory.roomType&&"base"===a.memory.roomType.type}),function(d){a+=
.7;e.globalVisual.text(d.name,43.5,a,{align:"right",font:"bold 0.5 Arial"});d.storage&&(e.globalVisual.text(d.storage.store[RESOURCE_ENERGY],45.8,a,{align:"right",font:"0.5 Arial"}),b.resource(e.globalVisual,46.15,a-.175,.5,RESOURCE_ENERGY,{opacity:1}));d.terminal&&(e.globalVisual.text(d.terminal.store[RESOURCE_ENERGY],48.8,a,{align:"right",font:"0.5 Arial"}),b.resource(e.globalVisual,49.15,a-.175,.5,RESOURCE_ENERGY,{opacity:1}))});for(Memory.stats.cpu.push(Game.cpu.getUsed());100<Memory.stats.cpu.length;)Memory.stats.cpu.shift();
for(Memory.stats.bucket.push(Game.cpu.bucket);100<Memory.stats.bucket.length;)Memory.stats.bucket.shift();for(Memory.stats.gclProgress.push(Game.gcl.progress);100<Memory.stats.gclProgress.length;)Memory.stats.gclProgress.shift();b.sparkline(e.globalVisual,23.5,1,18,2,_.map(Memory.stats.cpu,function(a,b){return{cpu:Memory.stats.cpu[b],bucket:Memory.stats.bucket[b],limit:Game.cpu.limit}}),[{key:"limit",min:.5*Game.cpu.limit,max:1.5*Game.cpu.limit,stroke:"#c0c0c0",opacity:.25},{key:"cpu",min:.5*Game.cpu.limit,
max:1.5*Game.cpu.limit,stroke:"#ffff00",opacity:.5},{key:"bucket",min:0,max:1E4,stroke:"#00ffff",opacity:.5,font:"0.5 Arial"}]);e.log.cpuUsed=Game.cpu.getUsed();Memory.stats.cpu[Memory.stats.cpu.length-1]=Game.cpu.getUsed();b.progressBar(e.globalVisual,23.5,-.4,10,.5,Game.cpu.getUsed(),Game.cpu.limit,{label:"CPU",background:"#808080",valueDecimals:2,bar:e.log.cpuUsed>Game.cpu.limit?"#ff0000":"#00ff00",color:"#ffffff",font:"0.5 Arial"})};f.finalize=function(){e.log.tick=Game.time;e.log.date=new Date;
e.log.gcl=Game.gcl.level;e.log.progress=Game.gcl.progress;e.log.progressTotal=Game.gcl.progressTotal;e.log.limit=Game.cpu.limit;e.log.tickLimit=Game.cpu.tickLimit;e.log.bucket=Game.cpu.bucket;e.log.credits=Game.market.credits;e.log.cpuUsed=Game.cpu.getUsed();Memory.console=e.log};Memory.profiling&&(g.registerObject(f,"Main"),g.enable());m.exports=f;return m.exports};r[1]=function(c,f){function g(){u=0;Game.profiler={stream:function(a,b,d){p("stream",a||10,b,d)},email:function(a,b,d){p("email",a||
100,b,d)},profile:function(a,b,d){p("profile",a||100,b,d)},background:function(a,b){p("background",!1,a,b)},restart:function(){if(w.isProfiling()){var a=Memory.profiler.filter,b=!1;Memory.profiler.disableTick&&(b=Memory.profiler.disableTick-Memory.profiler.enabledTick+1);p(Memory.profiler.type,b,a)}},reset:e,output:w.output};a()}function p(a,b,d,k){e();b=Number.isInteger(b)?Game.time+b:!1;Memory.profiler||(Memory.profiler={map:{},totalTime:0,enabledTick:Game.time+1,disableTick:b,type:a,filter:d,startsWith:k})}
function e(){Memory.profiler=null}function a(){Game.rooms.sim&&(l=0,Game.cpu.getUsed=function(){return performance.now()-l})}function b(a,b){return function(){if(w.isProfiling()){var d=Memory.profiler.startsWith?a.startsWith(Memory.profiler.filter):a===Memory.profiler.filter,k=Game.cpu.getUsed();d&&u++;var h=b.apply(this,arguments);if(0<u||!Memory.profiler.filter){var l=Game.cpu.getUsed();w.record(a,l-k)}d&&u--;return h}return b.apply(this,arguments)}}function d(){w.prototypes.forEach(function(a){h(a.val,
a.name)})}function k(a,b){Object.getOwnPropertyNames(a).forEach(function(d){var k=b+"."+d;try{var h="function"===typeof a[d],l=-1===q.indexOf(d);h&&l&&(a[d]=x(a[d],k))}catch(B){}});return a}function h(a,b){a.prototype&&k(a.prototype,b);k(a,b)}function x(a,d){d=d||a.name;return d?b(d,a):(console.log("Couldn't find a function name for - ",a),console.log("Will not profile this function."),a)}Array.prototype.forEach=function(a,b){for(var d=0;d<this.length;d++)a.call(b,this[d],d,this)};Array.prototype.map=
function(a,b){for(var d=[],k=0;k<this.length;k++)d.push(a.call(b,this[k],k,this));return d};var l=0,n=!1,u=0,q=["getUsed","constructor"],w={printProfile:function(){console.log(w.output())},emailProfile:function(){Game.notify(w.output())},output:function(a){a=a?a:20;if(!Memory.profiler||!Memory.profiler.enabledTick)return"Profiler not active.";var b=Game.time-Memory.profiler.enabledTick+1,b=["Avg: "+(Memory.profiler.totalTime/b).toFixed(2),"Total: "+Memory.profiler.totalTime.toFixed(2),"Ticks: "+b].join("\t");
return[].concat("calls\t\ttime\t\tavg\t\tfunction",w.lines().slice(0,a),b).join("\n")},lines:function(){return Object.keys(Memory.profiler.map).map(function(a){var b=Memory.profiler.map[a];return{name:a,calls:b.calls,totalTime:b.time,averageTime:b.time/b.calls}}).sort(function(a,b){return b.totalTime-a.totalTime}).map(function(a){return[a.calls,a.totalTime.toFixed(1),a.averageTime.toFixed(3),a.name].join("\t\t")})},prototypes:[{name:"Game",val:Game},{name:"Room",val:Room},{name:"Structure",val:Structure},
{name:"Spawn",val:Spawn},{name:"Creep",val:Creep},{name:"RoomPosition",val:RoomPosition},{name:"Source",val:Source},{name:"Flag",val:Flag}],record:function(a,b){Memory.profiler.map[a]||(Memory.profiler.map[a]={time:0,calls:0});Memory.profiler.map[a].calls++;Memory.profiler.map[a].time+=b},endTick:function(){if(Game.time>=Memory.profiler.enabledTick){var a=Game.cpu.getUsed();Memory.profiler.totalTime+=a;w.report()}},report:function(){w.shouldPrint()?w.printProfile():w.shouldEmail()&&w.emailProfile()},
isProfiling:function(){return n&&Memory.profiler?!Memory.profiler.disableTick||Game.time<=Memory.profiler.disableTick:!1},type:function(){return Memory.profiler.type},shouldPrint:function(){var a="stream"===w.type(),b="profile"===w.type(),d=Memory.profiler.disableTick===Game.time;return a||b&&d},shouldEmail:function(){return"email"===w.type()&&Memory.profiler.disableTick===Game.time}};c.exports={wrap:function(a){n&&g();return w.isProfiling()?(l=Game.cpu.getUsed(),a=a(),w.endTick(),a):a()},enable:function(){n=
!0;d()},output:w.output,registerObject:h,registerFN:x,registerClass:h};return c.exports};r[2]=function(m,f){var g=c(3,2),p=c(9,2),e=c(10,2),a=c(11,2),b=c(12,2),d=c(13,2),k=function(a,b){b.directive||(b.directive="preparing");Memory.army[a]||(Memory.army[a]=b);_.extend(this,b);this.name=a};k.prototype.run=function(){var k=this,x=this.name,l=g.creeps[x]&&g.creeps[x].all||[],n=Game.rooms[this.attackRoom],u=this.dismantler,q=this.healer,w=this.melee,c=this.ranged;if(!(this.scheduled&&this.scheduled>Game.time))if(0===
l.length&&this.success)this.delete=!0;else{"preparing"===this.directive||"building"===this.directive||0!==l.length||this.success||(Game.notify("Army "+x+" operation failed, restarting."),this.directive="preparing");this.safeMode&&n&&n.controller&&n.controller.safeMode&&(this.directive="staging",this.stageRoom=this.safeMode.stageRoom,this.attackRoom=this.safeMode.attackRoom,this.dismantle=this.safeMode.dismantle,this.safeMode=this.safeMode.safeMode);if("preparing"===this.directive){var f=this.boostRoom;
if(f){if(f=Game.rooms[f].storage.store,!f||(f[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]||0)>=150*(u.maxCreeps+w.maxCreeps+c.maxCreeps+q.maxCreeps)&&(f[RESOURCE_CATALYZED_ZYNTHIUM_ACID]||0)>=30*u.units*u.maxCreeps&&(f[RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE]||0)>=30*q.units*q.maxCreeps)this.directive="building"}else this.directive="building"}"building"===this.directive&&0===_.filter(l,function(a){return a.room.name!==k.buildRoom}).length&&_.filter(l,function(a){return a.room.name===k.buildRoom}).length>=
u.maxCreeps+q.maxCreeps+w.maxCreeps+c.maxCreeps&&(this.directive="staging");"staging"===this.directive&&0===_.filter(l,function(a){return a.room.name!==k.stageRoom}).length&&(this.directive="dismantle");"dismantle"===this.directive&&(this.dismantle?n&&(this.dismantle=_.filter(this.dismantle,function(a){return Game.getObjectById(a)}),0===this.dismantle.length&&(this.directive="attack")):this.directive="attack");n&&(this.hostileConstructionSites=n.find(FIND_HOSTILE_CONSTRUCTION_SITES),0!==n.find(FIND_HOSTILE_CREEPS).length||
this.reinforce||0!==_.filter(n.find(FIND_HOSTILE_STRUCTURES),function(a){return a.structureType!==STRUCTURE_CONTROLLER&&a.structureType!==STRUCTURE_RAMPART&&a.structureType!==STRUCTURE_KEEPER_LAIR}).length||0!==this.hostileConstructionSites.length||(this.directive="attack",this.success=!0));if("building"===this.directive||this.reinforce)this.checkSpawn("armyDismantler",u.maxCreeps,this.spawnFromRegion.bind(this,e)),this.checkSpawn("armyHealer",q.maxCreeps,this.spawnFromRegion.bind(this,a)),this.checkSpawn("armyMelee",
w.maxCreeps,this.spawnFromRegion.bind(this,b)),this.checkSpawn("armyRanged",c.maxCreeps,this.spawnFromRegion.bind(this,d));(u.escort||w.escort||c.escort)&&_.forEach(_.filter(g.creeps[x]&&g.creeps[x].armyHealer||[],function(a){return!a.memory.escorting&&!a.spawning}),function(a){var b=[].concat.apply([],[u.escort&&g.creeps[x].armyDismantler?_.filter(g.creeps[x].armyDismantler,function(a){return!a.memory.escortedBy&&!a.spawning}):[],w.escort&&g.creeps[x].armyMelee?_.filter(g.creeps[x].armyMelee,function(a){return!a.memory.escortedBy&&
!a.spawning}):[],c.escort&&g.creeps[x].armyRanged?_.filter(g.creeps[x].armyRanged,function(a){return!a.memory.escortedBy&&!a.spawning}):[]])[0];if(b)a.memory.escorting=b.id,b.memory.escortedBy=a.id;else return!1});if(n)switch(this.directive){case "attack":this.hostiles=g.hostilesInRoom(n);break;default:this.hostiles=0<l.length?_.filter(g.hostilesInRoom(n),function(a){return 3>=p.objectsClosestToObj(l,a)[0].pos.getRangeTo(a)}):[]}e.assignTasks(this);a.assignTasks(this);b.assignTasks(this);d.assignTasks(this)}};
k.prototype.checkSpawn=function(a,b,d){var k=this.name,h=_.filter(g.creeps[k]&&g.creeps[k][a]||[],function(a){return a.spawning||300<a.ticksToLive}).length,k=g.log.army[k];h<b&&d();k&&(0<b||0<h)&&k.creeps.push({role:a,count:h,max:b})};k.prototype.spawnFromRegion=function(a){var b=this,d=a.spawnSettings(this);a=_.filter(Game.spawns,function(a){return!a.spawning&&!g.spawning[a.id]&&a.room.energyAvailable>=p.getBodypartCost(d.body)&&a.room.memory.region===b.region});var k,h,e,w;if(0===a.length||this.boostRoom&&
(k=Game.rooms[this.boostRoom],h=k.memory.labsInUse,k&&!(e=p.getLabToBoostWith(k,Object.keys(d.boosts).length))))return!1;w=a[0].createCreep(d.body,d.name+"-"+this.name+"-"+Game.time.toFixed(0).substring(4),{role:d.name,army:this.name,labs:k?_.map(e,function(a){return a.id}):[],portals:this.portals});g.spawning[a[0].id]="number"!==typeof w;if("number"!==typeof w&&k){var c=0;_.forEach(d.boosts,function(a,b){e[c].creepToBoost=w;e[c].resource=b;e[c].amount=30*a;h.push(e[c]);c++});g.creeps[k.name]&&_.forEach(_.filter(g.creeps[k.name].all,
function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&-1!==_.map(e,function(a){return a.id}).indexOf(a.memory.currentTask.id)}),function(a){delete a.memory.currentTask})}return"number"!==typeof w};k.prototype.toObj=function(){this.delete?delete Memory.army[this.name]:Memory.army[this.name]={attackRoom:this.attackRoom,boostRoom:this.boostRoom,buildRoom:this.buildRoom,directive:this.directive,dismantle:this.dismantle,dismantler:this.dismantler,healer:this.healer,melee:this.melee,
ranged:this.ranged,region:this.region,reinforce:this.reinforce,restPosition:this.restPosition,safeMode:this.safeMode,scheduled:this.scheduled,stageRoom:this.stageRoom,success:this.success}};k.fromObj=function(a,b){return new k(a,b)};Memory.profiling&&c(1,2).registerObject(k,"Army");m.exports=k;return m.exports};r[3]=function(m,f){f=function(){};f.reset=function(){this.containers={};this.costMatrixes={};this.extensions={};this.extractors={};this.hostiles={};this.labs={};this.links={};this.nukers={};
this.portals={};this.powerBanks={};this.powerSpawns={};this.repairableStructures={};this.resources={};this.sortedRepairableStructures={};this.sourceKeepers={};this.spawns={};this.towers={};this.armies={};this.creepTasks={};this.minerals={};this.spawning={};this.rooms={};this.log={events:[],hostiles:[],creeps:[],spawns:[],structures:[],rooms:{},army:{}};this.credits=Game.market.credits;Memory.visualizations&&(this.globalVisual=new RoomVisual,this.time=(new Date).toLocaleString("en-US",{timeZone:"America/Los_Angeles"}).replace(",",
""))};f.containersInRoom=function(g){return this.containers[g.name]?this.containers[g.name]:this.containers[g.name]=_.filter(g.find(FIND_STRUCTURES),function(g){return g.structureType===STRUCTURE_CONTAINER})};f.costMatrixForRoom=function(g){var c=g.name;if(!g||g.unobservable)return new PathFinder.CostMatrix;if(!this.costMatrixes[c]){var e=new PathFinder.CostMatrix;_.forEach(g.find(FIND_STRUCTURES),function(a){var b=a.pos;a.structureType===STRUCTURE_ROAD?e.set(b.x,b.y,Math.max(1,e.get(b.x,b.y))):a.structureType===
STRUCTURE_WALL?e.set(b.x,b.y,255):a.structureType===STRUCTURE_CONTAINER?e.set(b.x,b.y,Math.max(10,e.get(b.x,b.y))):a.structureType===STRUCTURE_RAMPART&&a.my||e.set(b.x,b.y,255)});_.forEach(g.find(FIND_MY_CONSTRUCTION_SITES),function(a){a=a.pos;e.set(a.x,a.y,Math.max(5,e.get(a.x,a.y)))});_.forEach(this.portalsInRoom(g),function(a){a=a.pos;e.set(a.x,a.y,10)});Memory.avoidSquares[c]&&_.forEach(Memory.avoidSquares[c],function(a){e.set(a.x,a.y,255)});this.costMatrixes[c]=e}return this.costMatrixes[c]};
f.extensionsInRoom=function(g){return this.extensions[g.name]?this.extensions[g.name]:this.extensions[g.name]=_.filter(g.find(FIND_MY_STRUCTURES),function(g){return g.structureType===STRUCTURE_EXTENSION})};f.extractorsInRoom=function(g){return this.extractors[g.name]?this.extractors[g.name]:this.extractors[g.name]=g.find(FIND_STRUCTURES,{filter:function(g){return g.structureType===STRUCTURE_EXTRACTOR}})};f.hostilesInRoom=function(g){var c;if(!g||g.unobservable)return[];c=this.hostiles[g.name]?this.hostiles[g.name]:
this.hostiles[g.name]=_.filter(g.find(FIND_HOSTILE_CREEPS),function(e){return!e.owner||-1===Memory.allies.indexOf(e.owner.username)});g=g.memory;g.hostiles||(g.hostiles=[]);g.hostiles=_.map(c,function(e){return e.id});return c};f.labsInRoom=function(g){return this.labs[g.name]?this.labs[g.name]:this.labs[g.name]=_.filter(g.find(FIND_MY_STRUCTURES),function(g){return g.structureType===STRUCTURE_LAB})};f.linksInRoom=function(g){return this.links[g.name]?this.links[g.name]:this.links[g.name]=g.find(FIND_STRUCTURES,
{filter:function(g){return g.structureType===STRUCTURE_LINK}})};f.nukersInRoom=function(g){return this.nukers[g.name]?this.nukers[g.name]:this.nukers[g.name]=_.filter(g.find(FIND_MY_STRUCTURES),function(g){return g.structureType===STRUCTURE_NUKER})};f.portalsInRoom=function(g){return this.portals[g.name]?this.portals[g.name]:this.portals[g.name]=g.find(FIND_STRUCTURES,{filter:function(g){return g.structureType===STRUCTURE_PORTAL}})};f.powerBanksInRoom=function(g){return this.powerBanks[g.name]?this.powerBanks[g.name]:
this.powerBanks[g.name]=g.find(FIND_STRUCTURES,{filter:function(g){return g.structureType===STRUCTURE_POWER_BANK}})};f.powerSpawnsInRoom=function(g){return this.powerSpawns[g.name]?this.powerSpawns[g.name]:this.powerSpawns[g.name]=_.filter(g.find(FIND_MY_STRUCTURES),function(g){return g.structureType===STRUCTURE_POWER_SPAWN})};f.repairableStructuresInRoom=function(g){return this.repairableStructures[g.name]?this.repairableStructures[g.name]:this.repairableStructures[g.name]=g.find(FIND_STRUCTURES,
{filter:function(g){return(g.my||g.structureType===STRUCTURE_WALL||g.structureType===STRUCTURE_ROAD||g.structureType===STRUCTURE_CONTAINER)&&g.hits}})};f.sortedRepairableStructuresInRoom=function(g){return this.sortedRepairableStructures[g.name]?this.sortedRepairableStructures[g.name]:this.sortedRepairableStructures[g.name]=this.repairableStructuresInRoom(g).sort(function(g,e){return g.hits-e.hits})};f.sourceKeepersInRoom=function(g){return this.sourceKeepers[g.name]?this.sourceKeepers[g.name]:this.sourceKeepers[g.name]=
g.find(FIND_HOSTILE_STRUCTURES,{filter:function(g){return g.structureType===STRUCTURE_KEEPER_LAIR}})};f.spawnsInRoom=function(g){return this.spawns[g.name]?this.spawns[g.name]:this.spawns[g.name]=_.filter(g.find(FIND_MY_STRUCTURES),function(g){return g.structureType===STRUCTURE_SPAWN})};f.towersInRoom=function(g){return this.towers[g.name]?this.towers[g.name]:this.towers[g.name]=_.filter(g.find(FIND_MY_STRUCTURES),function(g){return g.structureType===STRUCTURE_TOWER})};f.resourcesInRoom=function(g){return this.resources[g.name]?
this.resources[g.name]:this.resources[g.name]=g.find(FIND_DROPPED_RESOURCES).sort(function(g,e){return e.amount-g.amount})};Memory.profiling&&c(1,3).registerObject(f,"Cache");m.exports=f;return m.exports};r[4]=function(m,f){var g=c(3,4);f=function(){};f.addAlly=function(g){Memory.allies.push(g)};f.addSign=function(g,e){Memory.signs||(Memory.signs={});e?Memory.signs[g]=e:delete Memory.signs[g]};f.avoidRoom=function(g,e){e&&-1===Memory.avoidRooms.indexOf(g)&&Memory.avoidRooms.push(g);e||_.remove(Memory.avoidRooms,
function(a){return a===g})};f.avoidSquare=function(g,e,a,b){b&&(Memory.avoidSquares[a]||(Memory.avoidSquares[a]=[]),Memory.avoidSquares[a].push({x:g,y:e}));b||Memory.avoidSquares[a]&&_.remove(Memory.avoidSquares[a],function(a){return a.x===g&&a.y===e})};f.claimMine=function(c){Game.rooms[c]&&g.creeps[c]&&_.forEach(g.creeps[c].remoteReserver,function(e){e.claimController(Game.rooms[c].controller)})};f.claimRoom=function(g,e,a){Memory.maxCreeps.claimer||(Memory.maxCreeps.claimer={});Memory.maxCreeps.claimer[g]||
(Memory.maxCreeps.claimer[g]={});a?Memory.maxCreeps.claimer[g][e]=!0:delete Memory.maxCreeps.claimer[g][e]};f.createArmy=function(g,e){void 0===e?delete Memory.army[g]:(Memory.army[g]=e,Memory.army[g].directive="preparing")};f.dismantle=function(g,e,a){Memory.dismantle||(Memory.dismantle={});Memory.dismantle[a]||(Memory.dismantle[a]=[]);Memory.dismantle[a].push({x:g,y:e})};f.downgradeRoomController=function(g,e,a){Memory.maxCreeps.downgrader||(Memory.maxCreeps.downgrader={});Memory.maxCreeps.downgrader[g]||
(Memory.maxCreeps.downgrader[g]={});a?Memory.maxCreeps.downgrader[g][e]=!0:delete Memory.maxCreeps.downgrader[g][e]};f.recover=function(){_.forEach(Game.spawns,function(g){return g.createCreep([MOVE,MOVE,CARRY,CARRY,CARRY,CARRY],"storer-emerg-"+g.room.name+"-"+g.name,{role:"storer",home:g.room.name})})};f.removeAlly=function(g){_.pull(Memory.allies,g)};f.resetBaseMatrix=function(g){Memory.baseMatrixes[g]={}};f.setContainerSource=function(g,e){Memory.containerSource[g]=e};f.setRoomType=function(g,
e,a){void 0===a?delete Memory.rooms[g].roomType:(Memory.rooms[g]||(Memory.rooms[g]={}),Memory.rooms[g].roomType=a,Memory.rooms[g].region=e)};f.startAllCreeps=function(){_.forEach(Game.creeps,function(g){delete g.memory.stop})};f.startCreep=function(g){Game.creeps[g]&&delete Game.creeps[g].memory.stop};f.stopCreep=function(g){Game.creeps[g]&&(Game.creeps[g].memory.stop=!0)};Memory.profiling&&c(1,4).registerObject(f,"Commands");m.exports=f;return m.exports};r[5]=function(m,f){f=function(){};f.progressBar=
function(g,c,e,a,b,d,k,h){void 0===h.showMax&&(h.showMax=!0);void 0===h.valueDecimals&&(h.valueDecimals=0);g.rect(c,e,a,b,{fill:h.background}).rect(c,e,a*Math.min(d/k,1),b,{fill:h.bar}).text(""+(h.label?h.label+" ":"")+d.toFixed(h.valueDecimals)+(h.showMax?"/"+k.toFixed(0):"")+(h.showDetails?" ("+(100*d/k).toFixed(3)+"%) "+(k-d).toFixed(0)+" to go":""),c+a/2,e+b/2+.175,{align:"center",color:h.color,font:h.font})};f.resource=function(g,c,e,a,b,d){switch(b){case RESOURCE_ENERGY:g.circle(c,e,{radius:.625*
a/2,fill:"#FFE664",opacity:d.opacity});break;case RESOURCE_POWER:g.circle(c,e,{radius:.625*a/2,fill:"#FF1930",opacity:d.opacity});break;case RESOURCE_HYDROGEN:g.circle(c,e,{radius:.4375*a,fill:"#B4B4B4",opacity:d.opacity}).circle(c,e,{radius:.375*a,fill:"#4C4C4C",opacity:d.opacity}).text(b,c,e+.2*a,{color:"#B4B4B4",size:.625*a,opacity:d.opacity});break;case RESOURCE_OXYGEN:g.circle(c,e,{radius:.4375*a,fill:"#B4B4B4",opacity:d.opacity}).circle(c,e,{radius:.375*a,fill:"#4C4C4C",opacity:d.opacity}).text(b,
c,e+.2*a,{color:"#B4B4B4",size:.625*a,opacity:d.opacity});break;case RESOURCE_UTRIUM:g.circle(c,e,{radius:.4375*a,fill:"#50D7F9",opacity:d.opacity}).circle(c,e,{radius:.375*a,fill:"#006181",opacity:d.opacity}).text(b,c,e+.2*a,{color:"#50D7F9",size:.625*a,opacity:d.opacity});break;case RESOURCE_KEANIUM:g.circle(c,e,{radius:.4375*a,fill:"#A071FF",opacity:d.opacity}).circle(c,e,{radius:.375*a,fill:"#371383",opacity:d.opacity}).text(b,c,e+.2*a,{color:"#A071FF",size:.625*a,opacity:d.opacity});break;case RESOURCE_LEMERGIUM:g.circle(c,
e,{radius:.4375*a,fill:"#00F4A2",opacity:d.opacity}).circle(c,e,{radius:.375*a,fill:"#236144",opacity:d.opacity}).text(b,c,e+.2*a,{color:"#00F4A2",size:.625*a,opacity:d.opacity});break;case RESOURCE_ZYNTHIUM:g.circle(c,e,{radius:.4375*a,fill:"#FDD388",opacity:d.opacity}).circle(c,e,{radius:.375*a,fill:"#5D4C2E",opacity:d.opacity}).text(b,c,e+.2*a,{color:"#FDD388",size:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYST:g.circle(c,e,{radius:.4375*a,fill:"#FF7B7B",opacity:d.opacity}).circle(c,e,
{radius:.375*a,fill:"#592121",opacity:d.opacity}).text(b,c,e+.2*a,{color:"#FF7B7B",size:.625*a,opacity:d.opacity});break;case RESOURCE_HYDROXIDE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#B4B4B4",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#666666",size:.625*a,opacity:d.opacity});break;case RESOURCE_ZYNTHIUM_KEANITE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#B4B4B4",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#666666",size:.625*a,opacity:d.opacity});break;case RESOURCE_UTRIUM_LEMERGITE:g.rect(c-
a/2,e-a/2,1.375*a,a,{fill:"#B4B4B4",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#666666",size:.625*a,opacity:d.opacity});break;case RESOURCE_GHODIUM:g.rect(c-a/2,e-a/2,a,a,{fill:"#FFFFFF",opacity:d.opacity}).text(b,c,e+.2*a,{color:"#666666",size:.625*a,opacity:d.opacity});break;case RESOURCE_UTRIUM_HYDRIDE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#50D7F9",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#006181",font:.625*a,opacity:d.opacity});break;case RESOURCE_UTRIUM_OXIDE:g.rect(c-a/2,e-
a/2,1.375*a,a,{fill:"#50D7F9",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#006181",font:.625*a,opacity:d.opacity});break;case RESOURCE_KEANIUM_HYDRIDE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#A071FF",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#371383",font:.625*a,opacity:d.opacity});break;case RESOURCE_KEANIUM_OXIDE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#A071FF",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#371383",font:.625*a,opacity:d.opacity});break;case RESOURCE_LEMERGIUM_HYDRIDE:g.rect(c-
a/2,e-a/2,1.375*a,a,{fill:"#00F4A2",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#236144",font:.625*a,opacity:d.opacity});break;case RESOURCE_LEMERGIUM_OXIDE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#00F4A2",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#236144",font:.625*a,opacity:d.opacity});break;case RESOURCE_ZYNTHIUM_HYDRIDE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#FDD388",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:d.opacity});break;case RESOURCE_ZYNTHIUM_OXIDE:g.rect(c-
a/2,e-a/2,1.375*a,a,{fill:"#FDD388",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:d.opacity});break;case RESOURCE_GHODIUM_HYDRIDE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#FFFFFF",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#666666",font:.625*a,opacity:d.opacity});break;case RESOURCE_GHODIUM_OXIDE:g.rect(c-a/2,e-a/2,1.375*a,a,{fill:"#FFFFFF",opacity:d.opacity}).text(b,c+.1875*a,e+.2*a,{color:"#666666",font:.625*a,opacity:d.opacity});break;case RESOURCE_UTRIUM_ACID:g.rect(c-
a/2,e-a/2,2.125*a,a,{fill:"#50D7F9",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#006181",font:.625*a,opacity:d.opacity});break;case RESOURCE_UTRIUM_ALKALIDE:g.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#50D7F9",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#006181",font:.625*a,opacity:d.opacity});break;case RESOURCE_KEANIUM_ACID:g.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#A071FF",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#371383",font:.625*a,opacity:d.opacity});break;case RESOURCE_KEANIUM_ALKALIDE:g.rect(c-
a/2,e-a/2,2.125*a,a,{fill:"#A071FF",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#371383",font:.625*a,opacity:d.opacity});break;case RESOURCE_LEMERGIUM_ACID:g.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#00F4A2",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#236144",font:.625*a,opacity:d.opacity});break;case RESOURCE_LEMERGIUM_ALKALIDE:g.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#00F4A2",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#236144",font:.625*a,opacity:d.opacity});break;case RESOURCE_ZYNTHIUM_ACID:g.rect(c-
a/2,e-a/2,2.125*a,a,{fill:"#FDD388",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:d.opacity});break;case RESOURCE_ZYNTHIUM_ALKALIDE:g.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#FDD388",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:d.opacity});break;case RESOURCE_GHODIUM_ACID:g.rect(c-a/2,e-a/2,2.125*a,a,{fill:"#FFFFFF",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#666666",font:.625*a,opacity:d.opacity});break;case RESOURCE_GHODIUM_ALKALIDE:g.rect(c-
a/2,e-a/2,2.125*a,a,{fill:"#FFFFFF",opacity:d.opacity}).text(b,c+.5*a,e+.2*a,{color:"#666666",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_UTRIUM_ACID:g.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#50D7F9",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#006181",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_UTRIUM_ALKALIDE:g.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#50D7F9",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#006181",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_KEANIUM_ACID:g.rect(c-
a/2,e-a/2,2.5*a,a,{fill:"#A071FF",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#371383",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_KEANIUM_ALKALIDE:g.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#A071FF",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#371383",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_LEMERGIUM_ACID:g.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#00F4A2",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#236144",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE:g.rect(c-
a/2,e-a/2,2.5*a,a,{fill:"#00F4A2",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#236144",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_ZYNTHIUM_ACID:g.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#FDD388",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE:g.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#FDD388",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#5D4C2E",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_GHODIUM_ACID:g.rect(c-
a/2,e-a/2,2.5*a,a,{fill:"#FFFFFF",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#666666",font:.625*a,opacity:d.opacity});break;case RESOURCE_CATALYZED_GHODIUM_ALKALIDE:g.rect(c-a/2,e-a/2,2.5*a,a,{fill:"#FFFFFF",opacity:d.opacity}).text(b,c+.725*a,e+.2*a,{color:"#666666",font:.625*a,opacity:d.opacity})}};f.sparkline=function(g,c,e,a,b,d,k){g.rect(c,e,a,b,{fill:"#404040",opacity:.5});_.forEach(k,function(k){g.poly(_.map(d,function(h,l){return[c+l/(d.length-1)*a,e+b*(1-(h[k.key]-k.min)/(k.max-k.min))]}),
k)})};Memory.profiling&&c(1,5).registerObject(f,"Drawing");m.exports=f;return m.exports};r[6]=function(m,f){var g=c(3,6),p=c(9,6),e=function(){};e.getAllOrders=function(){if(!e.orders||Game.cpu.bucket>=Memory.marketBucket)e.orders=Game.market.getAllOrders(),delete e.filteredOrders;return e.orders};e.getFilteredOrders=function(){e.filteredOrders||(e.filteredOrders=p.nest(_.filter(e.getAllOrders(),function(a){return 0<a.amount}),[function(a){return a.type},function(a){return a.resourceType}]),_.forEach(e.filteredOrders.sell,
function(a,b){e.filteredOrders.sell[b].sort(function(a,b){return a.price-b.price})}),_.forEach(e.filteredOrders.buy,function(a,b){e.filteredOrders.buy[b].sort(function(a,b){return b.price-a.price})}));return e.filteredOrders};e.deal=function(a,b,d){var k=Game.market.deal(a,b,d),h=_.find(e.orders,function(b){return b.id===a});k===OK?h&&("sell"===h.type&&(g.credits-=h.amount*h.price),h.amount<=b?(g.log.events.push(d+" "+h.resourceType+" x"+b+" @ "+h.price+" completed, "+h.type+" sold out "+h.id),_.remove(e.filteredOrders[h.type][h.resourceType],
function(b){return b.id===a}),_.remove(e.orders,function(b){return b.id===a})):(h.amount-=b,g.log.events.push(d+" "+h.resourceType+" x"+b+" @ "+h.price+" completed, "+h.type+" "+h.amount+" remaining on "+h.id))):h&&(g.log.events.push(d+" failed to process order ID "+a+": "+k),_.remove(e.filteredOrders[h.type][h.resourceType],function(b){return b.id===a}),_.remove(e.orders,function(b){return b.id===a}));return k};Memory.profiling&&c(1,6).registerObject(e,"Market");m.exports=e;return m.exports};r[7]=
function(c,f){f={};f[RESOURCE_HYDROGEN]=[];f[RESOURCE_OXYGEN]=[];f[RESOURCE_ZYNTHIUM]=[];f[RESOURCE_KEANIUM]=[];f[RESOURCE_UTRIUM]=[];f[RESOURCE_LEMERGIUM]=[];f[RESOURCE_CATALYST]=[];f[RESOURCE_HYDROXIDE]=[RESOURCE_HYDROGEN,RESOURCE_OXYGEN];f[RESOURCE_ZYNTHIUM_KEANITE]=[RESOURCE_ZYNTHIUM,RESOURCE_KEANIUM];f[RESOURCE_UTRIUM_LEMERGITE]=[RESOURCE_UTRIUM,RESOURCE_LEMERGIUM];f[RESOURCE_GHODIUM]=[RESOURCE_ZYNTHIUM_KEANITE,RESOURCE_UTRIUM_LEMERGITE];f[RESOURCE_UTRIUM_HYDRIDE]=[RESOURCE_UTRIUM,RESOURCE_HYDROGEN];
f[RESOURCE_UTRIUM_OXIDE]=[RESOURCE_UTRIUM,RESOURCE_OXYGEN];f[RESOURCE_KEANIUM_HYDRIDE]=[RESOURCE_KEANIUM,RESOURCE_HYDROGEN];f[RESOURCE_KEANIUM_OXIDE]=[RESOURCE_KEANIUM,RESOURCE_OXYGEN];f[RESOURCE_LEMERGIUM_HYDRIDE]=[RESOURCE_LEMERGIUM,RESOURCE_HYDROGEN];f[RESOURCE_LEMERGIUM_OXIDE]=[RESOURCE_LEMERGIUM,RESOURCE_OXYGEN];f[RESOURCE_ZYNTHIUM_HYDRIDE]=[RESOURCE_ZYNTHIUM,RESOURCE_HYDROGEN];f[RESOURCE_ZYNTHIUM_OXIDE]=[RESOURCE_ZYNTHIUM,RESOURCE_OXYGEN];f[RESOURCE_GHODIUM_HYDRIDE]=[RESOURCE_GHODIUM,RESOURCE_HYDROGEN];
f[RESOURCE_GHODIUM_OXIDE]=[RESOURCE_GHODIUM,RESOURCE_OXYGEN];f[RESOURCE_UTRIUM_ACID]=[RESOURCE_UTRIUM_HYDRIDE,RESOURCE_HYDROXIDE];f[RESOURCE_UTRIUM_ALKALIDE]=[RESOURCE_UTRIUM_OXIDE,RESOURCE_HYDROXIDE];f[RESOURCE_KEANIUM_ACID]=[RESOURCE_KEANIUM_HYDRIDE,RESOURCE_HYDROXIDE];f[RESOURCE_KEANIUM_ALKALIDE]=[RESOURCE_KEANIUM_OXIDE,RESOURCE_HYDROXIDE];f[RESOURCE_LEMERGIUM_ACID]=[RESOURCE_LEMERGIUM_HYDRIDE,RESOURCE_HYDROXIDE];f[RESOURCE_LEMERGIUM_ALKALIDE]=[RESOURCE_LEMERGIUM_OXIDE,RESOURCE_HYDROXIDE];f[RESOURCE_ZYNTHIUM_ACID]=
[RESOURCE_ZYNTHIUM_HYDRIDE,RESOURCE_HYDROXIDE];f[RESOURCE_ZYNTHIUM_ALKALIDE]=[RESOURCE_ZYNTHIUM_OXIDE,RESOURCE_HYDROXIDE];f[RESOURCE_GHODIUM_ACID]=[RESOURCE_GHODIUM_HYDRIDE,RESOURCE_HYDROXIDE];f[RESOURCE_GHODIUM_ALKALIDE]=[RESOURCE_GHODIUM_OXIDE,RESOURCE_HYDROXIDE];f[RESOURCE_CATALYZED_UTRIUM_ACID]=[RESOURCE_UTRIUM_ACID,RESOURCE_CATALYST];f[RESOURCE_CATALYZED_UTRIUM_ALKALIDE]=[RESOURCE_UTRIUM_ALKALIDE,RESOURCE_CATALYST];f[RESOURCE_CATALYZED_KEANIUM_ACID]=[RESOURCE_KEANIUM_ACID,RESOURCE_CATALYST];
f[RESOURCE_CATALYZED_KEANIUM_ALKALIDE]=[RESOURCE_KEANIUM_ALKALIDE,RESOURCE_CATALYST];f[RESOURCE_CATALYZED_LEMERGIUM_ACID]=[RESOURCE_LEMERGIUM_ACID,RESOURCE_CATALYST];f[RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE]=[RESOURCE_LEMERGIUM_ALKALIDE,RESOURCE_CATALYST];f[RESOURCE_CATALYZED_ZYNTHIUM_ACID]=[RESOURCE_ZYNTHIUM_ACID,RESOURCE_CATALYST];f[RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE]=[RESOURCE_ZYNTHIUM_ALKALIDE,RESOURCE_CATALYST];f[RESOURCE_CATALYZED_GHODIUM_ACID]=[RESOURCE_GHODIUM_ACID,RESOURCE_CATALYST];f[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]=
[RESOURCE_GHODIUM_ALKALIDE,RESOURCE_CATALYST];c.exports=f;return c.exports};r[8]=function(m,f){var g=c(3,8);f=function(){};f.assignTasks=function(c,e){0<e.rangedAttack.tasks.length?_.forEach(g.towersInRoom(c),function(a){a.attack(e.rangedAttack.tasks[0].enemy)}):0<e.repair.towerTasks.length?_.forEach(g.towersInRoom(c),function(a){a.repair(e.repair.towerTasks[0].structure)}):0<e.heal.tasks.length&&_.forEach(g.towersInRoom(c),function(a){a.heal(e.heal.tasks[0].ally)})};Memory.profiling&&c(1,8).registerObject(f,
"Tower");m.exports=f;return m.exports};r[9]=function(m,f){var g=c(3,9),p=function(){};p.nest=function(e,a){return a.length?_.mapValues(_.groupBy(e,a[0]),function(b){return p.nest(b,a.slice(1))}):e};p.creepsWithNoTask=function(e){return _.filter(e,function(a){return!a.memory.currentTask||a.memory.currentTask.unimportant})};p.objectsClosestToObj=function(e,a){var b=a.id;if(0===e.length)return[];if(!a)return e;e=_.map(e,function(d){var k=d.id,h;Memory.ranges&&Memory.ranges[b]&&Memory.ranges[b][k]?h=
Memory.ranges[b][k]:(h=a.pos.getRangeTo(d),d instanceof Creep||a instanceof Creep||(Memory.ranges||(Memory.ranges={}),Memory.ranges[b]||(Memory.ranges[b]={}),Memory.ranges[b][k]=h));return{object:d,distance:h}});e.sort(function(a,b){return a.distance-b.distance});return _.map(e,function(a){return a.object})};p.getEmptyPosAroundPos=function(e){var a=0,b,d,k;for(b=e.x-1;b<e.x+2;b++)for(d=e.y-1;d<e.y+2;d++)if(b!==e.x||d!==e.y)k=new RoomPosition(b,d,e.roomName),a+=_.filter(k.look(),function(a){return"terrain"===
a.type&&"wall"!==a.terrain}).length;return a};p.checkSiteIsClear=function(e){var a=!0,b=e.x,d=e.y,k=e.roomName,h=Game.rooms[k];if("wall"===(new RoomPosition(b,d,k)).lookFor(LOOK_TERRAIN)[0]||"wall"===(new RoomPosition(b-1,d,k)).lookFor(LOOK_TERRAIN)[0]&&"wall"===(new RoomPosition(b+1,d,k)).lookFor(LOOK_TERRAIN)[0]||"wall"===(new RoomPosition(b,d-1,k)).lookFor(LOOK_TERRAIN)[0]&&"wall"===(new RoomPosition(b,d+1,k)).lookFor(LOOK_TERRAIN)[0])return!1;_.forEach(h.find(FIND_SOURCES),function(b){return a=
1<e.getRangeTo(b)});if(!a)return!1;_.forEach(h.find(FIND_MINERALS),function(b){return a=1<e.getRangeTo(b)});if(!a||4>=e.getRangeTo(h.controller))return!1;b=_.filter(e.lookFor(LOOK_STRUCTURES),function(a){return"rampart"!==a.structureType});return 0===b.length?!0:_.filter(b,function(a){return-1!==[STRUCTURE_ROAD,STRUCTURE_WALL].indexOf(a.structureType)}).length!==b.length?!1:b};p.buildStructures=function(e,a,b,d){var k=1,h=d.pos;d=h.x;for(var h=h.y,c,l,n;0<b&&50>k;){for(c=d-k;c<=d+k;c+=2){for(l=h-
k;l<=h+k&&(1>c||48<c||1>l||48<l||0<_.filter(e.find(FIND_MY_CONSTRUCTION_SITES),function(a){return a.pos.x===c&&a.pos.y===l}).length||(n=p.checkSiteIsClear(new RoomPosition(c,l,e.name)),!1===n||(!0!==n&&_.forEach(n,function(a){a.destroy()}),e.createConstructionSite(c,l,a),b--,0!==b)));l+=Math.abs(d-c)===k?2:2*k);if(0===b)break}k++}};p.getBodypartCost=function(e){return _.sum(_.map(e,function(a){return BODYPART_COST[a]}))};p.getSourceLabs=function(e){var a=g.labsInRoom(e),b=[];_.forEach(a,function(d){if(2>=
p.objectsClosestToObj(a,d)[a.length-1].pos.getRangeTo(d)&&(b.push(d.id),2<=b.length))return!1});return b};p.getLabToBoostWith=function(e,a){var b=e.memory.labQueue,d=b&&b.sourceLabs?b.sourceLabs:[],k=[],b=null,h;a||(a=1);0===d.length&&(d=p.getSourceLabs(e));e.memory.labsInUse||(e.memory.labsInUse=[]);for(var c=0;c<a;c++){b={};h=_.filter(g.labsInRoom(e),function(a){return-1===d.indexOf(a.id)&&-1===_.map(e.memory.labsInUse,function(a){return a.id}).indexOf(a.id)&&-1===_.map(k,function(a){return a.id}).indexOf(a.id)});
0<h.length&&(b={id:h[0].id,pause:!1});if(!b||!b.id){b={id:_.filter(d,function(a){return-1===_.map(e.memory.labsInUse,function(a){return a.id}).indexOf(a)&&-1===_.map(k,function(a){return a.id}).indexOf(a)})[0],pause:!0};if(!b.id)return!1;h=Game.getObjectById(b.id);0<h.mineralAmount&&(b.status="emptying",b.oldResource=h.mineralType,b.oldAmount=h.mineralAmount)}if(!b.id)return!1;k.push(b)}return k};p.roomLabsArePaused=function(e){return e.memory.labsInUse&&0<_.filter(e.memory.labsInUse,function(a){return a.pause}).length};
p.getControllerOwner=function(e){return e.owner?e.owner.username:e.reservation?e.reservation.owner:""};Memory.profiling&&c(1,9).registerObject(p,"Utilities");m.exports=p;return m.exports};r[10]=function(m,f){var g=c(54,10),p=c(3,10),e=c(9,10);f=function(){};f.spawnSettings=function(a){var b=a.dismantler.units,d=[TOUGH,TOUGH,TOUGH,TOUGH,TOUGH],k;d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(b).fill(WORK))));d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(a.super?10:b+5).fill(MOVE))));
a.boostRoom&&(k={},k[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]=5,k[RESOURCE_CATALYZED_ZYNTHIUM_ACID]=b,a.super&&(k[RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE]=10));return{body:d,boosts:k,name:"armyDismantler"}};f.assignTasks=function(a){switch(a.directive){case "building":this.assignBuildingTasks(a);break;case "staging":this.assignStagingTasks(a);break;case "dismantle":this.assignDismantleTasks(a);break;case "attack":this.assignAttackTasks(a)}};f.assignBuildingTasks=function(a){var b=b=p.creeps[a.name],b=_.filter(e.creepsWithNoTask(b&&
b.armyDismantler||[]),function(a){return!a.spawning});g.getBoost(b,"Boosting");_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==b.length&&g.moveToRoom(b,a.buildRoom,"Building")};f.assignStagingTasks=function(a){var b=b=p.creeps[a.name];g.moveToRoom(_.filter(e.creepsWithNoTask(b&&b.armyDismantler||[]),function(a){return!a.spawning}),a.stageRoom,"Staging")};f.assignDismantleTasks=function(a){var b=p.creeps[a.name],
d=b&&b.armyDismantler||[],k=a.attackRoom,h=_.filter(e.creepsWithNoTask(d),function(a){return!a.spawning});g.retreatArmyUnitOrMoveToHealer(d,b&&b.armyHealer||[],a.stageRoom,k,.8,"Ouch!");_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==h.length&&(g.dismantleArmyTarget(h,k,a.dismantle,"Dismantle"),_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===
Game.time)}),0!==h.length&&g.moveToRoom(h,k,"Attacking"))};f.assignAttackTasks=function(a){var b=p.creeps[a.name],d=b&&b.armyDismantler||[],k=a.attackRoom,h=_.filter(e.creepsWithNoTask(d),function(a){return!a.spawning}),c;g.retreatArmyUnit(d,b&&b.armyHealer||[],a.stageRoom,k,.8,"Ouch!");_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==h.length&&(g.dismantleHostileStructures(h,k,"Dismantle"),_.remove(h,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==h.length&&(g.stomp(h,a.hostileConstructionSites,"Stomping"),_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==h.length&&((c=a.restPosition)?g.moveToPos(h,new RoomPosition(c.x,c.y,c.room),void 0,"Attacking"):g.moveToRoom(h,k,"Attacking"))))};Memory.profiling&&c(1,10).registerObject(f,"RoleArmyDismantler");m.exports=f;return m.exports};
r[11]=function(m,f){var g=c(54,11),p=c(3,11),e=c(9,11);f=function(){};f.spawnSettings=function(a){var b=a.healer.units,d=[TOUGH,TOUGH,TOUGH,TOUGH,TOUGH],k;d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(b-1).fill(HEAL))));d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(a.super?10:b+5).fill(MOVE))));d.push(HEAL);a.boostRoom&&(k={},k[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]=5,k[RESOURCE_CATALYZED_LEMERGIUM_ALKALIDE]=b,a.super&&(k[RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE]=10));return{body:d,
boosts:k,name:"armyHealer"}};f.assignTasks=function(a){var b=p.creeps[a.name];g.escort(b&&b.armyHealer||[],"Healing");switch(a.directive){case "building":this.assignBuildingTasks(a);break;case "staging":this.assignStagingTasks(a);break;case "dismantle":this.assignDismantleTasks(a);break;case "attack":this.assignAttackTasks(a)}};f.assignBuildingTasks=function(a){var b=p.creeps[a.name],d=_.filter(e.creepsWithNoTask(b&&b.armyHealer||[]),function(a){return!a.spawning&&!a.memory.escorting});g.getBoost(d,
"Boosting");_.remove(d,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==d.length&&(g.heal(d,_.filter(b&&b.all||[],function(a){return a.hits<a.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}),"Healing"),_.remove(d,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==d.length&&g.moveToRoom(d,a.buildRoom,"Building"))};f.assignStagingTasks=
function(a){var b=p.creeps[a.name],d=_.filter(e.creepsWithNoTask(b&&b.armyHealer||[]),function(a){return!a.spawning&&!a.memory.escorting});g.heal(d,_.filter(b&&b.all||[],function(a){return a.hits<a.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}),"Healing");_.remove(d,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==d.length&&g.moveToRoom(d,a.stageRoom,"Staging")};f.assignDismantleTasks=function(a){var b=
p.creeps[a.name],d=b&&b.armyHealer||[],k=a.attackRoom,h=_.filter(e.creepsWithNoTask(d),function(a){return!a.spawning&&!a.memory.escorting}),c;g.retreatArmyUnit(d,d,a.stageRoom,k,.8,"Ouch!");_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});if(0!==h.length&&(g.heal(h,_.filter(b&&b.all||[],function(a){return a.hits<a.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}),"Healing"),_.remove(h,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==h.length)){if(Game.rooms[k]&&0<(c=a.dismantle).length&&(g.moveToPos(h,c[0].pos,3,"Attacking"),_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0===h.length))return;g.moveToRoom(h,k,"Attacking")}};f.assignAttackTasks=function(a){var b=p.creeps[a.name],d=b&&b.armyHealer||[],k=a.attackRoom,h=_.filter(e.creepsWithNoTask(d),function(a){return!a.spawning&&
!a.memory.escorting}),c;g.retreatArmyUnit(d,d,a.stageRoom,k,.8,"Ouch!");_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});if(0!==h.length&&(g.heal(h,_.filter(b&&b.all||[],function(a){return a.hits<a.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}),"Healing"),_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==
h.length)){if(b=Game.rooms[k])if(g.heal(h,_.filter(b.find(FIND_MY_CREEPS),function(a){return a.hits<a.hitsMax}).sort(function(a,b){return a.hits/a.hitsMax-b.hits/b.hitsMax}),"Healing"),_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0===h.length)return;g.stomp(h,a.hostileConstructionSites,"Stomping");_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===
Game.time)});0!==h.length&&((c=a.restPosition)?g.moveToPos(h,new RoomPosition(c.x,c.y,c.room),void 0,"Attacking"):g.moveToRoom(h,k,"Attacking"))}};Memory.profiling&&c(1,11).registerObject(f,"RoleArmyHealer");m.exports=f;return m.exports};r[12]=function(m,f){var g=c(54,12),p=c(3,12),e=c(9,12);f=function(){};f.spawnSettings=function(a){var b=a.melee.units,d=[TOUGH,TOUGH,TOUGH,TOUGH,TOUGH],k;d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(b).fill(ATTACK))));d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(a.super?
10:b+5).fill(MOVE))));a.boostRoom&&(k={},k[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]=5,k[RESOURCE_CATALYZED_UTRIUM_ACID]=b,a.super&&(k[RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE]=10));return{body:d,boosts:k,name:"armyMelee"}};f.assignTasks=function(a){switch(a.directive){case "building":this.assignBuildingTasks(a);break;case "staging":this.assignStagingTasks(a);break;case "dismantle":this.assignDismantleTasks(a);break;case "attack":this.assignAttackTasks(a)}};f.assignBuildingTasks=function(a){var b=p.creeps[a.name],
b=_.filter(e.creepsWithNoTask(b&&b.armyMelee||[]),function(a){return!a.spawning});g.getBoost(b,"Boosting");_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==b.length&&(g.attack(b,a.hostiles,"Attacking"),_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==b.length&&g.moveToRoom(b,a.buildRoom,"Building"))};f.assignStagingTasks=function(a){var b=
p.creeps[a.name],b=_.filter(e.creepsWithNoTask(b&&b.armyMelee||[]),function(a){return!a.spawning});g.attack(b,a.hostiles,"Attacking");_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==b.length&&g.moveToRoom(b,a.stageRoom,"Staging")};f.assignDismantleTasks=function(a){var b=p.creeps[a.name],d=b&&b.armyMelee||[],k=a.attackRoom,h=_.filter(e.creepsWithNoTask(d),function(a){return!a.spawning}),c;g.retreatArmyUnitOrMoveToHealer(d,
b&&b.armyHealer||[],a.stageRoom,k,.8,"Ouch!");_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});if(0!==h.length&&(g.attack(h,a.hostiles,"Attacking"),_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==h.length)){if(Game.rooms[k]&&0<(c=a.dismantle).length&&(g.moveToPos(h,c[0].pos,3,"Attacking"),_.remove(h,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0===h.length))return;g.moveToRoom(h,k,"Attacking")}};f.assignAttackTasks=function(a){var b=p.creeps[a.name],d=b&&b.armyMelee||[],k=a.attackRoom,h=_.filter(e.creepsWithNoTask(d),function(a){return!a.spawning}),c;g.retreatArmyUnit(d,b&&b.armyHealer||[],a.stageRoom,k,.8,"Ouch!");_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==h.length&&
(g.attack(h,a.hostiles,"Attacking"),_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==h.length&&(g.stomp(h,a.hostileConstructionSites,"Stomping"),_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==h.length&&((c=a.restPosition)?g.moveToPos(h,new RoomPosition(c.x,c.y,c.room),void 0,"Attacking"):g.moveToRoom(h,k,"Attacking"))))};
Memory.profiling&&c(1,12).registerObject(f,"RoleArmyMelee");m.exports=f;return m.exports};r[13]=function(m,f){var g=c(54,13),p=c(3,13),e=c(9,13);f=function(){};f.spawnSettings=function(a){var b=a.ranged.units,d=[TOUGH,TOUGH,TOUGH,TOUGH,TOUGH],k;d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(b).fill(RANGED_ATTACK))));d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(a.super?10:b+5).fill(MOVE))));a.boostRoom&&(k={},k[RESOURCE_CATALYZED_GHODIUM_ALKALIDE]=5,k[RESOURCE_CATALYZED_UTRIUM_ACID]=
b,a.super&&(k[RESOURCE_CATALYZED_ZYNTHIUM_ALKALIDE]=10));return{body:d,boosts:k,name:"armyRanged"}};f.assignTasks=function(a){switch(a.directive){case "building":this.assignBuildingTasks(a);break;case "staging":this.assignStagingTasks(a);break;case "dismantle":this.assignDismantleTasks(a);break;case "attack":this.assignAttackTasks(a)}};f.assignBuildingTasks=function(a){var b=p.creeps[a.name],b=_.filter(e.creepsWithNoTask(b&&b.armyRanged||[]),function(a){return!a.spawning});g.getBoost(b,"Boosting");
_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==b.length&&(g.rangedAttack(b,a.hostiles,"Attacking"),_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==b.length&&g.moveToRoom(b,a.buildRoom,"Building"))};f.assignStagingTasks=function(a){var b=p.creeps[a.name],b=_.filter(e.creepsWithNoTask(b&&b.armyRanged||[]),function(a){return!a.spawning});
g.rangedAttack(b,a.hostiles,"Attacking");_.remove(b,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==b.length&&g.moveToRoom(b,a.stageRoom,"Staging")};f.assignDismantleTasks=function(a){var b=p.creeps[a.name],d=b&&b.armyRanged||[],k=a.attackRoom,h=_.filter(e.creepsWithNoTask(d),function(a){return!a.spawning}),c;g.retreatArmyUnitOrMoveToHealer(d,b&&b.armyHealer||[],a.stageRoom,k,.8,"Ouch!");_.remove(h,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});if(0!==h.length&&(g.rangedAttack(h,a.hostiles,"Attacking"),_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==h.length)){if(Game.rooms[k]&&0<(c=a.dismantle).length&&(g.moveToPos(h,c[0].pos,3,"Attacking"),_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),
0===h.length))return;g.moveToRoom(h,k,"Attacking")}};f.assignAttackTasks=function(a){var b=p.creeps[a.name],d=b&&b.armyRanged||[],k=a.attackRoom,h=_.filter(e.creepsWithNoTask(d),function(a){return!a.spawning}),c;g.retreatArmyUnit(d,b&&b.armyHealer||[],a.stageRoom,k,.8,"Ouch!");_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)});0!==h.length&&(g.rangedAttack(h,a.hostiles,"Attacking"),_.remove(h,function(a){return a.memory.currentTask&&
(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==h.length&&(g.stomp(h,a.hostileConstructionSites,"Stomping"),_.remove(h,function(a){return a.memory.currentTask&&(!a.memory.currentTask.unimportant||a.memory.currentTask.priority===Game.time)}),0!==h.length&&((c=a.restPosition)?g.moveToPos(h,new RoomPosition(c.x,c.y,c.room),void 0,"Attacking"):g.moveToRoom(h,k,"Attacking"))))};Memory.profiling&&c(1,13).registerObject(f,"RoleArmyRanged");m.exports=f;return m.exports};
r[14]=function(m,f){var g=c(3,14),p=c(9,14),e=c(49,14),a=c(37,14);f=function(){};f.checkSpawnSettings=function(a,d){var b=Memory.maxCreeps.claimer;a=a.room.name;var h,c;if(!d)return{name:"claimer",spawn:!1,max:b&&b[a]?Object.keys(b[a]).length:0};h=(d=g.creeps[a])&&d.claimer||[];b&&_.forEach(b[a],function(a,b){if(0===_.filter(h,function(a){return a.memory.claim===b}).length)return c=b,!1});return{name:"claimer",spawn:!!c,max:b&&b[a]?Object.keys(b[a]).length:0,roomToClaim:c}};f.spawnSettings=function(a){return{body:[CLAIM,
MOVE],memory:{role:"claimer",home:a.home,claim:a.roomToClaim}}};f.assignTasks=function(b){b=b.name;b=p.creepsWithNoTask(g.creeps[b]&&g.creeps[b].claimer||[]);var d=[];0!==b.length&&(_.forEach(_.filter(b,function(a){return a.room.name!==a.memory.claim}),function(a){e.getClaimerTask(a).canAssign(a)&&d.push(a.name)}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&(_.forEach(b,function(b){a.getTask(b).canAssign(b)&&(b.say("Claiming"),d.push(b.name))}),_.remove(b,function(a){return-1!==
d.indexOf(a.name)}),d=[],0!==b.length&&_.forEach(b,function(a){a.room.name===a.memory.claim&&a.room.controller.my&&a.suicide()})))};Memory.profiling&&c(1,14).registerObject(f,"RoleClaimer");m.exports=f;return m.exports};r[15]=function(m,f){var g=c(3,15),p=c(9,15),e=c(44,15),a=c(48,15),b=c(49,15);f=function(){};f.checkSpawnSettings=function(a,b){a=a.room;var d=a.storage,k,c,e;if(0!==g.containersInRoom(a).length&&d&&d.my)return{name:"collector",spawn:!1,max:0};d=a.find(FIND_SOURCES);if(1>=d.length)return{name:"collector",
spawn:!1,max:0};c=3*(d.length-1);if(!b)return{name:"collector",spawn:!1,max:c};k=(b=g.creeps[a.name])&&b.collector||[];_.forEach(p.objectsClosestToObj(d,g.spawnsInRoom(a)[0]),function(a,b){var d;if(0!==b&&(d=a.id,3>_.filter(k,function(a){return a.memory.homeSource===d}).length))return e=d,!1});return{name:"collector",spawn:!!e,max:c,spawnFromRegion:!0,sourceIdToCollectFrom:e}};f.spawnSettings=function(a){var b=Math.min(a.energyCapacityAvailable,3300),d=Math.floor(b/200),b=b%200,c=[];c.push.apply(c,
[].concat($jscomp.arrayFromIterable(Array(d+(150<=b?1:0)).fill(WORK))));c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(d+(100<=b&&150>b?1:0)).fill(CARRY))));c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(d+(50<=b?1:0)).fill(MOVE))));return{body:c,memory:{role:"collector",home:a.home,homeSource:a.sourceIdToCollectFrom}}};f.assignTasks=function(d,k){var h=d.name,c=_.filter(p.creepsWithNoTask(g.creeps[h]&&g.creeps[h].collector||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&
150<a.ticksToLive}),l=g.creeps[h]&&g.creeps[h].all||[],n=[];0!==c.length&&(_.forEach(k.upgradeController.criticalTasks,function(a){0===_.filter(l,function(b){return b.memory.currentTask&&"upgradeController"===b.memory.currentTask.type&&b.memory.currentTask.room===a.room}).length&&(_.forEach(p.objectsClosestToObj(c,d.controller),function(b){if(a.canAssign(b))return b.say("CritCntrlr"),n.push(b.name),!1}),_.remove(c,function(a){return-1!==n.indexOf(a.name)}),n=[])}),0!==c.length&&(_.forEach(c,function(a){a.carry[RESOURCE_ENERGY]<
(8===d.controller.level?200:7===d.controller.level?100:50)||_.forEach(k.fillEnergy.extensionTasks.sort(function(b,d){return b.object.pos.getRangeTo(a)-d.object.pos.getRangeTo(a)}),function(b){if(0<b.object.energyCapacity-b.object.energy-_.reduce(_.filter(l,function(a){return a.memory.currentTask&&"fillEnergy"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0)&&b.canAssign(a))return a.say("Extension"),n.push(a.name),!1})}),_.remove(c,
function(a){return-1!==n.indexOf(a.name)}),n=[],0!==c.length&&(_.forEach(k.fillEnergy.spawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(l,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(p.objectsClosestToObj(c,a.object),function(d){if(a.canAssign(d)&&(d.say("Spawn"),n.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),
_.remove(c,function(a){return-1!==n.indexOf(a.name)}),n=[])}),0!==c.length&&(_.forEach(k.fillEnergy.towerTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(l,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(p.objectsClosestToObj(c,a.object),function(d){if(a.canAssign(d)&&(d.say("Tower"),n.push(d.name),b-=d.carry[RESOURCE_ENERGY]||
0,0>=b))return!1}),_.remove(c,function(a){return-1!==n.indexOf(a.name)}),n=[])}),0!==c.length&&(_.forEach(k.repair.criticalTasks,function(a){_.forEach(p.objectsClosestToObj(c,a.structure),function(b){if(0===_.filter(g.creeps[a.structure.room.name]&&g.creeps[a.structure.room.name].all||[],function(b){return b.memory.currentTask&&"repair"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length&&a.canAssign(b))return b.say("CritRepair"),n.push(b.name),!1});_.remove(c,function(a){return-1!==
n.indexOf(a.name)});n=[]}),0!==c.length&&(_.forEach(k.build.tasks,function(a){var b=a.constructionSite.progressTotal-a.constructionSite.progress-_.reduce(_.filter(g.creeps[a.constructionSite.room.name]&&g.creeps[a.constructionSite.room.name].all||[],function(b){return b.memory.currentTask&&"build"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(p.objectsClosestToObj(c,a.constructionSite),function(d){if(a.canAssign(d)&&
(d.say("Build"),n.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(c,function(a){return-1!==n.indexOf(a.name)}),n=[])}),0!==c.length&&(_.forEach(k.repair.tasks,function(a){var b=a.structure.hitsMax-a.structure.hits-100*_.reduce(_.filter(g.creeps[a.structure.room.name]&&g.creeps[a.structure.room.name].all||[],function(b){return b.memory.currentTask&&"repair"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0),d=
!1;0<b&&(_.forEach(p.objectsClosestToObj(c,a.structure),function(k){if(a.canAssign(k)&&(k.say("Repair"),n.push(k.name),b-=100*(k.carry[RESOURCE_ENERGY]||0),d=!0,0>=b))return!1}),_.remove(c,function(a){return-1!==n.indexOf(a.name)}),n=[]);return d}),0!==c.length&&(_.forEach(k.upgradeController.tasks,function(a){_.forEach(p.objectsClosestToObj(c,d.controller),function(b){a.canAssign(b)&&(b.say("Controller"),n.push(b.name))});_.remove(c,function(a){return-1!==n.indexOf(a.name)});n=[]}),0!==c.length&&
(0===g.hostilesInRoom(d).length&&_.forEach(c,function(b){_.forEach(a.getCollectorTasks(b.room),function(a){if(!(0<_.filter(g.creeps[a.resource.room.name]&&g.creeps[a.resource.room.name].all||[],function(b){return b.memory.currentTask&&"pickupResource"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length)&&a.canAssign(b))return b.say("Pickup"),n.push(b.name),!1})}),_.remove(c,function(a){return-1!==n.indexOf(a.name)}),n=[],0!==c.length&&(_.forEach(k.collectEnergy.tasks,function(a){_.forEach(c,
function(b){a.canAssign(b)&&(b.say("Collecting"),n.push(b.name))});_.remove(c,function(a){return-1!==n.indexOf(a.name)});n=[]}),0!==c.length&&(_.forEach(c,function(a){(new e).canAssign(a)&&(a.say("Harvesting"),n.push(a.name))}),_.remove(c,function(a){return-1!==n.indexOf(a.name)}),n=[],0!==c.length&&_.forEach(b.getHarvesterTasks(c),function(a){a.canAssign(a.creep)}))))))))))))};Memory.profiling&&c(1,15).registerObject(f,"RoleCollector");m.exports=f;return m.exports};r[16]=function(m,f){var g=c(3,
16),p=c(9,16),e=c(49,16),a=c(46,16);f=function(){};f.checkSpawnSettings=function(a,d){if(!d)return{name:"defender",spawn:!1,max:1};a=g.creeps[a.room.name];return{name:"defender",spawn:1>_.filter(a&&a.defender||[],function(a){return a.spawning||300<=a.ticksToLive}).length,spawnFromRegion:!0,max:1}};f.spawnSettings=function(a){return{body:[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,
ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,ATTACK,HEAL,HEAL,HEAL,HEAL,HEAL],memory:{role:"defender",home:a.home,supportRoom:a.supportRoom}}};f.checkQuadrant=function(a,d){switch(d){case 0:return 25>a.x&&25>a.y;case 1:return 25>a.x&&25<=a.y;case 2:return 25<=a.x&&25<=a.y;case 3:return 25<=a.x&&25>a.y}};f.assignTasks=function(b){var d=this,k=b.name,k=_.filter(p.creepsWithNoTask(g.creeps[k]&&g.creeps[k].defender||[]),function(a){return!a.spawning}),h,c;
b&&!b.unobservable&&(h=g.hostilesInRoom(b),c=g.sourceKeepersInRoom(b));_.forEach(k,function(b){b.room.name!==b.memory.home?e.getDefenderTask(b).canAssign(b):(b.memory.quadrant||(b.memory.quadrant=0),_.forEach(_.filter(h,function(a){return d.checkQuadrant(a.pos,b.memory.quadrant)}),function(d){return!(new a(d.id)).canAssign(b)}),b.memory.currentTask||(_.forEach(_.filter(c,function(a){return 200>a.ticksToSpawn&&d.checkQuadrant(a.pos,b.memory.quadrant)}),function(a){a=new e(a.id,b);a.range=1;return!a.canAssign(b)}),
b.memory.currentTask||(b.memory.quadrant=(b.memory.quadrant+1)%4)))})};Memory.profiling&&c(1,16).registerObject(f,"RoleDefender");m.exports=f;return m.exports};r[17]=function(m,f){var g=c(3,17),p=c(9,17),e=c(36,17),a=c(48,17),b=c(49,17),d=c(51,17);f=function(){};f.checkSpawnSettings=function(a,b){if(!b)return{name:"dismantler",spawn:!1,max:1};a=g.creeps[a.room.name];return{name:"dismantler",spawn:1>_.filter(a&&a.dismantler||[],function(a){return a.spawning||150<=a.ticksToLive}).length,spawnFromRegion:!0,
max:1}};f.spawnSettings=function(a){var b=Math.min(a.energyCapacityAvailable,3300),d=Math.floor(b/200),b=b%200,k=[];k.push.apply(k,[].concat($jscomp.arrayFromIterable(Array(d+(150<=b?1:0)).fill(WORK))));k.push.apply(k,[].concat($jscomp.arrayFromIterable(Array(d+(100<=b&&150>b?1:0)).fill(CARRY))));k.push.apply(k,[].concat($jscomp.arrayFromIterable(Array(d+(50<=b?1:0)).fill(MOVE))));return{body:k,memory:{role:"dismantler",home:a.home,supportRoom:a.supportRoom}}};f.assignTasks=function(k,h){var c=k.name,
l=_.filter(p.creepsWithNoTask(g.creeps[c]&&g.creeps[c].dismantler||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),n=[];0!==l.length&&(_.forEach(_.filter(l,function(a){return a.room.name!==c}),function(a){_.forEach(d.getCriticalTasks(a.room),function(b){if(0===_.filter(g.creeps[b.structure.room.name]&&g.creeps[b.structure.room.name].all||[],function(a){return a.memory.currentTask&&"repair"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length&&b.canAssign(a))return a.say("CritRepair"),
n.push(a.name),!1})}),_.remove(l,function(a){return-1!==n.indexOf(a.name)}),n=[],0!==l.length&&(_.forEach(l,function(a){var b=a.room.find(FIND_MY_CONSTRUCTION_SITES);0<b.length&&(new e(b[0].id)).canAssign(a)&&(a.say("Build"),n.push(a.name))}),_.remove(l,function(a){return-1!==n.indexOf(a.name)}),n=[],0!==l.length&&(_.forEach([].concat.apply([],[h.fillEnergy.storageTasks,h.fillEnergy.containerTasks]),function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),
function(b){return b.memory.currentTask&&-1!==["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(p.objectsClosestToObj(l,a.object),function(d){if(a.canAssign(d)&&(d.say("Container"),n.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(l,function(a){return-1!==n.indexOf(a.name)}),n=[])}),0!==l.length&&(_.forEach(h.fillMinerals.storageTasks,function(a){_.forEach(l,
function(b){a.canAssign(b)&&(b.say("Storage"),n.push(b.name))});_.remove(l,function(a){return-1!==n.indexOf(a.name)});n=[]}),0!==l.length&&(_.forEach(h.fillMinerals.terminalTasks,function(a){_.forEach(l,function(b){a.canAssign(b)&&(b.say("Terminal"),n.push(b.name))});_.remove(l,function(a){return-1!==n.indexOf(a.name)});n=[]}),0!==l.length&&(_.forEach(_.filter(l,function(a){return a.room.name===c}),function(a){_.forEach(h.dismantle.tasks,function(b){if(!(0<_.filter(b.structure.room.find(FIND_MY_CREEPS),
function(a){return a.memory.currentTask&&"dismantle"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Dismantle"),n.push(a.name),!1})}),_.remove(l,function(a){return-1!==n.indexOf(a.name)}),n=[],0!==l.length&&(_.forEach(l,function(b){_.forEach(a.getTasks(b.room),function(a){if(!(0<_.filter(a.resource.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"pickupResource"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length)&&
a.canAssign(b))return b.say("Pickup"),n.push(b.name),!1})}),_.remove(l,function(a){return-1!==n.indexOf(a.name)}),n=[],0!==l.length&&_.forEach(l,function(a){(new b(a.memory.home)).canAssign(a)}))))))))};Memory.profiling&&c(1,17).registerObject(f,"RoleDismantler");m.exports=f;return m.exports};r[18]=function(m,f){var g=c(3,18),p=c(9,18),e=c(49,18),a=c(41,18);f=function(){};f.checkSpawnSettings=function(a,d){var b=Memory.maxCreeps.downgrader;a=a.room.name;var h,c;if(!d)return{name:"downgrader",spawn:!1,
max:b&&b[a]?Object.keys(b[a]).length:0};h=(d=g.creeps[a])&&d.downgrader||[];b&&_.forEach(b[a],function(a,b){if(0===_.filter(h,function(a){return a.memory.attack===b}).length)return c=b,!1});return{name:"downgrader",spawn:!!c,max:b&&b[a]?Object.keys(b[a]).length:0,roomToDowngrade:c}};f.spawnSettings=function(a){var b=Math.floor(Math.min(a.energyCapacityAvailable,24400)/3050),k=[];k.push.apply(k,[].concat($jscomp.arrayFromIterable(Array(5*b).fill(CLAIM))));k.push.apply(k,[].concat($jscomp.arrayFromIterable(Array(b).fill(MOVE))));
return{body:k,memory:{role:"downgrader",home:a.home,attack:a.roomToDowngrade}}};f.assignTasks=function(b){b=b.name;b=p.creepsWithNoTask(g.creeps[b]&&g.creeps[b].downgrader||[]);var d=[];0!==b.length&&(_.forEach(_.filter(b,function(a){return a.room.name!==a.memory.attack}),function(a){e.getClaimerTask(a).canAssign(a)&&d.push(a.name)}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&(_.forEach(b,function(b){a.getTask(b).canAssign(b)&&(b.say("Attacking"),d.push(b.name))}),_.remove(b,
function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&_.forEach(b,function(a){a.suicide()})))};Memory.profiling&&c(1,18).registerObject(f,"RoleDowngrader");m.exports=f;return m.exports};r[19]=function(m,f){var g=c(3,19),p=c(9,19),e=c(45,19),a=c(49,19);f=function(){};f.checkSpawnSettings=function(a,d){if(!d)return{name:"healer",spawn:!1,max:1};a=g.creeps[a.room.name];return{name:"healer",spawn:1>_.filter(a&&a.healer||[],function(a){return a.spawning||300<=a.ticksToLive}).length,spawnFromRegion:!0,
max:1}};f.spawnSettings=function(a){var b=Math.floor(Math.min(a.energyCapacityAvailable,7500)/300),k=[];k.push.apply(k,[].concat($jscomp.arrayFromIterable(Array(b).fill(MOVE))));k.push.apply(k,[].concat($jscomp.arrayFromIterable(Array(b).fill(HEAL))));return{body:k,memory:{role:"healer",home:a.home,supportRoom:a.supportRoom}}};f.assignTasks=function(b){b=b.name;b=_.filter(p.creepsWithNoTask(g.creeps[b]&&g.creeps[b].healer||[]),function(a){return!a.spawning});var d=[];0!==b.length&&(_.forEach(_.filter(b,
function(a){return a.room.name!==a.memory.home}),function(b){a.getDefenderTask(b).canAssign(b)&&d.push(b.name)}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&(_.forEach(b,function(a){var b=e.getDefenderTask(a);b&&b.canAssign(a)&&(a.say("Heal"),d.push(a.name))}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&_.forEach(_.filter(b,function(a){return a.room.name===a.memory.home}),function(b){var h=a.getDefenderTask(b);h.range=1;h.canAssign(b)&&d.push(b.name)})))};
Memory.profiling&&c(1,19).registerObject(f,"RoleHealer");m.exports=f;return m.exports};r[20]=function(m,f){var g=c(3,20),p=c(9,20),e=c(47,20),a=c(49,20);f=function(){};f.checkSpawnSettings=function(a,d){var b=a.room;a=g.containersInRoom(b);var h=b.find(FIND_MINERALS),c=[].concat.apply([],[b.find(FIND_SOURCES),h]),e,n,u,q;if(0===a.length)return{name:"miner",spawn:!1,max:0};if(!d)return{name:"miner",spawn:!1,max:a.length-_.filter(h,function(a){return 0===a.mineralAmount}).length};e=Memory.containerSource;
n=(d=g.creeps[b.name])&&d.miner||[];_.forEach(a,function(a){var b=a.id,d;e[b]||(e[b]=p.objectsClosestToObj(c,a)[0].id);a=Game.getObjectById(e[b]);d=a instanceof Mineral;if((!d||0!==a.mineralAmount)&&0===_.filter(n,function(a){return(a.spawning||150<=a.ticksToLive)&&a.memory.container===b}).length)return u=b,q=d,!1});return{name:"miner",spawn:!!u,max:a.length-_.filter(h,function(a){return 0===a.mineralAmount}).length,containerIdToMineOn:u,isMineralHarvester:q}};f.spawnSettings=function(a){var b=[];
if(a.isMineralHarvester){var c=Math.min(a.energyCapacityAvailable,4500),h=Math.floor(c/450),c=c%450;b.push.apply(b,[].concat($jscomp.arrayFromIterable(Array(h+(150<=c?1:0)).fill(MOVE))));b.push.apply(b,[].concat($jscomp.arrayFromIterable(Array(4*h+(150<=c?1:0)+(250<=c?1:0)+(350<=c?1:0)).fill(WORK))))}else b=[MOVE,WORK,WORK,WORK,WORK,WORK];return{body:b,memory:{role:"miner",home:a.home,container:a.containerIdToMineOn}}};f.assignTasks=function(b){b=b.name;b=p.creepsWithNoTask(g.creeps[b]&&g.creeps[b].miner||
[]);var d=[];0!==b.length&&(_.forEach(_.filter(b,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(b){(new a(b.memory.labs[0])).canAssign(b);d.push(b.name)}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&_.forEach(b,function(a){(new e).canAssign(a)&&a.say("Mining")}))};Memory.profiling&&c(1,20).registerObject(f,"RoleMiner");m.exports=f;return m.exports};r[21]=function(m,f){var g=c(3,21),p=c(9,21),e=c(36,21),a=c(44,21),b=c(48,21),d=c(49,21),k=c(51,21);f=
function(){};f.checkSpawnSettings=function(a,b){if(!b)return{name:"remoteBuilder",spawn:!1,max:2};a=g.creeps[a.room.name];return{name:"remoteBuilder",spawn:2>(a&&a.remoteBuilder||[]).length,spawnFromRegion:!0,max:2}};f.spawnSettings=function(a){var b=Math.min(a.energyCapacityAvailable,3300),d=Math.floor(b/200),b=b%200,c=[];c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(d+(150<=b?1:0)).fill(WORK))));c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(d+(100<=b&&150>b?1:0)).fill(CARRY))));
c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(d+(50<=b?1:0)).fill(MOVE))));return{body:c,memory:{role:"remoteBuilder",home:a.home,supportRoom:a.supportRoom}}};f.assignTasks=function(c){var h=c.name,h=_.filter(p.creepsWithNoTask(g.creeps[h]&&g.creeps[h].remoteBuilder||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),l=[];if(0!==h.length&&(_.forEach(_.filter(h,function(a){return a.room.name===c.name}),function(a){0<c.find(FIND_HOSTILE_CONSTRUCTION_SITES).length&&
((new d(c.find(FIND_HOSTILE_CONSTRUCTION_SITES)[0].id)).canAssign(a),a.say("Stomping"),l.push(a.name))}),_.remove(h,function(a){return-1!==l.indexOf(a.name)}),l=[],0!==h.length&&(_.forEach(h,function(a){_.forEach(k.getCriticalTasks(a.room),function(b){if(0===_.filter(b.structure.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"repair"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length&&b.canAssign(a))return a.say("CritRepair"),l.push(a.name),!1})}),_.remove(h,
function(a){return-1!==l.indexOf(a.name)}),l=[],0!==h.length))){if(!c.unobservable&&(_.forEach(h,function(a){var b=c.find(FIND_MY_CONSTRUCTION_SITES);0<b.length&&(new e(p.objectsClosestToObj(b,a)[0].id)).canAssign(a)&&(a.say("Build"),l.push(a.name))}),_.remove(h,function(a){return-1!==l.indexOf(a.name)}),l=[],0===h.length))return;_.forEach(h,function(a){a.room.name===a.memory.home&&_.forEach(b.getTasks(a.room),function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&
"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Pickup"),l.push(a.name),!1})});_.remove(h,function(a){return-1!==l.indexOf(a.name)});l=[];0!==h.length&&(c.unobservable||_.forEach(h,function(b){var d=new a,h=p.objectsClosestToObj(_.filter(c.find(FIND_SOURCES),function(a){return 0<a.energy}),b);if(0===h.length)return!1;b.memory.homeSource=h[0].id;d.canAssign(b)&&(b.say("Harvesting"),l.push(b.name))}),_.remove(h,function(a){return-1!==
l.indexOf(a.name)}),l=[],0!==h.length&&_.forEach(h,function(a){(new d(a.memory.home)).canAssign(a)}))}};Memory.profiling&&c(1,21).registerObject(f,"RoleRemoteBuilder");m.exports=f;return m.exports};r[22]=function(m,f){var g=c(3,22),p=c(9,22),e=c(48,22),a=c(49,22);f=function(){};f.checkSpawnSettings=function(a,d){var b="cleanup"===a.type?3:1;if(!d)return{name:"remoteCollector",spawn:!1,max:b};a=g.creeps[a.room.name];return{name:"remoteCollector",spawn:_.filter(a&&a.remoteCollector||[],function(a){return a.spawning||
300<=a.ticksToLive}).length<b,spawnFromRegion:!0,max:b}};f.spawnSettings=function(a){var b=Math.floor(Math.min(a.energyCapacityAvailable,2400)/150),c=[];c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(2*b).fill(CARRY))));c.push.apply(c,[].concat($jscomp.arrayFromIterable(Array(b).fill(MOVE))));return{body:c,memory:{role:"remoteCollector",home:a.home,supportRoom:a.supportRoom}}};f.assignTasks=function(b,d){var c=b.name,h=g.creeps[c],f=p.creepsWithNoTask(h&&h.remoteCollector||[]),l=[];0!==
f.length&&(_.forEach(f,function(a){_.forEach(e.getTasks(a.room),function(b){if(!(_.sum(h&&h.all||[],function(a){return a.memory.currentTask&&a.memory.currentTask.id===b.idG?a.carryCapacity-_.sum(a.carry):0})>=b.resource.amount)&&b.canAssign(a))return a.say("Pickup"),l.push(a.name),!1})}),_.remove(f,function(a){return-1!==l.indexOf(a.name)}),l=[],0!==f.length&&(d.collectMinerals&&d.collectMinerals.cleanupTasks&&_.forEach(d.collectMinerals.cleanupTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&
(b.say("Collecting"),l.push(b.name))});_.remove(f,function(a){return-1!==l.indexOf(a.name)});l=[]}),d.collectEnergy&&d.collectEnergy.cleanupTasks&&_.forEach(d.collectEnergy.cleanupTasks,function(a){_.forEach(_.filter(f,function(a){return a.room.name===c}),function(b){a.canAssign(b)&&(b.say("Collecting"),l.push(b.name))});_.remove(f,function(a){return-1!==l.indexOf(a.name)});l=[]}),_.forEach(d.fillEnergy.storageTasks,function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),
function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(p.objectsClosestToObj(f,a.object),function(d){if(a.canAssign(d)&&(d.say("Storage"),l.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(f,function(a){return-1!==l.indexOf(a.name)}),l=[])}),0!==f.length&&(_.forEach(d.fillMinerals.storageTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("Storage"),
l.push(b.name))});_.remove(f,function(a){return-1!==l.indexOf(a.name)});l=[]}),0!==f.length&&(_.forEach(d.fillMinerals.terminalTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("Terminal"),l.push(b.name))});_.remove(f,function(a){return-1!==l.indexOf(a.name)});l=[]}),0!==f.length&&(_.forEach(d.fillEnergy.containerTasks,function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy",
"fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(p.objectsClosestToObj(f,a.object),function(d){if(a.canAssign(d)&&(d.say("Container"),l.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(f,function(a){return-1!==l.indexOf(a.name)}),l=[])}),0!==f.length&&_.forEach(f,function(b){(0<_.sum(b.carry)?new a(b.memory.supportRoom):new a(b.memory.home)).canAssign(b)}))))))};Memory.profiling&&c(1,22).registerObject(f,
"RoleRemoteCollector");m.exports=f;return m.exports};r[23]=function(m,f){var g=c(3,23),p=c(9,23),e=c(49,23);f=function(){};f.checkSpawnSettings=function(a,b){var d=a.room;a=a=d.unobservable||"cleanup"!==a.type?1:Math.min(d.find(FIND_STRUCTURES).length,8);if(!b)return{name:"remoteDismantler",spawn:!1,max:a};b=g.creeps[d.name];return{name:"remoteDismantler",spawn:_.filter(b&&b.remoteDismantler||[],function(a){return a.spawning||300<=a.ticksToLive}).length<a,spawnFromRegion:!0,max:a}};f.spawnSettings=
function(a){var b=Math.floor(Math.min(a.energyCapacityAvailable,3750)/150),d=[];d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(b).fill(WORK))));d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(b).fill(MOVE))));return{body:d,memory:{role:"remoteDismantler",home:a.home,supportRoom:a.supportRoom}}};f.assignTasks=function(a,b){var d=a.name,c=_.filter(p.creepsWithNoTask(g.creeps[d]&&g.creeps[d].remoteDismantler||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),
h=[];0!==c.length&&(_.forEach(_.filter(c,function(a){return a.room.name===d}),function(b){0<a.find(FIND_HOSTILE_CONSTRUCTION_SITES).length&&((new e(a.find(FIND_HOSTILE_CONSTRUCTION_SITES)[0].id)).canAssign(b),b.say("Stomping"),h.push(b.name))}),_.remove(c,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==c.length&&(_.forEach(_.filter(c,function(a){return a.room.name===d}),function(a){_.forEach(b.remoteDismantle.cleanupTasks,function(b){if(!(0<_.filter(b.structure.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&
"dismantle"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Dismantle"),h.push(a.name),!1})}),_.remove(c,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==c.length&&_.forEach(c,function(a){(new e(a.memory.home)).canAssign(a)})))};Memory.profiling&&c(1,23).registerObject(f,"RoleRemoteDismantler");m.exports=f;return m.exports};r[24]=function(m,f){var g=c(3,24),p=c(9,24),e=c(47,24),a=c(49,24);f=function(){};f.checkSpawnSettings=function(a,d){var b=
a.room,c=g.containersInRoom(b),e=b.find(FIND_MINERALS),l=[].concat.apply([],[b.find(FIND_SOURCES),e]),n,u,q,f,v,A,m;if(0===c.length||0===l.length)return{name:"remoteMiner",spawn:!1,max:0};if(!d)return{name:"remoteMiner",spawn:!1,max:c.length-_.filter(e,function(a){return 0===a.mineralAmount}).length};n=Memory.lengthToContainer;a=a.supportRoom;q=a.name;f=g.spawnsInRoom(a);u=Memory.containerSource;v=(b=g.creeps[b.name])&&b.remoteMiner||[];_.forEach(c,function(a){var b=a.id,d,c;n[b]||(n[b]={});d=n[b];
d[q]||(d[q]=PathFinder.search(a.pos,{pos:f[0].pos,range:1},{swampCost:1,maxOps:1E5}).path.length);u[b]||(u[b]=p.objectsClosestToObj(l,a)[0].id);a=Game.getObjectById(u[b]);c=a instanceof Mineral;if((!c||0!==a.mineralAmount)&&0===_.filter(v,function(a){return(a.spawning||a.ticksToLive>=150+3*d[q])&&a.memory.container===b}).length)return A=b,m=c,!1});return{name:"remoteMiner",spawn:!!A,max:c.length-_.filter(e,function(a){return 0===a.mineralAmount}).length,spawnFromRegion:!0,containerIdToMineOn:A,isMineralHarvester:m}};
f.spawnSettings=function(a){var b=[];if(a.isMineralHarvester){var c=Math.min(a.energyCapacityAvailable,4500),h=Math.floor(c/450),c=c%450;b.push.apply(b,[].concat($jscomp.arrayFromIterable(Array(h+(150<=c?1:0)).fill(MOVE))));b.push.apply(b,[].concat($jscomp.arrayFromIterable(Array(4*h+(150<=c?1:0)+(250<=c?1:0)+(350<=c?1:0)).fill(WORK))))}else b=a.isSourceRoom?[MOVE,MOVE,MOVE,MOVE,WORK,WORK,WORK,WORK,WORK,WORK,WORK]:[MOVE,MOVE,MOVE,WORK,WORK,WORK,WORK,WORK];return{body:b,memory:{role:"remoteMiner",
home:a.home,supportRoom:a.supportRoom,container:a.containerIdToMineOn}}};f.assignTasks=function(b){var d=b.name,d=p.creepsWithNoTask(g.creeps[d]&&g.creeps[d].remoteMiner||[]),c=[];0!==d.length&&(b.unobservable||_.forEach(d,function(a){(new e).canAssign(a)&&(a.say("Mining"),c.push(a.name))}),_.remove(d,function(a){return-1!==c.indexOf(a.name)}),c=[],0!==d.length&&_.forEach(d,function(b){(new a(b.memory.home)).canAssign(b)}))};Memory.profiling&&c(1,24).registerObject(f,"RoleRemoteMiner");m.exports=
f;return m.exports};r[25]=function(m,f){var g=c(3,25),p=c(4,25),e=c(9,25),a=c(49,25),b=c(52,25);f=function(){};f.checkSpawnSettings=function(a,b){var d=a.room,c=d.controller,e,k,u;if(!c)return{name:"remoteReserver",spawn:!1,max:0};if(!b)return{name:"remoteReserver",spawn:!1,max:1};if((b=c.reservation)&&4E3<=b.ticksToEnd)return{name:"remoteReserver",spawn:!1,max:0};b=Memory.lengthToController;e=c.id;a=a.supportRoom;k=a.name;d=g.creeps[d.name];b[e]||(b[e]={});u=b[e];u[k]||(u[k]=PathFinder.search(c.pos,
{pos:g.spawnsInRoom(a)[0].pos,range:1},{swampCost:1,maxOps:1E5}).path.length);return{name:"remoteReserver",spawn:1>_.filter(d&&d.remoteReserver||[],function(a){return a.spawning||a.ticksToLive>u[k]}).length,max:0,spawnFromRegion:!0}};f.spawnSettings=function(a){var b=Math.floor(Math.min(a.energyCapacityAvailable,3250)/650),d=[];d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(b).fill(CLAIM))));d.push.apply(d,[].concat($jscomp.arrayFromIterable(Array(b).fill(MOVE))));return{body:d,memory:{role:"remoteReserver",
home:a.home,supportRoom:a.supportRoom}}};f.assignTasks=function(d){var c=d.name,c=e.creepsWithNoTask(g.creeps[c]&&g.creeps[c].remoteReserver||[]),h=[];0!==c.length&&(d.unobservable||_.forEach(c,function(a){a.room.name===a.memory.home&&a.room.controller.my&&(h.push(a.name),p.setRoomType(a.room,{type:"base"}),a.suicide())}),_.remove(c,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==c.length&&(d&&!d.unobservable&&d.controller&&_.forEach(c,function(a){b.getRemoteTask(a).canAssign(a)&&(a.say("Reserving"),
h.push(a.name))}),_.remove(c,function(a){return-1!==h.indexOf(a.name)}),h=[],0!==c.length&&_.forEach(c,function(b){(new a(b.memory.home)).canAssign(b)})))};Memory.profiling&&c(1,25).registerObject(f,"RoleRemoteReserver");m.exports=f;return m.exports};r[26]=function(m,f){var g=c(3,26),p=c(9,26),e=c(38,26),a=c(39,26),b=c(48,26),d=c(49,26);f=function(){};f.checkSpawnSettings=function(a,b){var d=a.room,c=g.containersInRoom(d),h=0,e,k,f,v,A,m,r,t;if(0===c.length)return{name:"remoteStorer",spawn:!1,max:0};
e=Memory.containerSource;k=[].concat.apply([],[d.find(FIND_SOURCES),d.find(FIND_MINERALS)]);f=!1;v=Memory.lengthToContainer;a=a.supportRoom;A=a.name;m=a.controller.level;r=(d=g.creeps[d.name])&&d.remoteStorer;_.forEach(c,function(a){var d=0,c=a.id,g;e[c]||(e[c]=p.objectsClosestToObj(k,a)[0].id);a=Game.getObjectById(e[c]);if(a instanceof Mineral){if(0===a.mineralAmount)return}else f||(d=-1,f=!0);g=v[c]?v[c][A]:0;d+=Math.max(Math.ceil(g/[18,18,18,18,30,44,54,62,62][m]),0);h+=d;b&&!t&&_.filter(r||[],
function(a){return(a.spawning||a.ticksToLive>=150+2*g)&&a.memory.container===c}).length<d&&(t=c)});return b?{name:"remoteStorer",spawn:!!t,max:h,spawnFromRegion:!0,containerIdToCollectFrom:t,supportRoomRcl:m}:{name:"remoteStorer",spawn:!1,max:h}};f.spawnSettings=function(a){var b;switch(a.supportRoomRcl){case 3:b=[MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 4:b=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,
CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 5:b=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 6:b=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,
CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;case 7:case 8:b=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY]}return{body:b,memory:{role:"remoteStorer",home:a.home,supportRoom:a.supportRoom,container:a.containerIdToCollectFrom}}};f.assignTasks=function(c,h){var k=c.name,l=p.creepsWithNoTask(g.creeps[k]&&
g.creeps[k].remoteStorer||[]),n=[];0!==l.length&&(_.forEach(l,function(a){_.forEach(b.getTasks(a.room),function(b){if(!(_.sum(g.creeps[c.name]&&g.creeps[c.name].all||[],function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id?a.carryCapacity-_.sum(a.carry):0})>=b.resource.amount)&&b.canAssign(a))return a.say("Pickup"),n.push(a.name),!1})}),_.remove(l,function(a){return-1!==n.indexOf(a.name)}),n=[],0!==l.length&&(_.forEach(h.fillEnergy.storageTasks,
function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(l,function(d){if(a.canAssign(d)&&(d.say("Storage"),n.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(l,function(a){return-1!==n.indexOf(a.name)}),n=[])}),0!==l.length&&(_.forEach(h.fillMinerals.storageTasks,
function(a){_.forEach(l,function(b){a.canAssign(b)&&(b.say("Storage"),n.push(b.name))});_.remove(l,function(a){return-1!==n.indexOf(a.name)});n=[]}),0!==l.length&&(_.forEach(h.fillMinerals.terminalTasks,function(a){_.forEach(l,function(b){a.canAssign(b)&&(b.say("Terminal"),n.push(b.name))});_.remove(l,function(a){return-1!==n.indexOf(a.name)});n=[]}),0!==l.length&&(_.forEach(h.fillEnergy.containerTasks,function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),
function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(l,function(d){if(a.canAssign(d)&&(d.say("Container"),n.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(l,function(a){return-1!==n.indexOf(a.name)}),n=[])}),0!==l.length&&(c.unobservable||_.forEach(l,function(b){var d=Game.getObjectById(b.memory.container),c;d&&(d.store[RESOURCE_ENERGY]?c=new e(b.memory.container):
0<_.sum(d.store)&&(c=new a(b.memory.container)),c&&c.canAssign(b)&&(b.say("Collecting"),n.push(b.name)))}),_.remove(l,function(a){return-1!==n.indexOf(a.name)}),n=[],0!==l.length&&_.forEach(l,function(a){(0<_.sum(a.carry)?new d(a.memory.supportRoom):new d(a.memory.home)).canAssign(a)})))))))};Memory.profiling&&c(1,26).registerObject(f,"RoleRemoteStorer");m.exports=f;return m.exports};r[27]=function(m,f){var g=c(3,27),p=c(9,27),e=c(36,27),a=c(38,27),b=c(44,27),d=c(48,27),k=c(49,27),h=c(51,27);f=function(){};
f.checkSpawnSettings=function(a,b){var d=a.room,c=g.containersInRoom(d),h=!1,e,k,l,f,x;if(0===c.length)return{name:"remoteWorker",spawn:!1,max:0};if(!b)return{name:"remoteWorker",spawn:!1,max:1};e=[].concat.apply([],[d.find(FIND_SOURCES),d.find(FIND_MINERALS)]);k=Memory.lengthToContainer;l=(b=g.creeps[d.name])&&b.remoteWorker||[];f=a.supportRoom.name;_.forEach(c,function(a){var b=p.objectsClosestToObj(e,a)[0],d=a.id,c=k[d];if(!(b instanceof Mineral))return 0===_.filter(l,function(a){return(a.spawning||
a.ticksToLive>=150+2*(c&&c[f]?c[f]:0))&&a.memory.container===d}).length&&(x=d,h=!0),!1});return{name:"remoteWorker",spawn:h,max:1,spawnFromRegion:!0,containerIdToCollectFrom:x}};f.spawnSettings=function(a){var b=Math.min(a.energyCapacityAvailable,3E3),d=Math.floor(Math.min(b,2E3)/200),c=Math.floor(Math.max(b-2E3,0)/150),h=Math.min(b,2E3)%200,b=Math.max(b-2E3,0)%150,e=[];e.push.apply(e,[].concat($jscomp.arrayFromIterable(Array(d+(150<=h?1:0)).fill(WORK))));e.push.apply(e,[].concat($jscomp.arrayFromIterable(Array(d+
2*c+(100<=h&&150>h?1:0)+(100<b?1:0)).fill(CARRY))));e.push.apply(e,[].concat($jscomp.arrayFromIterable(Array(d+c+(50<=h?1:0)+(50<=b?1:0)).fill(MOVE))));return{body:e,memory:{role:"remoteWorker",home:a.home,supportRoom:a.supportRoom,container:a.containerIdToCollectFrom}}};f.assignTasks=function(c,l){var n=c.name,f=_.filter(p.creepsWithNoTask(g.creeps[n]&&g.creeps[n].remoteWorker||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),q=[];0!==f.length&&(_.forEach(f,function(a){var b=
_.filter(a.room.find(FIND_MY_CONSTRUCTION_SITES),function(a){return 1===a.progressTotal});0<b.length&&(new e(b[0].id)).canAssign(a)&&(a.say("Build"),q.push(a.name))}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[],0!==f.length&&(_.forEach(f,function(a){_.forEach(h.getCriticalTasks(a.room),function(b){if(0===_.filter(b.structure.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"repair"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length&&b.canAssign(a))return a.say("CritRepair"),
q.push(a.name),!1})}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[],0!==f.length&&(_.forEach(f,function(a){var b=a.room.find(FIND_MY_CONSTRUCTION_SITES);0<b.length&&(new e(b[0].id)).canAssign(a)&&(a.say("Build"),q.push(a.name))}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[],0!==f.length&&(_.forEach([].concat.apply([],[l.fillEnergy.storageTasks,l.fillEnergy.containerTasks]),function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),
function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(p.objectsClosestToObj(f,a.object),function(d){if(a.canAssign(d)&&(d.say("Container"),q.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[])}),0!==f.length&&(_.forEach(l.fillMinerals.storageTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&
(b.say("Storage"),q.push(b.name))});_.remove(f,function(a){return-1!==q.indexOf(a.name)});q=[]}),0!==f.length&&(_.forEach(l.fillMinerals.terminalTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("Terminal"),q.push(b.name))});_.remove(f,function(a){return-1!==q.indexOf(a.name)});q=[]}),0!==f.length&&(_.forEach(f,function(a){a.room.name===c.name&&_.forEach(d.getTasks(a.room),function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===
a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Pickup"),q.push(a.name),!1})}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[],0!==f.length&&(c.unobservable||_.forEach(f,function(b){(new a(b.memory.container)).canAssign(b)&&(b.say("Collecting"),q.push(b.name))}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[],0!==f.length&&(c.unobservable||_.forEach(f,function(a){var d=new b,h=p.objectsClosestToObj(_.filter(c.find(FIND_SOURCES),
function(a){return 0<a.energy}),a);if(0===h.length)return!1;a.memory.homeSource=h[0].id;d.canAssign(a)&&(a.say("Harvesting"),q.push(a.name))}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[],0!==f.length&&_.forEach(f,function(a){(new k(a.memory.home)).canAssign(a)}))))))))))};Memory.profiling&&c(1,27).registerObject(f,"RoleRemoteWorker");m.exports=f;return m.exports};r[28]=function(m,f){var g=c(3,28),p=c(9,28),e=c(48,28),a=c(49,28);f=function(){};f.checkSpawnSettings=function(a,d){if(!d)return{name:"scientist",
spawn:!1,max:1};a=g.creeps[a.room.name];return{name:"scientist",spawn:1>_.filter(a&&a.scientist||[],function(a){return a.spawning||150<=a.ticksToLive}).length,max:1}};f.spawnSettings=function(a){var b=Math.min(a.energyCapacityAvailable,2500),c=Math.floor(b/150),b=b%150,h=[];h.push.apply(h,[].concat($jscomp.arrayFromIterable(Array(2*c+(100<=b?1:0)).fill(CARRY))));h.push.apply(h,[].concat($jscomp.arrayFromIterable(Array(c+(50<=b?1:0)).fill(MOVE))));return{body:h,memory:{role:"scientist",home:a.home}}};
f.assignTasks=function(b,d){var c=b.name,h=_.filter(p.creepsWithNoTask(g.creeps[c]&&g.creeps[c].scientist||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),f=g.creeps[c]&&g.creeps[c].all||[],l=[];0!==h.length&&(_.forEach(d.fillEnergy.towerTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(f,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||
0)},0);0<b&&(_.forEach(p.objectsClosestToObj(h,a.object),function(d){if(a.canAssign(d)&&(d.say("Tower"),l.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(h,function(a){return-1!==l.indexOf(a.name)}),l=[])}),0!==h.length&&(_.forEach(d.collectMinerals.labTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Collecting"),l.push(b.name))});_.remove(h,function(a){return-1!==l.indexOf(a.name)});l=[]}),0!==h.length&&(_.forEach(d.fillMinerals.labTasks,function(a){_.forEach(h,
function(b){a.canAssign(b)&&(b.say("Lab"),l.push(b.name))});_.remove(h,function(a){return-1!==l.indexOf(a.name)});l=[]}),0!==h.length&&(_.forEach(d.fillMinerals.nukerTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("NukeG"),l.push(b.name))});_.remove(h,function(a){return-1!==l.indexOf(a.name)});l=[]}),0!==h.length&&(_.forEach(d.fillMinerals.powerSpawnTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("powerPower"),l.push(b.name))});_.remove(h,function(a){return-1!==l.indexOf(a.name)});
l=[]}),0!==h.length&&(_.forEach(d.fillMinerals.storageTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Storage"),l.push(b.name))});_.remove(h,function(a){return-1!==l.indexOf(a.name)});l=[]}),0!==h.length&&(_.forEach(d.fillMinerals.terminalTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Terminal"),l.push(b.name))});_.remove(h,function(a){return-1!==l.indexOf(a.name)});l=[]}),0!==h.length&&(_.forEach(d.fillEnergy.labTasks,function(a){var b=a.object.energyCapacity-
a.object.energy-_.reduce(_.filter(f,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(p.objectsClosestToObj(h,a.object),function(d){if(a.canAssign(d)&&(d.say("LabEnergy"),l.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(h,function(a){return-1!==l.indexOf(a.name)}),l=[])}),0!==h.length&&(d.fillEnergy.terminalTask&&(_.forEach(h,function(a){d.fillEnergy.terminalTask.canAssign(a)&&
(a.say("Terminal"),l.push(a.name))}),_.remove(h,function(a){return-1!==l.indexOf(a.name)}),l=[]),0!==h.length&&(_.forEach(d.fillEnergy.nukerTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(f,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(p.objectsClosestToObj(h,a.object),function(d){if(a.canAssign(d)&&(d.say("NukeEnergy"),l.push(d.name),
b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(h,function(a){return-1!==l.indexOf(a.name)}),l=[])}),0!==h.length&&(b.storage&&25E3<b.storage.store[RESOURCE_ENERGY]&&_.forEach(d.fillEnergy.powerSpawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(f,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(p.objectsClosestToObj(h,
a.object),function(d){if(a.canAssign(d)&&(d.say("PwrEnergy"),l.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(h,function(a){return-1!==l.indexOf(a.name)}),l=[])}),0!==h.length&&(_.forEach(h,function(a){a.carry[RESOURCE_ENERGY]<(8===b.controller.level?200:7===b.controller.level?100:50)||_.forEach(d.fillEnergy.extensionTasks.sort(function(b,d){return b.object.pos.getRangeTo(a)-d.object.pos.getRangeTo(a)}),function(b){if(0<b.object.energyCapacity-b.object.energy-_.reduce(_.filter(f,
function(a){return a.memory.currentTask&&"fillEnergy"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0)&&b.canAssign(a))return a.say("Extension"),l.push(a.name),!1})}),_.remove(h,function(a){return-1!==l.indexOf(a.name)}),l=[],0!==h.length&&(_.forEach(d.fillEnergy.spawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(f,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&
b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(p.objectsClosestToObj(h,a.object),function(d){if(a.canAssign(d)&&(d.say("Spawn"),l.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(h,function(a){return-1!==l.indexOf(a.name)}),l=[])}),0!==h.length&&(_.forEach(d.fillEnergy.storageTasks,function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&
["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(p.objectsClosestToObj(h,a.object),function(d){if(!d.memory.lastCollectEnergyWasStorage&&a.canAssign(d)&&(d.say("Storage"),l.push(d.name),b-=_.sum(d.carry),0>=b))return!1}),_.remove(h,function(a){return-1!==l.indexOf(a.name)}),l=[])}),0!==h.length&&(_.forEach(d.collectMinerals.terminalTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Collecting"),
l.push(b.name))});_.remove(h,function(a){return-1!==l.indexOf(a.name)});l=[]}),0!==h.length&&(_.forEach(d.collectMinerals.storageTasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Collecting"),l.push(b.name))});_.remove(h,function(a){return-1!==l.indexOf(a.name)});l=[]}),0!==h.length&&(0===g.hostilesInRoom(b).length&&_.forEach(h,function(a){_.forEach(e.getTasks(a.room),function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===
a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Pickup"),l.push(a.name),!1})}),_.remove(h,function(a){return-1!==l.indexOf(a.name)}),l=[],0!==h.length&&(d.collectEnergy.terminalTask&&(_.forEach(h,function(a){d.collectEnergy.terminalTask.canAssign(a)&&(a.say("Collecting"),l.push(a.name))}),_.remove(h,function(a){return-1!==l.indexOf(a.name)}),l=[]),_.forEach(d.collectEnergy.tasks,function(a){_.forEach(h,function(b){a.canAssign(b)&&(b.say("Collecting"),
l.push(b.name))});_.remove(h,function(a){return-1!==l.indexOf(a.name)});l=[]}),0!==h.length&&b.terminal&&_.forEach(h,function(d){d=new a(b.terminal.id,d);d.canAssign(d.creep)})))))))))))))))))))};Memory.profiling&&c(1,28).registerObject(f,"RoleScientist");m.exports=f;return m.exports};r[29]=function(m,f){var g=c(3,29),p=c(9,29),e=c(49,29);f=function(){};f.checkSpawnSettings=function(a,b){var d=a.room;a=g.containersInRoom(d);var c=0,h=0,e,l,f,u,q,w,v;if(0===a.length||!d.storage||!d.storage.my)return{name:"storer",
spawn:!1,max:0};e=Memory.containerSource;l=[].concat.apply([],[d.find(FIND_SOURCES),d.find(FIND_MINERALS)]);f=Memory.lengthToStorage;u=d.controller;q=u.level;w=Memory.army;v=(v=g.creeps[d.name])&&v.storer||[];_.forEach(a,function(a){var b=a.id;e[b]||(e[b]=p.objectsClosestToObj(l,a)[0].id);b=Game.getObjectById(e[b]);b instanceof Mineral?0<b.mineralAmount&&(h+=1):(f[a.id]||(f[a.id]=PathFinder.search(a.pos,{pos:d.storage.pos,range:1},{swampCost:1}).path.length),c+=f[a.id])});h+=Math.ceil(2*c/(u&&8===
q?35:30))+(7<=q&&w&&0<_.filter(w,function(a){return a.region===d.memory.region&&"building"===a.directive}).length?1:0);return b?{name:"storer",spawn:_.filter(v,function(a){return a.spawning||300<=a.ticksToLive}).length<h,max:h,rcl:q}:{name:"storer",spawn:!1,max:h}};f.spawnSettings=function(a){var b;switch(a.rcl){case 7:b=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;
case 8:b=[MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY];break;default:b=[MOVE,MOVE,MOVE,MOVE,MOVE,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY,CARRY]}return{body:b,memory:{role:"storer",home:a.home}}};f.assignTasks=function(a,b){var d=a.name,c=_.filter(p.creepsWithNoTask(g.creeps[d]&&
g.creeps[d].storer||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),h=g.creeps[d]&&g.creeps[d].all||[],f=[];0!==c.length&&(_.forEach(b.fillEnergy.linkTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(h,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(p.objectsClosestToObj(c,a.object),function(d){if(a.canAssign(d)&&
(d.say("Link"),f.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(c,function(a){return-1!==f.indexOf(a.name)}),f=[])}),0!==c.length&&(_.forEach(c,function(d){d.carry[RESOURCE_ENERGY]<(8===a.controller.level?200:7===a.controller.level?100:50)||_.forEach(b.fillEnergy.extensionTasks.sort(function(a,b){return a.object.pos.getRangeTo(d)-b.object.pos.getRangeTo(d)}),function(a){if(0<a.object.energyCapacity-a.object.energy-_.reduce(_.filter(h,function(b){return b.memory.currentTask&&
"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0)&&a.canAssign(d))return d.say("Extension"),f.push(d.name),!1})}),_.remove(c,function(a){return-1!==f.indexOf(a.name)}),f=[],0!==c.length&&(_.forEach(b.fillEnergy.spawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(h,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,
b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(p.objectsClosestToObj(c,a.object),function(d){if(a.canAssign(d)&&(d.say("Spawn"),f.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(c,function(a){return-1!==f.indexOf(a.name)}),f=[])}),0!==c.length&&(b.fillEnergy.terminalTask&&(_.forEach(c,function(a){b.fillEnergy.terminalTask.canAssign(a)&&(a.say("Terminal"),f.push(a.name))}),_.remove(c,function(a){return-1!==f.indexOf(a.name)}),f=[]),0!==c.length&&(_.forEach(b.fillEnergy.storageTasks,
function(b){var d=b.object.storeCapacity-_.sum(b.object.store)-_.reduce(_.filter(b.object.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(a.memory.currentTask.type)&&a.memory.currentTask.id===b.id}),function(a,b){return a+_.sum(b.carry)},0);0<d&&(_.forEach(p.objectsClosestToObj(c,b.object),function(c){if((!a.terminal||!c.memory.lastCollectEnergyWasStorage)&&b.canAssign(c)&&(c.say("Storage"),f.push(c.name),d-=_.sum(c.carry),0>=d))return!1}),
_.remove(c,function(a){return-1!==f.indexOf(a.name)}),f=[])}),0!==c.length&&(_.forEach(b.fillMinerals.storageTasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&(b.say("Storage"),f.push(b.name))});_.remove(c,function(a){return-1!==f.indexOf(a.name)});f=[]}),0!==c.length&&(_.forEach(b.fillMinerals.terminalTasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&(b.say("Terminal"),f.push(b.name))});_.remove(c,function(a){return-1!==f.indexOf(a.name)});f=[]}),0!==c.length&&(_.forEach([].concat.apply([],
[b.collectEnergy.storerTasks,b.collectMinerals.storerTasks]).sort(function(a,b){return(b.object.energy||_.sum(b.object.store)||0)-(a.object.energy||_.sum(a.object.store)||0)}),function(a){if(a.object.energy||_.sum(a.object.store)){var b=(a.object.energy||_.sum(a.object.store)||0)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&b.memory.currentTask.type===a.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carryCapacity-_.sum(b.carry))},
0);500<=b&&(_.forEach(c,function(d){d.memory.lastCollectEnergyWasStorage=!1;if(a.canAssign(d)&&(d.say("Collecting"),f.push(d.name),b-=d.carryCapacity-_.sum(d.carry),500>b))return!1}),_.remove(c,function(a){return-1!==f.indexOf(a.name)}),f=[])}}),0!==c.length&&(b.collectEnergy.terminalTask&&(_.forEach(c,function(a){b.collectEnergy.terminalTask.canAssign(a)&&(a.say("Collecting"),f.push(a.name),a.memory.lastCollectEnergyWasStorage=!1)}),_.remove(c,function(a){return-1!==f.indexOf(a.name)}),f=[]),0!==
c.length&&(_.forEach(b.collectEnergy.tasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&(b.say("Collecting"),f.push(b.name),a.object.structureType===STRUCTURE_STORAGE&&(b.memory.lastCollectEnergyWasStorage=!0))});_.remove(c,function(a){return-1!==f.indexOf(a.name)});f=[]}),0!==c.length&&_.forEach(c,function(a){var b=new e(a.room.terminal?a.room.terminal.id:a.room.name);b.range=0;b.canAssign(a)})))))))))))};Memory.profiling&&c(1,29).registerObject(f,"RoleStorer");m.exports=f;return m.exports};
r[30]=function(m,f){var g=c(3,30),p=c(9,30),e=c(38,30),a=c(44,30),b=c(48,30),d=c(49,30);f=function(){};f.checkSpawnSettings=function(a,b){var d=a.room;a=d.name;var c=d.storage,h=c?c.store[RESOURCE_ENERGY]:0,e,k,f;e=a===Memory.rushRoom?1:!c||h<Memory.upgradeEnergy?0:1;if(!b)return{name:"upgrader",spawn:!1,max:e};b=d.controller;k=g.creeps[a];0<e&&(b&&8>b.level&&c&&9E5<h||_.filter(k&&k.upgrader||[],function(a){return a.spawning||150<=a.ticksToLive}).length<e)&&(f=a);f||_.forEach(_.filter(Game.rooms,
function(a){var b=a.memory,c=b.roomType,h=a.controller;return b&&c&&"base"===c.type&&b.region===d.memory.region&&a.name!==d.name&&h&&7>h.level}),function(a){a=a.name;var b=g.creeps[a];if(0===_.filter(b&&b.upgrader||[],function(a){a=a.memory;return a.supportRoom!==a.home}).length)return f=a,!1});return{name:"upgrader",spawn:!!f,max:e,spawnFromRegion:6>b.level,spawnForRoom:f}};f.spawnSettings=function(a){var b=Game.rooms[a.home],d=g.linksInRoom(b),c=b.controller,e=b.energyCapacityAvailable,k=b.storage,
f=k.store,w=g.spawnsInRoom(b),v=[],m={};2<=d&&2>=p.objectsClosestToObj(d,c)[0].pos.getRangeTo(c)?(e=Math.min(e,8===c.level?1950:4100),c=Math.ceil(e/3200),d=Math.floor((e-50*c)/250),e=(e-50*c)%250,v.push.apply(v,[].concat($jscomp.arrayFromIterable(Array(2*d+(150<=e?1:0)).fill(WORK)))),v.push.apply(v,[].concat($jscomp.arrayFromIterable(Array(c).fill(CARRY))))):(e=Math.min(e,8===c.level?3E3:3300),d=Math.floor(e/200),e%=200,v.push.apply(v,[].concat($jscomp.arrayFromIterable(Array(d+(150<=e?1:0)).fill(WORK)))),
v.push.apply(v,[].concat($jscomp.arrayFromIterable(Array(d+(100<=e&&150>e?1:0)).fill(CARRY)))));v.push.apply(v,[].concat($jscomp.arrayFromIterable(Array(d+(50<=e?1:0)).fill(MOVE))));k&&0<g.labsInRoom(b).length&&(f[RESOURCE_CATALYZED_LEMERGIUM_ACID]>=30*d?m[RESOURCE_CATALYZED_LEMERGIUM_ACID]=d:f[RESOURCE_LEMERGIUM_ACID]>=30*d?m[RESOURCE_LEMERGIUM_ACID]=d:f[RESOURCE_CATALYZED_LEMERGIUM_ACID]>=30*d&&(m[RESOURCE_LEMERGIUM_HYDRIDE]=d));return{body:v,boosts:m,memory:{role:"upgrader",home:a.home,supportRoom:a.supportRoom,
homeSource:w?p.objectsClosestToObj(b.find(FIND_SOURCES),w[0])[0].id:b.find(FIND_SOURCES)[0]}}};f.assignTasks=function(c,h){var k=c.name,f=_.filter(p.creepsWithNoTask(g.creeps[k]&&g.creeps[k].upgrader||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),n=[],m=c.controller;if(0!==f.length&&(_.forEach(_.filter(f,function(a){return a.memory.labs&&0<a.memory.labs.length}),function(a){(new d(a.memory.labs[0])).canAssign(a);n.push(a.name)}),_.remove(f,function(a){return-1!==n.indexOf(a.name)}),
n=[],0!==f.length&&(_.forEach(h.upgradeController.tasks,function(a){_.forEach(p.objectsClosestToObj(f,m),function(b){a.canAssign(b)&&(b.say("Controller"),n.push(b.name))});_.remove(f,function(a){return-1!==n.indexOf(a.name)});n=[]}),0!==f.length&&(_.forEach(f,function(a){var b=p.objectsClosestToObj(g.linksInRoom(c),m);0<b.length&&0<b[0].energy&&(b=new e(b[0].id),b.canAssign(a)&&(a.say("Collecting"),n.push(a.name)))}),_.remove(f,function(a){return-1!==n.indexOf(a.name)}),n=[],0!==f.length)))){if(!m||
6>m.level)if(0===g.hostilesInRoom(c).length&&_.forEach(f,function(a){_.forEach(b.getTasks(a.room),function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Pickup"),n.push(a.name),!1})}),_.remove(f,function(a){return-1!==n.indexOf(a.name)}),n=[],0===f.length)return;_.forEach(h.collectEnergy.tasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&
(b.say("Collecting"),n.push(b.name))});_.remove(f,function(a){return-1!==n.indexOf(a.name)});n=[]});if(0!==f.length){if(0===_.filter(g.containersInRoom(c),function(a){return 0<a.energy}).length&&!c.storage&&(_.forEach(f,function(b){(new a).canAssign(b)&&(b.say("Harvesting"),n.push(b.name))}),_.remove(f,function(a){return-1!==n.indexOf(a.name)}),n=[],0===f.length))return;_.forEach(f,function(a){(new d(a.memory.home)).canAssign(a)})}}};Memory.profiling&&c(1,30).registerObject(f,"RoleUpgrader");m.exports=
f;return m.exports};r[31]=function(m,f){var g=c(3,31),p=c(9,31),e=c(44,31),a=c(48,31),b=c(49,31);f=function(){};f.checkSpawnSettings=function(a,b){var d=a.room,c=d.storage;a=c&&c.my?1:2;var e,k;if(!b)return{name:"worker",spawn:!1,max:a};e=d.name;b=g.creeps[e];0<a&&_.filter(b&&b.worker||[],function(a){return a.spawning||a.ticksToLive>=(c&&c.my?150:300)}).length<a&&(k=d.name);k||_.forEach(_.filter(Game.rooms,function(a){var b=a.memory,c=b.roomType,h=a.controller;return b&&c&&"base"===c.type&&b.region===
d.memory.region&&a.name!==e&&h&&6>h.level}),function(a){var b=a.name;a=g.creeps[a.name];0===_.filter(a&&a.worker||[],function(a){a=a.memory;return a.supportRoom!==a.home}).length&&(k=b)});return{name:"worker",spawn:!!k,max:a,spawnFromRegion:6>d.controller.level,roomToSpawnFor:k}};f.spawnSettings=function(a){var b=Game.rooms[a.home],d=Math.min(b.energyCapacityAvailable,3300),c=Math.floor(d/200),d=d%200,e;e=b.storage;var f=e.store,m=g.spawnsInRoom(b),q=[],w={};q.push.apply(q,[].concat($jscomp.arrayFromIterable(Array(c+
(150<=d?1:0)).fill(WORK))));q.push.apply(q,[].concat($jscomp.arrayFromIterable(Array(c+(100<=d&&150>d?1:0)).fill(CARRY))));q.push.apply(q,[].concat($jscomp.arrayFromIterable(Array(c+(50<=d?1:0)).fill(MOVE))));e&&0<g.labsInRoom(b).length&&(f[RESOURCE_CATALYZED_LEMERGIUM_ACID]>=30*c?w[RESOURCE_CATALYZED_LEMERGIUM_ACID]=c:f[RESOURCE_LEMERGIUM_ACID]>=30*c?w[RESOURCE_LEMERGIUM_ACID]=c:f[RESOURCE_CATALYZED_LEMERGIUM_ACID]>=30*c&&(w[RESOURCE_LEMERGIUM_HYDRIDE]=c));return{body:q,boosts:w,memory:{role:"worker",
home:a.home,supportRoom:a.supportRoom,homeSource:m?p.objectsClosestToObj(b.find(FIND_SOURCES),m[0])[0].id:b.find(FIND_SOURCES)[0]}}};f.assignTasks=function(d,c){var h=d.name,k=g.creeps[h]&&g.creeps[h].worker||[],f=_.filter(p.creepsWithNoTask(k),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),n=g.creeps[h]&&g.creeps[h].all||[],h=g.creeps[h]&&g.creeps[h].storer||[],m=d.controller,q=[];if(0!==f.length&&(_.forEach(_.filter(f,function(a){return a.memory.labs&&0<a.memory.labs.length}),
function(a){var d=_.filter(Memory.rooms[a.memory.supportRoom].labsInUse,function(b){return b.id===a.memory.labs[0]})[0];d&&Game.getObjectById(a.memory.labs[0]).mineralType===d.resource&&Game.getObjectById(a.memory.labs[0]).mineralAmount>=d.amount&&((new b(a.memory.labs[0])).canAssign(a),q.push(a.name))}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[],0!==f.length&&(_.forEach(c.fillMinerals.storageTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("Storage"),q.push(b.name))});
_.remove(f,function(a){return-1!==q.indexOf(a.name)});q=[]}),0!==f.length&&(_.forEach(c.fillMinerals.terminalTasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("Terminal"),q.push(b.name))});_.remove(f,function(a){return-1!==q.indexOf(a.name)});q=[]}),0!==f.length&&(_.forEach(c.upgradeController.criticalTasks,function(a){0===_.filter(k,function(b){return b.memory.currentTask&&"upgradeController"===b.memory.currentTask.type&&b.memory.currentTask.room===a.room}).length&&(_.forEach(p.objectsClosestToObj(f,
m),function(b){if(a.canAssign(b))return b.say("CritCntrlr"),q.push(b.name),!1}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[])}),0!==f.length))))){if(!d.storage||0===h.length)if(_.forEach(f,function(a){a.carry[RESOURCE_ENERGY]<(8===d.controller.level?200:7===d.controller.level?100:50)||_.forEach(c.fillEnergy.extensionTasks.sort(function(b,d){return b.object.pos.getRangeTo(a)-d.object.pos.getRangeTo(a)}),function(b){if(0<b.object.energyCapacity-b.object.energy-_.reduce(_.filter(n,function(a){return a.memory.currentTask&&
"fillEnergy"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0)&&b.canAssign(a))return a.say("Extension"),q.push(a.name),!1})}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[],0===f.length)return;d.storage&&0!==h.length||_.forEach(c.fillEnergy.spawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(n,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===
a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(p.objectsClosestToObj(f,a.object),function(d){if(a.canAssign(d)&&(d.say("Spawn"),q.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[])});if(0!==f.length&&(_.forEach(c.fillEnergy.towerTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(n,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===
a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(p.objectsClosestToObj(f,a.object),function(d){if(a.canAssign(d)&&(d.say("Tower"),q.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[])}),0!==f.length&&(_.forEach(_.filter(c.build.tasks,function(a){return 1===a.constructionSite.progressTotal}),function(a){var b=a.constructionSite.progressTotal-a.constructionSite.progress-_.reduce(_.filter(a.constructionSite.room.find(FIND_MY_CREEPS),
function(b){return b.memory.currentTask&&"build"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(p.objectsClosestToObj(f,a.constructionSite),function(d){if(a.canAssign(d)&&(d.say("Build"),q.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[])}),0!==f.length&&(_.forEach(c.repair.criticalTasks,function(a){_.forEach(p.objectsClosestToObj(f,a.structure),
function(b){if(0===_.filter(a.structure.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"repair"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length&&a.canAssign(b))return b.say("CritRepair"),q.push(b.name),!1});_.remove(f,function(a){return-1!==q.indexOf(a.name)});q=[]}),0!==f.length&&(_.forEach(c.build.tasks,function(a){var b=a.constructionSite.progressTotal-a.constructionSite.progress-_.reduce(_.filter(a.constructionSite.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&
"build"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(p.objectsClosestToObj(f,a.constructionSite),function(d){if(a.canAssign(d)&&(d.say("Build"),q.push(d.name),b-=d.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[])}),0!==f.length&&(_.forEach(c.repair.tasks,function(a){var b=a.structure.hitsMax-a.structure.hits-100*_.reduce(_.filter(a.structure.room.find(FIND_MY_CREEPS),
function(b){return b.memory.currentTask&&"repair"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0),d=!1;if(0<b)return _.forEach(p.objectsClosestToObj(f,a.structure),function(c){if(a.canAssign(c)&&(c.say("Repair"),q.push(c.name),b-=100*(c.carry[RESOURCE_ENERGY]||0),d=!0,0>=b))return!1}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[],d}),0!==f.length)))))){if(m&&8>m.level&&(_.forEach(c.upgradeController.tasks,function(a){_.forEach(p.objectsClosestToObj(f,
d.controller),function(b){a.canAssign(b)&&(b.say("Controller"),q.push(b.name))});_.remove(f,function(a){return-1!==q.indexOf(a.name)});q=[]}),0===f.length))return;if(!m||6>m.level)if(0===g.hostilesInRoom(d).length&&_.forEach(_.filter(f,function(a){return a.room.name===d.name}),function(b){_.forEach(a.getTasks(b.room),function(a){if(!(0<_.filter(a.resource.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&"pickupResource"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}).length)&&
a.canAssign(b))return b.say("Pickup"),q.push(b.name),!1})}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[],0===f.length)return;c.collectEnergy.terminalTask&&(_.forEach(f,function(a){c.collectEnergy.terminalTask.canAssign(a)&&(a.say("Collecting"),q.push(a.name))}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[]);_.forEach(c.collectEnergy.tasks,function(a){_.forEach(f,function(b){a.canAssign(b)&&(b.say("Collecting"),q.push(b.name))});_.remove(f,function(a){return-1!==q.indexOf(a.name)});
q=[]});if(0!==f.length){if(0===_.filter(g.containersInRoom(d),function(a){return 0<a.energy}).length&&!d.storage&&(_.forEach(f,function(a){(new e).canAssign(a)&&(a.say("Harvesting"),q.push(a.name))}),_.remove(f,function(a){return-1!==q.indexOf(a.name)}),q=[],0===f.length))return;_.forEach(b.getHarvesterTasks(f),function(a){a.canAssign(a.creep)})}}}};Memory.profiling&&c(1,31).registerObject(f,"RoleWorker");m.exports=f;return m.exports};r[32]=function(m,f){var g=c(3,32),p=c(4,32),e=c(6,32),a=c(7,32),
b=c(55,32),d=c(8,32),k=c(9,32),h=c(14,32),x=c(15,32),l=c(17,32),n=c(18,32),u=c(20,32),q=c(28,32),w=c(29,32),v=c(30,32),A=c(31,32),r=c(36,32),t=c(38,32),E=c(39,32),F=c(40,32),B=c(42,32),y=c(43,32),L=c(45,32),O=c(50,32),K=c(51,32),M=c(53,32),z=function(a){var d;d=b.call(this)||this;d.type="base";d.room=a;return d};$jscomp.inherits(z,b);z.prototype.run=function(){var a=this.room,b,d,c,e,h,f;a.unobservable?Game.notify("Base Room "+b+" is unobservable, something is wrong!"):(b=a.name,d=g.spawnsInRoom(a),
c=a.terminal,b=a.storage,e=a.memory,h=e.labQueue,f=e.labsInUse,0===Game.time%100&&0<d.length&&this.manage(),this.defend(),0<d.length&&this.transferEnergy(),c&&!c.cooldown&&this.terminal(),d=this.tasks(),this.spawn(d,0<_.filter(Game.spawns,function(a){return!g.spawning[a.id]&&!a.spawning&&a.room.memory.region===e.region}).length),this.assignTasks(d),b&&3<=g.labsInRoom(a).length&&h&&!k.roomLabsArePaused(a)&&this.labQueue(),f&&this.labsInUse(),this.processPower())};z.prototype.manage=function(){var a=
this.room,b=a.controller.level,d=a.find(FIND_MY_CONSTRUCTION_SITES),c=g.spawnsInRoom(a)[0],e=c.pos,h=a.storage,f=a.find(FIND_MINERALS),l=a.name,n;0<(n=[0,5,10,20,30,40,50,60][b-1]-(g.extensionsInRoom(a).length+_.filter(d,function(a){return a.structureType===STRUCTURE_EXTENSION}).length))&&k.buildStructures(a,STRUCTURE_EXTENSION,n,c);3<=b&&0===g.towersInRoom(a).length&&0===_.filter(d,function(a){return a.structureType===STRUCTURE_TOWER}).length&&k.buildStructures(a,STRUCTURE_TOWER,1,c);3<=b&&_.forEach(a.find(FIND_SOURCES),
function(b){b=PathFinder.search(b.pos,{pos:e,range:1},{swampCost:1}).path[0];var c=b.lookFor(LOOK_STRUCTURES),h=b.x,g=b.y;0===_.filter(c,function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&0===_.filter(d,function(a){return a.pos.x===h&&a.pos.y===g&&a.structureType===STRUCTURE_CONTAINER}).length&&(_.forEach(_.filter(c,function(a){return-1!==[STRUCTURE_ROAD,STRUCTURE_WALL].indexOf(a.structureType)}),function(a){a.destroy()}),a.createConstructionSite(h,g,STRUCTURE_CONTAINER))});4<=b&&
!h&&0===_.filter(d,function(a){return a.structureType===STRUCTURE_STORAGE}).length&&k.buildStructures(a,STRUCTURE_STORAGE,1,c);6<=b&&h&&!a.terminal&&0===_.filter(d,function(a){return a.structureType===STRUCTURE_TERMINAL}).length&&k.buildStructures(a,STRUCTURE_TERMINAL,1,h);6<=b&&f.length!==g.extractorsInRoom(a).length&&_.forEach(f,function(b){b=b.pos;var c=b.x,e=b.y;0===_.filter(b.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_EXTRACTOR}).length&&0===_.filter(d,function(a){return a.pos.x===
c&&a.pos.y===e&&a.structureType===STRUCTURE_EXTRACTOR}).length&&a.createConstructionSite(c,e,STRUCTURE_EXTRACTOR)});6<=b&&_.forEach(f,function(b){b=PathFinder.search(b.pos,{pos:e,range:1},{swampCost:1}).path[0];var c=b.lookFor(LOOK_STRUCTURES),h=b.x,g=b.y;0===_.filter(c,function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&0===_.filter(d,function(a){return a.pos.x===h&&a.pos.y===g&&a.structureType===STRUCTURE_CONTAINER}).length&&(_.forEach(_.filter(c,function(a){return-1!==[STRUCTURE_ROAD,
STRUCTURE_WALL].indexOf(a.structureType)}),function(a){a.destroy()}),a.createConstructionSite(h,g,STRUCTURE_CONTAINER))});3<=b&&_.forEach(_.filter(a.find(FIND_MY_STRUCTURES),function(a){return a.structureType===STRUCTURE_SPAWN||a.structureType===STRUCTURE_EXTENSION||a.structureType===STRUCTURE_TOWER||a.structureType===STRUCTURE_STORAGE||a.structureType===STRUCTURE_TERMINAL}),function(b){var c=b.pos.x;b=b.pos.y;_.forEach([new RoomPosition(c-1,b,l),new RoomPosition(c+1,b,l),new RoomPosition(c,b-1,l),
new RoomPosition(c,b+1,l)],function(b){var c=b.x,e=b.y;0===_.filter(b.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_ROAD}).length&&0===_.filter(d,function(a){return a.pos.x===c&&a.pos.y===e&&a.structureType===STRUCTURE_ROAD}).length&&a.createConstructionSite(c,e,STRUCTURE_ROAD)})})};z.prototype.defend=function(){var a=this.room,b=_.filter(g.hostilesInRoom(a),function(a){return a.owner&&"Invader"!==a.owner.username}),d=a.name,c=d+"-defense",e=a.memory;if(0<b.length){var h,
f,k;e.lastHostile=Game.time;e.currentAttack||(e.currentAttack=Game.time);e.threats||(e.threats={});e.edgeTicks||(e.edgeTicks={1:0,3:0,5:0,7:0});h=e.threats;f=e.edgeTicks;_.forEach(_.filter(_.map(b,function(a){return{id:a.id,threat:_.filter(a.body,function(a){return-1!==[ATTACK,RANGED_ATTACK,HEAL].indexOf(a)}).length}})),function(a){h[a.id]=a.threat});k=Math.min(Math.ceil(_.sum(h)/20),3);0<_.filter(b,function(a){return 0===a.pos.x}).length&&f[TOP]++;0<_.filter(b,function(a){return 49===a.pos.x}).length&&
f[BOTTOM]++;0<_.filter(b,function(a){return 0===a.pos.y}).length&&f[LEFT]++;0<_.filter(b,function(a){return 49===a.pos.y}).length&&f[RIGHT]++;if(0<k)if(Memory.army[c]){var a=Game.time-e.currentAttack,l=Game.map.describeExits(d);500<=a&&(Memory.army[c].boostRoom=d,2E3<=a&&(c=_.filter(Game.rooms,function(a){return a.memory&&a.memory.region===e.region}),_.forEach(c,function(a){a=a.name;var b=a+"-defense-for-"+d;Memory.army[a+"-defense"]||Memory.army[b]||p.createArmy(b,{reinforce:!1,region:e.region,boostRoom:d,
buildRoom:d,stageRoom:d,attackRoom:d,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:k,units:17},melee:{maxCreeps:k,units:20},ranged:{maxCreeps:0,units:20}})}),2500<=a&&_.forEach(c,function(a){a=a.name;var b=a+"-defense-for-"+d;Memory.army[b]&&(Memory.army[b].boostRoom=a)})));_.forEach(_.keys(l),function(a){var b=d+"-"+a.toString()+"-border-defense";!Memory.army[b]&&50<=f[a]&&p.createArmy(b,{reinforce:!1,region:e.region,boostRoom:d,buildRoom:d,stageRoom:d,attackRoom:l[a],dismantle:[],
dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:k,units:17},melee:{maxCreeps:k,units:20},ranged:{maxCreeps:0,units:20}})})}else Game.notify("Warning! "+d+" is under attack!"),p.createArmy(c,{reinforce:!1,region:e.region,boostRoom:d,buildRoom:d,stageRoom:d,attackRoom:d,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:k,units:17},melee:{maxCreeps:k,units:20},ranged:{maxCreeps:0,units:20},creepCount:0})}else if(Memory.army[c]){if(e.lastHostile+50<Game.time){if(c=Memory.army[c])c.directive=
"attack",c.success=!0;delete e.lastHostile;delete e.currentAttack;delete e.threats;delete e.edgeTicks}}else delete e.lastHostile,delete e.currentAttack,delete e.threats,delete e.edgeTicks};z.prototype.transferEnergy=function(){var a=this.room,a=k.objectsClosestToObj(g.linksInRoom(a),g.spawnsInRoom(a)[0]),b=a[0];_.forEach(a,function(a,d){0!==d&&!b.cooldown&&0<b.energy&&300>=a.energy&&b.transferEnergy(a)})};z.prototype.terminal=function(){var b=this.room,d=b.terminal,c=d.store,h=c[RESOURCE_ENERGY]||
0,f=b.storage,k=b.name,b=b.memory,l=b.buyQueue,n=!1,m=[],q={},p=Game.market,x=Math.max.apply(Math,[].concat($jscomp.arrayFromIterable(_.map(_.filter(Game.rooms,function(a){return a.memory&&a.memory.roomType&&"base"===a.memory.roomType.type&&a.storage&&a.storage.my&&a.terminal&&a.terminal.my}),function(a){return a.storage&&a.storage.my?a.storage.store[RESOURCE_ENERGY]:0}))));f&&(q=f.store);if(1E3<=h&&x>=Memory.dealEnergy){var u=Memory.reserveMinerals,v;b.buyQueue&&(v=l.resource,g.credits<Memory.minimumCredits||
(q[v]||0)+(c[v]||0)>(u[v]||0))&&(delete b.buyQueue,l=void 0);if(l&&x>Memory.marketEnergy&&Memory.buy){if(f=(e.getFilteredOrders().sell[v]||[])[0])if(x=f.price,x>l.price)delete b.buyQueue,l=void 0;else{v=f.amount;var A=p.calcTransactionCost(Math.min(l.amount,v),k,f.roomName);h>A&&g.credits>=l.amount*x?(e.deal(f.id,Math.min(l.amount,v),k),n=!0,l.amount-=Math.min(l.amount,v)):0<h&&(x=Math.min(Math.floor(Math.min(l.amount,v)*h/A),Math.floor(g.credits/x)),0<x&&(e.deal(f.id,x,k),n=!0,l.amount-=x))}else delete b.buyQueue,
l=void 0;l&&0>=l.amount&&(delete b.buyQueue,l=void 0)}else if(g.credits>=Memory.minimumCredits&&_.forEach(_.filter(Game.rooms,function(a){var b=a.memory,d=b.roomType;a=a.terminal;return b&&d&&"base"===d.type&&a&&a.my}),function(a){var b=a.name,e=a.storage;n=!1;if(k!==b)return _.forEach(_.filter(_.map(c,function(b,d){return{resource:d,amount:Math.min(u?b+q[d]-(d.startsWith("X")&&5===d.length?u[d]-5E3:u[d]):0,b),otherRoomAmount:(a.terminal.store[d]||0)+(e&&e.store[d]||0),needed:u?(d.startsWith("X")&&
5===d.length?u[d]-5E3:u[d])||0:0}}),function(a){var b=a.otherRoomAmount,d=a.needed,c=a.amount;return u[a.resource]&&b<d&&0<c&&0<d-b&&100<=Math.min(c,d-b)}),function(a){var c=Math.min(a.amount,a.needed-a.otherRoomAmount);a=a.resource;var e=p.calcTransactionCost(c,k,b);if(h>e){if(d.send(a,c,b)===OK)return g.log.events.push("Sending "+c+" "+a+" from "+k+" to "+b),n=!0,!1}else if(0<h&&(c=Math.floor(c*h/e),0<c&&d.send(a,c,b)===OK))return g.log.events.push("Sending "+c+" "+a+" from "+k+" to "+b),n=!0,!1}),
!n}),n||(b=_.filter(_.map(c,function(a,b){return{resource:b,amount:Math.min(a,a-(u?(b.startsWith("X")&&5===b.length?u[b]-5E3:u[b])||0:0)+(q[b]||0))}}),function(a){return a.resource!==RESOURCE_ENERGY&&0<a.amount}),0<b.length&&_.forEach(b.sort(function(a,b){return b.amount-a.amount}),function(a){var b=a.resource,d=_.filter(e.getFilteredOrders().buy[b]||[],function(d){return 5005<=a.amount&&g.credits<Memory.minimumCredits||!Memory.minimumSell[b]&&!Memory.flipPrice[b]||Memory.minimumSell[b]&&d.price>=
Memory.minimumSell[b]||Memory.flipPrice[b]&&d.price>=Memory.flipPrice[b].price||Memory.flipPrice[b]&&Game.time>Memory.flipPrice[b].expiration})[0];if(d){var c=d.amount,f=p.calcTransactionCost(Math.min(a.amount,c),k,d.roomName);if(h>f)return e.deal(d.id,Math.min(a.amount,c),k),n=!0,5005>a.amount&&delete Memory.minimumSell[d.resourceType],!1;if(0<h&&(c=Math.floor(Math.min(a.amount,c)*h/f),0<c))return e.deal(d.id,c,k),n=!0,!1}})),!n&&f&&x>Memory.marketEnergy){var w=e.getFilteredOrders();_.forEach(a,
function(a,b){var d;!q||(q[b]||0)<u[b]||-1!==[RESOURCE_ENERGY,SUBSCRIPTION_TOKEN].indexOf(b)||(a=(w.sell[b]||[])[0],d=(w.buy[b]||[])[0],a&&d&&a.price<d.price&&a.price<g.credits&&m.push({resource:b,buy:d,sell:a}))});_.forEach(m.sort(function(a,b){return a.sell.price-a.buy.price-(b.sell.price-b.buy.price)}),function(a,b){var d=a.sell,c=d.price,f=a.buy,l=Math.min(f.amount,d.amount);l*c>g.credits&&(l=Math.floor(g.credits/c));0===b&&g.log.events.push("Biggest flip: "+a.resource+" x"+l+" "+c.toFixed(2)+
" to "+f.price.toFixed(2));b=p.calcTransactionCost(l,k,d.roomName);if(h>b||0<h&&(l=Math.floor(l*h/b),0<l))return e.deal(d.id,l,k),Memory.flipPrice[a.resource]={price:c,expiration:Game.time+100},n=!0,!1})}}};z.prototype.tasks=function(){var a=this.room,b=a.name,d=g.creeps[b],c=a.terminal,e=Memory.dismantle,h=0,f=0,l,n=d&&d.worker||[],m=0<_.filter(n,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,q=0<_.filter(n,function(a){return(!a.memory.currentTask||
a.memory.currentTask.unimportant)&&a.carry[RESOURCE_ENERGY]!==_.sum(a.carry)}).length,p=0<_.filter(n,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,x=d&&d.collector||[],u=0<_.filter(x,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,v=0<_.filter(x,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,A=d&&d.storer||[],w=0<_.filter(A,
function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,C=0<_.filter(A,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&a.carry[RESOURCE_ENERGY]!==_.sum(a.carry)}).length,A=0<_.filter(A,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,D=d&&d.scientist||[],z=0<_.filter(D,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,
G=0<_.filter(D,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&a.carry[RESOURCE_ENERGY]!==_.sum(a.carry)}).length,D=0<_.filter(D,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0===_.sum(a.carry)}).length,J=d&&d.upgrader||[],P=0<_.filter(J,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&0<a.carry[RESOURCE_ENERGY]}).length,J=0<_.filter(J,function(a){return(!a.memory.currentTask||a.memory.currentTask.unimportant)&&
0===_.sum(a.carry)}).length,I=0<k.creepsWithNoTask(d&&d.dismantler||[]).length,n=0===Game.time%10&&0===n.length+x.length,H={build:{tasks:m||u?r.getTasks(a):[]},collectEnergy:{tasks:p||A||D||v||J?t.getTasks(a):[],storerTasks:A?t.getStorerTasks(a):[]},collectMinerals:{storerTasks:A||C?E.getStorerTasks(a):[],labTasks:D||G?E.getLabTasks(a):[],storageTasks:D||G?E.getStorageTasks(a):[],terminalTasks:D||G?E.getTerminalTasks(a):[]},fillEnergy:{extensionTasks:m||w||z||u?B.getExtensionTasks(a):[],spawnTasks:m||
w||z||u?B.getSpawnTasks(a):[],powerSpawnTasks:z?B.getPowerSpawnTasks(a):[],towerTasks:m||z||u?B.getTowerTasks(a):[],storageTasks:w||z||I?B.getStorageTasks(a):[],containerTasks:I?B.getContainerTasks(a):[],labTasks:z?B.getLabTasks(a):[],linkTasks:w?B.getLinkTasks(a):[],nukerTasks:z?B.getNukerTasks(a):[]},fillMinerals:{labTasks:G?y.getLabTasks(a):[],storageTasks:q||C||G||I?y.getStorageTasks(a):[],terminalTasks:q||C||G||I?y.getTerminalTasks(a):[],nukerTasks:G?y.getNukerTasks(a):[],powerSpawnTasks:G?y.getPowerSpawnTasks(a):
[]},heal:{tasks:L.getTasks(a)},rangedAttack:{tasks:O.getTasks(a)},repair:{tasks:n||m||u?K.getTasks(a):[],criticalTasks:n||m||u?K.getCriticalTasks(a):[],towerTasks:Memory.towerTasks[b]||0===Game.time%10?K.getTowerTasks(a):[]},upgradeController:{tasks:m||u||P?M.getTasks(a):[],criticalTasks:n||m||u?M.getCriticalTasks(a):[]},dismantle:{tasks:[]}};Memory.towerTasks[b]=H.repair.towerTasks.length;c&&c.my&&(h=c.store[RESOURCE_ENERGY]||0,l=c.id);a.storage&&(f=a.storage.store[RESOURCE_ENERGY]||0);(A||D)&&c&&
(!c.my||5E3<=h&&(!a.memory.buyQueue||f<Memory.marketEnergy||g.credits<Memory.minimumCredits))&&(H.collectEnergy.terminalTask=new t(l));(m||w||z)&&c&&c.my&&1E3>h&&(H.fillEnergy.terminalTask=new B(l));if(e&&e[b]&&0<e[b].length){var N=[];_.forEach(e[b],function(b){var d=a.lookForAt(LOOK_STRUCTURES,b.x,b.y);0===d.length?N.push(b):I&&(H.dismantle.tasks=H.dismantle.tasks.concat(_.map(d,function(a){return new F(a.id)})))});_.forEach(N,function(a){_.remove(e[b],function(b){return b.x===a.x&&b.y===a.y})})}else _.forEach(d&&
d.dismantler||[],function(b){b.memory.role="worker";b.memory.container=g.containersInRoom(a)[0].id});return H};z.prototype.spawn=function(a,b){var d=this.room,c=d.storage,e=d.controller,g=e.level,f=Memory.dismantle,k=d.name;this.checkSpawn(A,b&&(!c||c.store[RESOURCE_ENERGY]>=Memory.workerEnergy||3500>e.ticksToDowngrade||0<d.find(FIND_MY_CONSTRUCTION_SITES).length||a.repair.criticalTasks&&0<a.repair.criticalTasks.length||a.repair.tasks&&0<_.filter(a.repair.tasks,function(a){return(a.structure.structureType===
STRUCTURE_WALL||a.structure.structureType===STRUCTURE_RAMPART)&&1E6>a.structure.hits}).length));this.checkSpawn(u,b);this.checkSpawn(w,b);this.checkSpawn(q,b&&6<=g);this.checkSpawn(l,b&&!!(f&&f[k]&&0<f[k].length));this.checkSpawn(x,b);this.checkSpawn(h,b);this.checkSpawn(n,b);this.checkSpawn(v,b&&(8>g||0<_.filter(Game.rooms,function(a){return(a=a.controller)&&a.my&&8>a.level}).length))};z.prototype.assignTasks=function(a){var b=this.room;A.assignTasks(b,a);u.assignTasks(b,a);w.assignTasks(b,a);q.assignTasks(b,
a);l.assignTasks(b,a);x.assignTasks(b,a);h.assignTasks(b,a);n.assignTasks(b,a);v.assignTasks(b,a);d.assignTasks(b,a)};z.prototype.labQueue=function(){var a=this.room,b=a.memory,d=b.labQueue,c=d.status;if("clearing"===c){var e=b.labsInUse,h=g.labsInRoom(a);if(!e||2<h.length-e.length&&0===_.filter(h,function(a){return 0===_.filter(e,function(b){return b.id===a.id}).length&&0<a.mineralAmount}).length)d.status="moving"}else if("moving"===c)if(!d.start||d.start+500<Game.time)delete b.labQueue,d=void 0;
else{var f=!0,c=d.children||[],h=g.labsInRoom(a),l=d.sourceLabs||[],n=Game.getObjectById(l[0]),m=Game.getObjectById(l[1]),e=b.labsInUse;_.forEach(c,function(a){if(_.sum(_.filter(h,function(b){return b.mineralType===a}),function(a){return a.mineralAmount})<d.amount)return f=!1});n.mineralType===c[0]&&m.mineralType===c[1]&&_.forEach(_.filter(h,function(a){return-1===l.indexOf(a.id)&&(!e||-1===_.map(_.filter(e,function(a){return a.resource!==d.resource}),function(a){return a.id}).indexOf(a.id))}),function(a){a.runReaction(n,
m)===OK&&(d.amount-=5)});f&&(d.status="creating")}else"creating"===c?(h=g.labsInRoom(a),l=d.sourceLabs||[],e=b.labsInUse,n=Game.getObjectById(l[0]),m=Game.getObjectById(l[1]),_.forEach(_.filter(h,function(a){return-1===l.indexOf(a.id)&&(!e||-1===_.map(_.filter(e,function(a){return a.resource!==d.resource}),function(a){return a.id}).indexOf(a.id))}),function(a){a.mineralAmount===LAB_MINERAL_CAPACITY&&(d.status="returning");a.runReaction(n,m)===OK&&(d.amount-=5)}),0===_.sum(_.filter(h,function(a){return-1!==
l.indexOf(a.id)}),function(a){return a.mineralAmount})&&(d.status="returning"),0>=d.amount&&(5>n.mineralAmount||5>m.mineralAmount)&&(delete b.labQueue,d=void 0)):"returning"===c?0===_.sum(_.filter(g.labsInRoom(a),function(a){return a.mineralType===d.resource}),function(a){return a.mineralAmount})&&(delete b.labQueue,d=void 0):(d.status="clearing",d.sourceLabs=k.getSourceLabs(a))};z.prototype.labsInUse=function(){var a=this.room.memory.labsInUse,b=[];_.forEach(a,function(a){var d=a.status,c=Game.getObjectById(a.id);
if("emptying"===d)0===c.mineralAmount&&(a.status="filling");else if("filling"===d)c.mineralAmount===a.amount&&c.mineralType===a.resource&&(a.status="waiting");else if("refilling"===d)c.mineralAmount===a.oldAmount&&c.mineralType===a.oldResource&&b.push(a);else{var e=Game.creeps[a.creepToBoost];1>=c.pos.getRangeTo(e)&&c.mineralType===a.resource&&c.mineralAmount>=a.amount&&c.boostCreep(e)===OK&&(_.remove(e.memory.labs,function(b){return b===a.id}),d&&0!==a.oldAmount?a.status="refilling":b.push(a))}});
_.forEach(b,function(b){_.remove(a,function(a){return a.id===b.id})})};z.prototype.processPower=function(){_.forEach(g.powerSpawnsInRoom(this.room),function(a){1<=a.power&&50<=a.energy&&a.processPower()})};z.prototype.toObj=function(){Memory.rooms[this.room.name].roomType={type:this.type}};z.fromObj=function(a){return new z(a)};Memory.profiling&&c(1,32).registerObject(z,"RoomBase");m.exports=z;return m.exports};r[33]=function(m,f){var g=c(3,33),p=c(4,33),e=c(55,33),a=c(9,33),b=c(23,33),d=c(22,33),
k=c(38,33),h=c(39,33),x=c(40,33),l=c(42,33),n=c(43,33),u=c(48,33),q=function(a){var b;b=e.call(this)||this;b.type="cleanup";b.room=a;b.supportRoom=Game.rooms[Memory.rooms[a.name].roomType.supportRoom];return b};$jscomp.inherits(q,e);q.prototype.run=function(){var c=this.supportRoom,e,f,m,q,r,t;if(c){e=this.room;f=e.name;m=[];q=[];r=[];t={collectEnergy:{cleanupTasks:[]},collectMinerals:{cleanupTasks:[]},fillEnergy:{storageTasks:l.getStorageTasks(c),containerTasks:l.getContainerTasks(c)},fillMinerals:{labTasks:n.getLabTasks(c),
storageTasks:n.getStorageTasks(c),terminalTasks:n.getTerminalTasks(c)},remoteDismantle:{cleanupTasks:[]},dismantle:{tasks:[]},pickupResource:{tasks:[]}};if(!this.room.unobservable){var B,y;if(Memory.dismantle&&Memory.dismantle[f]&&0<Memory.dismantle[f].length){var L=[];_.forEach(Memory.dismantle[f],function(a){var b=e.lookForAt(LOOK_STRUCTURES,a.x,a.y);0===b.length?L.push(a):t.dismantle.tasks=t.dismantle.tasks.concat(_.map(b,function(a){return new x(a.id)}))});_.forEach(L,function(a){_.remove(Memory.dismantle[f],
function(b){return b.x===a.x&&b.y===a.y})})}m=_.filter(e.find(FIND_STRUCTURES),function(a){return a.structureType===STRUCTURE_RAMPART});q=_.filter(e.find(FIND_STRUCTURES),function(b){return b.structureType!==STRUCTURE_RAMPART&&b.structureType!==STRUCTURE_CONTROLLER&&b.structureType!==STRUCTURE_ROAD&&b.structureType!==STRUCTURE_WALL&&(0===m.length||0<b.pos.getRangeTo(a.objectsClosestToObj(m,b)[0]))});B=_.filter(q,function(a){return a.structureType===STRUCTURE_NUKER||(!a.energy||0===a.energy)&&(!a.store||
0===_.sum(a.store))&&(!a.mineralAmount||0===a.mineralAmount)});y=_.filter(q,function(a){return a.structureType!==STRUCTURE_NUKER&&(a.energy&&0<a.energy||a.store&&0<_.sum(a.store)||a.mineralAmount&&0<a.mineralAmount)});r=_.filter(e.find(FIND_STRUCTURES),function(a){return-1!==[STRUCTURE_WALL,STRUCTURE_ROAD].indexOf(a.structureType)});t.collectEnergy.cleanupTasks=k.getCleanupTasks(y);t.collectMinerals.cleanupTasks=h.getCleanupTasks(y);t.pickupResource.tasks=u.getTasks(e);t.remoteDismantle.cleanupTasks=
[].concat.apply([],[x.getCleanupTasks(B),x.getCleanupTasks(m),x.getCleanupTasks(r)]);0===y.length&&0===t.remoteDismantle.cleanupTasks.length&&0===t.pickupResource.tasks.length&&(B=g.creeps[f],Game.notify("Cleanup Room "+f+" is squeaky clean!"),_.forEach(B&&B.remoteCollector||[],function(a){a=a.memory;a.role="storer";a.home=c.name}),_.forEach(B&&B.remoteDismantler||[],function(a){a=a.memory;a.role="upgrader";a.home=c.name}),p.setRoomType(f))}this.checkSpawn(b,e.unobservable||0<q.length||0<m.length||
0<r.length);this.checkSpawn(d,!0);b.assignTasks(e,t);d.assignTasks(e,t)}};q.prototype.toObj=function(){Memory.rooms[this.room.name].roomType={type:this.type,supportRoom:this.supportRoom.name}};q.fromObj=function(a){return new q(a)};Memory.profiling&&c(1,33).registerObject(q,"RoomCleanup");m.exports=q;return m.exports};r[34]=function(m,f){var g=c(3,34),p=c(4,34),e=c(55,34),a=c(9,34),b=c(17,34),d=c(21,34),k=c(24,34),h=c(25,34),x=c(26,34),l=c(27,34),n=c(36,34),u=c(40,34),q=c(42,34),r=c(43,34),v=function(a){var b,
d=Memory.rooms[a.name].roomType;b=e.call(this)||this;b.type="mine";b.room=a;b.supportRoom=Game.rooms[d.supportRoom];b.stage=d.stage||1;return b};$jscomp.inherits(v,e);v.prototype.run=function(){var a=this.room,b=a.controller;(a.unobservable||0!==a.find(FIND_SOURCES).length)&&Game.rooms[Memory.rooms[a.name].roomType.supportRoom]&&("mine"===this.type&&b&&b.my?this.convert():(1===this.stage&&this.stage1(),2===this.stage&&this.stage2()))};v.prototype.convert=function(){var b=this.supportRoom.name,d=this.room,
c=d.name,e=Memory.rooms[c],h=g.creeps[c];p.claimRoom(b,c,!1);p.setRoomType(c,{type:"base",region:e.region});_.forEach(h&&h.all||[],function(e){var h=e.memory;switch(h.role){case "remoteBuilder":case "remoteWorker":h.role="worker";h.home=c;h.homeSource=a.objectsClosestToObj(d.find(FIND_SOURCES),e)[0].id;break;case "remoteReserver":e.suicide();break;case "remoteStorer":h.role="storer";h.home=b;break;case "dismantler":h.home=c,h.supportRoom=c}})};v.prototype.stage1=function(){var a=this.stage1Tasks();
this.stage1Spawn();this.stage1AssignTasks(a);this.room.unobservable||(this.stage1Manage(),this.defend())};v.prototype.stage1Tasks=function(){var a=this.supportRoom,b=this.room,a={fillEnergy:{storageTasks:q.getStorageTasks(a),containerTasks:q.getContainerTasks(a)},fillMinerals:{storageTasks:r.getStorageTasks(a),terminalTasks:r.getTerminalTasks(a)},dismantle:{tasks:[]}};b.unobservable||(a.build={tasks:n.getTasks(b)});return a};v.prototype.stage1Spawn=function(){this.checkSpawn(h,this.room.controller);
this.checkSpawn(d,!0)};v.prototype.stage1AssignTasks=function(a){var c=this.room;c.controller&&h.assignTasks(c,a);d.assignTasks(c);k.assignTasks(c,a);l.assignTasks(c,a);x.assignTasks(c,a);b.assignTasks(c,a)};v.prototype.stage1Manage=function(){var b=this,d=this.room,c=d.name,e=d.find(FIND_MINERALS),h=d.find(FIND_SOURCES),f=[].concat.apply([],[h,/^[EW][0-9]*[4-6][NS][0-9]*[4-6]$/.test(c)?e:[]]),k=g.containersInRoom(d),l=[].concat.apply([],[h,e]),n=g.creeps[c],m;k.length>=f.length?(this.stage=2,_.forEach(k,
function(b){var d=a.objectsClosestToObj(l,b)[0];if(!(d instanceof Mineral))return _.forEach(n&&n.remoteBuilder||[],function(b){b=b.memory;b.role="remoteWorker";b.container=a.objectsClosestToObj(k,d)[0].id}),!1})):(m=d.find(FIND_MY_CONSTRUCTION_SITES),0===m.length&&_.forEach(f,function(a){var c=PathFinder.search(a.pos,{pos:g.spawnsInRoom(b.supportRoom)[0].pos,range:1},{swampCost:1}).path[0];0===_.filter(c.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_CONTAINER}).length&&0===
_.filter(m,function(a){return a.pos.x===c.x&&a.pos.y===c.y&&a.structureType===STRUCTURE_CONTAINER}).length&&d.createConstructionSite(c.x,c.y,STRUCTURE_CONTAINER)}))};v.prototype.defend=function(){var a=this.room,b=a.name,d=b+"-defense",c=Memory.army[d],e=this.supportRoom,h=e.name;0<_.filter(g.hostilesInRoom(a),function(a){return a.owner&&"Invader"===a.owner.username}).length?c||(c=e.energyCapacityAvailable,p.createArmy(d,{reinforce:!1,region:a.memory.region,boostRoom:void 0,buildRoom:h,stageRoom:h,
attackRoom:b,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:1,units:Math.min(Math.floor((c-300)/300),20)},melee:{maxCreeps:1,units:Math.min(Math.floor((c-300)/130),20)},ranged:{maxCreeps:0,units:20}})):c&&(c.directive="attack",c.success=!0)};v.prototype.stage2=function(){var a;this.stage2Manage();this.defend();1!==this.stage&&(a=this.stage2Tasks(),this.room.unobservable||this.stage2Spawn(),this.stage2AssignTasks(a))};v.prototype.stage2Manage=function(){var a=this.room,b=g.creeps[a.name];
a.unobservable?0===(b&&b.remoteMiner||[]).length&&0===(b&&b.remoteWorker||[]).length&&0===(b&&b.remoteStorer||[]).length&&0===(b&&b.remoteReserver||[]).length&&(this.stage=1):g.containersInRoom(a).length<[].concat.apply([],[a.find(FIND_SOURCES),/^[EW][0-9]*[4-6][NS][0-9]*[4-6]$/.test(a.name)?a.find(FIND_MINERALS):[]]).length&&(this.stage=1)};v.prototype.stage2Tasks=function(){var b=this.room,d=b.name,c=this.supportRoom,e=g.creeps[d],h=0<a.creepsWithNoTask(e&&e.remoteWorker||[]).length||0<a.creepsWithNoTask(e&&
e.remoteStorer||[]).length||0<a.creepsWithNoTask(e&&e.remoteDismantler||[]).length,f={fillEnergy:{storageTasks:h?q.getStorageTasks(c):[],containerTasks:h?q.getContainerTasks(c):[]},fillMinerals:{storageTasks:h?r.getStorageTasks(c):[],terminalTasks:h?r.getTerminalTasks(c):[]}};if(!b.unobservable){var c=Memory.dismantle,k=c[d];f.dismantle={tasks:[]};if(c&&k&&0<k.length){var l=[];_.forEach(k,function(a){var d=b.lookForAt(LOOK_STRUCTURES,a.x,a.y);0===d.length?l.push(a):f.dismantle.tasks=f.dismantle.tasks.concat(_.map(d,
function(a){return new u(a.id)}))});_.forEach(l,function(a){_.remove(k,function(b){return b.x===a.x&&b.y===a.y})})}else{var n=g.containersInRoom(b)[0].id;_.forEach(e&&e.dismantler||[],function(a){a=a.memory;a.role="remoteWorker";a.container=n})}}return f};v.prototype.stage2Spawn=function(){var a=this.room,d,c;0<g.hostilesInRoom(a).length||(d=Memory.dismantle,c=d[a.name],this.checkSpawn(h,a.controller),this.checkSpawn(k,!0),this.checkSpawn(l,!0),this.checkSpawn(x,!0),this.checkSpawn(b,!!(d&&c&&0<c.length)))};
v.prototype.stage2AssignTasks=function(a){var d=this.room;d.controller&&h.assignTasks(d,a);k.assignTasks(d,a);l.assignTasks(d,a);x.assignTasks(d,a);b.assignTasks(d,a)};v.prototype.toObj=function(){Memory.rooms[this.room.name].roomType={type:this.type,supportRoom:this.supportRoom.name,stage:this.stage}};v.fromObj=function(a){return new v(a)};Memory.profiling&&c(1,34).registerObject(v,"RoomMine");m.exports=v;return m.exports};r[35]=function(m,f){var g=c(3,35),p=c(4,35),e=c(34,35),a=c(16,35),b=c(19,
35),d=c(22,35),k=function(a){a=e.call(this,a)||this;a.type="source";delete a.convert;return a};$jscomp.inherits(k,e);k.prototype.stage1Spawn=function(){var d=g.creeps[this.room.name],c=d.defender;this.checkSpawn(a,!0);this.checkSpawn(b,!0);d&&c&&0!==_.filter(c,function(a){return!a.spawning}).length&&e.prototype.stage1Spawn.call(this)};k.prototype.stage1AssignTasks=function(d){var c=this.room;a.assignTasks(c,d);b.assignTasks(c,d);e.prototype.stage1AssignTasks.call(this,d)};k.prototype.defend=function(){var a=
this.room,b=a.name,d=b+"-defense",c=Memory.army[d],e=this.supportRoom.name;0<_.filter(g.hostilesInRoom(a),function(a){return a.owner&&"Invader"===a.owner.username}).length?c||p.createArmy(d,{reinforce:!1,region:a.memory.region,boostRoom:void 0,buildRoom:e,stageRoom:e,attackRoom:b,dismantle:[],dismantler:{maxCreeps:0,units:20},healer:{maxCreeps:2,units:17},melee:{maxCreeps:2,units:20},ranged:{maxCreeps:0,units:20}}):c&&(c.directive="attack",c.success=!0)};k.prototype.stage2Spawn=function(){var c=g.creeps[this.room.name],
f=c.defender;this.checkSpawn(a,!0);this.checkSpawn(b,!0);c&&f&&0!==_.filter(f,function(a){return!a.spawning}).length&&(e.prototype.stage2Spawn.call(this),this.checkSpawn(d,!0))};k.prototype.stage2AssignTasks=function(c){var h=this.room;a.assignTasks(h,c);b.assignTasks(h,c);e.prototype.stage2AssignTasks.call(this,c);d.assignTasks(h,c)};k.fromObj=function(a){return new k(a)};Memory.profiling&&c(1,35).registerObject(k,"RoomSource");m.exports=k;return m.exports};r[36]=function(m,f){var g=c(3,36),p=c(56,
36),e=function(a){this.type="build";this.id=a;this.constructionSite=Game.getObjectById(a);this.force=!0};e.prototype.canAssign=function(a){if(a.spawning||!a.carry[RESOURCE_ENERGY]||0===a.getActiveBodyparts(WORK))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){var b=this.constructionSite;a.carry[RESOURCE_ENERGY]&&b&&0!==a.getActiveBodyparts(WORK)?(p.moveTo(a,b,Math.max(Math.min(a.pos.getRangeTo(b)-1,3),1)),a.build(b,RESOURCE_ENERGY)===OK&&(Math.min(5*a.getActiveBodyparts(WORK),
a.carry[RESOURCE_ENERGY])>=b.progressTotal-b.progress||a.carry[RESOURCE_ENERGY]<=Math.min(5*a.getActiveBodyparts(WORK)))&&delete a.memory.currentTask):delete a.memory.currentTask};e.prototype.toObj=function(a){this.constructionSite?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};e.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new e(a.memory.currentTask.id)};e.getTasks=function(a){return _.map(a.find(FIND_MY_CONSTRUCTION_SITES),function(a){return new e(a.id)})};
Memory.profiling&&c(1,36).registerObject(e,"TaskBuild");m.exports=e;return m.exports};r[37]=function(m,f){var g=c(3,37),p=c(56,37),e=function(){this.type="claim"};e.prototype.canAssign=function(a){var b=a.room.controller;if(a.spawning||"claimer"!==a.memory.role||!b||b.my||0===a.getActiveBodyparts(CLAIM))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){!a.room.controller||a.room.controller.my||0===!a.getActiveBodyparts(CLAIM)?delete a.memory.currentTask:(p.moveTo(a,
a.room.controller,1),a.claimController(a.room.controller))};e.prototype.toObj=function(a){a.room.controller?a.memory.currentTask={type:this.type}:delete a.memory.currentTask};e.fromObj=function(a){return new e};e.getTask=function(a){if(a.room.controller)return new e};Memory.profiling&&c(1,37).registerObject(e,"TaskClaim");m.exports=e;return m.exports};r[38]=function(m,f){var g=c(3,38),p=c(56,38),e=function(a){this.type="collectEnergy";this.id=a;this.object=Game.getObjectById(a)};e.prototype.canAssign=
function(a){var b=this.object;if(a.spawning||150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||!b||0===(b.energy||b.store&&b.store[RESOURCE_ENERGY]||0))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){var b=this.object,d,c;150>a.ticksToLive||!b?delete a.memory.currentTask:(d=b.energy||b.store&&b.store[RESOURCE_ENERGY]||0,_.sum(a.carry)===a.carryCapacity||0===d?delete a.memory.currentTask:(p.moveTo(a,b,1),1===a.pos.getRangeTo(b)&&0<(c=_.filter(b.pos.lookFor(LOOK_RESOURCES),
function(a){return 50<a.amount})).length?a.pickup(c[0]):a.withdraw(b,RESOURCE_ENERGY)===OK&&delete a.memory.currentTask))};e.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};e.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new e(a.memory.currentTask.id)};e.getTasks=function(a){var b=_.filter(a.find(FIND_HOSTILE_STRUCTURES),function(a){return(0<a.energy||a.store&&0<a.store[RESOURCE_ENERGY])&&a.structureType!==
STRUCTURE_NUKER});return 0<b.length?_.map(b,function(a){return new e(a.id)}):a.storage&&0<a.storage.store[RESOURCE_ENERGY]?[new e(a.storage.id)]:_.map(_.filter(g.containersInRoom(a),function(a){return 500<=a.store[RESOURCE_ENERGY]}).sort(function(a,b){return b.store[RESOURCE_ENERGY]-a.store[RESOURCE_ENERGY]}),function(a){return new e(a.id)})};e.getStorerTasks=function(a){return _.map(_.filter(g.containersInRoom(a),function(a){return a.store[RESOURCE_ENERGY]&&500<=a.store[RESOURCE_ENERGY]}),function(a){return new e(a.id)})};
e.getCleanupTasks=function(a){return _.map(_.filter(a,function(a){return a.energy||a.store&&a.store[RESOURCE_ENERGY]}).sort(function(a,d){return(a.energy||a.store[RESOURCE_ENERGY])-(d.energy||d.store[RESOURCE_ENERGY])}),function(a){return new e(a.id)})};Memory.profiling&&c(1,38).registerObject(e,"TaskCollectEnergy");m.exports=e;return m.exports};r[39]=function(m,f){var g=c(3,39),p=c(56,39),e=c(9,39),a=function(a,d,c){this.type="collectMinerals";this.id=a;this.resource=d;this.amount=c;this.object=
Game.getObjectById(a)};a.prototype.canAssign=function(a){var b=this.object;if(0>this.amount||a.spawning||150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||this.resource&&this.amount&&(b.structureType===STRUCTURE_LAB&&b.mineralType!==this.resource&&b.mineralAmount<this.amount||b.structureType!==STRUCTURE_LAB&&(b.store[this.resource]||0)<this.amount))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){var b=this.object,c=this.resource,e=a.carry,f=a.carryCapacity,
g=this.amount,n;if(0>g||150>a.ticksToLive||!b)delete a.memory.currentTask;else if(n=b.store,_.sum(a.carry)===a.carryCapacity)delete a.memory.currentTask;else{if(b.structureType===STRUCTURE_LAB){if(null===b.mineralType){delete a.memory.currentTask;return}c=[b.mineralType]}else c=c?[c]:_.filter(_.keys(n),function(a){return a!==RESOURCE_ENERGY&&0<n[a]});0===c.length?delete a.memory.currentTask:(p.moveTo(a,b,1),g?a.withdraw(b,c[0],Math.min(g,f-_.sum(e)))===OK&&delete a.memory.currentTask:a.withdraw(b,
c[0])===OK&&delete a.memory.currentTask)}};a.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id,resource:this.resource,amount:this.amount}:delete a.memory.currentTask};a.fromObj=function(b){if(Game.getObjectById(b.memory.currentTask.id))return new a(b.memory.currentTask.id,b.memory.currentTask.resource,b.memory.currentTask.amount)};a.getStorerTasks=function(b){return _.map(_.filter(g.containersInRoom(b),function(a){return 0<_.filter(_.keys(a.store),function(b){return b!==
RESOURCE_ENERGY&&500<=a.store[b]}).length}).sort(function(a,b){return _.sum(b.store)-_.sum(a.store)}),function(b){return new a(b.id)})};a.getCleanupTasks=function(b){return _.map(_.filter(b,function(a){return(a.store||-1!==[STRUCTURE_LAB,STRUCTURE_NUKER,STRUCTURE_POWER_SPAWN].indexOf(a.structureType))&&(0<_.sum(a.store)&&a.store[RESOURCE_ENERGY]<_.sum(a.store)||0<a.mineralAmount||0<a.ghodium||0<a.power)}).sort(function(a,b){return(a.mineralAmount||a.ghodium||a.power||_.sum(a.store)-a.store[RESOURCE_ENERGY])-
(b.mineralAmount||b.ghodium||b.power||_.sum(b.store)-b.store[RESOURCE_ENERGY])}),function(b){return new a(b.id)})};a.getLabTasks=function(b){var d=b.memory,c=d.labsInUse,h=d.labQueue,d=b.storage,f=g.labsInRoom(b),l=[],n,m;h&&(n=h.status,m=h.sourceLabs);c&&(_.forEach(c,function(b){Game.creeps[b.creepToBoost]||l.push(new a(b.id))}),_.forEach(l,function(a){_.remove(c,function(b){return b.id===a.id})}));d&&h&&"clearing"===n&&_.forEach(_.filter(f,function(a){return-1===_.map(c,function(a){return a.id}).indexOf(a.id)&&
0<a.mineralAmount}),function(b){l.push(new a(b.id))});d&&c&&_.forEach(_.filter(c,function(a){return(!a.status||"emptying"===a.status)&&Game.getObjectById(a.id).mineralType&&Game.getObjectById(a.id).mineralType!==a.resource}),function(b){l.push(new a(b.id))});d&&h&&"creating"===n&&!e.roomLabsArePaused(b)&&(0===Game.getObjectById(m[0]).mineralAmount&&0!==Game.getObjectById(m[1]).mineralAmount&&l.push(new a(m[1])),0!==Game.getObjectById(m[0]).mineralAmount&&0===Game.getObjectById(m[1]).mineralAmount&&
l.push(new a(m[0])));d&&h&&"returning"===n&&_.forEach(_.filter(f,function(a){return a.mineralType===h.resource}),function(b){l.push(new a(b.id))});return l};a.getStorageTasks=function(b){var d=[],c;b.controller&&6<=b.controller.level&&(b.storage&&b.memory.labsInUse&&_.forEach(_.filter(b.memory.labsInUse,function(a){return(!a.status||-1!==["filling","refilling"].indexOf(a.status))&&(!Game.getObjectById(a.id).mineralType||Game.getObjectById(a.id).mineralType===("refilling"===a.status?a.oldResource:
a.resource))}),function(c){0<("refilling"===c.status?c.oldAmount-Game.getObjectById(c.id).mineralAmount:c.amount-Game.getObjectById(c.id).mineralAmount)&&d.push(new a(b.storage.id,"refilling"===c.status?c.oldResource:c.resource,"refilling"===c.status?c.oldAmount-Game.getObjectById(c.id).mineralAmount:c.amount-Game.getObjectById(c.id).mineralAmount))}),b.storage&&b.memory.labQueue&&"moving"===b.memory.labQueue.status&&3<=g.labsInRoom(b).length&&!e.roomLabsArePaused(b)&&_.forEach(b.memory.labQueue.children,
function(e){(c=_.sum(_.filter(g.labsInRoom(b),function(a){return a.mineralType===e}),function(a){return a.mineralAmount}))<b.memory.labQueue.amount&&d.push(new a(b.storage.id,e,b.memory.labQueue.amount-c))}),b.storage&&b.terminal&&Memory.reserveMinerals&&_.forEach(b.storage.store,function(c,e){e!==RESOURCE_ENERGY&&(Memory.reserveMinerals[e]?(e.startsWith("X")&&5===e.length?Memory.reserveMinerals[e]-5E3:Memory.reserveMinerals[e])<c&&d.push(new a(b.storage.id,e,c-(e.startsWith("X")&&5===e.length?Memory.reserveMinerals[e]-
5E3:Memory.reserveMinerals[e]))):d.push(new a(b.storage.id,e,c)))}),0<g.nukersInRoom(b).length&&8<=b.controller.level&&(_.forEach(g.nukersInRoom(b),function(c){c.ghodium<c.ghodiumCapacity&&d.push(new a(b.storage.id,RESOURCE_GHODIUM,c.ghodiumCapacity-c.ghodium))}),_.forEach(g.powerSpawnsInRoom(b),function(c){c.power<c.powerCapacity&&b.storage.store[RESOURCE_POWER]&&d.push(new a(b.storage.id,RESOURCE_POWER,Math.min(c.powerCapacity-c.power,b.storage.store[RESOURCE_POWER])))})));return d};a.getTerminalTasks=
function(b){var d=[];b.storage&&b.terminal&&Memory.reserveMinerals&&_.forEach(b.terminal.store,function(c,e){e!==RESOURCE_ENERGY&&Memory.reserveMinerals[e]&&(b.storage.store[e]?b.storage.store[e]<(e.startsWith("X")&&5===e.length?Memory.reserveMinerals[e]-5E3:Memory.reserveMinerals[e])&&d.push(new a(b.terminal.id,e,Math.min(c,(e.startsWith("X")&&5===e.length?Memory.reserveMinerals[e]-5E3:Memory.reserveMinerals[e])-b.storage.store[e]))):d.push(new a(b.terminal.id,e,Math.min(c,e.startsWith("X")&&5===
e.length?Memory.reserveMinerals[e]-5E3:Memory.reserveMinerals[e]))))});return d};Memory.profiling&&c(1,39).registerObject(a,"TaskCollectMinerals");m.exports=a;return m.exports};r[40]=function(m,f){var g=c(3,40),p=c(56,40),e=function(a){this.type="dismantle";this.id=a;this.structure=Game.getObjectById(a);this.force=this.unimportant=!0};e.prototype.canAssign=function(a){if(a.spawning||0<a.carryCapacity&&_.sum(a.carry)===a.carryCapacity||a.spawning||0===a.getActiveBodyparts(WORK))return!1;g.creepTasks[a.name]=
this;this.toObj(a);return!0};e.prototype.run=function(a){var b=this.structure;0<a.carryCapacity&&_.sum(a.carry)===a.carryCapacity||!this.structure||0===a.getActiveBodyparts(WORK)?delete a.memory.currentTask:(p.moveTo(a,b,1),a.dismantle(b),50*Math.min(a.getActiveBodyparts(WORK),a.carry[RESOURCE_ENERGY])>=b.hits&&delete a.memory.currentTask)};e.prototype.toObj=function(a){this.structure?a.memory.currentTask={type:this.type,id:this.structure.id}:delete a.memory.currentTask};e.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new e(a.memory.currentTask.id)};
e.getCleanupTasks=function(a){return _.map(a,function(a){return new e(a.id)})};Memory.profiling&&c(1,40).registerObject(e,"TaskDismantle");m.exports=e;return m.exports};r[41]=function(m,f){var g=c(3,41),p=c(56,41),e=function(){this.type="downgrade"};e.prototype.canAssign=function(a){var b=a.room.controller;if(a.spawning||"downgrader"!==a.memory.role||!b||0===b.level||0===a.getActiveBodyparts(CLAIM))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){a.room.controller&&
0!==a.room.controller.level&&0!==!a.getActiveBodyparts(CLAIM)?(p.moveTo(a,a.room.controller,1),a.attackController(a.room.controller)):delete a.memory.currentTask};e.prototype.toObj=function(a){a.room.controller?a.memory.currentTask={type:this.type}:delete a.memory.currentTask};e.fromObj=function(){return new e};e.getTask=function(a){if(a.room.controller)return new e};Memory.profiling&&c(1,41).registerObject(e,"TaskDowngrade");m.exports=e;return m.exports};r[42]=function(m,f){var g=c(3,42),p=c(56,
42),e=c(9,42),a=function(a){this.type="fillEnergy";this.id=a;this.object=Game.getObjectById(a)};a.prototype.canAssign=function(a){var b;if(a.spawning||!a.carry[RESOURCE_ENERGY]||this.object.energyCapacity&&this.object.energy===this.object.energyCapacity)return!1;if(this.object.structureType===STRUCTURE_EXTENSION){switch(this.object.room.controller.level){case 7:b=100;break;case 8:b=200;break;default:b=50}if(a.carry[RESOURCE_ENERGY]<b)return!1}g.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=
function(a){var b=this.object;b&&(b.energy||_.sum(b.store))!==(b.energyCapacity||b.storeCapacity)?b&&a.carry[RESOURCE_ENERGY]?(p.moveTo(a,b,1),a.transfer(b,RESOURCE_ENERGY)===OK&&delete a.memory.currentTask):delete a.memory.currentTask:delete a.memory.currentTask};a.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};a.fromObj=function(b){if(Game.getObjectById(b.memory.currentTask.id))return new a(b.memory.currentTask.id)};a.getExtensionTasks=
function(b){return _.map(_.filter(g.extensionsInRoom(b),function(a){return a.energy<a.energyCapacity}),function(b){return new a(b.id)})};a.getSpawnTasks=function(b){return _.map(_.filter(g.spawnsInRoom(b),function(a){return a.energy<a.energyCapacity}),function(b){return new a(b.id)})};a.getTowerTasks=function(b){return _.map(_.filter(g.towersInRoom(b),function(a){return.8>a.energy/a.energyCapacity}).sort(function(a,b){return a.energy-b.energy}),function(b){return new a(b.id)})};a.getLabTasks=function(b){return _.map(_.filter(g.labsInRoom(b),
function(a){return a.energy<a.energyCapacity}),function(b){return new a(b.id)})};a.getContainerTasks=function(b){var d=_.filter(g.containersInRoom(b),function(a){return _.sum(a.store)<a.storeCapacity});b.storage&&b.storage.my&&_.sum(b.storage.store)<b.storage.storeCapacity&&d.unshift(b.storage);return _.map(d,function(b){return new a(b.id)})};a.getStorageTasks=function(b){return b.storage&&b.storage.my&&_.sum(b.storage.store)<b.storage.storeCapacity?[new a(b.storage.id)]:[]};a.getLinkTasks=function(b){var d=
g.linksInRoom(b);b=g.spawnsInRoom(b);if(0===d.length||0===b.length)return[];d=e.objectsClosestToObj(d,b[0]);return[new a(d[0].id)]};a.getNukerTasks=function(b){b=g.nukersInRoom(b);return 0===b.length?[]:[new a(b[0].id)]};a.getPowerSpawnTasks=function(b){b=g.powerSpawnsInRoom(b);return 0===b.length?[]:[new a(b[0].id)]};Memory.profiling&&c(1,42).registerObject(a,"TaskFillEnergy");m.exports=a;return m.exports};r[43]=function(m,f){var g=c(3,43),p=c(56,43),e=c(9,43),a=function(a,d){this.type="fillMinerals";
this.id=a;this.resources=d;this.object=Game.getObjectById(a)};a.prototype.canAssign=function(a){if(a.spawning||_.sum(a.carry)===a.carry[RESOURCE_ENERGY]||this.resources&&0===_.intersection(_.keys(this.resources),_.filter(_.keys(a.carry),function(b){return b!==RESOURCE_ENERGY&&a.carry[b]})).length||this.object.structureType===STRUCTURE_NUKER&&this.object.ghodium===this.object.ghodiumCapacity||this.object.structureType===STRUCTURE_POWER_SPAWN&&this.object.power===this.object.powerCapacity)return!1;
g.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){var b=this,c=this.object,e;if(c){if(c.storeCapacity&&0===_.filter(_.keys(a.carry),function(b){return b!==RESOURCE_ENERGY&&0<a.carry[b]}).length||(_.sum(c.store)||0)===c.storeCapacity)return delete a.memory.currentTask,!0;this.resources?(e=_.intersection(_.keys(this.resources),_.filter(_.keys(a.carry),function(b){return a.carry[b]})).sort(function(a,d){a=b.resources[a];d=b.resources[d];return a===d?0:null===a?1:null===d?
-1:a-d}),0===e.length?delete a.memory.currentTask:(p.moveTo(a,c,1),a.transfer(c,e[0],null!==this.resources[e[0]]?Math.min(this.resources[e[0]],a.carry[e[0]]):void 0)===OK&&1===e.length&&delete a.memory.currentTask)):(e=_.filter(_.keys(a.carry),function(b){return b!==RESOURCE_ENERGY&&0<a.carry[b]}),0===e.length?delete a.memory.currentTask:(p.moveTo(a,c,1),a.transfer(c,e[0])===OK&&0===_.filter(_.keys(a.carry),function(b){return b!==RESOURCE_ENERGY&&0<a.carry[b]}).length&&delete a.memory.currentTask))}else delete a.memory.currentTask};
a.prototype.toObj=function(a){this.object?a.memory.currentTask={type:this.type,id:this.id,resources:this.resources}:delete a.memory.currentTask};a.fromObj=function(b){if(Game.getObjectById(b.memory.currentTask.id))return new a(b.memory.currentTask.id,b.memory.currentTask.resources)};a.getLabTasks=function(b){var d,c=[];_.forEach(_.filter(b.memory.labsInUse,function(a){return(!a.status||-1!==["filling","refilling"].indexOf(a.status))&&(!Game.getObjectById(a.id).mineralType||Game.getObjectById(a.id).mineralType===
("refilling"===a.status?a.oldResource:a.resource))&&Game.getObjectById(a.id).mineralAmount<("refilling"===a.status?a.oldAmount:a.amount)}),function(b){d={};d["refilling"===b.status?b.oldResource:b.resource]=("refilling"===b.status?b.oldAmount:b.amount)-Game.getObjectById(b.id).mineralAmount;c.push(new a(b.id,d))});b.storage&&3<=g.labsInRoom(b).length&&b.memory.labQueue&&"moving"===b.memory.labQueue.status&&!e.roomLabsArePaused(b)&&(Game.getObjectById(b.memory.labQueue.sourceLabs[0]).mineralAmount<
b.memory.labQueue.amount&&(d={},d[b.memory.labQueue.children[0]]=b.memory.labQueue.amount-Game.getObjectById(b.memory.labQueue.sourceLabs[0]).mineralAmount,c.push(new a(b.memory.labQueue.sourceLabs[0],d))),Game.getObjectById(b.memory.labQueue.sourceLabs[1]).mineralAmount<b.memory.labQueue.amount&&(d={},d[b.memory.labQueue.children[1]]=b.memory.labQueue.amount-Game.getObjectById(b.memory.labQueue.sourceLabs[1]).mineralAmount,c.push(new a(b.memory.labQueue.sourceLabs[1],d))));return c};a.getStorageTasks=
function(b){var d=b.storage,c,e;if(d&&d.my&&(!b.terminal||!b.terminal.my))return[new a(d.id)];if(d&&d.my&&_.sum(c=d.store)<d.storeCapacity&&Memory.reserveMinerals)return e={},_.forEach(_.keys(Memory.reserveMinerals),function(a){var b=(a.startsWith("X")&&5===a.length?Memory.reserveMinerals[a]-5E3:Memory.reserveMinerals[a])-(c[a]||0);0<b&&(e[a]=b)}),[new a(d.id,e)]};a.getTerminalTasks=function(b){return b.terminal&&b.terminal.my&&_.sum(b.terminal.store)<b.terminal.storeCapacity?[new a(b.terminal.id)]:
[]};a.getNukerTasks=function(b){b=g.nukersInRoom(b);var d;if(0===b.length)return[];d={};d[RESOURCE_GHODIUM]=b[0].ghodiumCapacity-b[0].ghodium;return 0>=d[RESOURCE_GHODIUM]?[]:[new a(b[0].id,d)]};a.getPowerSpawnTasks=function(b){b=g.powerSpawnsInRoom(b);var d;if(0===b.length)return[];d={};d[RESOURCE_POWER]=b[0].powerCapacity-b[0].power;return 0>=d[RESOURCE_POWER]?[]:[new a(b[0].id,d)]};Memory.profiling&&c(1,43).registerObject(a,"TaskFillMinerals");m.exports=a;return m.exports};r[44]=function(m,f){var g=
c(3,44),p=c(56,44),e=function(a,b){this.type="harvest";this.failIn=a||10;this.source=b};e.prototype.canAssign=function(a){var b=Game.getObjectById(a.memory.homeSource);if(a.spawning||150>a.ticksToLive||_.sum(a.carry)===a.carryCapacity||!b||0===a.getActiveBodyparts(WORK)||0===b.energy&&(b=a.room.find(FIND_SOURCES_ACTIVE)[0],!b))return!1;this.source=b.id;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){var b=Game.getObjectById(this.source||a.memory.homeSource);150>a.ticksToLive||
_.sum(a.carry)===a.carryCapacity||!b||0===b.energy||0===a.getActiveBodyparts(WORK)?delete a.memory.currentTask:(p.moveTo(a,b,1),a.harvest(b)!==OK&&(this.failIn--,0===this.failIn&&delete a.memory.currentTask))};e.prototype.toObj=function(a){a.memory.currentTask={type:this.type,failIn:this.failIn,source:this.source}};e.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.source))return new e(a.memory.currentTask.failIn,a.memory.currentTask.source)};Memory.profiling&&c(1,44).registerObject(e,
"TaskHarvest");m.exports=e;return m.exports};r[45]=function(m,f){var g=c(3,45),p=c(56,45),e=function(a){this.type="heal";this.id=a;this.ally=Game.getObjectById(a);this.unimportant=!0};e.prototype.canAssign=function(a,b){if(a.spawning||0===a.getActiveBodyparts(HEAL))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){var b=this.ally;a.hits<a.hitsMax&&a.heal(a);if(!b)return delete a.memory.currentTask,!0;p.moveTo(a,b);b.hits!==b.hitsMax&&a.id!==b.id&&(1>=a.pos.getRangeTo(b)?
a.heal(b):3>=a.pos.getRangeTo(b)&&a.rangedHeal(b))};e.prototype.toObj=function(a){this.ally?a.memory.currentTask={type:this.type,id:this.ally.id,unimportant:this.unimportant}:delete a.memory.currentTask};e.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new e(a.memory.currentTask.id)};e.getTasks=function(a){return _.map(_.filter(a.find(FIND_MY_CREEPS),function(a){return a.hits<a.hitsMax}).sort(function(a,d){return a.hits-d.hits}),function(a){return new e(a.id)})};e.getDefenderTask=
function(a){return _.map(_.filter(a.room.find(FIND_MY_CREEPS),function(b){return b.hits<b.hitsMax&&b.id!==a.id}).sort(function(a,d){return a.hits-d.hits}),function(a){return new e(a.id)})[0]};Memory.profiling&&c(1,45).registerObject(e,"TaskHeal");m.exports=e;return m.exports};r[46]=function(m,f){var g=c(3,46),p=c(56,46),e=function(a){this.type="meleeAttack";this.id=a;this.enemy=Game.getObjectById(a)};e.prototype.canAssign=function(a){if(a.spawning||0===a.getActiveBodyparts(ATTACK))return!1;g.creepTasks[a.name]=
this;this.toObj(a);return!0};e.prototype.run=function(a){this.enemy?0===a.getActiveBodyparts(ATTACK)?(a.say("Help!"),delete a.memory.currentTask):(p.moveTo(a,this.enemy),a.attack(this.enemy)===ERR_NOT_IN_RANGE&&a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a),0<a.getActiveBodyparts(RANGED_ATTACK)&&a.rangedAttack(this.enemy)):(a.say("Get Rekt!",!0),delete a.memory.currentTask)};e.prototype.toObj=function(a){this.enemy?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};
e.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new e(a.memory.currentTask.id)};e.getTasks=function(a){return _.map(g.hostilesInRoom(a).sort(function(a,d){return a.hits-d.hits}),function(a){return new e(a.id)})};Memory.profiling&&c(1,46).registerObject(e,"TaskMeleeAttack");m.exports=e;return m.exports};r[47]=function(m,f){var g=c(3,47),p=c(56,47),e=c(9,47),a=function(a){this.type="mine";this.id=a;this.source=Game.getObjectById(a);this.force=!0};a.prototype.canAssign=function(a){var b=
Game.getObjectById(a.memory.container);if(a.spawning||!b||0===a.getActiveBodyparts(WORK))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){var b=Game.getObjectById(a.memory.container),c;b?(b.pos.x===a.pos.x&&b.pos.y===a.pos.y&&b.pos.roomName===a.pos.roomName||p.moveTo(a,b,0),b.pos.x===a.pos.x&&b.pos.y===a.pos.y&&b.pos.roomName===a.pos.roomName&&(this.source?c=this.source:(c=Memory.containerSource[a.memory.container]?Game.getObjectById(Memory.containerSource[a.memory.container]):
e.objectsClosestToObj([].concat.apply([],[b.room.find(FIND_SOURCES),b.room.find(FIND_MINERALS)]),a)[0],this.id=c.id),c instanceof Mineral&&0===c.mineralAmount&&(a.say(":(",!0),a.suicide()),c instanceof Mineral&&1500<=_.sum(b.store)||(a.harvest(c),0<_.filter([].concat.apply([],[g.creeps[a.room.name]&&g.creeps[a.room.name].miner||[],g.creeps[a.room.name]&&g.creeps[a.room.name].remoteMiner||[]]),function(b){return b.room.name===a.room.name&&b.memory.container===a.memory.container&&1===b.pos.getRangeTo(a)&&
b.ticksToLive>a.ticksToLive&&0===b.fatigue}).length&&(a.say(":(",!0),a.suicide())))):delete a.memory.currentTask};a.prototype.toObj=function(a){a.memory.currentTask={type:this.type,id:this.id}};a.fromObj=function(b){if(!b.memory.currentTask.id||Game.getObjectById(b.memory.currentTask.id))return new a(b.memory.currentTask.id)};Memory.profiling&&c(1,47).registerObject(a,"TaskMine");m.exports=a;return m.exports};r[48]=function(m,f){var g=c(3,48),p=c(38,48),e=c(9,48),a=c(56,48),b=function(a){this.type=
"pickupResource";this.id=a;this.resource=Game.getObjectById(a);this.force=!0};b.prototype.canAssign=function(a){if(a.spawning||150>a.ticksToLive||!this.resource||_.sum(a.carry)===a.carryCapacity||this.resource.amount<a.pos.getRangeTo(this.resource)||this.resource.resourceType===RESOURCE_ENERGY&&50>this.resource.amount||this.resource.room.controller&&-1!==Memory.allies.indexOf(e.getControllerOwner(this.resource.room.controller)))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};b.prototype.run=
function(b){if(this.resource&&_.sum(b.carry)!==b.carryCapacity){if(a.moveTo(b,this.resource,1),b.pickup(this.resource)===OK){delete b.memory.currentTask;var c=_.filter(b.room.lookForAt(LOOK_STRUCTURES,this.resource),function(a){return a.structureType===STRUCTURE_CONTAINER&&a.store[RESOURCE_ENERGY]});0<c.length&&(new p(c[0].id)).canAssign(b)}}else delete b.memory.currentTask};b.prototype.toObj=function(a){this.resource?a.memory.currentTask={type:this.type,id:this.resource.id}:delete a.memory.currentTask};
b.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new b(a.memory.currentTask.id)};b.getTasks=function(a){return _.map(g.resourcesInRoom(a),function(a){return new b(a.id)})};b.getCollectorTasks=function(a){return _.map(_.filter(g.resourcesInRoom(a),function(a){return a.resourceType===RESOURCE_ENERGY}),function(a){return new b(a.id)})};Memory.profiling&&c(1,48).registerObject(b,"TaskPickupResource");m.exports=b;return m.exports};r[49]=function(m,f){var g=c(3,49),p=c(56,49),
e=function(a,b){this.type="rally";this.id=a;this.creep=b;a instanceof RoomPosition?this.rallyPoint=new RoomPosition(a.x,a.y,a.roomName):(this.rallyPoint=Game.getObjectById(a),this.rallyPoint||(this.rallyPoint=new RoomPosition(25,25,a),this.range=5));this.unimportant=!0};e.prototype.canAssign=function(a){if(a.spawning)return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=function(a){var b=this.rallyPoint,c;b?(c=a.room.name===b.roomName||!(b instanceof RoomPosition)||b.pos&&a.room.name===
b.pos.roomName?this.range||0:20,a.pos.getRangeTo(b)<=c?0===a.pos.x?a.move(RIGHT):49===a.pos.x?a.move(LEFT):0===a.pos.y?a.move(BOTTOM):49===a.pos.y?a.move(TOP):0<_.filter(a.pos.lookFor(LOOK_STRUCTURES),function(a){return a.structureType===STRUCTURE_ROAD||a.structureType===STRUCTURE_CONTAINER}).length&&a.move(Math.floor(8*Math.random())):p.moveTo(a,b,c),0<a.getActiveBodyparts(HEAL)&&(this.heal?a.heal(Game.getObjectById(this.heal)):this.rangedHeal?a.rangedHeal(Game.getObjectById(this.rangedHeal)):a.hits<
a.hitsMax&&a.heal(a)),0<a.getActiveBodyparts(ATTACK)&&this.attack&&a.attack(Game.getObjectById(this.attack)),0<a.getActiveBodyparts(RANGED_ATTACK)&&(this.rangedAttack?a.rangedAttack(Game.getObjectById(this.rangedAttack)):a.rangedMassAttack())):delete a.memory.currentTask};e.prototype.toObj=function(a){this.rallyPoint?a.memory.currentTask={type:this.type,id:this.id,unimportant:this.unimportant,range:this.range}:delete a.memory.currentTask};e.fromObj=function(a){var b;if(b=a.memory.currentTask.id.roomName?
new e(new RoomPosition(a.memory.currentTask.id.x,a.memory.currentTask.id.y,a.memory.currentTask.id.roomName)):new e(a.memory.currentTask.id),a.memory.currentTask.range)b.range=a.memory.currentTask.range;return b};e.getHarvesterTasks=function(a){return _.map(_.filter(a,function(a){return!a.spawning&&150<=a.ticksToLive&&a.memory.homeSource}),function(a){return new e(a.memory.homeSource,a)})};e.getDefenderTask=function(a){var b=g.sourceKeepersInRoom(a.room).sort(function(a,b){return a.ticksToSpawn-b.ticksToSpawn})[0];
return b&&a.room.name===a.memory.home?new e(b.id,a):new e(a.memory.home,a)};e.getClaimerTask=function(a){return new e(a.memory.claim,a)};Memory.profiling&&c(1,49).registerObject(e,"TaskRally");m.exports=e;return m.exports};r[50]=function(m,f){var g=c(3,50),p=c(56,50),e=function(a){this.type="rangedAttack";this.id=a;this.enemy=Game.getObjectById(a)};e.prototype.canAssign=function(a){if(a.spawning||0===a.getActiveBodyparts(RANGED_ATTACK))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};e.prototype.run=
function(a){this.enemy?0===a.getActiveBodyparts(RANGED_ATTACK)?(a.say("Help!"),delete a.memory.currentTask):0<a.getActiveBodyparts(ATTACK)?(p.moveTo(a,this.enemy),a.attack(this.enemy)===ERR_NOT_IN_RANGE&&a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a),0<a.getActiveBodyparts(RANGED_ATTACK)&&a.rangedAttack(this.enemy)):(p.moveTo(a,this.enemy,3),a.rangedAttack(this.enemy),a.hits<a.hitsMax&&0<a.getActiveBodyparts(HEAL)&&a.heal(a)):(a.say("Get Rekt!",!0),delete a.memory.currentTask)};e.prototype.toObj=
function(a){this.enemy?a.memory.currentTask={type:this.type,id:this.id}:delete a.memory.currentTask};e.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new e(a.memory.currentTask.id)};e.getTasks=function(a){return _.map(g.hostilesInRoom(a).sort(function(a,c){return a.hits-c.hits}),function(a){return new e(a.id)})};Memory.profiling&&c(1,50).registerObject(e,"TaskRangedAttack");m.exports=e;return m.exports};r[51]=function(m,f){var g=c(3,51),p=c(56,51),e=function(a){this.type=
"repair";this.id=a;this.structure=Game.getObjectById(a);this.force=!0};e.prototype.canAssign=function(a){if(a.spawning||!a.carry[RESOURCE_ENERGY]||0===a.carry[RESOURCE_ENERGY]||0===a.getActiveBodyparts(WORK)||1E6<=this.structure.hits&&"worker"===a.memory.role&&a.room.name===a.memory.home&&8>a.room.controller.level&&!_.find(a.body,function(a){return a.type===WORK&&-1!==[RESOURCE_CATALYZED_LEMERGIUM_ACID,RESOURCE_LEMERGIUM_ACID,RESOURCE_LEMERGIUM_HYDRIDE].indexOf(a.boost)}))return!1;g.creepTasks[a.name]=
this;this.toObj(a);return!0};e.prototype.run=function(a){var b=this.structure;a.carry[RESOURCE_ENERGY]&&b&&b.hits!==b.hitsMax&&0!==a.getActiveBodyparts(WORK)?(p.moveTo(a,b,Math.max(Math.min(a.pos.getRangeTo(b)-1,3),1)),a.repair(b)===OK&&100*Math.min(a.getActiveBodyparts(WORK),a.carry[RESOURCE_ENERGY])>=b.hitsMax-b.hits&&delete a.memory.currentTask):delete a.memory.currentTask};e.prototype.toObj=function(a){this.structure?a.memory.currentTask={type:this.type,id:this.structure.id}:delete a.memory.currentTask};
e.fromObj=function(a){if(Game.getObjectById(a.memory.currentTask.id))return new e(a.memory.currentTask.id)};e.getTowerTasks=function(a){return _.map(_.take(_.filter(g.sortedRepairableStructuresInRoom(a),function(a){return 1E4>a.hits&&.25>a.hits/a.hitsMax}),5),function(a){return new e(a.id)})};e.getCriticalTasks=function(a){return _.map(_.take(_.filter(g.sortedRepairableStructuresInRoom(a),function(a){return 125E3>a.hits&&.5>a.hits/a.hitsMax}),5),function(a){return new e(a.id)})};e.getTasks=function(a){return _.map(_.take(_.filter(g.sortedRepairableStructuresInRoom(a),
function(a){return.9>a.hits/a.hitsMax||1E5<a.hitsMax-a.hits}),5),function(a){return new e(a.id)})};Memory.profiling&&c(1,51).registerObject(e,"TaskRepair");m.exports=e;return m.exports};r[52]=function(m,f){var g=c(3,52),p=c(56,52),e=function(a){this.type="reserve";this.force=!0};e.prototype.canAssign=function(a){if(a.spawning||0===a.getActiveBodyparts(CLAIM)||!Game.rooms[a.memory.home]||!Game.rooms[a.memory.home].controller||Game.rooms[a.memory.home].controller.my)return!1;g.creepTasks[a.name]=this;
this.toObj(a);return!0};e.prototype.run=function(a){a.say("You;spin;me;right;round;baby;right;round;like a;record;baby;right;round;round;round;".split(";")[Game.time%16],!0);Game.rooms[a.memory.home]&&Game.rooms[a.memory.home].controller&&!Game.rooms[a.memory.home].controller.my&&0!==a.getActiveBodyparts(CLAIM)?(p.moveTo(a,Game.rooms[a.memory.home].controller,1),a.reserveController(Game.rooms[a.memory.home].controller),!Memory.signs||!Memory.signs[a.room.name]||a.room.controller.sign&&"roncli"===
a.room.controller.sign.username||a.signController(a.room.controller,Memory.signs[a.room.name])):delete a.memory.currentTask};e.prototype.toObj=function(a){a.memory.currentTask={type:this.type}};e.fromObj=function(a){return new e};e.getTask=function(a){if(a.room.controller)return new e};e.getRemoteTask=function(a){if(Game.rooms[a.memory.home]&&Game.rooms[a.memory.home].controller)return new e};Memory.profiling&&c(1,52).registerObject(e,"TaskReserve");m.exports=e;return m.exports};r[53]=function(m,
f){var g=c(3,53),p=c(56,53),e=c(9,53),a=function(a){this.type="upgradeController";this.room=a;this.controller=Game.rooms[a].controller;this.force=!0};a.prototype.canAssign=function(a){if(a.spawning||!a.carry[RESOURCE_ENERGY]||"upgrader"!==a.memory.role&&_.sum(a.carry)!==a.carryCapacity&&150<=a.ticksToLive&&1E3<=this.controller.ticksToDowngrade||0===a.getActiveBodyparts(WORK))return!1;g.creepTasks[a.name]=this;this.toObj(a);return!0};a.prototype.run=function(a){a.say("I've;got to;celebrate;you baby;I've got;to praise;GCL like;I should!;".split(";")[Game.time%
9],!0);if(this.controller&&a.carry[RESOURCE_ENERGY]&&0!==a.getActiveBodyparts(WORK)){if("upgrader"===a.memory.role){var b=e.objectsClosestToObj(g.linksInRoom(a.room),a);0<b.length&&0<b[0].energy&&1>=a.pos.getRangeTo(b[0])&&a.withdraw(b[0],RESOURCE_ENERGY)}p.moveTo(a,this.controller,Math.max(Math.min(a.pos.getRangeTo(this.controller)-1,3),1));a.transfer(this.controller,RESOURCE_ENERGY);!Memory.signs||!Memory.signs[a.room.name]||this.controller.sign&&"roncli"===this.controller.sign.username||a.signController(this.controller,
Memory.signs[a.room.name]);a.carry[RESOURCE_ENERGY]<=a.getActiveBodyparts(WORK)&&delete a.memory.currentTask}else delete a.memory.currentTask};a.prototype.toObj=function(a){a.memory.currentTask={type:this.type,room:this.room}};a.fromObj=function(b){return new a(b.memory.currentTask.room)};a.getCriticalTasks=function(b){var c;if(b.controller&&b.controller.my){switch(b.controller.level){case 1:c=1E4;break;case 2:c=3500;break;case 3:c=5E3;break;case 4:c=1E4;break;case 5:c=2E4;break;case 6:c=3E4;break;
case 7:c=5E4;break;case 8:c=1E5}if(b.controller.ticksToDowngrade<c)return[new a(b.name)]}return[]};a.getTasks=function(b){if(b.controller&&b.controller.my)return[new a(b.name)]};Memory.profiling&&c(1,53).registerObject(a,"TaskUpgradeController");m.exports=a;return m.exports};r[54]=function(m,f){var g=c(3,54),p=c(9,54),e=c(46,54),a=c(40,54),b=c(45,54),d=c(49,54),k=c(50,54);f=function(){};f.attack=function(a,b,c){var f;b&&0!==b.length&&_.forEach(a,function(a){var h;f=b[0];if(1>=a.pos.getRangeTo(f))h=
new e(f.id);else{var g=_.filter(b,function(b){return 1>=a.pos.getRangeTo(b)});h=new d(f.id);0<g.length&&(h.attack=g[0].id)}h.canAssign(a)&&(a.memory.currentTask.priority=Game.time,a.say(c))})};f.dismantleArmyTarget=function(b,c,d,e){if(Game.rooms[c]&&d&&0<d.length){var f=new a(d[0]);_.forEach(b,function(a){f.canAssign(a)&&a.say(e)})}};f.dismantleHostileStructures=function(b,c,d){if(c=Game.rooms[c])if(c=_.filter(c.find(FIND_HOSTILE_STRUCTURES),function(a){return-1===[STRUCTURE_CONTROLLER,STRUCTURE_RAMPART,
STRUCTURE_KEEPER_LAIR].indexOf(a.structureType)}),0<c.length){var e=new a(c[0].id);_.forEach(b,function(a){e.canAssign(a)&&a.say(d)})}};f.escort=function(a,c){_.forEach(_.filter(a,function(a){return!a.spawning&&a.memory.escorting}),function(a){var e=Game.getObjectById(a.memory.escorting);e?0===e.hitsMax-e.hits||e.hits/e.hitsMax>a.hits/a.hitsMax||!(new b(e.id)).canAssign(a)?(new d(e.id)).canAssign(a):a.say(c):delete a.memory.escorting})};f.getBoost=function(a,b){_.forEach(_.filter(a,function(a){return a.memory.labs&&
0<a.memory.labs.length}),function(a){(new d(a.memory.labs[0])).canAssign(a)&&(a.memory.currentTask.priority=Game.time,a.say(b))})};f.heal=function(a,c,e){var f;c&&0!==c.length&&_.forEach(a,function(a){var g;f=c[0];if(a.id===f.id&&2<=c.length)g=new d(c[1].id);else if(3>=a.pos.getRangeTo(f))g=new b(f.id);else{var h;g=new d(f.id);a.hits===a.hitsMax&&(h=_.filter(c,function(b){return 1>=a.pos.getRangeTo(b)}),0<h.length?g.heal=h[0].id:(h=_.filter(c,function(b){return 3>=a.pos.getRangeTo(b)}),0<h.length&&
(g.rangedHeal=h[0].id)))}g.canAssign(a)&&(a.memory.currentTask.priority=Game.time,a.say(e))})};f.moveToPos=function(a,b,c,e){var f=new d(b);c&&(f.range=c);_.forEach(a,function(a){f.canAssign(a)&&a.say(e)})};f.moveToRoom=function(a,b,c){_.forEach(a,function(a){var e=a.memory.portals;a.memory.portaling&&e[0]!==a.room.name&&e.shift();e&&0<e.length?e[0]===a.room.name?(a.memory.portaling=!0,e=new d(g.portalsInRoom(a.room)[0].id)):e=new d(e[0]):e=new d(b);e.canAssign(a)&&a.say(c)})};f.rangedAttack=function(a,
b,c){var e;b&&0!==b.length&&_.forEach(a,function(a){var f;e=b[0];if(1>=a.pos.getRangeTo(e))f=new k(e.id);else{var g=_.filter(b,function(b){return 3>=a.pos.getRangeTo(b)});f=new d(e.id);0<g.length&&(f.rangedAttack=g[0].id)}f.canAssign(a)&&(a.memory.currentTask.priority=Game.time,a.say(c))})};f.retreatArmyUnit=function(a,b,c,e,f,g){if(b&&0!==b.length&&c!==e){var h=new d(c);_.forEach(_.filter(a,function(a){return(a.room.name===e||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&a.hits/a.hitsMax<f}),
function(a){h.canAssign(a)&&(a.memory.currentTask.priority=Game.time,a.say(g))})}};f.retreatArmyUnitOrMoveToHealer=function(a,b,c,e,f,g){var h;if(b&&0!==b.length){if(c!==e){var k=new d(c);_.forEach(_.filter(a,function(a){return(a.room.name===e||1>=a.pos.x||48<=a.pos.x||1>=a.pos.y||48<=a.pos.y)&&a.hits/a.hitsMax<f}),function(a){k.canAssign(a)&&(a.memory.currentTask.priority=Game.time,a.say(g))})}h=_.filter(b,function(a){return!a.memory.escorting});0<h.length&&_.forEach(a,function(a){var b=p.objectsClosestToObj(h,
a);2<b[0].pos.getRangeTo(a)&&(b=new d(b[0].id),b.canAssign(a)&&(a.memory.currentTask.priority=Game.time))})}};f.stomp=function(a,b,c){b&&0!==b.length&&_.forEach(a,function(a){(new d(p.objectsClosestToObj(b,a)[0])).canAssign(a)&&(a.memory.currentTask.priority=Game.time,a.say(c))})};f.tasks=function(a,b,c,d){_.forEach(b,function(b){_.forEach(a,function(a){b.canAssign(a)&&a.say(d);return c})})};Memory.profiling&&c(1,54).registerObject(f,"Assign");m.exports=f;return m.exports};r[55]=function(m,f){var g=
c(3,55),p=c(9,55);f=function(){};f.prototype.checkSpawn=function(c,a){var b=this.room,d=b.name,e=g.log.rooms[d],f=g.creeps[d],m=!1,l,n,r;void 0===a&&(a=!0);a=c.checkSpawnSettings(this,a);f=f&&f[a.name]?f[a.name].length:0;e&&(0<a.max||0<f)&&e.creeps.push({role:a.name,count:f,max:a.max});if(a.spawn&&(e=a.supportRoom||(b.memory.roomType&&b.memory.roomType.supportRoom?b.memory.roomType.supportRoom:d),f=Game.rooms[e],a.home=a.roomToSpawnFor||d,a.supportRoom=e,a.energyCapacityAvailable=f.energyCapacityAvailable,
l=c.spawnSettings(a),l.boosts&&f&&0<g.labsInRoom(f).length&&(m=!!(n=p.getLabToBoostWith(f,Object.keys(l.boosts).length))),c=a.spawnFromRegion?_.filter(Game.spawns,function(a){return!g.spawning[a.id]&&!a.spawning&&a.room.memory.region===b.memory.region&&a.room.energyAvailable>=p.getBodypartCost(l.body)}).sort(function(a,b){return(a.room.name===d?0:1)-(b.room.name===d?0:1)})[0]:_.filter(Game.spawns,function(a){return!g.spawning[a.id]&&!a.spawning&&a.room.name===d&&a.room.energyAvailable>=p.getBodypartCost(l.body)})[0])&&
(l.memory.labs=m?_.map(n,function(a){return a.id}):[],r=c.createCreep(l.body,a.name+"-"+(a.roomToSpawnFor||d)+"-"+Game.time.toFixed(0).substring(4),l.memory),g.spawning[c.id]="number"!==typeof r,m&&"number"!==typeof r)){var q=0,t=f.memory.labsInUse;_.forEach(l.boosts,function(a,b){n[q].creepToBoost=r;n[q].resource=b;n[q].amount=30*a;t.push(n[q]);q++});g.creeps[e]&&_.forEach(_.filter(g.creeps[e].all,function(a){return a.memory.currentTask&&"fillMinerals"===a.memory.currentTask.type&&-1!==_.map(n,function(a){return a.id}).indexOf(a.memory.currentTask.id)}),
function(a){delete a.memory.currentTask})}};Memory.profiling&&c(1,55).registerObject(f,"RoomEngine");m.exports=f;return m.exports};r[56]=function(m,f){var g={1:{dx:0,dy:-1},2:{dx:1,dy:-1},3:{dx:1,dy:0},4:{dx:1,dy:1},5:{dx:0,dy:1},6:{dx:-1,dy:1},7:{dx:-1,dy:0},8:{dx:-1,dy:-1}},p=c(3,56);f=function(){};f.moveTo=function(c,a,b){var d=c.memory,e=d._pathing,f=[],m=c.pos,l=m.x,n=m.y,r=m.roomName,q=Game.time,t,v,y,C,D,E;a instanceof RoomObject&&(a=a.pos);b||(b=0);if(!(m.getRangeTo(a)<=b)){t=a.x;v=a.y;y=
a.roomName;!e||e.dest.x===t&&e.dest.y===v&&e.dest.room===y||(delete d._pathing,e=void 0);e&&e.restartOn&&-1!==e.restartOn.indexOf(r)&&(delete e.path,delete e.restartOn);e&&((C=l===e.start.x&&n===e.start.y&&r===e.start.room||(49===Math.abs(l-e.start.x)||49===Math.abs(n-e.start.y))&&r!==e.start.room,e.stationary=C?e.stationary+1:0,2<=e.stationary)?(e.path&&0<e.path.length&&(C=g[+e.path[0]],C={x:l+C.dx,y:n+C.dy,room:r,blockedUntil:q+12},C.x!==l||C.y!==n)&&(e.blocked||(e.blocked=[]),e.blocked.push(C)),
e.stationary=0,delete e.path,delete e.restartOn):e.path&&!C&&(1===e.path.length?(delete d._pathing,e=void 0):(e.start={x:l,y:n,room:r},e.path=e.path.substring(1))));if(!e||!e.path){E=c.getActiveBodyparts(MOVE);C=Memory.paths;var F;D=1+(_.filter(c.body,function(a){return 0<a.hits&&-1===[MOVE,CARRY].indexOf(a.type)}).length+Math.ceil(_.sum(c.carry)/50)-E)/E;e&&e.blocked&&_.remove(e.blocked,function(a){return a.blockedUntil<=q});E=r+"."+l+"."+n+"."+y+"."+t+"."+v+"."+b+"."+(1>=D?0:1);F=C[E];if(e&&0!==
e.blocked.length||!F){a=PathFinder.search(m,{pos:a,range:b},{plainCost:Math.ceil(1*D),swampCost:Math.ceil(5*D),maxOps:r===y?2E3:1E5,roomCallback:function(a){var b=Game.rooms[a],c;if(r!==a&&(-1!==Memory.avoidRooms.indexOf(a)||r===y&&a!==y&&!d.role.startsWith("remote")&&!d.role.startsWith("army")))return!1;if(b)return c=p.costMatrixForRoom(b),e&&a===r&&_.forEach(e.blocked,function(b){a===b.room&&q<b.blockedUntil&&c.set(b.x,b.y,255)}),c;f.push(a)}});if(!a.path||0===a.path.length)return;e?(e.path=this.serializePath(m,
a.path),e.restartOn=f):e={start:{x:l,y:n,room:r},dest:{x:t,y:v,room:y},path:this.serializePath(m,a.path),stationary:0,blocked:[],restartOn:f};0===e.blocked.length&&10<e.path.length&&(C[E]=[this.encodePath(e.path),[],q,q],f&&0<f.length&&(C[E][1]=f))}else e?(e.path=this.decodePath(F[0]),e.restartOn=F[1]):e={start:{x:l,y:n,room:r},dest:{x:t,y:v,room:y},path:this.decodePath(F[0]),stationary:0,blocked:[],restartOn:F[1]},F[3]=q}c.move(+e.path[0])!==OK&&--e.stationary;d._pathing=e}};f.serializePath=function(c,
a){return _.map(a,function(b,d){d=0===d?c:a[d-1];switch(b.x-d.x){case 0:case -49:case 49:switch(b.y-d.y){case 0:case -49:case 49:return"";case 1:case -48:return BOTTOM.toString();case -1:case 48:return TOP.toString()}break;case 1:case -48:switch(b.y-d.y){case 0:case -49:case 49:return RIGHT.toString();case 1:case -48:return BOTTOM_RIGHT.toString();case -1:case 48:return TOP_RIGHT.toString()}break;case -1:case 48:switch(b.y-d.y){case 0:case -49:case 49:return LEFT.toString();case 1:case -48:return BOTTOM_LEFT.toString();
case -1:case 48:return TOP_LEFT.toString()}}}).join("")};f.encodePath=function(c){var a=[],b;for(b=0;b<c.length;b+=2)b===c.length-1?a.push(c.charCodeAt(b)-17):a.push(8*(c.charCodeAt(b)-49)+(c.charCodeAt(b+1)-49)+40);return String.fromCharCode.apply(String,[].concat($jscomp.arrayFromIterable(a)))};f.decodePath=function(c){var a=[],b;for(b=0;b<c.length;b++){var d=c.charCodeAt(b);40>d?a.push(d+17):(a.push(Math.floor((d-40)/8)+49),a.push((d-40)%8+49))}return String.fromCharCode.apply(String,[].concat($jscomp.arrayFromIterable(a)))};
Memory.profiling&&c(1,56).registerObject(f,"Pathing");m.exports=f;return m.exports};if("object"===typeof module)module.exports=c(0);else return c(0)})();