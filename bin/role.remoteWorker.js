var $jscomp={scope:{},findInternal:function(c,e,f){c instanceof String&&(c=String(c));for(var b=c.length,d=0;d<b;d++){var a=c[d];if(e.call(f,a,d,c))return{i:d,v:a}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,e,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[e]=f.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,e,f,b){if(e){f=$jscomp.global;c=c.split(".");for(b=0;b<c.length-1;b++){var d=c[b];d in f||(f[d]={});f=f[d]}c=c[c.length-1];b=f[c];e=e(b);e!=b&&null!=e&&$jscomp.defineProperty(f,c,{configurable:!0,writable:!0,value:e})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,f){return $jscomp.findInternal(this,c,f).v}},"es6-impl","es3");
var Cache=require("cache"),Utilities=require("utilities"),TaskBuild=require("task.build"),TaskCollectEnergy=require("task.collectEnergy"),TaskHarvest=require("task.harvest"),TaskPickupResource=require("task.pickupResource"),TaskRally=require("task.rally"),TaskRepair=require("task.repair"),Worker={checkSpawn:function(c){var e=c.name,f=Game.rooms[Memory.rooms[e].roomType.supportRoom],b=f.name,d=Cache.containersInRoom(c),a=Cache.creeps[e]&&Cache.creeps[e].remoteWorker||[],h=0;0===Cache.spawnsInRoom(f).length||
c.unobservable||0===d.length||(_.forEach(d,function(d){var k=Utilities.objectsClosestToObj([].concat.apply([],[c.find(FIND_SOURCES),c.find(FIND_MINERALS)]),d)[0],e=d.id;if(!(k instanceof Mineral))return h+=1,0===_.filter(a,function(a){return(a.spawning||a.ticksToLive>=150+2*(Memory.lengthToContainer&&Memory.lengthToContainer[e]&&Memory.lengthToContainer[e][b]?Memory.lengthToContainer[e][b]:0))&&a.memory.container===e}).length&&Worker.spawn(c,f,e),!1}),Memory.log&&(0<a.length||0<h)&&Cache.log.rooms[e].creeps.push({role:"remoteWorker",
count:a.length,max:h}))},spawn:function(c,e,f){var b=[];c=c.name;var d=e.name,a,h,k,l,g;if(0===_.filter(Game.spawns,function(a){return!a.spawning&&!Cache.spawning[a.id]}).length)return!1;a=Math.min(e.energyCapacityAvailable,2750);h=Math.floor(a/200);k=Math.floor((a-1E3)/150);l=a%200;for(g=0;g<h&&5>g;g++)b.push(WORK);1E3>a&&150<=l&&b.push(WORK);for(g=0;g<h&&5>g;g++)b.push(CARRY);for(g=0;g<k;g++)b.push(CARRY),b.push(CARRY);1E3>a&&100<=l&&150>l&&b.push(CARRY);1E3<a&&100<=(a-1E3)%150&&b.push(CARRY);for(g=
0;g<h&&5>g;g++)b.push(MOVE);for(g=0;g<k;g++)b.push(MOVE);1E3>a&&50<=l&&b.push(MOVE);1E3<a&&50<=(a-1E3)%150&&b.push(MOVE);a=_.filter(Game.spawns,function(a){return!a.spawning&&!Cache.spawning[a.id]&&a.room.energyAvailable>=Utilities.getBodypartCost(b)&&a.room.memory.region===e.memory.region}).sort(function(a,b){return(a.room.name===d?0:1)-(b.room.name===d?0:1)})[0];if(!a)return!1;f=a.createCreep(b,"remoteWorker-"+c+"-"+Game.time.toFixed(0).substring(4),{role:"remoteWorker",home:c,supportRoom:d,container:f});
a.room.name===d&&(Cache.spawning[a.id]="number"!==typeof f);return"number"!==typeof f},assignTasks:function(c,e){var f=c.name,b=_.filter(Utilities.creepsWithNoTask(Cache.creeps[f]&&Cache.creeps[f].remoteWorker||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),d=[];0!==b.length&&(_.forEach(b,function(a){var b=_.filter(a.room.find(FIND_MY_CONSTRUCTION_SITES),function(a){return 1===a.progressTotal});0<b.length&&(new TaskBuild(b[0].id)).canAssign(a)&&(a.say("Build"),d.push(a.name))}),
_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&(_.forEach(b,function(a){_.forEach(TaskRepair.getCriticalTasks(a.room),function(b){if(0===_.filter(b.structure.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"repair"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length&&b.canAssign(a))return a.say("CritRepair"),d.push(a.name),!1})}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&(_.forEach(b,function(a){var b=a.room.find(FIND_MY_CONSTRUCTION_SITES);
0<b.length&&(new TaskBuild(b[0].id)).canAssign(a)&&(a.say("Build"),d.push(a.name))}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&(_.forEach([].concat.apply([],[e.fillEnergy.storageTasks,e.fillEnergy.containerTasks]),function(a){var c=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),
function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<c&&(_.forEach(Utilities.objectsClosestToObj(b,a.object),function(b){if(a.canAssign(b)&&(b.say("Container"),d.push(b.name),c-=b.carry[RESOURCE_ENERGY]||0,0>=c))return!1}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[])}),0!==b.length&&(_.forEach(e.fillMinerals.storageTasks,function(a){_.forEach(b,function(b){a.canAssign(b)&&(b.say("Storage"),d.push(b.name))});_.remove(b,function(a){return-1!==d.indexOf(a.name)});d=[]}),0!==b.length&&
(_.forEach(e.fillMinerals.terminalTasks,function(a){_.forEach(b,function(b){a.canAssign(b)&&(b.say("Terminal"),d.push(b.name))});_.remove(b,function(a){return-1!==d.indexOf(a.name)});d=[]}),0!==b.length&&(_.forEach(b,function(a){a.room.name===c.name&&_.forEach(TaskPickupResource.getTasks(a.room),function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Pickup"),
d.push(a.name),!1})}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&(c.unobservable||_.forEach(b,function(a){(new TaskCollectEnergy(a.memory.container)).canAssign(a)&&(a.say("Collecting"),d.push(a.name))}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&(c.unobservable||_.forEach(b,function(a){var b=new TaskHarvest,e=Utilities.objectsClosestToObj(_.filter(c.find(FIND_SOURCES),function(a){return 0<a.energy}),a);if(0===e.length)return!1;a.memory.homeSource=
e[0].id;b.canAssign(a)&&(a.say("Harvesting"),d.push(a.name))}),_.remove(b,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==b.length&&_.forEach(b,function(a){(new TaskRally(a.memory.home)).canAssign(a)}))))))))))}};require("screeps-profiler").registerObject(Worker,"RoleRemoteWorker");module.exports=Worker;