var Task=require("task"),Pathing=require("pathing"),Dismantle=function(a){this.init(a)};Dismantle.prototype=Object.create(Task.prototype);Dismantle.prototype.constructor=Dismantle;Dismantle.prototype.init=function(a){Task.call(this);this.type="dismantle";this.id=a;this.structure=Game.getObjectById(a);this.force=!0};
Dismantle.prototype.canAssign=function(a){if(a.spawning||0<a.carryCapacity&&_.sum(a.carry)===a.carryCapacity||a.spawning||0===a.getActiveBodyparts(WORK))return!1;Task.prototype.assign.call(this,a);return!0};
Dismantle.prototype.run=function(a){var b=this.structure;_.sum(a.carry)!==a.carryCapacity&&this.structure&&0!==a.getActiveBodyparts(WORK)?(Pathing.moveTo(a,b,1),a.dismantle(b),50*Math.min(a.getActiveBodyparts(WORK),a.carry[RESOURCE_ENERGY])>=b.hits&&Task.prototype.complete.call(this,a)):Task.prototype.complete.call(this,a)};Dismantle.prototype.toObj=function(a){this.structure?a.memory.currentTask={type:this.type,id:this.structure.id}:delete a.memory.currentTask};Dismantle.fromObj=function(a){return new Dismantle(a.memory.currentTask.id)};
Dismantle.getCleanupTasks=function(a){return _.map(a,function(a){return new Dismantle(a.id)})};require("screeps-profiler").registerObject(Dismantle,"TaskDismantle");module.exports=Dismantle;