var $jscomp={scope:{},findInternal:function(e,f,g){e instanceof String&&(e=String(e));for(var c=e.length,k=0;k<c;k++){var d=e[k];if(f.call(g,d,k,e))return{i:k,v:d}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(e,f,g){if(g.get||g.set)throw new TypeError("ES3 does not support getters and setters.");e!=Array.prototype&&e!=Object.prototype&&(e[f]=g.value)};
$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(e,f,g,c){if(f){g=$jscomp.global;e=e.split(".");for(c=0;c<e.length-1;c++){var k=e[c];k in g||(g[k]={});g=g[k]}e=e[e.length-1];c=g[e];f=f(c);f!=c&&null!=f&&$jscomp.defineProperty(g,e,{configurable:!0,writable:!0,value:f})}};
$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(e,g){return $jscomp.findInternal(this,e,g).v}},"es6-impl","es3");
var Cache=require("cache"),Utilities=require("utilities"),TaskPickupResource=require("task.pickupResource"),TaskRally=require("task.rally"),Scientist={checkSpawn:function(e){var f=e.controller,g=e.name,g=Cache.creeps[g]&&Cache.creeps[g].scientist||[];!f||6>f.level||(1>_.filter(g,function(c){return c.spawning||150<=c.ticksToLive}).length&&Scientist.spawn(e),Memory.log&&Cache.log.rooms[e.name].creeps.push({role:"scientist",count:g.length,max:1}))},spawn:function(e){var f=Cache.spawnsInRoom(e),g=[],
c=e.name,k,d,a;if(0===_.filter(f,function(a){return!a.spawning&&!Cache.spawning[a.id]}).length)return!1;k=Math.min(e.energyCapacityAvailable,2500);d=Math.floor(k/150);k%=150;for(a=0;a<d;a++)g.push(CARRY),g.push(CARRY);100<=k&&g.push(CARRY);for(a=0;a<d;a++)g.push(MOVE);50<=k&&g.push(MOVE);d=_.filter(f,function(a){return!a.spawning&&!Cache.spawning[a.id]&&a.room.energyAvailable>=Utilities.getBodypartCost(g)})[0];if(!d)return!1;e=d.createCreep(g,"scientist-"+c+"-"+Game.time.toFixed(0).substring(4),{role:"scientist",
home:c,homeSource:Utilities.objectsClosestToObj(e.find(FIND_SOURCES),f[0])[0].id});Cache.spawning[d.id]="number"!==typeof e;return"number"!==typeof e},assignTasks:function(e,f){var g=e.name,c=_.filter(Utilities.creepsWithNoTask(Cache.creeps[g]&&Cache.creeps[g].scientist||[]),function(a){return 0<_.sum(a.carry)||!a.spawning&&150<a.ticksToLive}),k=Cache.creeps[g]&&Cache.creeps[g].all||[],d=[];0!==c.length&&(_.forEach(f.fillEnergy.towerTasks,function(a){var b=a.object.energyCapacity-a.object.energy-
_.reduce(_.filter(k,function(h){return h.memory.currentTask&&"fillEnergy"===h.memory.currentTask.type&&h.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(Utilities.objectsClosestToObj(c,a.object),function(h){if(a.canAssign(h)&&(h.say("Tower"),d.push(h.name),b-=h.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(c,function(a){return-1!==d.indexOf(a.name)}),d=[])}),0!==c.length&&(_.forEach(f.collectMinerals.labTasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&
(b.say("Collecting"),d.push(b.name))});_.remove(c,function(a){return-1!==d.indexOf(a.name)});d=[]}),0!==c.length&&(_.forEach(f.fillMinerals.labTasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&(b.say("Lab"),d.push(b.name))});_.remove(c,function(a){return-1!==d.indexOf(a.name)});d=[]}),0!==c.length&&(_.forEach(f.fillMinerals.nukerTasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&(b.say("NukeG"),d.push(b.name))});_.remove(c,function(a){return-1!==d.indexOf(a.name)});d=[]}),0!==c.length&&
(_.forEach(f.fillMinerals.powerSpawnTasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&(b.say("powerPower"),d.push(b.name))});_.remove(c,function(a){return-1!==d.indexOf(a.name)});d=[]}),0!==c.length&&(_.forEach(f.fillMinerals.storageTasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&(b.say("Storage"),d.push(b.name))});_.remove(c,function(a){return-1!==d.indexOf(a.name)});d=[]}),0!==c.length&&(_.forEach(f.fillMinerals.terminalTasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&
(b.say("Terminal"),d.push(b.name))});_.remove(c,function(a){return-1!==d.indexOf(a.name)});d=[]}),0!==c.length&&(_.forEach(f.fillEnergy.labTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(k,function(h){return h.memory.currentTask&&"fillEnergy"===h.memory.currentTask.type&&h.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(Utilities.objectsClosestToObj(c,a.object),function(h){if(a.canAssign(h)&&(h.say("LabEnergy"),
d.push(h.name),b-=h.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(c,function(a){return-1!==d.indexOf(a.name)}),d=[])}),0!==c.length&&(f.fillEnergy.terminalTask&&(_.forEach(c,function(a){f.fillEnergy.terminalTask.canAssign(a)&&(a.say("Terminal"),d.push(a.name))}),_.remove(c,function(a){return-1!==d.indexOf(a.name)}),d=[]),0!==c.length&&(_.forEach(f.fillEnergy.nukerTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(k,function(h){return h.memory.currentTask&&"fillEnergy"===
h.memory.currentTask.type&&h.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(Utilities.objectsClosestToObj(c,a.object),function(h){if(a.canAssign(h)&&(h.say("NukeEnergy"),d.push(h.name),b-=h.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(c,function(a){return-1!==d.indexOf(a.name)}),d=[])}),0!==c.length&&(_.forEach(f.fillEnergy.powerSpawnTasks,function(a){var b=a.object.energyCapacity-a.object.energy-_.reduce(_.filter(k,function(b){return b.memory.currentTask&&
"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(Utilities.objectsClosestToObj(c,a.object),function(c){if(a.canAssign(c)&&(c.say("PwrEnergy"),d.push(c.name),b-=c.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(c,function(a){return-1!==d.indexOf(a.name)}),d=[])}),0!==c.length&&(_.forEach(c,function(a){a.carry[RESOURCE_ENERGY]<(8===e.controller.level?200:7===e.controller.level?100:50)||_.forEach(f.fillEnergy.extensionTasks.sort(function(b,
c){return b.object.pos.getRangeTo(a)-c.object.pos.getRangeTo(a)}),function(b){if(0<b.object.energyCapacity-b.object.energy-_.reduce(_.filter(k,function(a){return a.memory.currentTask&&"fillEnergy"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0)&&b.canAssign(a))return a.say("Extension"),d.push(a.name),!1})}),_.remove(c,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==c.length&&(_.forEach(f.fillEnergy.spawnTasks,function(a){var b=
a.object.energyCapacity-a.object.energy-_.reduce(_.filter(k,function(b){return b.memory.currentTask&&"fillEnergy"===b.memory.currentTask.type&&b.memory.currentTask.id===a.id}),function(a,b){return a+(b.carry[RESOURCE_ENERGY]||0)},0);0<b&&(_.forEach(Utilities.objectsClosestToObj(c,a.object),function(c){if(a.canAssign(c)&&(c.say("Spawn"),d.push(c.name),b-=c.carry[RESOURCE_ENERGY]||0,0>=b))return!1}),_.remove(c,function(a){return-1!==d.indexOf(a.name)}),d=[])}),0!==c.length&&(_.forEach(f.fillEnergy.storageTasks,
function(a){var b=a.object.storeCapacity-_.sum(a.object.store)-_.reduce(_.filter(a.object.room.find(FIND_MY_CREEPS),function(b){return b.memory.currentTask&&["fillEnergy","fillMinerals"].indexOf(b.memory.currentTask.type)&&b.memory.currentTask.id===a.id}),function(a,b){return a+_.sum(b.carry)},0);0<b&&(_.forEach(Utilities.objectsClosestToObj(c,a.object),function(c){if(!c.memory.lastCollectEnergyWasStorage&&a.canAssign(c)&&(c.say("Storage"),d.push(c.name),b-=_.sum(c.carry),0>=b))return!1}),_.remove(c,
function(a){return-1!==d.indexOf(a.name)}),d=[])}),0!==c.length&&(_.forEach(f.collectMinerals.terminalTasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&(b.say("Collecting"),d.push(b.name))});_.remove(c,function(a){return-1!==d.indexOf(a.name)});d=[]}),0!==c.length&&(_.forEach(f.collectMinerals.storageTasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&(b.say("Collecting"),d.push(b.name))});_.remove(c,function(a){return-1!==d.indexOf(a.name)});d=[]}),0!==c.length&&(0===Cache.hostilesInRoom(e).length&&
_.forEach(c,function(a){_.forEach(TaskPickupResource.getTasks(a.room),function(b){if(!(0<_.filter(b.resource.room.find(FIND_MY_CREEPS),function(a){return a.memory.currentTask&&"pickupResource"===a.memory.currentTask.type&&a.memory.currentTask.id===b.id}).length)&&b.canAssign(a))return a.say("Pickup"),d.push(a.name),!1})}),_.remove(c,function(a){return-1!==d.indexOf(a.name)}),d=[],0!==c.length&&(f.collectEnergy.terminalTask&&(_.forEach(c,function(a){f.collectEnergy.terminalTask.canAssign(a)&&(a.say("Collecting"),
d.push(a.name))}),_.remove(c,function(a){return-1!==d.indexOf(a.name)}),d=[]),_.forEach(f.collectEnergy.tasks,function(a){_.forEach(c,function(b){a.canAssign(b)&&(b.say("Collecting"),d.push(b.name))});_.remove(c,function(a){return-1!==d.indexOf(a.name)});d=[]}),0!==c.length&&_.forEach(c,function(a){a=new TaskRally(e.terminal.id,a);a.canAssign(a.creep)})))))))))))))))))))}};require("screeps-profiler").registerObject(Scientist,"RoleScientist");module.exports=Scientist;